<html>

<head>
    <meta http-equiv=Content-Type content="text/html; charset=UTF-8">
    <style type="text/css">
        <!-- span.cls_002 {
            font-family: Arial, serif;
            font-size: 10.1px;
            color: rgb(0, 0, 255);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_002 {
            font-family: Arial, serif;
            font-size: 10.1px;
            color: rgb(0, 0, 255);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_003 {
            font-family: Arial, serif;
            font-size: 28.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_003 {
            font-family: Arial, serif;
            font-size: 28.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_004 {
            font-family: Arial, serif;
            font-size: 16.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_004 {
            font-family: Arial, serif;
            font-size: 16.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_005 {
            font-family: Arial, serif;
            font-size: 14.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_005 {
            font-family: Arial, serif;
            font-size: 14.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_006 {
            font-family: "Book Antiqua", serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_006 {
            font-family: "Book Antiqua", serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_007 {
            font-family: Courier New, serif;
            font-size: 9.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_007 {
            font-family: Courier New, serif;
            font-size: 9.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_008 {
            font-family: Arial, serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_008 {
            font-family: Arial, serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_009 {
            font-family: Arial, serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_009 {
            font-family: Arial, serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_010 {
            font-family: "Book Antiqua Bold", serif;
            font-size: 12.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_010 {
            font-family: "Book Antiqua Bold", serif;
            font-size: 12.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_011 {
            font-family: Times, serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_011 {
            font-family: Times, serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_012 {
            font-family: Times, serif;
            font-size: 12.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_012 {
            font-family: Times, serif;
            font-size: 12.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_013 {
            font-family: Arial, serif;
            font-size: 16.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_013 {
            font-family: Arial, serif;
            font-size: 16.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_014 {
            font-family: Arial, serif;
            font-size: 2.9px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_014 {
            font-family: Arial, serif;
            font-size: 2.9px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_015 {
            font-family: Arial, serif;
            font-size: 30.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_015 {
            font-family: Arial, serif;
            font-size: 30.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_016 {
            font-family: Arial, serif;
            font-size: 12.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_016 {
            font-family: Arial, serif;
            font-size: 12.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_017 {
            font-family: Arial, serif;
            font-size: 11.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_017 {
            font-family: Arial, serif;
            font-size: 11.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_018 {
            font-family: Arial, serif;
            font-size: 11.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_018 {
            font-family: Arial, serif;
            font-size: 11.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_019 {
            font-family: "Book Antiqua Italic", serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: italic;
            text-decoration: none
        }

        div.cls_019 {
            font-family: "Book Antiqua Italic", serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: italic;
            text-decoration: none
        }

        span.cls_020 {
            font-family: Arial, serif;
            font-size: 8.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_020 {
            font-family: Arial, serif;
            font-size: 8.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_021 {
            font-family: "Book Antiqua Italic", serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: italic;
            text-decoration: none
        }

        div.cls_021 {
            font-family: "Book Antiqua Italic", serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: italic;
            text-decoration: none
        }

        span.cls_022 {
            font-family: Arial, serif;
            font-size: 20.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_022 {
            font-family: Arial, serif;
            font-size: 20.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_023 {
            font-family: Courier New, serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_023 {
            font-family: Courier New, serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_024 {
            font-family: Courier New, serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_024 {
            font-family: Courier New, serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_025 {
            font-family: "Book Antiqua Bold", serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_025 {
            font-family: "Book Antiqua Bold", serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_026 {
            font-family: "Book Antiqua", serif;
            font-size: 9.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_026 {
            font-family: "Book Antiqua", serif;
            font-size: 9.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_027 {
            font-family: Arial, serif;
            font-size: 18.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_027 {
            font-family: Arial, serif;
            font-size: 18.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_028 {
            font-family: "Book Antiqua Bold", serif;
            font-size: 9.6px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_028 {
            font-family: "Book Antiqua Bold", serif;
            font-size: 9.6px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_029 {
            font-family: Arial, serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_029 {
            font-family: Arial, serif;
            font-size: 10.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        span.cls_030 {
            font-family: "Book Antiqua Italic", serif;
            font-size: 9.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: italic;
            text-decoration: none
        }

        div.cls_030 {
            font-family: "Book Antiqua Italic", serif;
            font-size: 9.6px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: italic;
            text-decoration: none
        }

        span.cls_031 {
            font-family: Times, serif;
            font-size: 10.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: italic;
            text-decoration: none
        }

        div.cls_031 {
            font-family: Times, serif;
            font-size: 10.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: italic;
            text-decoration: none
        }

        span.cls_032 {
            font-family: Arial, serif;
            font-size: 19.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        div.cls_032 {
            font-family: Arial, serif;
            font-size: 19.1px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-style: normal;
            text-decoration: none
        }

        span.cls_033 {
            font-family: "Book Antiqua", serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        div.cls_033 {
            font-family: "Book Antiqua", serif;
            font-size: 9.1px;
            color: rgb(0, 0, 0);
            font-weight: normal;
            font-style: normal;
            text-decoration: none
        }

        -->
    </style>
    <script type="text/javascript" src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/wz_jsgraphics.js"></script>
</head>

<body>
    <div style="position:absolute;left:50%;margin-left:-306px;top:0px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background001.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:802px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background002.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:163.23px" class="cls_003">
            <span class="cls_003">Mongoose for Application</span>
        </div>
        <div style="position:absolute;left:108.00px;top:196.83px" class="cls_003">
            <span class="cls_003">Development</span>
        </div>
        <div style="position:absolute;left:108.00px;top:296.75px" class="cls_004">
            <span class="cls_004">Learn to speed up your application development by</span>
        </div>
        <div style="position:absolute;left:108.00px;top:315.95px" class="cls_004">
            <span class="cls_004">using Mongoose to harness the power of Node.js</span>
        </div>
        <div style="position:absolute;left:108.00px;top:335.15px" class="cls_004">
            <span class="cls_004">and MongoDB</span>
        </div>
        <div style="position:absolute;left:108.00px;top:426.31px" class="cls_005">
            <span class="cls_005">Simon Holmes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:607.65px" class="cls_006">
            <span class="cls_006">BIRMINGHAM - MUMBAI</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:1604px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background003.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_004">
            <span class="cls_004">Mongoose for Application Development</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.35px" class="cls_006">
            <span class="cls_006">Copyright © 2013 Packt Publishing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:194.83px" class="cls_006">
            <span class="cls_006">All rights reserved. No part of this book may be reproduced, stored in a retrieval</span>
        </div>
        <div style="position:absolute;left:108.00px;top:207.43px" class="cls_006">
            <span class="cls_006">system, or transmitted in any form or by any means, without the prior written</span>
        </div>
        <div style="position:absolute;left:108.00px;top:220.03px" class="cls_006">
            <span class="cls_006">permission of the publisher, except in the case of brief quotations embedded in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:232.63px" class="cls_006">
            <span class="cls_006">critical articles or reviews.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:253.87px" class="cls_006">
            <span class="cls_006">Every effort has been made in the preparation of this book to ensure the accuracy</span>
        </div>
        <div style="position:absolute;left:108.00px;top:266.47px" class="cls_006">
            <span class="cls_006">of the information presented. However, the information contained in this book is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:279.07px" class="cls_006">
            <span class="cls_006">sold without warranty, either express or implied. Neither the author, nor Packt</span>
        </div>
        <div style="position:absolute;left:108.00px;top:291.67px" class="cls_006">
            <span class="cls_006">Publishing, and its dealers and distributors will be held liable for any damages</span>
        </div>
        <div style="position:absolute;left:108.00px;top:304.27px" class="cls_006">
            <span class="cls_006">caused or alleged to be caused directly or indirectly by this book.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:325.51px" class="cls_006">
            <span class="cls_006">Packt Publishing has endeavored to provide trademark information about all of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:338.11px" class="cls_006">
            <span class="cls_006">companies and products mentioned in this book by the appropriate use of capitals.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:350.71px" class="cls_006">
            <span class="cls_006">However, Packt Publishing cannot guarantee the accuracy of this information.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:393.20px" class="cls_006">
            <span class="cls_006">First published: August 2013</span>
        </div>
        <div style="position:absolute;left:108.00px;top:435.68px" class="cls_006">
            <span class="cls_006">Production Reference: 1200813</span>
        </div>
        <div style="position:absolute;left:108.00px;top:478.16px" class="cls_006">
            <span class="cls_006">Published by Packt Publishing Ltd.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:490.76px" class="cls_006">
            <span class="cls_006">Livery Place</span>
        </div>
        <div style="position:absolute;left:108.00px;top:503.36px" class="cls_006">
            <span class="cls_006">35 Livery Street</span>
        </div>
        <div style="position:absolute;left:108.00px;top:515.96px" class="cls_006">
            <span class="cls_006">Birmingham B3 2PB, UK.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:537.20px" class="cls_006">
            <span class="cls_006">ISBN 978-1-78216-819-5</span>
        </div>
        <div style="position:absolute;left:108.00px;top:559.43px" class="cls_007">
            <span class="cls_007"> </span>
            <A HREF="http://www.packtpub.com/">www.packtpub.com</A>
        </div>
        <div style="position:absolute;left:108.00px;top:579.67px" class="cls_006">
            <span class="cls_006">Cover Image by Abhishek Pandey (</span>
            <span class="cls_007">abhishek.pandey1210@gmail.com</span>
            <span class="cls_006">)</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:2406px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background004.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:261.66px;top:163.23px" class="cls_003">
            <span class="cls_003">Credits</span>
        </div>
        <div style="position:absolute;left:175.77px;top:240.78px" class="cls_008">
            <span class="cls_008">Author</span>
        </div>
        <div style="position:absolute;left:324.73px;top:240.80px" class="cls_008">
            <span class="cls_008">Project Coordinator</span>
        </div>
        <div style="position:absolute;left:182.98px;top:254.59px" class="cls_009">
            <span class="cls_009">Simon Holmes</span>
        </div>
        <div style="position:absolute;left:331.92px;top:254.61px" class="cls_009">
            <span class="cls_009">Joel Goveya</span>
        </div>
        <div style="position:absolute;left:175.77px;top:285.20px" class="cls_008">
            <span class="cls_008">Reviewers</span>
        </div>
        <div style="position:absolute;left:324.73px;top:285.21px" class="cls_008">
            <span class="cls_008">Proofreader</span>
        </div>
        <div style="position:absolute;left:182.98px;top:299.00px" class="cls_009">
            <span class="cls_009">Alexandru Vlăduțu</span>
        </div>
        <div style="position:absolute;left:331.92px;top:299.02px" class="cls_009">
            <span class="cls_009">Mario Cecere</span>
        </div>
        <div style="position:absolute;left:182.98px;top:315.81px" class="cls_009">
            <span class="cls_009">Robert Klep</span>
        </div>
        <div style="position:absolute;left:324.73px;top:329.63px" class="cls_008">
            <span class="cls_008">Indexer</span>
        </div>
        <div style="position:absolute;left:182.98px;top:332.61px" class="cls_009">
            <span class="cls_009">David Harvey</span>
        </div>
        <div style="position:absolute;left:331.92px;top:343.44px" class="cls_009">
            <span class="cls_009">Hemangini Bari</span>
        </div>
        <div style="position:absolute;left:175.77px;top:363.22px" class="cls_008">
            <span class="cls_008">Acquisition Editor</span>
        </div>
        <div style="position:absolute;left:324.73px;top:374.04px" class="cls_008">
            <span class="cls_008">Production Coordinator</span>
        </div>
        <div style="position:absolute;left:182.98px;top:377.02px" class="cls_009">
            <span class="cls_009">Grant Mizen</span>
        </div>
        <div style="position:absolute;left:331.92px;top:387.85px" class="cls_009">
            <span class="cls_009">Aditi Gajjar</span>
        </div>
        <div style="position:absolute;left:175.77px;top:407.63px" class="cls_008">
            <span class="cls_008">Commisioning Editor</span>
        </div>
        <div style="position:absolute;left:324.73px;top:418.46px" class="cls_008">
            <span class="cls_008">Cover Work</span>
        </div>
        <div style="position:absolute;left:182.98px;top:421.44px" class="cls_009">
            <span class="cls_009">Llewellyn Rozario</span>
        </div>
        <div style="position:absolute;left:331.92px;top:432.27px" class="cls_009">
            <span class="cls_009">Aditi Gajjar</span>
        </div>
        <div style="position:absolute;left:175.77px;top:452.05px" class="cls_008">
            <span class="cls_008">Technical Editor</span>
        </div>
        <div style="position:absolute;left:182.98px;top:465.85px" class="cls_009">
            <span class="cls_009">Akashdeep Kundu</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:3208px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background005.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:295.39px;top:163.21px" class="cls_003">
            <span class="cls_003">About the Author</span>
        </div>
        <div style="position:absolute;left:108.00px;top:235.53px" class="cls_010">
            <span class="cls_010">Simon Holmes</span>
            <span class="cls_006"> started his journey as a web developer in late 1990s. He built his</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.63px" class="cls_006">
            <span class="cls_006">first website for a project at university and soon saw what the industry had to offer</span>
        </div>
        <div style="position:absolute;left:108.00px;top:262.23px" class="cls_006">
            <span class="cls_006">when he promptly sold it! Following university, Simon worked his way through</span>
        </div>
        <div style="position:absolute;left:108.00px;top:274.83px" class="cls_006">
            <span class="cls_006">the ranks of design agency life, learning the skills of becoming a full-stack web</span>
        </div>
        <div style="position:absolute;left:108.00px;top:287.43px" class="cls_006">
            <span class="cls_006">developer. From server management and database design to building dynamic, UIs</span>
        </div>
        <div style="position:absolute;left:108.00px;top:300.03px" class="cls_006">
            <span class="cls_006">from Photoshop files, it all fell under Simon's remit. Having witnessed first-hand the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:312.63px" class="cls_006">
            <span class="cls_006">terrible JavaScript code so prevalent in the early 2000s Simon is very much enjoying</span>
        </div>
        <div style="position:absolute;left:108.00px;top:325.23px" class="cls_006">
            <span class="cls_006">its resurgence as a powerful, structured language. Simon now works in SaaS, which</span>
        </div>
        <div style="position:absolute;left:108.00px;top:337.83px" class="cls_006">
            <span class="cls_006">is very heavy on the JavaScript.</span>
        </div>
        <div style="position:absolute;left:145.45px;top:372.03px" class="cls_006">
            <span class="cls_006">Firstly I would like to thank my wife Sally for taking increased</span>
        </div>
        <div style="position:absolute;left:145.45px;top:384.63px" class="cls_006">
            <span class="cls_006">duties with our two lovely young daughters Eri and Bel, affording</span>
        </div>
        <div style="position:absolute;left:145.45px;top:397.23px" class="cls_006">
            <span class="cls_006">me some peace and quiet in which to code and write. Thanks also to</span>
        </div>
        <div style="position:absolute;left:145.45px;top:409.83px" class="cls_006">
            <span class="cls_006">Andreas Soellner for his feedback and encouragement throughout</span>
        </div>
        <div style="position:absolute;left:145.45px;top:422.43px" class="cls_006">
            <span class="cls_006">the process, and technical reviewers David Harvey of Vyclone Inc.,</span>
        </div>
        <div style="position:absolute;left:145.45px;top:435.03px" class="cls_006">
            <span class="cls_006">Robert Klep, and Alexandru Vlădu</span>
            <span class="cls_011">ț</span>
            <span class="cls_006">u. I also wish to express my</span>
        </div>
        <div style="position:absolute;left:145.45px;top:447.63px" class="cls_006">
            <span class="cls_006">thanks to the team at Packt Publishing who have been open and</span>
        </div>
        <div style="position:absolute;left:145.45px;top:460.23px" class="cls_006">
            <span class="cls_006">helpful from start to finish. Not forgetting of course Aaron Heckman</span>
        </div>
        <div style="position:absolute;left:145.45px;top:472.83px" class="cls_006">
            <span class="cls_006">who created Mongoose and continues to maintain, support, and</span>
        </div>
        <div style="position:absolute;left:145.45px;top:485.43px" class="cls_006">
            <span class="cls_006">push it forward.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:4010px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background006.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:245.64px;top:163.23px" class="cls_003">
            <span class="cls_003">About the Reviewers</span>
        </div>
        <div style="position:absolute;left:108.00px;top:235.63px" class="cls_010">
            <span class="cls_010">David Harvey</span>
            <span class="cls_006"> has built tools for more than twenty five years for developers,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.73px" class="cls_006">
            <span class="cls_006">architectural infrastructure for investment banks, and high-end music software. He</span>
        </div>
        <div style="position:absolute;left:108.00px;top:262.33px" class="cls_006">
            <span class="cls_006">has formed and led teams in organizations of all sizes, and has taught, consulted,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:274.93px" class="cls_006">
            <span class="cls_006">and presented on object technology, patterns and agile software development. He</span>
        </div>
        <div style="position:absolute;left:108.00px;top:287.53px" class="cls_006">
            <span class="cls_006">is currently the CTO at Vyclone Inc., delivering ground-breaking multi-angle video</span>
        </div>
        <div style="position:absolute;left:108.00px;top:300.13px" class="cls_006">
            <span class="cls_006">technology on mobile and cloud platforms.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:355.51px" class="cls_010">
            <span class="cls_010">Robert Klep</span>
            <span class="cls_006"> is a freelance frontend and backend web developer from</span>
        </div>
        <div style="position:absolute;left:108.00px;top:369.61px" class="cls_006">
            <span class="cls_006">'s-Hertogenbosch, the Netherlands, with more than 17 years experience. Lately,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:382.21px" class="cls_006">
            <span class="cls_006">Robert has been focusing more on JavaScript and Node.js development. He has</span>
        </div>
        <div style="position:absolute;left:108.00px;top:394.81px" class="cls_006">
            <span class="cls_006">used Mongoose extensively in several projects. He was the winner of the 0th Annual</span>
        </div>
        <div style="position:absolute;left:108.00px;top:407.41px" class="cls_006">
            <span class="cls_006">Obfuscated Perl Contest in 1996.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:462.79px" class="cls_010">
            <span class="cls_010">Alexandru Vlădu</span>
            <span class="cls_012">ț</span>
            <span class="cls_010">u</span>
            <span class="cls_006"> is a JavaScript developer at a company in Bucharest,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:476.89px" class="cls_006">
            <span class="cls_006">Romania. He started creating applications with PHP five years ago, but after finding</span>
        </div>
        <div style="position:absolute;left:108.00px;top:489.49px" class="cls_006">
            <span class="cls_006">out about server-side JavaScript with Node.js he never had to switch technologies</span>
        </div>
        <div style="position:absolute;left:108.00px;top:502.09px" class="cls_006">
            <span class="cls_006">again. You may have seen him answering questions on </span>
            <span class="cls_007">stackoverflow.com</span>
            <span class="cls_006"> under</span>
        </div>
        <div style="position:absolute;left:108.00px;top:514.69px" class="cls_006">
            <span class="cls_006">the nickname alessioalex, where he is in the top three overall answerers for tags</span>
        </div>
        <div style="position:absolute;left:108.00px;top:527.29px" class="cls_006">
            <span class="cls_006">like Node.js, Express, Mongoose, or Socket.IO. By day he battles cross browser</span>
        </div>
        <div style="position:absolute;left:108.00px;top:539.89px" class="cls_006">
            <span class="cls_006">compatibility issues, but by night he brings together embedded databases, servers,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:552.49px" class="cls_006">
            <span class="cls_006">and caching layers into single applications using the good parts of JavaScript. Aside</span>
        </div>
        <div style="position:absolute;left:108.00px;top:565.09px" class="cls_006">
            <span class="cls_006">from the geeky stuff, he enjoys spending time with his wife.</span>
        </div>
        <div style="position:absolute;left:145.44px;top:590.65px" class="cls_006">
            <span class="cls_006">I would like to thank the Node.js community for being so friendly</span>
        </div>
        <div style="position:absolute;left:145.44px;top:603.25px" class="cls_006">
            <span class="cls_006">and helpful.</span>
        </div>
        <div style="position:absolute;left:145.44px;top:628.45px" class="cls_006">
            <span class="cls_006">Most importantly, I would like to thank my wife Diana for her</span>
        </div>
        <div style="position:absolute;left:145.44px;top:641.05px" class="cls_006">
            <span class="cls_006">support, encouragement, and patience.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:4812px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background007.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:256.58px;top:163.21px" class="cls_003">
            <span class="cls_003">w</span>
            <A HREF="http://www.PacktPub.com">ww.PacktPub.com</A>
        </div>
        <div style="position:absolute;left:108.00px;top:236.33px" class="cls_013">
            <span class="cls_013">Support files, eBooks, discount offers and more</span>
        </div>
        <div style="position:absolute;left:108.00px;top:264.51px" class="cls_006">
            <span class="cls_006">You might want to visit </span>
            <A HREF="http://www.PacktPub.com">www.PacktPub.com</A>
            </span>
            <span class="cls_006"> for support files and downloads related</span>
        </div>
        <div style="position:absolute;left:108.00px;top:277.11px" class="cls_006">
            <span class="cls_006">to your book.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:298.35px" class="cls_006">
            <span class="cls_006">Did you know that Packt offers eBook versions of every book published, with PDF</span>
        </div>
        <div style="position:absolute;left:108.00px;top:310.95px" class="cls_006">
            <span class="cls_006">and ePub files available? You can upgrade to the eBook version at </span>
            <A HREF="http://www.PacktPub.com">www.PacktPub.</A>
            </span>
        </div>
        <div style="position:absolute;left:108.00px;top:323.55px" class="cls_007">
            <span class="cls_007"> </span>
            <A HREF="http://www.PacktPub.com">com</A>
            <span class="cls_006"> and as a print book customer, you are entitled to a discount on the eBook copy.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:336.15px" class="cls_006">
            <span class="cls_006">Get in touch with us at </span>
            <A HREF="mailto:service@packtpub.com">service@packtpub.com</A>
            </span>
            <span class="cls_006"> for more details.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:357.39px" class="cls_006">
            <span class="cls_006">At </span>
            <A HREF="http://www.PacktPub.com">www.PacktPub.com</A>
            </span>
            <span class="cls_006">, you can also read a collection of free technical articles, sign</span>
        </div>
        <div style="position:absolute;left:108.00px;top:369.99px" class="cls_006">
            <span class="cls_006">up for a range of free newsletters and receive exclusive discounts and offers on Packt</span>
        </div>
        <div style="position:absolute;left:108.00px;top:382.59px" class="cls_006">
            <span class="cls_006">books and eBooks.</span>
        </div>
        <div style="position:absolute;left:263.43px;top:406.76px" class="cls_014">
            <span class="cls_014">TM</span>
        </div>
        <div style="position:absolute;left:108.00px;top:449.20px" class="cls_007">
            <span class="cls_007"> </span>
            <A HREF="http://PacktLib.PacktPub.com">http://PacktLib.PacktPub.com</A>
        </div>
        <div style="position:absolute;left:108.00px;top:469.44px" class="cls_006">
            <span class="cls_006">Do you need instant solutions to your IT questions? PacktLib is Packt's online</span>
        </div>
        <div style="position:absolute;left:108.00px;top:482.04px" class="cls_006">
            <span class="cls_006">digital book library. Here, you can access, read and search across Packt's entire</span>
        </div>
        <div style="position:absolute;left:108.00px;top:494.64px" class="cls_006">
            <span class="cls_006">library of books.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:518.02px" class="cls_005">
            <span class="cls_005">Why Subscribe?</span>
        </div>
        <div style="position:absolute;left:126.00px;top:537.00px" class="cls_006">
            <span class="cls_006">• Fully searchable across every book published by Packt</span>
        </div>
        <div style="position:absolute;left:126.00px;top:553.91px" class="cls_006">
            <span class="cls_006">• Copy and paste, print and bookmark content</span>
        </div>
        <div style="position:absolute;left:126.00px;top:570.83px" class="cls_006">
            <span class="cls_006">• On demand and accessible via web browser</span>
        </div>
        <div style="position:absolute;left:108.00px;top:594.22px" class="cls_005">
            <span class="cls_005">Free Access for Packt account holders</span>
        </div>
        <div style="position:absolute;left:108.00px;top:613.20px" class="cls_006">
            <span class="cls_006">If you have an account with Packt at </span>
            <A HREF="http://www.packtpub.com/">www.PacktPub.com</A>
            </span>
            <span class="cls_006">, you can use this to access</span>
        </div>
        <div style="position:absolute;left:108.00px;top:625.80px" class="cls_006">
            <span class="cls_006">PacktLib today and view nine entirely free books. Simply use your login credentials</span>
        </div>
        <div style="position:absolute;left:108.00px;top:638.40px" class="cls_006">
            <span class="cls_006">for immediate access.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:5614px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background008.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:270.52px;top:218.71px" class="cls_015">
            <span class="cls_015">Table of Contents</span>
        </div>
        <div style="position:absolute;left:108.00px;top:274.09px" class="cls_016">
            <span class="cls_016">Preface</span>
        </div>
        <div style="position:absolute;left:497.33px;top:274.09px" class="cls_016">
            <span class="cls_016">1</span>
        </div>
        <div style="position:absolute;left:108.00px;top:291.37px" class="cls_016">
            <span class="cls_016">Chapter 1: Introducing Mongoose to the Technology Stack</span>
        </div>
        <div style="position:absolute;left:497.33px;top:291.37px" class="cls_016">
            <span class="cls_016">7</span>
        </div>
        <div style="position:absolute;left:115.20px;top:307.07px" class="cls_017">
            <span class="cls_017">The technology stack - Node.js, npm, MongoDB, and Express</span>
        </div>
        <div style="position:absolute;left:497.88px;top:307.07px" class="cls_017">
            <span class="cls_017">7</span>
        </div>
        <div style="position:absolute;left:126.00px;top:320.27px" class="cls_018">
            <span class="cls_018">The language and the server - JavaScript and Node</span>
        </div>
        <div style="position:absolute;left:497.88px;top:320.27px" class="cls_018">
            <span class="cls_018">7</span>
        </div>
        <div style="position:absolute;left:126.00px;top:333.47px" class="cls_018">
            <span class="cls_018">Single-threaded versus multithreaded</span>
        </div>
        <div style="position:absolute;left:497.88px;top:333.47px" class="cls_018">
            <span class="cls_018">8</span>
        </div>
        <div style="position:absolute;left:133.20px;top:346.27px" class="cls_009">
            <span class="cls_009">Blocking versus non-blocking code</span>
        </div>
        <div style="position:absolute;left:499.00px;top:346.27px" class="cls_009">
            <span class="cls_009">9</span>
        </div>
        <div style="position:absolute;left:126.00px;top:357.47px" class="cls_018">
            <span class="cls_018">The database - MongoDB</span>
        </div>
        <div style="position:absolute;left:492.59px;top:357.47px" class="cls_018">
            <span class="cls_018">11</span>
        </div>
        <div style="position:absolute;left:126.00px;top:370.67px" class="cls_018">
            <span class="cls_018">The framework - Express</span>
        </div>
        <div style="position:absolute;left:491.76px;top:370.67px" class="cls_018">
            <span class="cls_018">12</span>
        </div>
        <div style="position:absolute;left:115.20px;top:383.87px" class="cls_017">
            <span class="cls_017">What Mongoose is all about</span>
        </div>
        <div style="position:absolute;left:491.76px;top:383.87px" class="cls_017">
            <span class="cls_017">12</span>
        </div>
        <div style="position:absolute;left:126.00px;top:397.07px" class="cls_018">
            <span class="cls_018">What is Mongoose good for?</span>
        </div>
        <div style="position:absolute;left:491.76px;top:397.07px" class="cls_018">
            <span class="cls_018">13</span>
        </div>
        <div style="position:absolute;left:126.00px;top:410.27px" class="cls_018">
            <span class="cls_018">What Mongoose is not ideally suited for</span>
        </div>
        <div style="position:absolute;left:491.76px;top:410.27px" class="cls_018">
            <span class="cls_018">13</span>
        </div>
        <div style="position:absolute;left:126.00px;top:423.47px" class="cls_018">
            <span class="cls_018">The cornerstones of Mongoose</span>
        </div>
        <div style="position:absolute;left:491.76px;top:423.47px" class="cls_018">
            <span class="cls_018">14</span>
        </div>
        <div style="position:absolute;left:133.20px;top:436.27px" class="cls_009">
            <span class="cls_009">Mongoose schemas</span>
        </div>
        <div style="position:absolute;left:493.99px;top:436.27px" class="cls_009">
            <span class="cls_009">14</span>
        </div>
        <div style="position:absolute;left:133.20px;top:447.07px" class="cls_009">
            <span class="cls_009">Mongoose models</span>
        </div>
        <div style="position:absolute;left:493.99px;top:447.07px" class="cls_009">
            <span class="cls_009">14</span>
        </div>
        <div style="position:absolute;left:115.20px;top:458.27px" class="cls_017">
            <span class="cls_017">Installing the full stack</span>
        </div>
        <div style="position:absolute;left:491.76px;top:458.27px" class="cls_017">
            <span class="cls_017">15</span>
        </div>
        <div style="position:absolute;left:126.00px;top:471.47px" class="cls_018">
            <span class="cls_018">Installing the prerequisites</span>
        </div>
        <div style="position:absolute;left:491.76px;top:471.47px" class="cls_018">
            <span class="cls_018">15</span>
        </div>
        <div style="position:absolute;left:126.00px;top:484.67px" class="cls_018">
            <span class="cls_018">Installing Node.js</span>
        </div>
        <div style="position:absolute;left:491.76px;top:484.67px" class="cls_018">
            <span class="cls_018">15</span>
        </div>
        <div style="position:absolute;left:126.00px;top:497.87px" class="cls_018">
            <span class="cls_018">Installing npm</span>
        </div>
        <div style="position:absolute;left:491.76px;top:497.87px" class="cls_018">
            <span class="cls_018">15</span>
        </div>
        <div style="position:absolute;left:126.00px;top:511.07px" class="cls_018">
            <span class="cls_018">Installing MongoDB</span>
        </div>
        <div style="position:absolute;left:491.76px;top:511.07px" class="cls_018">
            <span class="cls_018">16</span>
        </div>
        <div style="position:absolute;left:126.00px;top:524.27px" class="cls_018">
            <span class="cls_018">Installing Express.js</span>
        </div>
        <div style="position:absolute;left:491.76px;top:524.27px" class="cls_018">
            <span class="cls_018">17</span>
        </div>
        <div style="position:absolute;left:126.00px;top:537.47px" class="cls_018">
            <span class="cls_018">Installing Mongoose</span>
        </div>
        <div style="position:absolute;left:491.76px;top:537.47px" class="cls_018">
            <span class="cls_018">17</span>
        </div>
        <div style="position:absolute;left:133.20px;top:550.27px" class="cls_009">
            <span class="cls_009">Direct installation into project</span>
        </div>
        <div style="position:absolute;left:493.99px;top:550.27px" class="cls_009">
            <span class="cls_009">17</span>
        </div>
        <div style="position:absolute;left:133.20px;top:561.07px" class="cls_009">
            <span class="cls_009">Using project dependencies - package.json</span>
        </div>
        <div style="position:absolute;left:493.99px;top:561.07px" class="cls_009">
            <span class="cls_009">17</span>
        </div>
        <div style="position:absolute;left:126.00px;top:572.27px" class="cls_018">
            <span class="cls_018">Creating a project</span>
        </div>
        <div style="position:absolute;left:491.76px;top:572.27px" class="cls_018">
            <span class="cls_018">18</span>
        </div>
        <div style="position:absolute;left:115.20px;top:585.47px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:491.76px;top:585.47px" class="cls_017">
            <span class="cls_017">21</span>
        </div>
        <div style="position:absolute;left:108.00px;top:600.25px" class="cls_016">
            <span class="cls_016">Chapter 2: Establishing a Database Connection</span>
        </div>
        <div style="position:absolute;left:490.66px;top:600.25px" class="cls_016">
            <span class="cls_016">23</span>
        </div>
        <div style="position:absolute;left:115.20px;top:615.95px" class="cls_017">
            <span class="cls_017">Mongoose default connection</span>
        </div>
        <div style="position:absolute;left:491.76px;top:615.95px" class="cls_017">
            <span class="cls_017">23</span>
        </div>
        <div style="position:absolute;left:126.00px;top:629.15px" class="cls_018">
            <span class="cls_018">Using multiple connections</span>
        </div>
        <div style="position:absolute;left:491.76px;top:629.15px" class="cls_018">
            <span class="cls_018">24</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:6416px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background009.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Table of Contents</span>
        </div>
        <div style="position:absolute;left:115.20px;top:114.37px" class="cls_017">
            <span class="cls_017">About the connection string</span>
        </div>
        <div style="position:absolute;left:491.76px;top:114.37px" class="cls_017">
            <span class="cls_017">24</span>
        </div>
        <div style="position:absolute;left:126.00px;top:127.57px" class="cls_018">
            <span class="cls_018">Setting the port</span>
        </div>
        <div style="position:absolute;left:491.76px;top:127.57px" class="cls_018">
            <span class="cls_018">24</span>
        </div>
        <div style="position:absolute;left:126.00px;top:140.77px" class="cls_018">
            <span class="cls_018">Specifying a database user</span>
        </div>
        <div style="position:absolute;left:491.76px;top:140.77px" class="cls_018">
            <span class="cls_018">24</span>
        </div>
        <div style="position:absolute;left:115.20px;top:153.97px" class="cls_017">
            <span class="cls_017">Connection options</span>
        </div>
        <div style="position:absolute;left:491.76px;top:153.97px" class="cls_017">
            <span class="cls_017">24</span>
        </div>
        <div style="position:absolute;left:115.20px;top:167.17px" class="cls_017">
            <span class="cls_017">Closing the connection</span>
        </div>
        <div style="position:absolute;left:491.76px;top:167.17px" class="cls_017">
            <span class="cls_017">25</span>
        </div>
        <div style="position:absolute;left:126.00px;top:180.37px" class="cls_018">
            <span class="cls_018">Calling the close command</span>
        </div>
        <div style="position:absolute;left:491.76px;top:180.37px" class="cls_018">
            <span class="cls_018">25</span>
        </div>
        <div style="position:absolute;left:126.00px;top:193.57px" class="cls_018">
            <span class="cls_018">Closing when the Node process ends</span>
        </div>
        <div style="position:absolute;left:491.76px;top:193.57px" class="cls_018">
            <span class="cls_018">26</span>
        </div>
        <div style="position:absolute;left:115.20px;top:206.77px" class="cls_017">
            <span class="cls_017">Connection events</span>
        </div>
        <div style="position:absolute;left:491.76px;top:206.77px" class="cls_017">
            <span class="cls_017">26</span>
        </div>
        <div style="position:absolute;left:115.20px;top:219.97px" class="cls_017">
            <span class="cls_017">Connecting our project</span>
        </div>
        <div style="position:absolute;left:491.76px;top:219.97px" class="cls_017">
            <span class="cls_017">26</span>
        </div>
        <div style="position:absolute;left:126.00px;top:233.17px" class="cls_018">
            <span class="cls_018">Creating the connection</span>
        </div>
        <div style="position:absolute;left:491.76px;top:233.17px" class="cls_018">
            <span class="cls_018">26</span>
        </div>
        <div style="position:absolute;left:126.00px;top:246.37px" class="cls_018">
            <span class="cls_018">Catching the events</span>
        </div>
        <div style="position:absolute;left:491.76px;top:246.37px" class="cls_018">
            <span class="cls_018">27</span>
        </div>
        <div style="position:absolute;left:126.00px;top:259.57px" class="cls_018">
            <span class="cls_018">Opening the connection at application start</span>
        </div>
        <div style="position:absolute;left:491.76px;top:259.57px" class="cls_018">
            <span class="cls_018">28</span>
        </div>
        <div style="position:absolute;left:126.00px;top:272.77px" class="cls_018">
            <span class="cls_018">Creating the database</span>
        </div>
        <div style="position:absolute;left:491.76px;top:272.77px" class="cls_018">
            <span class="cls_018">28</span>
        </div>
        <div style="position:absolute;left:115.20px;top:285.97px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:491.76px;top:285.97px" class="cls_017">
            <span class="cls_017">29</span>
        </div>
        <div style="position:absolute;left:108.00px;top:300.75px" class="cls_016">
            <span class="cls_016">Chapter 3: Schemas and Models</span>
        </div>
        <div style="position:absolute;left:490.66px;top:300.75px" class="cls_016">
            <span class="cls_016">31</span>
        </div>
        <div style="position:absolute;left:115.20px;top:316.45px" class="cls_017">
            <span class="cls_017">Introducing schemas</span>
        </div>
        <div style="position:absolute;left:491.76px;top:316.45px" class="cls_017">
            <span class="cls_017">31</span>
        </div>
        <div style="position:absolute;left:126.00px;top:329.65px" class="cls_018">
            <span class="cls_018">Field sizes</span>
        </div>
        <div style="position:absolute;left:491.76px;top:329.65px" class="cls_018">
            <span class="cls_018">32</span>
        </div>
        <div style="position:absolute;left:115.20px;top:342.85px" class="cls_017">
            <span class="cls_017">Data types allowed in schemas</span>
        </div>
        <div style="position:absolute;left:491.76px;top:342.85px" class="cls_017">
            <span class="cls_017">32</span>
        </div>
        <div style="position:absolute;left:126.00px;top:356.05px" class="cls_018">
            <span class="cls_018">String</span>
        </div>
        <div style="position:absolute;left:491.76px;top:356.05px" class="cls_018">
            <span class="cls_018">32</span>
        </div>
        <div style="position:absolute;left:126.00px;top:369.25px" class="cls_018">
            <span class="cls_018">Number</span>
        </div>
        <div style="position:absolute;left:491.76px;top:369.25px" class="cls_018">
            <span class="cls_018">33</span>
        </div>
        <div style="position:absolute;left:126.00px;top:382.45px" class="cls_018">
            <span class="cls_018">Date</span>
        </div>
        <div style="position:absolute;left:491.76px;top:382.45px" class="cls_018">
            <span class="cls_018">33</span>
        </div>
        <div style="position:absolute;left:126.00px;top:395.65px" class="cls_018">
            <span class="cls_018">Boolean</span>
        </div>
        <div style="position:absolute;left:491.76px;top:395.65px" class="cls_018">
            <span class="cls_018">33</span>
        </div>
        <div style="position:absolute;left:126.00px;top:408.85px" class="cls_018">
            <span class="cls_018">Buffer</span>
        </div>
        <div style="position:absolute;left:491.76px;top:408.85px" class="cls_018">
            <span class="cls_018">33</span>
        </div>
        <div style="position:absolute;left:126.00px;top:422.05px" class="cls_018">
            <span class="cls_018">ObjectId</span>
        </div>
        <div style="position:absolute;left:491.76px;top:422.05px" class="cls_018">
            <span class="cls_018">33</span>
        </div>
        <div style="position:absolute;left:126.00px;top:435.25px" class="cls_018">
            <span class="cls_018">Mixed</span>
        </div>
        <div style="position:absolute;left:491.76px;top:435.25px" class="cls_018">
            <span class="cls_018">33</span>
        </div>
        <div style="position:absolute;left:133.20px;top:448.05px" class="cls_009">
            <span class="cls_009">Tracking changes to Mixed type</span>
        </div>
        <div style="position:absolute;left:493.99px;top:448.05px" class="cls_009">
            <span class="cls_009">34</span>
        </div>
        <div style="position:absolute;left:126.00px;top:459.25px" class="cls_018">
            <span class="cls_018">Array</span>
        </div>
        <div style="position:absolute;left:491.76px;top:459.25px" class="cls_018">
            <span class="cls_018">34</span>
        </div>
        <div style="position:absolute;left:133.20px;top:472.05px" class="cls_009">
            <span class="cls_009">Warning - array defined as mixed type</span>
        </div>
        <div style="position:absolute;left:493.99px;top:472.05px" class="cls_009">
            <span class="cls_009">34</span>
        </div>
        <div style="position:absolute;left:126.00px;top:483.25px" class="cls_018">
            <span class="cls_018">Custom SchemaTypes</span>
        </div>
        <div style="position:absolute;left:491.76px;top:483.25px" class="cls_018">
            <span class="cls_018">35</span>
        </div>
        <div style="position:absolute;left:115.20px;top:496.45px" class="cls_017">
            <span class="cls_017">Where to write the schemas</span>
        </div>
        <div style="position:absolute;left:491.76px;top:496.45px" class="cls_017">
            <span class="cls_017">35</span>
        </div>
        <div style="position:absolute;left:115.20px;top:509.65px" class="cls_017">
            <span class="cls_017">Writing a schema</span>
        </div>
        <div style="position:absolute;left:491.76px;top:509.65px" class="cls_017">
            <span class="cls_017">35</span>
        </div>
        <div style="position:absolute;left:126.00px;top:522.85px" class="cls_018">
            <span class="cls_018">Modifying an existing schema</span>
        </div>
        <div style="position:absolute;left:491.76px;top:522.85px" class="cls_018">
            <span class="cls_018">36</span>
        </div>
        <div style="position:absolute;left:126.00px;top:536.05px" class="cls_018">
            <span class="cls_018">Setting a default value</span>
        </div>
        <div style="position:absolute;left:491.76px;top:536.05px" class="cls_018">
            <span class="cls_018">36</span>
        </div>
        <div style="position:absolute;left:126.00px;top:549.25px" class="cls_018">
            <span class="cls_018">Only allowing unique entries</span>
        </div>
        <div style="position:absolute;left:491.76px;top:549.25px" class="cls_018">
            <span class="cls_018">37</span>
        </div>
        <div style="position:absolute;left:126.00px;top:562.45px" class="cls_018">
            <span class="cls_018">Our final User schema</span>
        </div>
        <div style="position:absolute;left:491.76px;top:562.45px" class="cls_018">
            <span class="cls_018">38</span>
        </div>
        <div style="position:absolute;left:126.00px;top:575.65px" class="cls_018">
            <span class="cls_018">What's that "__v" thing?</span>
        </div>
        <div style="position:absolute;left:491.76px;top:575.65px" class="cls_018">
            <span class="cls_018">38</span>
        </div>
        <div style="position:absolute;left:133.20px;top:588.45px" class="cls_009">
            <span class="cls_009">Why is this needed?</span>
        </div>
        <div style="position:absolute;left:493.99px;top:588.45px" class="cls_009">
            <span class="cls_009">38</span>
        </div>
        <div style="position:absolute;left:126.00px;top:599.65px" class="cls_018">
            <span class="cls_018">Defining the Project schema</span>
        </div>
        <div style="position:absolute;left:491.76px;top:599.65px" class="cls_018">
            <span class="cls_018">39</span>
        </div>
        <div style="position:absolute;left:133.20px;top:612.45px" class="cls_009">
            <span class="cls_009">Improving the Project schema</span>
        </div>
        <div style="position:absolute;left:493.99px;top:612.45px" class="cls_009">
            <span class="cls_009">40</span>
        </div>
        <div style="position:absolute;left:115.20px;top:623.65px" class="cls_017">
            <span class="cls_017">Building models</span>
        </div>
        <div style="position:absolute;left:491.76px;top:623.65px" class="cls_017">
            <span class="cls_017">40</span>
        </div>
        <div style="position:absolute;left:297.59px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> ii </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:7218px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background010.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:440.96px;top:94.56px" class="cls_019">
            <span class="cls_019">Table of Contents</span>
        </div>
        <div style="position:absolute;left:126.00px;top:114.37px" class="cls_018">
            <span class="cls_018">Instances</span>
        </div>
        <div style="position:absolute;left:491.76px;top:114.37px" class="cls_018">
            <span class="cls_018">40</span>
        </div>
        <div style="position:absolute;left:133.20px;top:127.17px" class="cls_009">
            <span class="cls_009">Interacting with instances</span>
        </div>
        <div style="position:absolute;left:493.99px;top:127.17px" class="cls_009">
            <span class="cls_009">41</span>
        </div>
        <div style="position:absolute;left:133.20px;top:137.97px" class="cls_009">
            <span class="cls_009">Finding a single instance</span>
        </div>
        <div style="position:absolute;left:493.99px;top:137.97px" class="cls_009">
            <span class="cls_009">41</span>
        </div>
        <div style="position:absolute;left:133.20px;top:148.77px" class="cls_009">
            <span class="cls_009">Finding many instances</span>
        </div>
        <div style="position:absolute;left:493.99px;top:148.77px" class="cls_009">
            <span class="cls_009">41</span>
        </div>
        <div style="position:absolute;left:126.00px;top:159.97px" class="cls_018">
            <span class="cls_018">Considerations when choosing your model name</span>
        </div>
        <div style="position:absolute;left:491.76px;top:159.97px" class="cls_018">
            <span class="cls_018">42</span>
        </div>
        <div style="position:absolute;left:115.20px;top:173.17px" class="cls_017">
            <span class="cls_017">Setting the collection name</span>
        </div>
        <div style="position:absolute;left:491.76px;top:173.17px" class="cls_017">
            <span class="cls_017">42</span>
        </div>
        <div style="position:absolute;left:126.00px;top:186.37px" class="cls_018">
            <span class="cls_018">Overriding the collection name in the schema</span>
        </div>
        <div style="position:absolute;left:491.76px;top:186.37px" class="cls_018">
            <span class="cls_018">42</span>
        </div>
        <div style="position:absolute;left:126.00px;top:199.57px" class="cls_018">
            <span class="cls_018">Overriding the collection name in the model</span>
        </div>
        <div style="position:absolute;left:491.76px;top:199.57px" class="cls_018">
            <span class="cls_018">43</span>
        </div>
        <div style="position:absolute;left:126.00px;top:212.77px" class="cls_018">
            <span class="cls_018">Building models from our schemas</span>
        </div>
        <div style="position:absolute;left:491.76px;top:212.77px" class="cls_018">
            <span class="cls_018">43</span>
        </div>
        <div style="position:absolute;left:115.20px;top:225.97px" class="cls_017">
            <span class="cls_017">Our complete code</span>
        </div>
        <div style="position:absolute;left:491.76px;top:225.97px" class="cls_017">
            <span class="cls_017">44</span>
        </div>
        <div style="position:absolute;left:115.20px;top:239.17px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:491.76px;top:239.17px" class="cls_017">
            <span class="cls_017">45</span>
        </div>
        <div style="position:absolute;left:108.00px;top:253.95px" class="cls_016">
            <span class="cls_016">Chapter 4: Interacting with Data - an Introduction</span>
        </div>
        <div style="position:absolute;left:490.66px;top:253.95px" class="cls_016">
            <span class="cls_016">47</span>
        </div>
        <div style="position:absolute;left:115.20px;top:269.65px" class="cls_017">
            <span class="cls_017">Model methods and instance methods</span>
        </div>
        <div style="position:absolute;left:491.76px;top:269.65px" class="cls_017">
            <span class="cls_017">47</span>
        </div>
        <div style="position:absolute;left:115.20px;top:282.85px" class="cls_017">
            <span class="cls_017">Setting up the project</span>
        </div>
        <div style="position:absolute;left:491.76px;top:282.85px" class="cls_017">
            <span class="cls_017">48</span>
        </div>
        <div style="position:absolute;left:126.00px;top:296.05px" class="cls_018">
            <span class="cls_018">Code structure</span>
        </div>
        <div style="position:absolute;left:491.76px;top:296.05px" class="cls_018">
            <span class="cls_018">48</span>
        </div>
        <div style="position:absolute;left:133.20px;top:308.85px" class="cls_009">
            <span class="cls_009">Adding the routes files</span>
        </div>
        <div style="position:absolute;left:493.99px;top:308.85px" class="cls_009">
            <span class="cls_009">49</span>
        </div>
        <div style="position:absolute;left:133.20px;top:319.65px" class="cls_009">
            <span class="cls_009">Tying the routes to Mongoose models</span>
        </div>
        <div style="position:absolute;left:493.99px;top:319.65px" class="cls_009">
            <span class="cls_009">49</span>
        </div>
        <div style="position:absolute;left:126.00px;top:330.85px" class="cls_018">
            <span class="cls_018">URLs and routes</span>
        </div>
        <div style="position:absolute;left:491.76px;top:330.85px" class="cls_018">
            <span class="cls_018">49</span>
        </div>
        <div style="position:absolute;left:133.20px;top:343.65px" class="cls_009">
            <span class="cls_009">Routes for user management</span>
        </div>
        <div style="position:absolute;left:493.99px;top:343.65px" class="cls_009">
            <span class="cls_009">50</span>
        </div>
        <div style="position:absolute;left:133.20px;top:354.45px" class="cls_009">
            <span class="cls_009">Routes for project management</span>
        </div>
        <div style="position:absolute;left:493.99px;top:354.45px" class="cls_009">
            <span class="cls_009">50</span>
        </div>
        <div style="position:absolute;left:115.20px;top:365.65px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:491.76px;top:365.65px" class="cls_017">
            <span class="cls_017">51</span>
        </div>
        <div style="position:absolute;left:108.00px;top:380.43px" class="cls_016">
            <span class="cls_016">Chapter 5: Interacting with Data - Creation</span>
        </div>
        <div style="position:absolute;left:490.66px;top:380.43px" class="cls_016">
            <span class="cls_016">53</span>
        </div>
        <div style="position:absolute;left:115.20px;top:396.13px" class="cls_017">
            <span class="cls_017">Creating an instance</span>
        </div>
        <div style="position:absolute;left:491.76px;top:396.13px" class="cls_017">
            <span class="cls_017">53</span>
        </div>
        <div style="position:absolute;left:126.00px;top:409.33px" class="cls_018">
            <span class="cls_018">Adding data to the instance</span>
        </div>
        <div style="position:absolute;left:491.76px;top:409.33px" class="cls_018">
            <span class="cls_018">54</span>
        </div>
        <div style="position:absolute;left:115.20px;top:422.53px" class="cls_017">
            <span class="cls_017">Saving an instance</span>
        </div>
        <div style="position:absolute;left:491.76px;top:422.53px" class="cls_017">
            <span class="cls_017">54</span>
        </div>
        <div style="position:absolute;left:126.00px;top:435.73px" class="cls_018">
            <span class="cls_018">Using the saved data</span>
        </div>
        <div style="position:absolute;left:491.76px;top:435.73px" class="cls_018">
            <span class="cls_018">55</span>
        </div>
        <div style="position:absolute;left:115.20px;top:448.93px" class="cls_017">
            <span class="cls_017">Creating and saving database entry in one step</span>
        </div>
        <div style="position:absolute;left:491.76px;top:448.93px" class="cls_017">
            <span class="cls_017">56</span>
        </div>
        <div style="position:absolute;left:126.00px;top:462.13px" class="cls_018">
            <span class="cls_018">Chaining methods</span>
        </div>
        <div style="position:absolute;left:491.76px;top:462.13px" class="cls_018">
            <span class="cls_018">56</span>
        </div>
        <div style="position:absolute;left:126.00px;top:475.33px" class="cls_018">
            <span class="cls_018">The Model.create() method</span>
        </div>
        <div style="position:absolute;left:491.76px;top:475.33px" class="cls_018">
            <span class="cls_018">56</span>
        </div>
        <div style="position:absolute;left:115.20px;top:488.53px" class="cls_017">
            <span class="cls_017">CRUD - create data</span>
        </div>
        <div style="position:absolute;left:491.76px;top:488.53px" class="cls_017">
            <span class="cls_017">57</span>
        </div>
        <div style="position:absolute;left:126.00px;top:501.73px" class="cls_018">
            <span class="cls_018">Adding a new user form</span>
        </div>
        <div style="position:absolute;left:491.76px;top:501.73px" class="cls_018">
            <span class="cls_018">58</span>
        </div>
        <div style="position:absolute;left:133.20px;top:514.53px" class="cls_009">
            <span class="cls_009">Adding the Jade template</span>
        </div>
        <div style="position:absolute;left:493.99px;top:514.53px" class="cls_009">
            <span class="cls_009">58</span>
        </div>
        <div style="position:absolute;left:133.20px;top:525.33px" class="cls_009">
            <span class="cls_009">Linking the view to the URL</span>
        </div>
        <div style="position:absolute;left:493.98px;top:525.33px" class="cls_009">
            <span class="cls_009">59</span>
        </div>
        <div style="position:absolute;left:126.00px;top:536.53px" class="cls_018">
            <span class="cls_018">Adding the create user function</span>
        </div>
        <div style="position:absolute;left:491.76px;top:536.53px" class="cls_018">
            <span class="cls_018">60</span>
        </div>
        <div style="position:absolute;left:133.20px;top:549.33px" class="cls_009">
            <span class="cls_009">Error trapping</span>
        </div>
        <div style="position:absolute;left:493.99px;top:549.33px" class="cls_009">
            <span class="cls_009">62</span>
        </div>
        <div style="position:absolute;left:133.20px;top:560.13px" class="cls_009">
            <span class="cls_009">Creating a user session</span>
        </div>
        <div style="position:absolute;left:493.99px;top:560.13px" class="cls_009">
            <span class="cls_009">62</span>
        </div>
        <div style="position:absolute;left:126.00px;top:571.33px" class="cls_018">
            <span class="cls_018">Displaying the confirmation page</span>
        </div>
        <div style="position:absolute;left:491.76px;top:571.33px" class="cls_018">
            <span class="cls_018">63</span>
        </div>
        <div style="position:absolute;left:126.00px;top:584.53px" class="cls_018">
            <span class="cls_018">Try it out!</span>
        </div>
        <div style="position:absolute;left:491.76px;top:584.53px" class="cls_018">
            <span class="cls_018">64</span>
        </div>
        <div style="position:absolute;left:126.00px;top:597.73px" class="cls_018">
            <span class="cls_018">Adding create project functionality</span>
        </div>
        <div style="position:absolute;left:491.76px;top:597.73px" class="cls_018">
            <span class="cls_018">64</span>
        </div>
        <div style="position:absolute;left:133.20px;top:610.53px" class="cls_009">
            <span class="cls_009">Routes</span>
        </div>
        <div style="position:absolute;left:493.99px;top:610.53px" class="cls_009">
            <span class="cls_009">64</span>
        </div>
        <div style="position:absolute;left:133.20px;top:621.33px" class="cls_009">
            <span class="cls_009">New files and functions</span>
        </div>
        <div style="position:absolute;left:493.99px;top:621.33px" class="cls_009">
            <span class="cls_009">65</span>
        </div>
        <div style="position:absolute;left:115.20px;top:632.53px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:491.76px;top:632.53px" class="cls_017">
            <span class="cls_017">65</span>
        </div>
        <div style="position:absolute;left:297.10px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> iii </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:8020px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background011.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Table of Contents</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.60px" class="cls_016">
            <span class="cls_016">Chapter 6: Interacting with Data - Reading,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.00px" class="cls_016">
            <span class="cls_016">Querying, and Finding</span>
        </div>
        <div style="position:absolute;left:490.66px;top:127.00px" class="cls_016">
            <span class="cls_016">67</span>
        </div>
        <div style="position:absolute;left:115.20px;top:142.70px" class="cls_017">
            <span class="cls_017">Approaches to find and read data</span>
        </div>
        <div style="position:absolute;left:491.76px;top:142.70px" class="cls_017">
            <span class="cls_017">67</span>
        </div>
        <div style="position:absolute;left:126.00px;top:155.90px" class="cls_018">
            <span class="cls_018">Using the QueryBuilder</span>
        </div>
        <div style="position:absolute;left:491.76px;top:155.90px" class="cls_018">
            <span class="cls_018">68</span>
        </div>
        <div style="position:absolute;left:126.00px;top:169.10px" class="cls_018">
            <span class="cls_018">Single query operation</span>
        </div>
        <div style="position:absolute;left:491.76px;top:169.10px" class="cls_018">
            <span class="cls_018">69</span>
        </div>
        <div style="position:absolute;left:126.00px;top:182.30px" class="cls_018">
            <span class="cls_018">Static helper methods - finding data</span>
        </div>
        <div style="position:absolute;left:491.76px;top:182.30px" class="cls_018">
            <span class="cls_018">70</span>
        </div>
        <div style="position:absolute;left:115.20px;top:195.50px" class="cls_017">
            <span class="cls_017">CRUD - reading user and project data</span>
        </div>
        <div style="position:absolute;left:491.76px;top:195.50px" class="cls_017">
            <span class="cls_017">71</span>
        </div>
        <div style="position:absolute;left:126.00px;top:208.70px" class="cls_018">
            <span class="cls_018">findOne() - finding a single user</span>
        </div>
        <div style="position:absolute;left:491.76px;top:208.70px" class="cls_018">
            <span class="cls_018">71</span>
        </div>
        <div style="position:absolute;left:133.20px;top:221.50px" class="cls_009">
            <span class="cls_009">Login form</span>
        </div>
        <div style="position:absolute;left:493.99px;top:221.50px" class="cls_009">
            <span class="cls_009">71</span>
        </div>
        <div style="position:absolute;left:133.20px;top:232.30px" class="cls_009">
            <span class="cls_009">Login action</span>
        </div>
        <div style="position:absolute;left:493.99px;top:232.30px" class="cls_009">
            <span class="cls_009">72</span>
        </div>
        <div style="position:absolute;left:133.20px;top:243.10px" class="cls_009">
            <span class="cls_009">Housekeeping - adding homepage links</span>
        </div>
        <div style="position:absolute;left:493.99px;top:243.10px" class="cls_009">
            <span class="cls_009">73</span>
        </div>
        <div style="position:absolute;left:133.20px;top:253.90px" class="cls_009">
            <span class="cls_009">Try it out!</span>
        </div>
        <div style="position:absolute;left:493.99px;top:253.90px" class="cls_009">
            <span class="cls_009">73</span>
        </div>
        <div style="position:absolute;left:126.00px;top:265.10px" class="cls_018">
            <span class="cls_018">find() - finding a list of projects and returning JSON to AJAX</span>
        </div>
        <div style="position:absolute;left:491.76px;top:265.10px" class="cls_018">
            <span class="cls_018">74</span>
        </div>
        <div style="position:absolute;left:133.20px;top:277.90px" class="cls_009">
            <span class="cls_009">Creating a new static find method</span>
        </div>
        <div style="position:absolute;left:493.99px;top:277.90px" class="cls_009">
            <span class="cls_009">74</span>
        </div>
        <div style="position:absolute;left:133.20px;top:288.70px" class="cls_009">
            <span class="cls_009">Setting up the route</span>
        </div>
        <div style="position:absolute;left:493.99px;top:288.70px" class="cls_009">
            <span class="cls_009">75</span>
        </div>
        <div style="position:absolute;left:133.20px;top:299.50px" class="cls_009">
            <span class="cls_009">Updating the view</span>
        </div>
        <div style="position:absolute;left:493.99px;top:299.50px" class="cls_009">
            <span class="cls_009">76</span>
        </div>
        <div style="position:absolute;left:133.20px;top:310.30px" class="cls_009">
            <span class="cls_009">Building the AJAX call</span>
        </div>
        <div style="position:absolute;left:493.99px;top:310.30px" class="cls_009">
            <span class="cls_009">77</span>
        </div>
        <div style="position:absolute;left:133.20px;top:321.10px" class="cls_009">
            <span class="cls_009">Try it out!</span>
        </div>
        <div style="position:absolute;left:493.99px;top:321.10px" class="cls_009">
            <span class="cls_009">78</span>
        </div>
        <div style="position:absolute;left:126.00px;top:332.30px" class="cls_018">
            <span class="cls_018">findByld() - finding a single project</span>
        </div>
        <div style="position:absolute;left:491.76px;top:332.30px" class="cls_018">
            <span class="cls_018">78</span>
        </div>
        <div style="position:absolute;left:133.20px;top:345.10px" class="cls_009">
            <span class="cls_009">Route setup</span>
        </div>
        <div style="position:absolute;left:493.99px;top:345.10px" class="cls_009">
            <span class="cls_009">78</span>
        </div>
        <div style="position:absolute;left:133.20px;top:355.90px" class="cls_009">
            <span class="cls_009">Creating the view</span>
        </div>
        <div style="position:absolute;left:493.99px;top:355.90px" class="cls_009">
            <span class="cls_009">80</span>
        </div>
        <div style="position:absolute;left:115.20px;top:367.10px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:491.76px;top:367.10px" class="cls_017">
            <span class="cls_017">80</span>
        </div>
        <div style="position:absolute;left:108.00px;top:381.88px" class="cls_016">
            <span class="cls_016">Chapter 7: Interacting with Data - Updating</span>
        </div>
        <div style="position:absolute;left:490.66px;top:381.88px" class="cls_016">
            <span class="cls_016">81</span>
        </div>
        <div style="position:absolute;left:115.20px;top:397.58px" class="cls_017">
            <span class="cls_017">Model helper methods</span>
        </div>
        <div style="position:absolute;left:491.76px;top:397.58px" class="cls_017">
            <span class="cls_017">81</span>
        </div>
        <div style="position:absolute;left:126.00px;top:410.78px" class="cls_018">
            <span class="cls_018">Building the commands</span>
        </div>
        <div style="position:absolute;left:491.76px;top:410.78px" class="cls_018">
            <span class="cls_018">82</span>
        </div>
        <div style="position:absolute;left:126.00px;top:423.98px" class="cls_018">
            <span class="cls_018">Which method to choose</span>
        </div>
        <div style="position:absolute;left:491.76px;top:423.98px" class="cls_018">
            <span class="cls_018">83</span>
        </div>
        <div style="position:absolute;left:126.00px;top:437.18px" class="cls_018">
            <span class="cls_018">The catch</span>
        </div>
        <div style="position:absolute;left:491.76px;top:437.18px" class="cls_018">
            <span class="cls_018">83</span>
        </div>
        <div style="position:absolute;left:115.20px;top:450.38px" class="cls_017">
            <span class="cls_017">The three-step find-edit-save approach</span>
        </div>
        <div style="position:absolute;left:491.76px;top:450.38px" class="cls_017">
            <span class="cls_017">83</span>
        </div>
        <div style="position:absolute;left:115.20px;top:463.58px" class="cls_017">
            <span class="cls_017">CRUD - editing users and projects</span>
        </div>
        <div style="position:absolute;left:491.76px;top:463.58px" class="cls_017">
            <span class="cls_017">84</span>
        </div>
        <div style="position:absolute;left:126.00px;top:476.78px" class="cls_018">
            <span class="cls_018">Tracking user login</span>
        </div>
        <div style="position:absolute;left:491.76px;top:476.78px" class="cls_018">
            <span class="cls_018">84</span>
        </div>
        <div style="position:absolute;left:126.00px;top:489.98px" class="cls_018">
            <span class="cls_018">Editing the current user</span>
        </div>
        <div style="position:absolute;left:491.76px;top:489.98px" class="cls_018">
            <span class="cls_018">85</span>
        </div>
        <div style="position:absolute;left:133.20px;top:502.78px" class="cls_009">
            <span class="cls_009">Routes in use</span>
        </div>
        <div style="position:absolute;left:493.99px;top:502.78px" class="cls_009">
            <span class="cls_009">85</span>
        </div>
        <div style="position:absolute;left:133.20px;top:513.58px" class="cls_009">
            <span class="cls_009">Setting up the form</span>
        </div>
        <div style="position:absolute;left:493.99px;top:513.58px" class="cls_009">
            <span class="cls_009">85</span>
        </div>
        <div style="position:absolute;left:133.20px;top:524.38px" class="cls_009">
            <span class="cls_009">Setting up the controllers</span>
        </div>
        <div style="position:absolute;left:493.99px;top:524.38px" class="cls_009">
            <span class="cls_009">85</span>
        </div>
        <div style="position:absolute;left:133.20px;top:535.18px" class="cls_009">
            <span class="cls_009">Committing the edit</span>
        </div>
        <div style="position:absolute;left:493.99px;top:535.18px" class="cls_009">
            <span class="cls_009">86</span>
        </div>
        <div style="position:absolute;left:126.00px;top:546.38px" class="cls_018">
            <span class="cls_018">Editing projects</span>
        </div>
        <div style="position:absolute;left:491.76px;top:546.38px" class="cls_018">
            <span class="cls_018">88</span>
        </div>
        <div style="position:absolute;left:133.20px;top:559.18px" class="cls_009">
            <span class="cls_009">Routes</span>
        </div>
        <div style="position:absolute;left:493.99px;top:559.18px" class="cls_009">
            <span class="cls_009">88</span>
        </div>
        <div style="position:absolute;left:133.20px;top:569.98px" class="cls_009">
            <span class="cls_009">New files and functions</span>
        </div>
        <div style="position:absolute;left:493.99px;top:569.98px" class="cls_009">
            <span class="cls_009">89</span>
        </div>
        <div style="position:absolute;left:115.20px;top:581.18px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:491.76px;top:581.18px" class="cls_017">
            <span class="cls_017">89</span>
        </div>
        <div style="position:absolute;left:108.00px;top:595.96px" class="cls_016">
            <span class="cls_016">Chapter 8: Interacting with Data - Deleting</span>
        </div>
        <div style="position:absolute;left:490.66px;top:595.96px" class="cls_016">
            <span class="cls_016">91</span>
        </div>
        <div style="position:absolute;left:115.20px;top:611.66px" class="cls_017">
            <span class="cls_017">Deleting data</span>
        </div>
        <div style="position:absolute;left:491.76px;top:611.66px" class="cls_017">
            <span class="cls_017">91</span>
        </div>
        <div style="position:absolute;left:115.20px;top:624.86px" class="cls_017">
            <span class="cls_017">CRUD - deleting user and projects</span>
        </div>
        <div style="position:absolute;left:491.76px;top:624.86px" class="cls_017">
            <span class="cls_017">93</span>
        </div>
        <div style="position:absolute;left:126.00px;top:638.06px" class="cls_018">
            <span class="cls_018">The "Are you sure" page</span>
        </div>
        <div style="position:absolute;left:491.76px;top:638.06px" class="cls_018">
            <span class="cls_018">93</span>
        </div>
        <div style="position:absolute;left:296.48px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> iv </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:8822px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background012.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:440.96px;top:94.56px" class="cls_019">
            <span class="cls_019">Table of Contents</span>
        </div>
        <div style="position:absolute;left:126.00px;top:114.37px" class="cls_018">
            <span class="cls_018">Deleting the user</span>
        </div>
        <div style="position:absolute;left:491.76px;top:114.37px" class="cls_018">
            <span class="cls_018">94</span>
        </div>
        <div style="position:absolute;left:133.20px;top:127.17px" class="cls_009">
            <span class="cls_009">Improving on this</span>
        </div>
        <div style="position:absolute;left:493.99px;top:127.17px" class="cls_009">
            <span class="cls_009">95</span>
        </div>
        <div style="position:absolute;left:126.00px;top:138.37px" class="cls_018">
            <span class="cls_018">Deleting individual projects</span>
        </div>
        <div style="position:absolute;left:491.76px;top:138.37px" class="cls_018">
            <span class="cls_018">95</span>
        </div>
        <div style="position:absolute;left:133.20px;top:151.17px" class="cls_009">
            <span class="cls_009">Routes</span>
        </div>
        <div style="position:absolute;left:493.99px;top:151.17px" class="cls_009">
            <span class="cls_009">95</span>
        </div>
        <div style="position:absolute;left:133.20px;top:161.97px" class="cls_009">
            <span class="cls_009">New files and functions</span>
        </div>
        <div style="position:absolute;left:493.99px;top:161.97px" class="cls_009">
            <span class="cls_009">95</span>
        </div>
        <div style="position:absolute;left:115.20px;top:173.17px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:491.76px;top:173.17px" class="cls_017">
            <span class="cls_017">95</span>
        </div>
        <div style="position:absolute;left:108.00px;top:187.95px" class="cls_016">
            <span class="cls_016">Chapter 9: Validating Data</span>
        </div>
        <div style="position:absolute;left:490.66px;top:187.95px" class="cls_016">
            <span class="cls_016">97</span>
        </div>
        <div style="position:absolute;left:115.20px;top:203.65px" class="cls_017">
            <span class="cls_017">Mongoose validation - the basics</span>
        </div>
        <div style="position:absolute;left:491.76px;top:203.65px" class="cls_017">
            <span class="cls_017">97</span>
        </div>
        <div style="position:absolute;left:126.00px;top:216.85px" class="cls_018">
            <span class="cls_018">Default validators</span>
        </div>
        <div style="position:absolute;left:491.76px;top:216.85px" class="cls_018">
            <span class="cls_018">97</span>
        </div>
        <div style="position:absolute;left:133.20px;top:229.65px" class="cls_009">
            <span class="cls_009">All SchemaTypes</span>
        </div>
        <div style="position:absolute;left:493.99px;top:229.65px" class="cls_009">
            <span class="cls_009">98</span>
        </div>
        <div style="position:absolute;left:133.20px;top:240.45px" class="cls_009">
            <span class="cls_009">Number SchemaType</span>
        </div>
        <div style="position:absolute;left:493.99px;top:240.45px" class="cls_009">
            <span class="cls_009">98</span>
        </div>
        <div style="position:absolute;left:133.20px;top:251.25px" class="cls_009">
            <span class="cls_009">String SchemaType</span>
        </div>
        <div style="position:absolute;left:493.99px;top:251.25px" class="cls_009">
            <span class="cls_009">98</span>
        </div>
        <div style="position:absolute;left:115.20px;top:262.45px" class="cls_017">
            <span class="cls_017">Understanding validation errors</span>
        </div>
        <div style="position:absolute;left:491.76px;top:262.45px" class="cls_017">
            <span class="cls_017">99</span>
        </div>
        <div style="position:absolute;left:115.20px;top:275.65px" class="cls_017">
            <span class="cls_017">Doing it your way - create custom validation</span>
        </div>
        <div style="position:absolute;left:485.65px;top:275.65px" class="cls_017">
            <span class="cls_017">100</span>
        </div>
        <div style="position:absolute;left:126.00px;top:288.85px" class="cls_018">
            <span class="cls_018">Single function - no custom error message</span>
        </div>
        <div style="position:absolute;left:485.65px;top:288.85px" class="cls_018">
            <span class="cls_018">100</span>
        </div>
        <div style="position:absolute;left:126.00px;top:302.05px" class="cls_018">
            <span class="cls_018">Returning a custom error message</span>
        </div>
        <div style="position:absolute;left:485.65px;top:302.05px" class="cls_018">
            <span class="cls_018">100</span>
        </div>
        <div style="position:absolute;left:133.20px;top:314.85px" class="cls_009">
            <span class="cls_009">Validating a regular expression</span>
        </div>
        <div style="position:absolute;left:488.99px;top:314.85px" class="cls_009">
            <span class="cls_009">101</span>
        </div>
        <div style="position:absolute;left:133.20px;top:325.65px" class="cls_009">
            <span class="cls_009">Taking the messages out of the schema</span>
        </div>
        <div style="position:absolute;left:488.99px;top:325.65px" class="cls_009">
            <span class="cls_009">101</span>
        </div>
        <div style="position:absolute;left:126.00px;top:336.85px" class="cls_018">
            <span class="cls_018">Using multiple re-usable validators</span>
        </div>
        <div style="position:absolute;left:485.64px;top:336.85px" class="cls_018">
            <span class="cls_018">101</span>
        </div>
        <div style="position:absolute;left:126.00px;top:350.05px" class="cls_018">
            <span class="cls_018">Non-blocking, asynchronous validation</span>
        </div>
        <div style="position:absolute;left:485.64px;top:350.05px" class="cls_018">
            <span class="cls_018">102</span>
        </div>
        <div style="position:absolute;left:126.00px;top:363.25px" class="cls_018">
            <span class="cls_018">Extending Mongoose validation</span>
        </div>
        <div style="position:absolute;left:485.64px;top:363.25px" class="cls_018">
            <span class="cls_018">103</span>
        </div>
        <div style="position:absolute;left:115.20px;top:376.45px" class="cls_017">
            <span class="cls_017">Adding validation to our project</span>
        </div>
        <div style="position:absolute;left:485.64px;top:376.45px" class="cls_017">
            <span class="cls_017">103</span>
        </div>
        <div style="position:absolute;left:115.20px;top:389.65px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:485.64px;top:389.65px" class="cls_017">
            <span class="cls_017">104</span>
        </div>
        <div style="position:absolute;left:108.00px;top:404.43px" class="cls_016">
            <span class="cls_016">Chapter 10: Complex Schemas</span>
        </div>
        <div style="position:absolute;left:483.98px;top:404.43px" class="cls_016">
            <span class="cls_016">105</span>
        </div>
        <div style="position:absolute;left:115.20px;top:420.13px" class="cls_017">
            <span class="cls_017">Population - references to other collections</span>
        </div>
        <div style="position:absolute;left:485.65px;top:420.13px" class="cls_017">
            <span class="cls_017">105</span>
        </div>
        <div style="position:absolute;left:126.00px;top:433.33px" class="cls_018">
            <span class="cls_018">Defining data for population</span>
        </div>
        <div style="position:absolute;left:485.65px;top:433.33px" class="cls_018">
            <span class="cls_018">106</span>
        </div>
        <div style="position:absolute;left:126.00px;top:446.53px" class="cls_018">
            <span class="cls_018">Saving population references</span>
        </div>
        <div style="position:absolute;left:485.65px;top:446.53px" class="cls_018">
            <span class="cls_018">107</span>
        </div>
        <div style="position:absolute;left:126.00px;top:459.73px" class="cls_018">
            <span class="cls_018">Retrieving populated data</span>
        </div>
        <div style="position:absolute;left:485.65px;top:459.73px" class="cls_018">
            <span class="cls_018">107</span>
        </div>
        <div style="position:absolute;left:133.20px;top:472.53px" class="cls_009">
            <span class="cls_009">Querying to return a subset of results</span>
        </div>
        <div style="position:absolute;left:488.99px;top:472.53px" class="cls_009">
            <span class="cls_009">109</span>
        </div>
        <div style="position:absolute;left:133.20px;top:483.33px" class="cls_009">
            <span class="cls_009">Populating into multiple parent items</span>
        </div>
        <div style="position:absolute;left:489.65px;top:483.33px" class="cls_009">
            <span class="cls_009">110</span>
        </div>
        <div style="position:absolute;left:115.20px;top:494.53px" class="cls_017">
            <span class="cls_017">Subdocuments</span>
        </div>
        <div style="position:absolute;left:486.25px;top:494.53px" class="cls_017">
            <span class="cls_017">110</span>
        </div>
        <div style="position:absolute;left:126.00px;top:507.73px" class="cls_018">
            <span class="cls_018">Creating subdocuments</span>
        </div>
        <div style="position:absolute;left:486.46px;top:507.73px" class="cls_018">
            <span class="cls_018">112</span>
        </div>
        <div style="position:absolute;left:133.20px;top:520.53px" class="cls_009">
            <span class="cls_009">Saving and validation</span>
        </div>
        <div style="position:absolute;left:489.65px;top:520.53px" class="cls_009">
            <span class="cls_009">112</span>
        </div>
        <div style="position:absolute;left:126.00px;top:531.73px" class="cls_018">
            <span class="cls_018">Retrieving subdocuments</span>
        </div>
        <div style="position:absolute;left:486.46px;top:531.73px" class="cls_018">
            <span class="cls_018">113</span>
        </div>
        <div style="position:absolute;left:133.20px;top:544.53px" class="cls_009">
            <span class="cls_009">Accessing a specific subdocument</span>
        </div>
        <div style="position:absolute;left:489.65px;top:544.53px" class="cls_009">
            <span class="cls_009">113</span>
        </div>
        <div style="position:absolute;left:126.00px;top:555.73px" class="cls_018">
            <span class="cls_018">Deleting subdocuments</span>
        </div>
        <div style="position:absolute;left:486.46px;top:555.73px" class="cls_018">
            <span class="cls_018">114</span>
        </div>
        <div style="position:absolute;left:115.20px;top:568.93px" class="cls_017">
            <span class="cls_017">Data management when modifying existing schemas</span>
        </div>
        <div style="position:absolute;left:486.25px;top:568.93px" class="cls_017">
            <span class="cls_017">114</span>
        </div>
        <div style="position:absolute;left:115.20px;top:582.13px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:486.25px;top:582.13px" class="cls_017">
            <span class="cls_017">115</span>
        </div>
        <div style="position:absolute;left:108.00px;top:596.91px" class="cls_016">
            <span class="cls_016">Chapter 11: Plugins - Re-using Code</span>
        </div>
        <div style="position:absolute;left:484.64px;top:596.91px" class="cls_016">
            <span class="cls_016">117</span>
        </div>
        <div style="position:absolute;left:115.20px;top:612.61px" class="cls_017">
            <span class="cls_017">Reusable schema plugins</span>
        </div>
        <div style="position:absolute;left:486.25px;top:612.61px" class="cls_017">
            <span class="cls_017">117</span>
        </div>
        <div style="position:absolute;left:126.00px;top:625.81px" class="cls_018">
            <span class="cls_018">Creating a schema plugin</span>
        </div>
        <div style="position:absolute;left:486.46px;top:625.81px" class="cls_018">
            <span class="cls_018">117</span>
        </div>
        <div style="position:absolute;left:133.20px;top:638.61px" class="cls_009">
            <span class="cls_009">Applying the plugin to an existing schema</span>
        </div>
        <div style="position:absolute;left:489.65px;top:638.61px" class="cls_009">
            <span class="cls_009">118</span>
        </div>
        <div style="position:absolute;left:298.21px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> v </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:9624px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background013.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Table of Contents</span>
        </div>
        <div style="position:absolute;left:133.20px;top:114.91px" class="cls_009">
            <span class="cls_009">Using an external file</span>
        </div>
        <div style="position:absolute;left:489.65px;top:114.91px" class="cls_009">
            <span class="cls_009">118</span>
        </div>
        <div style="position:absolute;left:133.20px;top:125.71px" class="cls_009">
            <span class="cls_009">Using schema middleware</span>
        </div>
        <div style="position:absolute;left:489.65px;top:125.71px" class="cls_009">
            <span class="cls_009">119</span>
        </div>
        <div style="position:absolute;left:115.20px;top:136.91px" class="cls_017">
            <span class="cls_017">Sharing with the community</span>
        </div>
        <div style="position:absolute;left:485.65px;top:136.91px" class="cls_017">
            <span class="cls_017">120</span>
        </div>
        <div style="position:absolute;left:115.20px;top:150.11px" class="cls_017">
            <span class="cls_017">Summary</span>
        </div>
        <div style="position:absolute;left:485.65px;top:150.11px" class="cls_017">
            <span class="cls_017">120</span>
        </div>
        <div style="position:absolute;left:108.00px;top:164.89px" class="cls_016">
            <span class="cls_016">Index</span>
        </div>
        <div style="position:absolute;left:483.98px;top:164.89px" class="cls_016">
            <span class="cls_016">121</span>
        </div>
        <div style="position:absolute;left:296.48px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> vi </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:10426px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background014.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:400.61px;top:218.73px" class="cls_015">
            <span class="cls_015">Preface</span>
        </div>
        <div style="position:absolute;left:108.00px;top:272.43px" class="cls_021">
            <span class="cls_021">Mongoose for Application Development</span>
            <span class="cls_006"> will show you how to leverage the power of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:285.03px" class="cls_006">
            <span class="cls_006">Mongoose to dramatically speed up your development process with Node.js and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:297.63px" class="cls_006">
            <span class="cls_006">MongoDB. At the highest level, Mongoose is all about having a data model, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:310.23px" class="cls_006">
            <span class="cls_006">bringing control and management of that model into your application. Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:322.83px" class="cls_006">
            <span class="cls_006">enables you to create a robust yet rich data structure, providing you with a level</span>
        </div>
        <div style="position:absolute;left:108.00px;top:335.43px" class="cls_006">
            <span class="cls_006">of database management that you don't normally get with MongoDB. With its</span>
        </div>
        <div style="position:absolute;left:108.00px;top:348.03px" class="cls_006">
            <span class="cls_006">built-in helper methods, Mongoose provides a lot of the common functionality you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:360.63px" class="cls_006">
            <span class="cls_006">will need, while also providing a framework for extending it in ways to meet your</span>
        </div>
        <div style="position:absolute;left:108.00px;top:373.23px" class="cls_006">
            <span class="cls_006">application needs.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:405.73px" class="cls_022">
            <span class="cls_022">What this book covers</span>
        </div>
        <div style="position:absolute;left:108.00px;top:430.71px" class="cls_021">
            <span class="cls_021">Chapter 1</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Introducing Mongoose to the Technology Stack</span>
            <span class="cls_006">, takes a look at the Node.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:443.31px" class="cls_006">
            <span class="cls_006">js, MongoDB, and Express technology stack and introduces Mongoose and shows</span>
        </div>
        <div style="position:absolute;left:108.00px;top:455.91px" class="cls_006">
            <span class="cls_006">where it fits in.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:477.16px" class="cls_021">
            <span class="cls_021">Chapter 2</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Establishing a Database Connection</span>
            <span class="cls_006">, covers the different methods of creating</span>
        </div>
        <div style="position:absolute;left:108.00px;top:489.76px" class="cls_006">
            <span class="cls_006">database connections with Mongoose, including how and when to use them.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:511.00px" class="cls_021">
            <span class="cls_021">Chapter</span>
            <span class="cls_006"> </span>
            <span class="cls_021">3</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Schemas and Models</span>
            <span class="cls_006">, introduces the two cornerstones of Mongoose,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:523.60px" class="cls_006">
            <span class="cls_006">covering how to create them and how they relate to the data.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:544.84px" class="cls_021">
            <span class="cls_021">Chapter</span>
            <span class="cls_006"> </span>
            <span class="cls_021">4</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Interacting with Data - An Introduction</span>
            <span class="cls_006">, explains how Mongoose</span>
        </div>
        <div style="position:absolute;left:108.01px;top:557.44px" class="cls_006">
            <span class="cls_006">provides methods for easily interacting with data, setting the scene for the</span>
        </div>
        <div style="position:absolute;left:108.01px;top:570.04px" class="cls_006">
            <span class="cls_006">following four chapters.</span>
        </div>
        <div style="position:absolute;left:108.01px;top:591.28px" class="cls_021">
            <span class="cls_021">Chapter</span>
            <span class="cls_006"> </span>
            <span class="cls_021">5</span>
            <span class="cls_006">,</span>
            <span class="cls_021"> Interacting with Data - Creation</span>
            <span class="cls_006">, covers the ways we can use Mongoose</span>
        </div>
        <div style="position:absolute;left:108.01px;top:603.88px" class="cls_006">
            <span class="cls_006">to create data and save it to the database.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:11228px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background015.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Preface</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_021">
            <span class="cls_021">Chapter</span>
            <span class="cls_006"> </span>
            <span class="cls_021">6</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Interacting with Data - Reading, Querying, and Finding</span>
            <span class="cls_006">, covers the ways we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">can use Mongoose to find the data we want by querying the database and reading</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">the data back into Model instances. It shows how to use the built-in methods, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.29px" class="cls_006">
            <span class="cls_006">also how to extend Mongoose to run the specific queries that you may want.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:173.54px" class="cls_021">
            <span class="cls_021">Chapter 7</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Interacting with Data - Updating</span>
            <span class="cls_006">, covers the ways we can use Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:186.14px" class="cls_006">
            <span class="cls_006">to change existing data, including the built-in helper methods, and a more robust</span>
        </div>
        <div style="position:absolute;left:108.00px;top:198.74px" class="cls_006">
            <span class="cls_006">approach for data integrity.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:219.98px" class="cls_021">
            <span class="cls_021">Chapter 8</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Interacting with Data - Deleting</span>
            <span class="cls_006">, covers the ways we can use Mongoose to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:232.58px" class="cls_006">
            <span class="cls_006">delete documents from the database.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:253.82px" class="cls_021">
            <span class="cls_021">Chapter 9</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Validating Data</span>
            <span class="cls_006">, looks at maintaining data integrity, covering the validators</span>
        </div>
        <div style="position:absolute;left:108.00px;top:266.42px" class="cls_006">
            <span class="cls_006">built in to Mongoose and explaining how to add custom validation.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:287.66px" class="cls_021">
            <span class="cls_021">Chapter 10</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Complex Schemas</span>
            <span class="cls_006">, introduces the concepts of population and sub-</span>
        </div>
        <div style="position:absolute;left:108.00px;top:300.26px" class="cls_006">
            <span class="cls_006">documents to allow richer data models, mimicking some of the functionality found</span>
        </div>
        <div style="position:absolute;left:108.00px;top:312.86px" class="cls_006">
            <span class="cls_006">with traditional SQL JOIN statements.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:334.10px" class="cls_021">
            <span class="cls_021">Chapter 11</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Plugins - Reusing Code</span>
            <span class="cls_006">, introduces the Mongoose plugin architecture,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:346.70px" class="cls_006">
            <span class="cls_006">covering how to create your own re-usable plugins to remove repetition in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:359.30px" class="cls_006">
            <span class="cls_006">your schemas.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:391.79px" class="cls_022">
            <span class="cls_022">What you need for this book</span>
        </div>
        <div style="position:absolute;left:108.00px;top:416.77px" class="cls_006">
            <span class="cls_006">All you need for this book is a computer capable of running Node.js, administrator/</span>
        </div>
        <div style="position:absolute;left:108.00px;top:429.37px" class="cls_006">
            <span class="cls_006">installation permissions, and a text editor.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:461.87px" class="cls_022">
            <span class="cls_022">Who this book is for</span>
        </div>
        <div style="position:absolute;left:108.00px;top:486.85px" class="cls_006">
            <span class="cls_006">This book is for people who are interested in building applications in Node.js.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:499.45px" class="cls_006">
            <span class="cls_006">If you want to build applications quickly with a robust and manageable data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:512.05px" class="cls_006">
            <span class="cls_006">structure then this book is for you! No experience with Node is necessary, but</span>
        </div>
        <div style="position:absolute;left:108.00px;top:524.65px" class="cls_006">
            <span class="cls_006">some basic knowledge of HTML and JavaScript would be useful. The focus of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:537.25px" class="cls_006">
            <span class="cls_006">book is on the power of Mongoose, so experienced Node.js developers will also</span>
        </div>
        <div style="position:absolute;left:108.00px;top:549.85px" class="cls_006">
            <span class="cls_006">find it useful.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:582.35px" class="cls_022">
            <span class="cls_022">Conventions</span>
        </div>
        <div style="position:absolute;left:108.00px;top:607.33px" class="cls_006">
            <span class="cls_006">In this book, you will find a number of styles of text that distinguish between</span>
        </div>
        <div style="position:absolute;left:108.00px;top:619.93px" class="cls_006">
            <span class="cls_006">different kinds of information. Here are some examples of these styles, and an</span>
        </div>
        <div style="position:absolute;left:108.00px;top:632.53px" class="cls_006">
            <span class="cls_006">explanation of their meaning.</span>
        </div>
        <div style="position:absolute;left:297.59px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 2 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:12030px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background016.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:478.46px;top:94.56px" class="cls_019">
            <span class="cls_019">Preface</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Code words in text, database table names, folder names, filenames, file extensions,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">pathnames, dummy URLs, user input, and Twitter handles are shown as follows:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">"You may find that your installation of Express has already created the file </span>
            <span class="cls_007">routes/</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.29px" class="cls_007">
            <span class="cls_007">user.js</span>
            <span class="cls_006">—this is fine, you can just open it and delete the contents."</span>
        </div>
        <div style="position:absolute;left:108.00px;top:173.54px" class="cls_006">
            <span class="cls_006">A block of code is set as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:194.47px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:206.71px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:218.95px" class="cls_023">
            <span class="cls_023">email: {type: String, unique:true},</span>
        </div>
        <div style="position:absolute;left:136.80px;top:231.19px" class="cls_023">
            <span class="cls_023">createdOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:243.43px" class="cls_023">
            <span class="cls_023">modifiedOn: { type: Date, default: Date.now },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:255.67px" class="cls_023">
            <span class="cls_023">lastLogin: Date</span>
        </div>
        <div style="position:absolute;left:108.00px;top:275.41px" class="cls_006">
            <span class="cls_006">When we wish to draw your attention to a particular part of a code block, the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:288.01px" class="cls_006">
            <span class="cls_006">relevant lines or items are set in bold:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:308.95px" class="cls_023">
            <span class="cls_023">var express = require('express')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:321.19px" class="cls_023">
            <span class="cls_023">, db = require('./model/db')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:333.43px" class="cls_023">
            <span class="cls_023">, routes = require('./routes')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:345.67px" class="cls_024">
            <span class="cls_024">, user = require('./routes/user')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:357.91px" class="cls_024">
            <span class="cls_024">, project = require('./routes/project')</span>
        </div>
        <div style="position:absolute;left:108.00px;top:377.65px" class="cls_006">
            <span class="cls_006">Any command-line input or output is written as follows:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:398.59px" class="cls_024">
            <span class="cls_024">$ sudo apt-get install npm</span>
        </div>
        <div style="position:absolute;left:108.00px;top:418.33px" class="cls_025">
            <span class="cls_025">New terms</span>
            <span class="cls_006"> and </span>
            <span class="cls_025">important words</span>
            <span class="cls_006"> are shown in bold. Words that you see on the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:430.93px" class="cls_006">
            <span class="cls_006">screen, in menus or dialog boxes for example, appear in the text like this: "If it</span>
        </div>
        <div style="position:absolute;left:108.00px;top:443.53px" class="cls_006">
            <span class="cls_006">finds it, MongoDB (not Mongoose) will return an </span>
            <span class="cls_025">E11000</span>
            <span class="cls_006"> error.".</span>
        </div>
        <div style="position:absolute;left:209.72px;top:481.49px" class="cls_026">
            <span class="cls_026">Warnings or important notes appear in a box like this.</span>
        </div>
        <div style="position:absolute;left:209.06px;top:535.49px" class="cls_026">
            <span class="cls_026">Tips and tricks appear like this.</span>
        </div>
        <div style="position:absolute;left:298.21px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 3 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:12832px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background017.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Preface</span>
        </div>
        <div style="position:absolute;left:108.00px;top:111.92px" class="cls_022">
            <span class="cls_022">Reader feedback</span>
        </div>
        <div style="position:absolute;left:108.00px;top:136.90px" class="cls_006">
            <span class="cls_006">Feedback from our readers is always welcome. Let us know what you think about</span>
        </div>
        <div style="position:absolute;left:108.00px;top:149.50px" class="cls_006">
            <span class="cls_006">this book—what you liked or may have disliked. Reader feedback is important for us</span>
        </div>
        <div style="position:absolute;left:108.00px;top:162.10px" class="cls_006">
            <span class="cls_006">to develop titles that you really get the most out of.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:183.34px" class="cls_006">
            <span class="cls_006">To send us general feedback, simply send an e-mail to </span>
            <span class="cls_007">feedback@packtpub.com</span>
            <span class="cls_006">,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:195.94px" class="cls_006">
            <span class="cls_006">and mention the book title via the subject of your message.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:217.18px" class="cls_006">
            <span class="cls_006">If there is a topic that you have expertise in and you are interested in either writing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:229.78px" class="cls_006">
            <span class="cls_006">or contributing to a book, see our author guide on </span>
            <span class="cls_007">www.packtpub.com/authors</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:262.28px" class="cls_022">
            <span class="cls_022">Customer support</span>
        </div>
        <div style="position:absolute;left:108.00px;top:287.26px" class="cls_006">
            <span class="cls_006">Now that you are the proud owner of a Packt book, we have a number of things to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:299.86px" class="cls_006">
            <span class="cls_006">help you to get the most from your purchase.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:329.80px" class="cls_027">
            <span class="cls_027">Downloading the example code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:352.78px" class="cls_006">
            <span class="cls_006">You can download the example code files for all Packt books you have purchased</span>
        </div>
        <div style="position:absolute;left:108.00px;top:365.38px" class="cls_006">
            <span class="cls_006">from your account at </span>
            <A HREF="http://www.PacktPub.com">http://www.packtpub.com</A>
            </span>
            <span class="cls_006">. If you purchased this book</span>
        </div>
        <div style="position:absolute;left:108.00px;top:377.98px" class="cls_006">
            <span class="cls_006">elsewhere, you can visit </span>
            <A HREF="http://www.PacktPub.com/support">http://www.packtpub.com/support</A>
            </span>
            <span class="cls_006"> and register to have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:390.58px" class="cls_006">
            <span class="cls_006">the files e-mailed directly to you.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:420.52px" class="cls_027">
            <span class="cls_027">Errata</span>
        </div>
        <div style="position:absolute;left:108.00px;top:443.50px" class="cls_006">
            <span class="cls_006">Although we have taken every care to ensure the accuracy of our content, mistakes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:456.10px" class="cls_006">
            <span class="cls_006">do happen. If you find a mistake in one of our books—maybe a mistake in the text or</span>
        </div>
        <div style="position:absolute;left:108.00px;top:468.70px" class="cls_006">
            <span class="cls_006">the code—we would be grateful if you would report this to us. By doing so, you can</span>
        </div>
        <div style="position:absolute;left:108.00px;top:481.30px" class="cls_006">
            <span class="cls_006">save other readers from frustration and help us improve subsequent versions of this</span>
        </div>
        <div style="position:absolute;left:108.00px;top:493.90px" class="cls_006">
            <span class="cls_006">book. If you find any errata, please report them by visiting </span>
            <A HREF="http://www.packtpub./">http://www.packtpub.</A>
            </span>
        </div>
        <div style="position:absolute;left:108.00px;top:506.50px" class="cls_007">
            <span class="cls_007">com/submit-errata</span>
            <span class="cls_006">, selecting your book, clicking on the </span>
            <span class="cls_025">errata</span>
            <span class="cls_006"> </span>
            <span class="cls_025">submission</span>
            <span class="cls_006"> </span>
            <span class="cls_025">form</span>
            <span class="cls_006"> link,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:519.10px" class="cls_006">
            <span class="cls_006">and entering the details of your errata. Once your errata are verified, your submission</span>
        </div>
        <div style="position:absolute;left:108.00px;top:531.70px" class="cls_006">
            <span class="cls_006">will be accepted and the errata will be uploaded on our website, or added to any list of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:544.30px" class="cls_006">
            <span class="cls_006">existing errata, under the Errata section of that title. Any existing errata can be viewed</span>
        </div>
        <div style="position:absolute;left:108.00px;top:556.90px" class="cls_006">
            <span class="cls_006">by selecting your title from </span>
            <span class="cls_007">http://www.packtpub.com/support</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:297.59px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 4 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:13634px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background018.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:478.46px;top:94.56px" class="cls_019">
            <span class="cls_019">Preface</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Piracy</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">Piracy of copyright material on the Internet is an ongoing problem across all media.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">At Packt, we take the protection of our copyright and licenses very seriously. If you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">come across any illegal copies of our works, in any form, on the Internet, please</span>
        </div>
        <div style="position:absolute;left:108.00px;top:173.24px" class="cls_006">
            <span class="cls_006">provide us with the location address or website name immediately so that we can</span>
        </div>
        <div style="position:absolute;left:108.00px;top:185.84px" class="cls_006">
            <span class="cls_006">pursue a remedy.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:207.08px" class="cls_006">
            <span class="cls_006">Please contact us at </span>
            <A HREF="mailto:copyright@packtpub.com">copyright@packtpub.com</A>
            </span>
            <span class="cls_006"> with a link to the suspected</span>
        </div>
        <div style="position:absolute;left:107.99px;top:219.68px" class="cls_006">
            <span class="cls_006">pirated material.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:240.93px" class="cls_006">
            <span class="cls_006">We appreciate your help in protecting our authors, and our ability to bring you</span>
        </div>
        <div style="position:absolute;left:107.99px;top:253.53px" class="cls_006">
            <span class="cls_006">valuable content.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:283.46px" class="cls_027">
            <span class="cls_027">Questions</span>
        </div>
        <div style="position:absolute;left:108.00px;top:306.44px" class="cls_006">
            <span class="cls_006">You can contact us at </span>
            <span class="cls_007">questions@packtpub.com</span>
            <span class="cls_006"> if you are having a problem with</span>
        </div>
        <div style="position:absolute;left:108.00px;top:319.04px" class="cls_006">
            <span class="cls_006">any aspect of the book, and we will do our best to address it.</span>
        </div>
        <div style="position:absolute;left:298.21px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 5 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:14436px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background019.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:15238px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background020.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:123.74px;top:218.71px" class="cls_015">
            <span class="cls_015">Introducing Mongoose to the</span>
        </div>
        <div style="position:absolute;left:268.85px;top:254.71px" class="cls_015">
            <span class="cls_015">Technology Stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.41px" class="cls_006">
            <span class="cls_006">We are going to take a look at the technology stack we'll be using throughout</span>
        </div>
        <div style="position:absolute;left:108.00px;top:321.01px" class="cls_006">
            <span class="cls_006">the book. After a brief discussion of Node, npm, MongoDB, and Express we will</span>
        </div>
        <div style="position:absolute;left:108.00px;top:333.61px" class="cls_006">
            <span class="cls_006">introduce Mongoose as an </span>
            <span class="cls_025">ODM</span>
            <span class="cls_006"> (</span>
            <span class="cls_025">Object-Document Modeler</span>
            <span class="cls_006">), cover good and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:346.21px" class="cls_006">
            <span class="cls_006">bad use cases, and introduce the two cornerstones of Mongoose.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:367.46px" class="cls_006">
            <span class="cls_006">By the end of this chapter you will have an understanding of the technology stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:380.06px" class="cls_006">
            <span class="cls_006">and where Mongoose fits in. We will also have set up the sample project that we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:392.66px" class="cls_006">
            <span class="cls_006">will build throughout the book.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:425.15px" class="cls_022">
            <span class="cls_022">The technology stack - Node.js, npm,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:449.15px" class="cls_022">
            <span class="cls_022">MongoDB, and Express</span>
        </div>
        <div style="position:absolute;left:108.00px;top:474.13px" class="cls_006">
            <span class="cls_006">The benefits of Node are making it ever more popular, and a set of compatible</span>
        </div>
        <div style="position:absolute;left:108.00px;top:486.73px" class="cls_006">
            <span class="cls_006">technologies are fast becoming the basis of a new standard development stack.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:516.67px" class="cls_027">
            <span class="cls_027">The language and the server - JavaScript</span>
        </div>
        <div style="position:absolute;left:108.00px;top:538.27px" class="cls_027">
            <span class="cls_027">and Node</span>
        </div>
        <div style="position:absolute;left:108.00px;top:561.25px" class="cls_006">
            <span class="cls_006">For quite some time JavaScript was mainly thought of as a lightweight browser-</span>
        </div>
        <div style="position:absolute;left:108.00px;top:573.85px" class="cls_006">
            <span class="cls_006">based scripting language. Microsoft did support a JavaScript version of Classic ASP,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:586.45px" class="cls_006">
            <span class="cls_006">but it was largely side-lined in favor of the VBScript version.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:607.70px" class="cls_006">
            <span class="cls_006">Fast-forward 10 years and there were some pretty impressive JavaScript-based apps</span>
        </div>
        <div style="position:absolute;left:108.00px;top:620.30px" class="cls_006">
            <span class="cls_006">on the Web, for example Gmail. The general view of JavaScript as a programming</span>
        </div>
        <div style="position:absolute;left:108.00px;top:632.90px" class="cls_006">
            <span class="cls_006">language was starting to change back then.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:16040px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background021.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Introducing Mongoose to the Technology Stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">In 2010 a new server-side system called </span>
            <span class="cls_025">Node.js</span>
            <span class="cls_006"> was starting to make waves in the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">Internet developer community. Node.js was a new way for using JavaScript on</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">the server side again. And it was quick and efficient. It could make scaling a web</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.29px" class="cls_006">
            <span class="cls_006">application much more cost-effective by reducing the amount of hardware required</span>
        </div>
        <div style="position:absolute;left:108.00px;top:164.89px" class="cls_006">
            <span class="cls_006">per-site visitor or request.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:186.14px" class="cls_006">
            <span class="cls_006">By 2012 Node was one of the buzzwords of the start-up scene, and you can see why.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:198.74px" class="cls_006">
            <span class="cls_006">Firstly, most Web developers have some JavaScript experience so it doesn't require</span>
        </div>
        <div style="position:absolute;left:108.00px;top:211.34px" class="cls_006">
            <span class="cls_006">you to learn a new language from scratch. This also means you can share some code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:223.94px" class="cls_006">
            <span class="cls_006">between front-end and back-end, so you don't have to code the same thing twice in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:236.54px" class="cls_006">
            <span class="cls_006">two different languages. An excellent example of this is form validation; you want</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.14px" class="cls_006">
            <span class="cls_006">real-time validation in the browser for a better user experience, but you also need</span>
        </div>
        <div style="position:absolute;left:108.00px;top:261.74px" class="cls_006">
            <span class="cls_006">to validate on the server side to protect your system. So you code the same thing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:274.34px" class="cls_006">
            <span class="cls_006">twice. Using Node you can use the same validation script on the server side and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:286.94px" class="cls_006">
            <span class="cls_006">the browser, so you only have to code it once, in JavaScript.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.18px" class="cls_006">
            <span class="cls_006">Second, there is the reduced cost of scaling, especially when dealing with large</span>
        </div>
        <div style="position:absolute;left:108.00px;top:320.78px" class="cls_006">
            <span class="cls_006">numbers of concurrent users. On the same hardware Node's efficiencies allow it</span>
        </div>
        <div style="position:absolute;left:108.00px;top:333.38px" class="cls_006">
            <span class="cls_006">to handle many more requests than classic stacks on Apache or IIS. That being said,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:345.98px" class="cls_006">
            <span class="cls_006">adding scalability to Node is more complicated than other stacks. Unlike the others</span>
        </div>
        <div style="position:absolute;left:108.00px;top:358.58px" class="cls_006">
            <span class="cls_006">you can't just put it on a more powerful machine and set it running. By default</span>
        </div>
        <div style="position:absolute;left:108.00px;top:371.18px" class="cls_006">
            <span class="cls_006">Node will currently only run one process, using only one core of a machine. There</span>
        </div>
        <div style="position:absolute;left:108.00px;top:383.78px" class="cls_006">
            <span class="cls_006">are methods to address this issue, using a load balancer in front of several processes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:396.38px" class="cls_006">
            <span class="cls_006">running alongside each other for example, and there are plans to enable future</span>
        </div>
        <div style="position:absolute;left:108.00px;top:408.98px" class="cls_006">
            <span class="cls_006">versions of Node to be able to manage this natively, directly addressing this issue.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:430.22px" class="cls_006">
            <span class="cls_006">The benefits of scalability do have a cost. The single process is a more complicated</span>
        </div>
        <div style="position:absolute;left:108.00px;top:442.82px" class="cls_006">
            <span class="cls_006">approach to server-side programming and requires a change in mindset.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:472.75px" class="cls_027">
            <span class="cls_027">Single-threaded versus multithreaded</span>
        </div>
        <div style="position:absolute;left:108.00px;top:495.73px" class="cls_006">
            <span class="cls_006">Traditional stacks are generally </span>
            <span class="cls_025">multithreaded</span>
            <span class="cls_006">. This means that every new visitor</span>
        </div>
        <div style="position:absolute;left:108.00px;top:508.33px" class="cls_006">
            <span class="cls_006">or session is given a new thread, and these are never shared. One session's activity</span>
        </div>
        <div style="position:absolute;left:108.00px;top:520.93px" class="cls_006">
            <span class="cls_006">generally doesn't impact another, until the server resources are exhausted. For</span>
        </div>
        <div style="position:absolute;left:108.00px;top:533.53px" class="cls_006">
            <span class="cls_006">example, if </span>
            <span class="cls_007">Session 1</span>
            <span class="cls_006"> is doing a complex database write operation it may take</span>
        </div>
        <div style="position:absolute;left:108.00px;top:546.13px" class="cls_006">
            <span class="cls_006">a couple of seconds, but </span>
            <span class="cls_007">Session 2</span>
            <span class="cls_006"> continues running oblivious to this.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:567.38px" class="cls_006">
            <span class="cls_006">Node is </span>
            <span class="cls_025">single-threaded</span>
            <span class="cls_006">. This means that every visitor or session is added to that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:579.98px" class="cls_006">
            <span class="cls_006">one thread. So it is possible for a two-second database write operation to hold up</span>
        </div>
        <div style="position:absolute;left:108.00px;top:592.58px" class="cls_006">
            <span class="cls_006">every other user for two seconds. Multiply this by just 10 users and you've got a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:605.18px" class="cls_006">
            <span class="cls_006">big problem on your hands.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:626.42px" class="cls_006">
            <span class="cls_006">Addressing this requires a different way of coding.</span>
        </div>
        <div style="position:absolute;left:297.59px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 8 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:16842px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background022.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 1</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Blocking versus non-blocking code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">In the traditional stack, the approach to coding would be one step after the other, as</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">in the following steps:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:167.83px" class="cls_006">
            <span class="cls_006">1. First, take the data.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:184.75px" class="cls_006">
            <span class="cls_006">2. Then write this data to the database.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:201.66px" class="cls_006">
            <span class="cls_006">3. Send a confirmation message.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:218.58px" class="cls_006">
            <span class="cls_006">4. Wait for the next request.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:239.82px" class="cls_006">
            <span class="cls_006">This is </span>
            <span class="cls_025">blocking</span>
            <span class="cls_006"> code, as you can only do one thing at a time. This is fine in the</span>
        </div>
        <div style="position:absolute;left:107.99px;top:252.42px" class="cls_006">
            <span class="cls_006">multithreaded stack, as you're only ever responding to one person's requests.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:273.66px" class="cls_006">
            <span class="cls_006">In the single-threaded stack, you may have to respond to several people's requests</span>
        </div>
        <div style="position:absolute;left:107.99px;top:286.26px" class="cls_006">
            <span class="cls_006">at the same time, so you can't afford to be stuck doing time-consuming operations</span>
        </div>
        <div style="position:absolute;left:107.99px;top:298.86px" class="cls_006">
            <span class="cls_006">or waiting for someone else to do something. To do this, the approach to coding</span>
        </div>
        <div style="position:absolute;left:107.99px;top:311.46px" class="cls_006">
            <span class="cls_006">becomes more like the following:</span>
        </div>
        <div style="position:absolute;left:125.99px;top:332.70px" class="cls_006">
            <span class="cls_006">1. You give this data to someone.</span>
        </div>
        <div style="position:absolute;left:125.99px;top:349.62px" class="cls_006">
            <span class="cls_006">2. They write this data to the database.</span>
        </div>
        <div style="position:absolute;left:125.99px;top:366.53px" class="cls_006">
            <span class="cls_006">3. When they are done, they send a confirmation message; if this isn't</span>
        </div>
        <div style="position:absolute;left:143.98px;top:379.13px" class="cls_006">
            <span class="cls_006">something they can do, then they add it to your request list.</span>
        </div>
        <div style="position:absolute;left:125.99px;top:396.05px" class="cls_006">
            <span class="cls_006">4. You're going to take the next request.</span>
        </div>
        <div style="position:absolute;left:107.98px;top:417.29px" class="cls_006">
            <span class="cls_006">This is </span>
            <span class="cls_025">non-blocking</span>
            <span class="cls_006"> code. You can only do one at a time. So you're getting someone</span>
        </div>
        <div style="position:absolute;left:107.99px;top:429.89px" class="cls_006">
            <span class="cls_006">else to do something for you, and telling them what to do when they have finished.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:442.49px" class="cls_006">
            <span class="cls_006">You can then deal with the next request coming in without any delay.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:474.53px" class="cls_005">
            <span class="cls_005">JavaScript callbacks</span>
        </div>
        <div style="position:absolute;left:108.00px;top:493.51px" class="cls_006">
            <span class="cls_006">The way to code this in JavaScript is to use callbacks. Most JavaScript coders start</span>
        </div>
        <div style="position:absolute;left:108.00px;top:506.11px" class="cls_006">
            <span class="cls_006">using them before they even know it, particularly anybody who uses libraries such</span>
        </div>
        <div style="position:absolute;left:108.00px;top:518.71px" class="cls_006">
            <span class="cls_006">as jQuery.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:539.95px" class="cls_006">
            <span class="cls_006">Take the basic jQuery </span>
            <span class="cls_007">document.ready</span>
            <span class="cls_006"> method as shown in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:560.89px" class="cls_023">
            <span class="cls_023">$(document).ready(function() {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:573.13px" class="cls_023">
            <span class="cls_023">console.log("document ready");</span>
        </div>
        <div style="position:absolute;left:126.00px;top:585.37px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:298.21px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 9 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:17644px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background023.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Introducing Mongoose to the Technology Stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">This is an event driven callback. The </span>
            <span class="cls_007">$(document).ready()</span>
            <span class="cls_006"> part is a method</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">function of jQuery, and we are sending it a function </span>
            <span class="cls_007">function()</span>
            <span class="cls_006"> that it can run</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">at the appropriate time. So we are saying "Hi ready, here is what I want you to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.29px" class="cls_006">
            <span class="cls_006">do once the document is ready, I'll leave it up to you to decide when that is". The</span>
        </div>
        <div style="position:absolute;left:108.00px;top:164.89px" class="cls_006">
            <span class="cls_006">callback function we are using in this example is the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:185.83px" class="cls_023">
            <span class="cls_023">function() {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:198.07px" class="cls_023">
            <span class="cls_023">console.log("document ready");</span>
        </div>
        <div style="position:absolute;left:126.00px;top:210.31px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:232.19px" class="cls_005">
            <span class="cls_005">Running the callback</span>
        </div>
        <div style="position:absolute;left:108.00px;top:251.17px" class="cls_006">
            <span class="cls_006">The jQuery </span>
            <span class="cls_007">.ready()</span>
            <span class="cls_006"> function is pretty complicated, so we're not going to look at</span>
        </div>
        <div style="position:absolute;left:108.00px;top:263.77px" class="cls_006">
            <span class="cls_006">that here. However, the construct is very useful to understand. Look at the following</span>
        </div>
        <div style="position:absolute;left:108.00px;top:276.37px" class="cls_006">
            <span class="cls_006">code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:297.31px" class="cls_023">
            <span class="cls_023">ready = function (callback) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:309.55px" class="cls_023">
            <span class="cls_023">// do something</span>
        </div>
        <div style="position:absolute;left:136.80px;top:321.79px" class="cls_023">
            <span class="cls_023">// do something else</span>
        </div>
        <div style="position:absolute;left:136.80px;top:334.03px" class="cls_023">
            <span class="cls_023">//</span>
        </div>
        <div style="position:absolute;left:136.80px;top:346.27px" class="cls_023">
            <span class="cls_023">// and so on</span>
        </div>
        <div style="position:absolute;left:136.80px;top:358.51px" class="cls_023">
            <span class="cls_023">callback();</span>
        </div>
        <div style="position:absolute;left:126.00px;top:370.75px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:390.49px" class="cls_006">
            <span class="cls_006">So </span>
            <span class="cls_007">ready</span>
            <span class="cls_006"> itself is a function, and this function accepts one parameter </span>
            <span class="cls_007">callback</span>
            <span class="cls_006">. The</span>
        </div>
        <div style="position:absolute;left:108.00px;top:403.09px" class="cls_007">
            <span class="cls_007">callback</span>
            <span class="cls_006"> parameter is generally an anonymous function, like the one we looked at</span>
        </div>
        <div style="position:absolute;left:108.00px;top:415.69px" class="cls_006">
            <span class="cls_006">earlier. A very important point to note is that </span>
            <span class="cls_007">callback</span>
            <span class="cls_006"> now exists in the scope of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:428.29px" class="cls_007">
            <span class="cls_007">ready</span>
            <span class="cls_006"> function. This means that your </span>
            <span class="cls_007">callback</span>
            <span class="cls_006"> function has access to any variables</span>
        </div>
        <div style="position:absolute;left:108.00px;top:440.89px" class="cls_006">
            <span class="cls_006">or objects created in the </span>
            <span class="cls_007">ready</span>
            <span class="cls_006"> function.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:464.27px" class="cls_005">
            <span class="cls_005">A Node.js example</span>
        </div>
        <div style="position:absolute;left:108.00px;top:483.25px" class="cls_006">
            <span class="cls_006">Now consider the following standard Node "hello world" example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:504.19px" class="cls_023">
            <span class="cls_023">var http = require('http');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:516.43px" class="cls_023">
            <span class="cls_023">http.createServer(function (req, res) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:528.67px" class="cls_023">
            <span class="cls_023">res.writeHead(200, {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:540.91px" class="cls_023">
            <span class="cls_023">'Content-Type': 'text/plain'</span>
        </div>
        <div style="position:absolute;left:136.80px;top:553.15px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:136.80px;top:565.39px" class="cls_023">
            <span class="cls_023">res.write('Hello world');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:577.63px" class="cls_023">
            <span class="cls_023">res.end();</span>
        </div>
        <div style="position:absolute;left:126.00px;top:589.87px" class="cls_023">
            <span class="cls_023">})</span>
        </div>
        <div style="position:absolute;left:126.00px;top:602.11px" class="cls_023">
            <span class="cls_023">listen(8888, '127.0.0.1');</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 10 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:18446px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background024.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 1</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Look familiar? This is sending a callback to the </span>
            <span class="cls_007">http.createServer</span>
            <span class="cls_006"> method</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">function. See how the parameters—</span>
            <span class="cls_007">req</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">res</span>
            <span class="cls_006">—are being sent to the callback</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">function even though they haven't been defined or created anywhere. This works</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.29px" class="cls_006">
            <span class="cls_006">because the </span>
            <span class="cls_007">http.createServer</span>
            <span class="cls_006"> function will create these objects before calling</span>
        </div>
        <div style="position:absolute;left:108.00px;top:164.89px" class="cls_006">
            <span class="cls_006">this callback function that will use them.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:194.83px" class="cls_027">
            <span class="cls_027">The database - MongoDB</span>
        </div>
        <div style="position:absolute;left:108.00px;top:217.81px" class="cls_006">
            <span class="cls_006">MongoDB has become the main database of choice for working with Node. Note that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:230.41px" class="cls_006">
            <span class="cls_006">there are Node drivers for many other databases, including MySQL, Microsoft SQL</span>
        </div>
        <div style="position:absolute;left:108.00px;top:243.01px" class="cls_006">
            <span class="cls_006">Server, Reddis, PostgreSQL, CouchDB, and more.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:264.26px" class="cls_006">
            <span class="cls_006">MongoDB is popular as it is fast and flexible with excellent community support. It</span>
        </div>
        <div style="position:absolute;left:108.00px;top:276.86px" class="cls_006">
            <span class="cls_006">is a document-oriented database, fitting in somewhere between Key-Value stores</span>
        </div>
        <div style="position:absolute;left:108.00px;top:289.46px" class="cls_006">
            <span class="cls_006">and traditional relational databases. Despite being a document store, MongoDB also</span>
        </div>
        <div style="position:absolute;left:108.00px;top:302.06px" class="cls_006">
            <span class="cls_006">enables rich querying and secondary indexing of documents, setting it apart from</span>
        </div>
        <div style="position:absolute;left:108.00px;top:314.66px" class="cls_006">
            <span class="cls_006">other databases and making it a very powerful option.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:335.90px" class="cls_006">
            <span class="cls_006">MongoDB stores documents as BSON, which is effectively binary-encoded JSON.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:348.50px" class="cls_006">
            <span class="cls_006">When you run a query you get a JSON object returned (or a string in JSON format,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:361.10px" class="cls_006">
            <span class="cls_006">depending on the driver). Look at the following code snippet for example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:382.03px" class="cls_023">
            <span class="cls_023">{ "_id" : ObjectId("4ffbc45c35097b5a1583ad71"),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:392.83px" class="cls_023">
            <span class="cls_023">"firstname" : "Simon", "lastname" : "Holmes }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:412.57px" class="cls_006">
            <span class="cls_006">So, a document is a set of keys (for example, </span>
            <span class="cls_007">firstname</span>
            <span class="cls_006">) and values (for example,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:425.17px" class="cls_007">
            <span class="cls_007">Simon</span>
            <span class="cls_006">). The </span>
            <span class="cls_007">_id</span>
            <span class="cls_006"> entry is a unique identifier that the underlying MongoDB driver</span>
        </div>
        <div style="position:absolute;left:108.00px;top:437.77px" class="cls_006">
            <span class="cls_006">will—by default—create for each new document.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:459.02px" class="cls_006">
            <span class="cls_006">If you are more experienced with relational databases, it may help you to think of a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:471.62px" class="cls_006">
            <span class="cls_006">document as a bit like a row in a table. In this analogy, the </span>
            <span class="cls_025">key</span>
            <span class="cls_006"> can be thought of as</span>
        </div>
        <div style="position:absolute;left:108.00px;top:484.22px" class="cls_006">
            <span class="cls_006">a column. An important difference is that each document doesn't have to contain the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:496.82px" class="cls_006">
            <span class="cls_006">exact same set of keys, and there is no direct need to have keys with empty values</span>
        </div>
        <div style="position:absolute;left:108.00px;top:509.42px" class="cls_006">
            <span class="cls_006">taking up space.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:530.66px" class="cls_006">
            <span class="cls_006">A collection of documents is called a </span>
            <span class="cls_025">collection</span>
            <span class="cls_006">. The closest analogy is a table. So in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:543.26px" class="cls_006">
            <span class="cls_006">your database you could well have multiple collections, such as a users collection,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:555.86px" class="cls_006">
            <span class="cls_006">posts collection, and stats collection.</span>
        </div>
        <div style="position:absolute;left:296.21px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 11 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:19248px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background025.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Introducing Mongoose to the Technology Stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">MongoDB is also extremely scalable, with many built-in capabilities for distributing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">across multiple servers, without compromising speed or data integrity.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.34px" class="cls_006">
            <span class="cls_006">With everything combined, it makes MongoDB a great playmate for Node.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:178.27px" class="cls_027">
            <span class="cls_027">The framework - Express</span>
        </div>
        <div style="position:absolute;left:108.00px;top:201.25px" class="cls_025">
            <span class="cls_025">Express</span>
            <span class="cls_006"> is a web application framework for Node.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:222.50px" class="cls_006">
            <span class="cls_006">When you create a Node project, you have to do a lot more groundwork than</span>
        </div>
        <div style="position:absolute;left:108.00px;top:235.10px" class="cls_006">
            <span class="cls_006">you might be used to. Until you create it, there isn't even a web server. Then you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:247.70px" class="cls_006">
            <span class="cls_006">have to deal with serving static files in a non-blocking way, figure out the routing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:260.30px" class="cls_006">
            <span class="cls_006">mechanism, view engine, session management, and so on.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:281.54px" class="cls_006">
            <span class="cls_006">Or you can create an Express project and let it do all of this for you, in a tried-and-</span>
        </div>
        <div style="position:absolute;left:108.00px;top:294.14px" class="cls_006">
            <span class="cls_006">tested way. At the end of this chapter, we'll see how easy it is to set up an</span>
        </div>
        <div style="position:absolute;left:108.00px;top:306.74px" class="cls_006">
            <span class="cls_006">Express project.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:327.98px" class="cls_006">
            <span class="cls_006">Note that Express is not required to build a Node application, but it is a great starting</span>
        </div>
        <div style="position:absolute;left:108.00px;top:340.58px" class="cls_006">
            <span class="cls_006">point for building web applications.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:373.07px" class="cls_022">
            <span class="cls_022">What Mongoose is all about</span>
        </div>
        <div style="position:absolute;left:108.00px;top:398.05px" class="cls_006">
            <span class="cls_006">Mongoose is an object modeling tool for MongoDB and Node.js. What this means in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:410.65px" class="cls_006">
            <span class="cls_006">practical terms is that you can define your data model in just one place, in your code.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:431.90px" class="cls_006">
            <span class="cls_006">Yes, that's right. You don't have to create a schema in the database, link that to an</span>
        </div>
        <div style="position:absolute;left:108.00px;top:444.50px" class="cls_006">
            <span class="cls_006">ORM or map it into your project objects and classes. You can just define your data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:457.10px" class="cls_006">
            <span class="cls_006">structure in JSON inside your project.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:478.34px" class="cls_006">
            <span class="cls_006">The first time I created a project like this I was amazed at how much time and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:490.94px" class="cls_006">
            <span class="cls_006">frustration it saves. Even now I still get that warm glow when I start a new project or</span>
        </div>
        <div style="position:absolute;left:108.00px;top:503.54px" class="cls_006">
            <span class="cls_006">prototype using Mongoose. It's like taking a shortcut to work down deserted country</span>
        </div>
        <div style="position:absolute;left:108.00px;top:516.14px" class="cls_006">
            <span class="cls_006">lanes while everybody else is gridlocked on the highway.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:537.38px" class="cls_006">
            <span class="cls_006">A schema definition can be as simple as the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:558.31px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:570.55px" class="cls_023">
            <span class="cls_023">firstname: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:582.79px" class="cls_023">
            <span class="cls_023">lastname: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:595.03px" class="cls_023">
            <span class="cls_023">createdOn: Date</span>
        </div>
        <div style="position:absolute;left:126.00px;top:607.27px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 12 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:20050px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background026.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 1</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">A document in MongoDB created from this schema would be like the following</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.03px" class="cls_023">
            <span class="cls_023">{ "__v" : 0, "_id" : ObjectId("51412597e8e6d3e35c000001"),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:158.83px" class="cls_023">
            <span class="cls_023">"createdOn" : ISODate("2013-03-14T01:19:19.866Z"),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:169.63px" class="cls_023">
            <span class="cls_023">"firstname" : "Simon", " lastname " : "Holmes" }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:182.17px" class="cls_006">
            <span class="cls_006">If you want to refactor, then you can just do it from within your code, saving a huge</span>
        </div>
        <div style="position:absolute;left:108.00px;top:194.77px" class="cls_006">
            <span class="cls_006">amount of development time.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:224.71px" class="cls_027">
            <span class="cls_027">What is Mongoose good for?</span>
        </div>
        <div style="position:absolute;left:108.00px;top:247.69px" class="cls_006">
            <span class="cls_006">Mongoose is primarily useful when you want to interact with structured data in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:260.29px" class="cls_006">
            <span class="cls_006">MongoDB. It allows you to define a schema for your data, so that you can interact</span>
        </div>
        <div style="position:absolute;left:108.00px;top:272.89px" class="cls_006">
            <span class="cls_006">with your MongoDB data in a structured and repeatable way.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:294.14px" class="cls_006">
            <span class="cls_006">Mongoose helps with many common MongoDB tasks, and removes some of levels of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:306.74px" class="cls_006">
            <span class="cls_006">complexity from the nested callbacks you find yourself getting lost in with the native</span>
        </div>
        <div style="position:absolute;left:108.00px;top:319.34px" class="cls_006">
            <span class="cls_006">MongoDB driver.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:340.58px" class="cls_006">
            <span class="cls_006">Mongoose also returns the data to you as a JSON object that you can use directly,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:353.18px" class="cls_006">
            <span class="cls_006">rather than the JSON string returned by MongoDB.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:374.42px" class="cls_006">
            <span class="cls_006">Mongoose also has a whole suite of helper functions and methods that we'll explore</span>
        </div>
        <div style="position:absolute;left:108.00px;top:387.02px" class="cls_006">
            <span class="cls_006">throughout the subsequent chapters of this book.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:416.95px" class="cls_027">
            <span class="cls_027">What Mongoose is not ideally suited for</span>
        </div>
        <div style="position:absolute;left:108.00px;top:439.93px" class="cls_006">
            <span class="cls_006">Mongoose is probably not the answer for you if you are primarily working with</span>
        </div>
        <div style="position:absolute;left:108.00px;top:452.53px" class="cls_006">
            <span class="cls_006">the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:473.78px" class="cls_006">
            <span class="cls_006">• Schema-less data</span>
        </div>
        <div style="position:absolute;left:126.00px;top:490.69px" class="cls_006">
            <span class="cls_006">• Random documents</span>
        </div>
        <div style="position:absolute;left:126.00px;top:507.61px" class="cls_006">
            <span class="cls_006">• Pure Key-Value pairs</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 13 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:20852px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background027.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Introducing Mongoose to the Technology Stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">The cornerstones of Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">There are two aspects of Mongoose that we need to introduce you to before going</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">much further:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:169.29px" class="cls_006">
            <span class="cls_006">• Schemas</span>
        </div>
        <div style="position:absolute;left:126.00px;top:186.20px" class="cls_006">
            <span class="cls_006">• Models</span>
        </div>
        <div style="position:absolute;left:107.99px;top:207.44px" class="cls_006">
            <span class="cls_006">This is a very high-level view; so don't worry if you're not 100 percent confident with</span>
        </div>
        <div style="position:absolute;left:107.99px;top:220.04px" class="cls_006">
            <span class="cls_006">this just yet, as we'll be covering it in a lot more detail later in this book.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:248.14px" class="cls_013">
            <span class="cls_013">Mongoose schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:269.12px" class="cls_006">
            <span class="cls_006">As we saw earlier, a </span>
            <span class="cls_025">schema</span>
            <span class="cls_006"> is fundamentally describing the data construct of a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:281.72px" class="cls_006">
            <span class="cls_006">document. This schema defines the name of each item of data, and the type of data,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:294.32px" class="cls_006">
            <span class="cls_006">whether it is a string, number, date, Boolean, and so on.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:315.26px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:327.50px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:339.74px" class="cls_023">
            <span class="cls_023">email: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:351.98px" class="cls_023">
            <span class="cls_023">createdOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:364.22px" class="cls_023">
            <span class="cls_023">verified: Boolean</span>
        </div>
        <div style="position:absolute;left:126.00px;top:376.46px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:396.20px" class="cls_006">
            <span class="cls_006">In most scenarios you would have one schema for each collection within the database.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:417.45px" class="cls_006">
            <span class="cls_006">Schemas are a powerful aspect of Mongoose, which can also be extended with</span>
        </div>
        <div style="position:absolute;left:108.00px;top:430.05px" class="cls_006">
            <span class="cls_006">helper functions and additional methods. But we'll describe more about that in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:442.65px" class="cls_006">
            <span class="cls_006">a later chapter.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:470.74px" class="cls_013">
            <span class="cls_013">Mongoose models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:491.72px" class="cls_006">
            <span class="cls_006">A </span>
            <span class="cls_025">model</span>
            <span class="cls_006"> is a compiled version of the schema. One instance of the model will</span>
        </div>
        <div style="position:absolute;left:108.00px;top:504.32px" class="cls_006">
            <span class="cls_006">map to one document in the database.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:525.56px" class="cls_006">
            <span class="cls_006">Creating a </span>
            <span class="cls_007">User</span>
            <span class="cls_006"> instance based on the schema </span>
            <span class="cls_007">userSchema</span>
            <span class="cls_006"> is a one line task:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:546.50px" class="cls_023">
            <span class="cls_023">var User = mongoose.model('User', userSchema);</span>
        </div>
        <div style="position:absolute;left:108.00px;top:566.24px" class="cls_006">
            <span class="cls_006">It is the model that handles the reading, creating, updating, and deleting</span>
        </div>
        <div style="position:absolute;left:108.00px;top:578.84px" class="cls_006">
            <span class="cls_006">of documents.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 14 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:21654px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background028.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 1</span>
        </div>
        <div style="position:absolute;left:108.00px;top:111.92px" class="cls_022">
            <span class="cls_022">Installing the full stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:136.90px" class="cls_006">
            <span class="cls_006">Now that we know a little bit about the technology, it's time to get everything</span>
        </div>
        <div style="position:absolute;left:108.00px;top:149.50px" class="cls_006">
            <span class="cls_006">installed. What follows is not an in-depth installation tutorial, but covers the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:162.10px" class="cls_006">
            <span class="cls_006">necessary steps to get everything installed on Ubuntu. The installation process is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:174.70px" class="cls_006">
            <span class="cls_006">very similar on other Linux distributions and Mac OS X. For Windows users, Node</span>
        </div>
        <div style="position:absolute;left:108.00px;top:187.30px" class="cls_006">
            <span class="cls_006">and MongoDB have installation packages you can run, and after that everything else</span>
        </div>
        <div style="position:absolute;left:108.00px;top:199.90px" class="cls_006">
            <span class="cls_006">is pretty much the same.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:229.84px" class="cls_027">
            <span class="cls_027">Installing the prerequisites</span>
        </div>
        <div style="position:absolute;left:108.00px;top:252.82px" class="cls_006">
            <span class="cls_006">Node needs a couple of things installed to run properly, Python and a C compiler.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:265.42px" class="cls_006">
            <span class="cls_006">So let's make sure those are installed and up-to-date with a terminal command. I</span>
        </div>
        <div style="position:absolute;left:108.00px;top:278.02px" class="cls_006">
            <span class="cls_006">use the Ubuntu </span>
            <span class="cls_025">Advanced Packaging Tool</span>
            <span class="cls_006"> (</span>
            <span class="cls_025">APT</span>
            <span class="cls_006">) to install most software, as it</span>
        </div>
        <div style="position:absolute;left:108.00px;top:290.62px" class="cls_006">
            <span class="cls_006">makes it this easy:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:311.56px" class="cls_024">
            <span class="cls_024">$ sudo apt-get install python-software-properties python g++ make</span>
        </div>
        <div style="position:absolute;left:108.00px;top:340.00px" class="cls_027">
            <span class="cls_027">Installing Node.js</span>
        </div>
        <div style="position:absolute;left:108.00px;top:362.98px" class="cls_006">
            <span class="cls_006">Again we'll use APT to install Node.js. As Node is actively developed and frequently</span>
        </div>
        <div style="position:absolute;left:108.00px;top:375.58px" class="cls_006">
            <span class="cls_006">updated, APT doesn't always have the latest build. The latest version on APT is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:388.18px" class="cls_006">
            <span class="cls_006">currently several versions behind, so we will add the repository of one of the Node.js</span>
        </div>
        <div style="position:absolute;left:108.00px;top:400.78px" class="cls_006">
            <span class="cls_006">developers. This is also the approach recommended on the Node website nodejs.org.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:421.72px" class="cls_024">
            <span class="cls_024">$ sudo add-apt-repository ppa:chris-lea/node.js</span>
        </div>
        <div style="position:absolute;left:108.00px;top:436.84px" class="cls_024">
            <span class="cls_024">$ sudo apt-get update</span>
        </div>
        <div style="position:absolute;left:108.00px;top:451.96px" class="cls_024">
            <span class="cls_024">$ sudo apt-get install nodejs</span>
        </div>
        <div style="position:absolute;left:108.00px;top:471.70px" class="cls_006">
            <span class="cls_006">If everything has gone smoothly then you should be able to check the installed</span>
        </div>
        <div style="position:absolute;left:108.00px;top:484.30px" class="cls_006">
            <span class="cls_006">version displayed in terminal using the following command:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:505.24px" class="cls_024">
            <span class="cls_024">$ node --version</span>
        </div>
        <div style="position:absolute;left:108.00px;top:524.98px" class="cls_006">
            <span class="cls_006">You should be greeted with a message back in the terminal along the lines of </span>
            <span class="cls_025">v0.10.0</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:554.92px" class="cls_027">
            <span class="cls_027">Installing npm</span>
        </div>
        <div style="position:absolute;left:108.00px;top:577.90px" class="cls_006">
            <span class="cls_006">npm is a package manager for Node, although npm does not actually stand for Node</span>
        </div>
        <div style="position:absolute;left:108.00px;top:590.50px" class="cls_006">
            <span class="cls_006">Package Manager. As of Node Version 0.6.3, npm is actually automatically installed</span>
        </div>
        <div style="position:absolute;left:108.00px;top:603.10px" class="cls_006">
            <span class="cls_006">when you install Node.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 15 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:22456px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background029.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Introducing Mongoose to the Technology Stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">You can quickly check that this has been done by checking the version number</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">on the terminal.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.03px" class="cls_024">
            <span class="cls_024">$ npm --version</span>
        </div>
        <div style="position:absolute;left:108.00px;top:163.15px" class="cls_024">
            <span class="cls_024">1.1.23</span>
        </div>
        <div style="position:absolute;left:108.00px;top:182.89px" class="cls_006">
            <span class="cls_006">If it is not there for some reason, simply install it with APT with the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:195.49px" class="cls_006">
            <span class="cls_006">following command:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:216.43px" class="cls_024">
            <span class="cls_024">$ sudo apt-get install npm</span>
        </div>
        <div style="position:absolute;left:108.00px;top:244.87px" class="cls_027">
            <span class="cls_027">Installing MongoDB</span>
        </div>
        <div style="position:absolute;left:108.00px;top:267.85px" class="cls_006">
            <span class="cls_006">Again we're using APT here.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:288.79px" class="cls_024">
            <span class="cls_024">$ sudo apt-get install mongodb</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.53px" class="cls_006">
            <span class="cls_006">In order to test MongoDB, we need to run it. You can do this by just typing </span>
            <span class="cls_007">mongodb</span>
        </div>
        <div style="position:absolute;left:108.00px;top:321.13px" class="cls_006">
            <span class="cls_006">into terminal, but I prefer to run it as a persistent service so that you don't have to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:333.73px" class="cls_006">
            <span class="cls_006">restart it.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:354.67px" class="cls_024">
            <span class="cls_024">$ sudo service mongodb start</span>
        </div>
        <div style="position:absolute;left:108.00px;top:374.41px" class="cls_006">
            <span class="cls_006">This should give you a confirmation message in terminal that the mongodb process</span>
        </div>
        <div style="position:absolute;left:108.00px;top:387.01px" class="cls_006">
            <span class="cls_006">is running.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:408.26px" class="cls_006">
            <span class="cls_006">Now to finally test that it has installed correctly we'll drop into the built-in MongoDB</span>
        </div>
        <div style="position:absolute;left:108.00px;top:420.86px" class="cls_006">
            <span class="cls_006">shell. In terminal, enter the following:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:441.79px" class="cls_024">
            <span class="cls_024">$ mongo</span>
        </div>
        <div style="position:absolute;left:108.00px;top:461.53px" class="cls_006">
            <span class="cls_006">This should do three things:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:482.78px" class="cls_006">
            <span class="cls_006">• Enter you into the MongoDB shell</span>
        </div>
        <div style="position:absolute;left:126.00px;top:499.69px" class="cls_006">
            <span class="cls_006">• Show you the version of the shell being used</span>
        </div>
        <div style="position:absolute;left:126.00px;top:516.61px" class="cls_006">
            <span class="cls_006">• Connect to the </span>
            <span class="cls_007">test</span>
            <span class="cls_006"> database that comes with MongoDB</span>
        </div>
        <div style="position:absolute;left:108.00px;top:537.86px" class="cls_006">
            <span class="cls_006">You should see something like the following screenshot:</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 16 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:23258px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background030.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 1</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Installing Express.js</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">Now we're starting to get into the Node-based applications. So those of you who are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">working on different operating systems can start paying attention again now. We are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">going to install Express using </span>
            <span class="cls_007">npm</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:181.58px" class="cls_024">
            <span class="cls_024">$ sudo npm install -g express</span>
        </div>
        <div style="position:absolute;left:176.04px;top:215.84px" class="cls_026">
            <span class="cls_026">See the </span>
            <span class="cls_007">-g</span>
            <span class="cls_026"> flag there in the command line? This installs express</span>
        </div>
        <div style="position:absolute;left:176.04px;top:227.24px" class="cls_026">
            <span class="cls_026">globally, meaning that we can use it wherever we want.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:258.68px" class="cls_006">
            <span class="cls_006">Once again you can test the installation by checking the version number.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:279.62px" class="cls_024">
            <span class="cls_024">$ express --version</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.06px" class="cls_027">
            <span class="cls_027">Installing Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.04px" class="cls_006">
            <span class="cls_006">Finally we get round to installing Mongoose!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:352.29px" class="cls_006">
            <span class="cls_006">There are two ways of installing Mongoose, both using npm. I recommend using the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:364.89px" class="cls_006">
            <span class="cls_006">latter one.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:392.98px" class="cls_013">
            <span class="cls_013">Direct installation into project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:413.96px" class="cls_006">
            <span class="cls_006">If you're creating a quick test app, or will never have to move or publish the project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:426.56px" class="cls_006">
            <span class="cls_006">elsewhere, you can use npm to install Mongoose directly into your project. Navigate</span>
        </div>
        <div style="position:absolute;left:108.00px;top:439.16px" class="cls_006">
            <span class="cls_006">to the root folder of your site or project in terminal and run the following command:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:460.10px" class="cls_024">
            <span class="cls_024">$ sudo npm install mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:486.70px" class="cls_013">
            <span class="cls_013">Using project dependencies - package.json</span>
        </div>
        <div style="position:absolute;left:108.00px;top:507.68px" class="cls_006">
            <span class="cls_006">Any Node project can have a </span>
            <span class="cls_007">package.json</span>
            <span class="cls_006"> file, and any packages you install via</span>
        </div>
        <div style="position:absolute;left:108.00px;top:520.28px" class="cls_006">
            <span class="cls_006">npm will have one. This file is normally in the root of your project, and can contain</span>
        </div>
        <div style="position:absolute;left:108.00px;top:532.88px" class="cls_006">
            <span class="cls_006">various metadata, such as </span>
            <span class="cls_007">project name</span>
            <span class="cls_006">, </span>
            <span class="cls_007">description</span>
            <span class="cls_006">, </span>
            <span class="cls_007">version number</span>
            <span class="cls_006">, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:545.48px" class="cls_007">
            <span class="cls_007">authors</span>
            <span class="cls_006">. It also helps manage the project's dependencies.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:566.73px" class="cls_006">
            <span class="cls_006">If you ever need to move, copy, or distribute your project you will find this</span>
        </div>
        <div style="position:absolute;left:108.00px;top:579.33px" class="cls_006">
            <span class="cls_006">invaluable. The dependency management means that you are not forced to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:591.93px" class="cls_006">
            <span class="cls_006">remember which versions of which modules you added to each particular project.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:604.53px" class="cls_006">
            <span class="cls_006">It becomes even more necessary if you distribute it widely, as it removes any doubt</span>
        </div>
        <div style="position:absolute;left:108.00px;top:617.13px" class="cls_006">
            <span class="cls_006">from the end-user's mind as to what the project needed.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 17 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:24060px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background031.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Introducing Mongoose to the Technology Stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Before we get into creating one, the following code snippet is an example of a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_007">
            <span class="cls_007">package.json</span>
            <span class="cls_006"> file following code snippet that you might expect to see when you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">create a new project using Express.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:160.63px" class="cls_023">
            <span class="cls_023">{</span>
        </div>
        <div style="position:absolute;left:136.80px;top:172.87px" class="cls_023">
            <span class="cls_023">"name": "application-name",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:185.11px" class="cls_023">
            <span class="cls_023">"version": "0.0.1",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:197.35px" class="cls_023">
            <span class="cls_023">"private": true,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:209.59px" class="cls_023">
            <span class="cls_023">"scripts": {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:221.83px" class="cls_023">
            <span class="cls_023">"start": "node app"</span>
        </div>
        <div style="position:absolute;left:136.80px;top:234.07px" class="cls_023">
            <span class="cls_023">},</span>
        </div>
        <div style="position:absolute;left:131.40px;top:246.31px" class="cls_023">
            <span class="cls_023">"dependencies": {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:258.55px" class="cls_023">
            <span class="cls_023">"express": "3.0.0rc5",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:270.79px" class="cls_023">
            <span class="cls_023">"jade": "*"</span>
        </div>
        <div style="position:absolute;left:131.40px;top:283.03px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:295.27px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:170.77px;top:326.03px" class="cls_026">
            <span class="cls_026">The list of dependencies are: a specific version of express and the latest</span>
        </div>
        <div style="position:absolute;left:170.77px;top:337.43px" class="cls_026">
            <span class="cls_026">version of </span>
            <span class="cls_007">jade</span>
            <span class="cls_026">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:365.37px" class="cls_006">
            <span class="cls_006">To install a specific version of Mongoose—which is the recommended approach,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:377.97px" class="cls_006">
            <span class="cls_006">especially if you are going to distribute your project—you would update the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:390.57px" class="cls_006">
            <span class="cls_006">dependencies section to look like the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:411.51px" class="cls_023">
            <span class="cls_023">"dependencies": {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:423.75px" class="cls_023">
            <span class="cls_023">"express": "3.0.0rc5",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:435.99px" class="cls_023">
            <span class="cls_023">"jade": "*",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:448.23px" class="cls_023">
            <span class="cls_023">"mongoose": "3.6"</span>
        </div>
        <div style="position:absolute;left:126.00px;top:460.47px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:480.21px" class="cls_006">
            <span class="cls_006">To install or update all of the dependencies listed in a </span>
            <span class="cls_007">package.json</span>
            <span class="cls_006"> file,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:492.81px" class="cls_006">
            <span class="cls_006">using terminal, you simply navigate to the folder containing the file and run</span>
        </div>
        <div style="position:absolute;left:108.00px;top:505.41px" class="cls_006">
            <span class="cls_006">the following command:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:526.35px" class="cls_024">
            <span class="cls_024">$ npm install</span>
        </div>
        <div style="position:absolute;left:108.00px;top:554.79px" class="cls_027">
            <span class="cls_027">Creating a project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:577.77px" class="cls_006">
            <span class="cls_006">Now that we have the entire building blocks ready, let's set the foundations.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:590.37px" class="cls_006">
            <span class="cls_006">Throughout this book, we are going to build a simple project management web</span>
        </div>
        <div style="position:absolute;left:108.00px;top:602.97px" class="cls_006">
            <span class="cls_006">app, called </span>
            <span class="cls_025">MongoosePM</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 18 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:24862px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background032.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 1</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Let's start off by creating an Express project.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.73px" class="cls_006">
            <span class="cls_006">1. In terminal, navigate to a relevant folder, for example, </span>
            <span class="cls_007">/MyWebsites</span>
            <span class="cls_006"> in Linux,</span>
        </div>
        <div style="position:absolute;left:144.00px;top:148.33px" class="cls_006">
            <span class="cls_006">or </span>
            <span class="cls_007">C:\Users\Your Username\Documents\My Web Sites\</span>
            <span class="cls_006"> in Windows.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:165.25px" class="cls_006">
            <span class="cls_006">2. Enter the following command:</span>
        </div>
        <div style="position:absolute;left:144.00px;top:181.87px" class="cls_024">
            <span class="cls_024">$ express --sessions mongoosepm</span>
        </div>
        <div style="position:absolute;left:108.00px;top:201.61px" class="cls_006">
            <span class="cls_006">This will create a new folder called </span>
            <span class="cls_007">mongoosepm</span>
            <span class="cls_006">. Inside this folder it will create a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:214.21px" class="cls_006">
            <span class="cls_006">new Express project. By default an Express project doesn't support user sessions;</span>
        </div>
        <div style="position:absolute;left:108.00px;top:226.81px" class="cls_006">
            <span class="cls_006">an Express project is essentially stateless. By adding the </span>
            <span class="cls_007">--sessions</span>
            <span class="cls_006"> parameter in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:239.41px" class="cls_006">
            <span class="cls_006">the command line we add session support to our project, so that we can follow a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:252.01px" class="cls_006">
            <span class="cls_006">user from page to page without having to constantly re-authenticate.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:273.26px" class="cls_006">
            <span class="cls_006">After Express has finished doing its thing you'll be able to see a whole load of new</span>
        </div>
        <div style="position:absolute;left:108.00px;top:285.85px" class="cls_006">
            <span class="cls_006">files and folders within your </span>
            <span class="cls_007">mongoosepm</span>
            <span class="cls_006"> folder. The intricacies of Express are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:298.45px" class="cls_006">
            <span class="cls_006">beyond the scope of this book, which is one of the reasons we have mainly stuck</span>
        </div>
        <div style="position:absolute;left:108.00px;top:311.05px" class="cls_006">
            <span class="cls_006">with the default settings.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:332.30px" class="cls_006">
            <span class="cls_006">The next step is normally to install the dependencies, but first let's add Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.89px" class="cls_006">
            <span class="cls_006">and Connect to the dependency list. So open up the </span>
            <span class="cls_007">package.json</span>
            <span class="cls_006"> file in the root</span>
        </div>
        <div style="position:absolute;left:108.00px;top:357.49px" class="cls_006">
            <span class="cls_006">of the project and add a couple of lines to the </span>
            <span class="cls_007">dependencies</span>
            <span class="cls_006"> hash.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:378.74px" class="cls_006">
            <span class="cls_006">For example, if your dependencies section looks like the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:399.67px" class="cls_023">
            <span class="cls_023">"dependencies": {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:411.91px" class="cls_023">
            <span class="cls_023">"express": "3.0.0rc5",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:422.71px" class="cls_023">
            <span class="cls_023">"jade": "*"</span>
        </div>
        <div style="position:absolute;left:126.00px;top:434.95px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:454.69px" class="cls_006">
            <span class="cls_006">Then you change it with this (see the following code):</span>
        </div>
        <div style="position:absolute;left:126.00px;top:475.63px" class="cls_023">
            <span class="cls_023">"dependencies": {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:487.87px" class="cls_023">
            <span class="cls_023">"express": "3.0.0rc5",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:498.67px" class="cls_023">
            <span class="cls_023">"jade": "*",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:509.47px" class="cls_023">
            <span class="cls_023">"connect": "2.7.x",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:520.27px" class="cls_023">
            <span class="cls_023">"mongoose": "3.6.x"</span>
        </div>
        <div style="position:absolute;left:126.00px;top:532.51px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:552.25px" class="cls_006">
            <span class="cls_006">It is recommended that you don't "wildcard" the version for most modules, as there</span>
        </div>
        <div style="position:absolute;left:108.00px;top:564.85px" class="cls_006">
            <span class="cls_006">is no guarantee that code based on older versions will work on newer versions.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:577.45px" class="cls_006">
            <span class="cls_006">Putting a wildcard in for the patch version like we have for Connect and Mongoose,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:590.05px" class="cls_006">
            <span class="cls_006">is recommended as they should only be patch updates and be backwards compatible.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 19 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:25664px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background033.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Introducing Mongoose to the Technology Stack</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">To install these dependencies, go to the </span>
            <span class="cls_007">mongoosepm</span>
            <span class="cls_006"> folder in terminal and run the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">following command:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.03px" class="cls_024">
            <span class="cls_024">$ npm install</span>
        </div>
        <div style="position:absolute;left:108.00px;top:167.77px" class="cls_006">
            <span class="cls_006">Once this has finished working, we should have a fully functional Express website to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:180.37px" class="cls_006">
            <span class="cls_006">play with. Let's test it to make sure!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:201.62px" class="cls_006">
            <span class="cls_006">Run the following command from terminal:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:222.55px" class="cls_024">
            <span class="cls_024">$ node app</span>
        </div>
        <div style="position:absolute;left:108.00px;top:242.29px" class="cls_006">
            <span class="cls_006">You should see the following confirmation message directly in terminal:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:263.54px" class="cls_025">
            <span class="cls_025">Express server listening on port 3000</span>
        </div>
        <div style="position:absolute;left:108.00px;top:284.77px" class="cls_006">
            <span class="cls_006">So open up a web browser, and point it to </span>
            <span class="cls_007">http://localhost:3000</span>
            <span class="cls_006">. All being well,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:297.37px" class="cls_006">
            <span class="cls_006">you should be presented with the default Express project landing page, as shown in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:309.97px" class="cls_006">
            <span class="cls_006">the following screenshot:</span>
        </div>
        <div style="position:absolute;left:169.50px;top:520.36px" class="cls_028">
            <span class="cls_028">Downloading the example code</span>
        </div>
        <div style="position:absolute;left:169.50px;top:536.09px" class="cls_026">
            <span class="cls_026">You can download the example code files for all Packt books you have</span>
        </div>
        <div style="position:absolute;left:169.50px;top:547.48px" class="cls_026">
            <span class="cls_026">purchased from your account at </span>
            <span class="cls_007">http://www.PacktPub.com</span>
            <span class="cls_026">. If you</span>
        </div>
        <div style="position:absolute;left:169.50px;top:558.89px" class="cls_026">
            <span class="cls_026">purchased this book elsewhere, you can visit </span>
            <A HREF="http://www.packtpub./">http://www.PacktPub.</A>
            </span>
        </div>
        <div style="position:absolute;left:169.50px;top:570.28px" class="cls_007">
            <span class="cls_007">com/support</span>
            <span class="cls_026"> and register to have the files e-mailed directly to you.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 20 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:26466px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background034.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 1</span>
        </div>
        <div style="position:absolute;left:108.00px;top:111.92px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:136.90px" class="cls_006">
            <span class="cls_006">In this chapter we have taken a whirlwind tour of the technology stack, and installed</span>
        </div>
        <div style="position:absolute;left:108.00px;top:149.50px" class="cls_006">
            <span class="cls_006">the required programs, which are as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:170.74px" class="cls_006">
            <span class="cls_006">• Node.js</span>
        </div>
        <div style="position:absolute;left:126.00px;top:187.66px" class="cls_006">
            <span class="cls_006">• npm</span>
        </div>
        <div style="position:absolute;left:126.00px;top:204.57px" class="cls_006">
            <span class="cls_006">• MongoDB</span>
        </div>
        <div style="position:absolute;left:126.00px;top:221.49px" class="cls_006">
            <span class="cls_006">• Express</span>
        </div>
        <div style="position:absolute;left:126.00px;top:238.40px" class="cls_006">
            <span class="cls_006">• Mongoose</span>
        </div>
        <div style="position:absolute;left:107.99px;top:259.65px" class="cls_006">
            <span class="cls_006">You should have at least a basic understanding of the majority of the stack. We're not</span>
        </div>
        <div style="position:absolute;left:107.99px;top:272.25px" class="cls_006">
            <span class="cls_006">going to be discussing in depth the workings of Node, MongoDB, and Express, but I</span>
        </div>
        <div style="position:absolute;left:107.99px;top:284.85px" class="cls_006">
            <span class="cls_006">will make sure to briefly describe any new concepts as we go.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:306.09px" class="cls_006">
            <span class="cls_006">In this first chapter, we have also created the framework for the project that we are</span>
        </div>
        <div style="position:absolute;left:107.99px;top:318.69px" class="cls_006">
            <span class="cls_006">going to build in later chapters. This is a website built on Node.js, using the Express</span>
        </div>
        <div style="position:absolute;left:107.99px;top:331.29px" class="cls_006">
            <span class="cls_006">framework. We have tested and seen this working in a browser.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:352.53px" class="cls_006">
            <span class="cls_006">In the next chapter, we will take a look at how to create Mongoose connections to</span>
        </div>
        <div style="position:absolute;left:107.99px;top:365.13px" class="cls_006">
            <span class="cls_006">database, and the best way to add a connection to our new project.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 21 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:27268px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background035.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:28070px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background036.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:317.22px;top:218.71px" class="cls_015">
            <span class="cls_015">Establishing a</span>
        </div>
        <div style="position:absolute;left:215.46px;top:254.71px" class="cls_015">
            <span class="cls_015">Database Connection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.41px" class="cls_006">
            <span class="cls_006">We are going to look at the two methods Mongoose uses to connect to databases,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:321.01px" class="cls_007">
            <span class="cls_007">mongoose.connect</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">createConnection</span>
            <span class="cls_006">. We will also go through various</span>
        </div>
        <div style="position:absolute;left:108.00px;top:333.61px" class="cls_006">
            <span class="cls_006">configuration options.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:354.86px" class="cls_006">
            <span class="cls_006">By the end of this chapter, you will understand how to best use the different</span>
        </div>
        <div style="position:absolute;left:108.00px;top:367.46px" class="cls_006">
            <span class="cls_006">Mongoose connection methods to meet your needs. We will also have added</span>
        </div>
        <div style="position:absolute;left:108.00px;top:380.06px" class="cls_006">
            <span class="cls_006">a connection to the MongoosePM example project.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:412.55px" class="cls_022">
            <span class="cls_022">Mongoose default connection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:437.53px" class="cls_006">
            <span class="cls_006">The way to set the default connection to a MongoDB database via Mongoose is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:450.13px" class="cls_006">
            <span class="cls_006">nice and easy, using the </span>
            <span class="cls_007">mongoose.connect</span>
            <span class="cls_006"> method.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:471.07px" class="cls_023">
            <span class="cls_023">var dbURI = 'mongodb://localhost/mydatabase';</span>
        </div>
        <div style="position:absolute;left:126.00px;top:483.31px" class="cls_023">
            <span class="cls_023">mongoose.connect(dbURI);</span>
        </div>
        <div style="position:absolute;left:108.00px;top:503.05px" class="cls_006">
            <span class="cls_006">This will open a Mongoose connection to the Mongo database </span>
            <span class="cls_007">mydatabase</span>
            <span class="cls_006">, running</span>
        </div>
        <div style="position:absolute;left:108.00px;top:515.65px" class="cls_006">
            <span class="cls_006">on the server </span>
            <span class="cls_007">localhost</span>
            <span class="cls_006">. If established at the correct place in your code, this</span>
        </div>
        <div style="position:absolute;left:108.00px;top:528.25px" class="cls_006">
            <span class="cls_006">connection will now be available at any point in your app, if you </span>
            <span class="cls_021">require</span>
            <span class="cls_006"> Mongoose.</span>
        </div>
        <div style="position:absolute;left:174.60px;top:555.25px" class="cls_028">
            <span class="cls_028">Best practice</span>
        </div>
        <div style="position:absolute;left:174.60px;top:570.97px" class="cls_026">
            <span class="cls_026">The best practice for a default Mongoose database connection is to</span>
        </div>
        <div style="position:absolute;left:174.60px;top:582.37px" class="cls_026">
            <span class="cls_026">open it when the application starts, and keep it open to be re-used.</span>
        </div>
        <div style="position:absolute;left:174.60px;top:593.77px" class="cls_026">
            <span class="cls_026">The connection should only need to be closed if your app is being shut</span>
        </div>
        <div style="position:absolute;left:174.60px;top:605.17px" class="cls_026">
            <span class="cls_026">down or restarted.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:28872px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background037.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Establishing a Database Connection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Using multiple connections</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">The default connection is great if your app only needs to connect to one database.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">But what happens if you need to connect to a second database at the same time?</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">Or connect to the same database as a different user with different permissions.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:181.88px" class="cls_006">
            <span class="cls_006">For this we can use the </span>
            <span class="cls_007">mongoose.createConnection</span>
            <span class="cls_006"> method, which is as follows</span>
        </div>
        <div style="position:absolute;left:108.00px;top:194.48px" class="cls_006">
            <span class="cls_006">in the code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:215.42px" class="cls_023">
            <span class="cls_023">var dbURI = 'mongodb://localhost/myadmindatabase';</span>
        </div>
        <div style="position:absolute;left:126.00px;top:227.66px" class="cls_023">
            <span class="cls_023">var adminConnection = mongoose.createConnection(dbURI);</span>
        </div>
        <div style="position:absolute;left:108.00px;top:258.66px" class="cls_022">
            <span class="cls_022">About the connection string</span>
        </div>
        <div style="position:absolute;left:108.00px;top:283.64px" class="cls_006">
            <span class="cls_006">The connection string—</span>
            <span class="cls_007">dbURI</span>
            <span class="cls_006"> in our examples—can use any of the options from the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:296.24px" class="cls_006">
            <span class="cls_006">MongoDB connection string. We're not going to cover them all here, but here are a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.84px" class="cls_006">
            <span class="cls_006">couple of common options.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:338.78px" class="cls_027">
            <span class="cls_027">Setting the port</span>
        </div>
        <div style="position:absolute;left:108.00px;top:361.76px" class="cls_006">
            <span class="cls_006">The default port is 27017. If you wanted to specify a different port, say 27018, you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:374.36px" class="cls_006">
            <span class="cls_006">would do so using the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:395.30px" class="cls_023">
            <span class="cls_023">var dbURI = 'mongodb://localhost:27018/mydatabase';</span>
        </div>
        <div style="position:absolute;left:108.00px;top:423.74px" class="cls_027">
            <span class="cls_027">Specifying a database user</span>
        </div>
        <div style="position:absolute;left:108.00px;top:446.72px" class="cls_006">
            <span class="cls_006">If you want to access the database as a particular user, you can add the username</span>
        </div>
        <div style="position:absolute;left:108.00px;top:459.32px" class="cls_006">
            <span class="cls_006">and password in front of the hostname.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:480.26px" class="cls_023">
            <span class="cls_023">var dbURI = 'mongodb://username:password@localhost/mydatabase';</span>
        </div>
        <div style="position:absolute;left:108.00px;top:511.26px" class="cls_022">
            <span class="cls_022">Connection options</span>
        </div>
        <div style="position:absolute;left:108.00px;top:536.24px" class="cls_006">
            <span class="cls_006">Mongoose allows you to pass certain options through to both connection methods.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:548.84px" class="cls_006">
            <span class="cls_006">If specified, these options will override those set in the connection string.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:570.09px" class="cls_006">
            <span class="cls_006">The options are sent as a JSON object as an optional second parameter to the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:582.69px" class="cls_006">
            <span class="cls_006">connection call. For example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:603.62px" class="cls_023">
            <span class="cls_023">var dbURI = 'mongodb://localhost/mydatabase';</span>
        </div>
        <div style="position:absolute;left:126.00px;top:615.86px" class="cls_023">
            <span class="cls_023">var dbOptions = {'user':'db_username','pass':'db_password'};</span>
        </div>
        <div style="position:absolute;left:126.00px;top:628.10px" class="cls_023">
            <span class="cls_023">mongoose.connect(dbURI, dbOptions);</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 24 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:29674px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background038.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 2</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">The options you can use this way are:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.74px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> user and pass</span>
            <span class="cls_006">: Username and password for the database, if required and</span>
        </div>
        <div style="position:absolute;left:143.99px;top:148.34px" class="cls_006">
            <span class="cls_006">not specified in the connection string.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:165.25px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> db</span>
            <span class="cls_006">: This relates to the DB options available in the Node MongoDB</span>
        </div>
        <div style="position:absolute;left:143.99px;top:177.85px" class="cls_006">
            <span class="cls_006">Native driver.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:194.77px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> server</span>
            <span class="cls_006">: This relates to the server options available in the Node MongoDB</span>
        </div>
        <div style="position:absolute;left:143.99px;top:207.37px" class="cls_006">
            <span class="cls_006">Native driver.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:224.28px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> replset</span>
            <span class="cls_006">: This option allows you to specify a ReplicaSet. The details of</span>
        </div>
        <div style="position:absolute;left:143.99px;top:236.88px" class="cls_006">
            <span class="cls_006">ReplicaSet methods are beyond the scope of this book, but the principle is</span>
        </div>
        <div style="position:absolute;left:143.99px;top:249.48px" class="cls_006">
            <span class="cls_006">that you can have one primary database where all the writes are made to,</span>
        </div>
        <div style="position:absolute;left:143.99px;top:262.08px" class="cls_006">
            <span class="cls_006">and multiple secondary databases. If the primary database fails, one of the</span>
        </div>
        <div style="position:absolute;left:143.99px;top:274.68px" class="cls_006">
            <span class="cls_006">secondary databases is automatically made the new primary.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:307.19px" class="cls_022">
            <span class="cls_022">Closing the connection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:332.17px" class="cls_006">
            <span class="cls_006">As we have already seen, the general best practice is to open your connection at</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.77px" class="cls_006">
            <span class="cls_006">application start up, and keep it open. However, there are times when you will</span>
        </div>
        <div style="position:absolute;left:108.00px;top:357.37px" class="cls_006">
            <span class="cls_006">want to close the connection. For example, if your application is shutting down,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:369.97px" class="cls_006">
            <span class="cls_006">or restarting, the database connection needs to be manually closed, or if you are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:382.57px" class="cls_006">
            <span class="cls_006">running a single-hit script rather than a persistent application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:412.51px" class="cls_027">
            <span class="cls_027">Calling the close command</span>
        </div>
        <div style="position:absolute;left:108.00px;top:435.49px" class="cls_006">
            <span class="cls_006">Each Mongoose connection has a </span>
            <span class="cls_007">close()</span>
            <span class="cls_006"> method that takes an optional callback</span>
        </div>
        <div style="position:absolute;left:108.00px;top:448.09px" class="cls_006">
            <span class="cls_006">function.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:469.34px" class="cls_006">
            <span class="cls_006">If you are using the default connection you call it like the following code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:481.94px" class="cls_006">
            <span class="cls_006">snippet does:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:502.87px" class="cls_023">
            <span class="cls_023">mongoose.connection.close(function () {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:515.11px" class="cls_023">
            <span class="cls_023">console.log('Mongoose default connection closed');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:527.35px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:547.09px" class="cls_006">
            <span class="cls_006">Calling the </span>
            <span class="cls_007">close()</span>
            <span class="cls_006"> method on a named connection is just as easy, using our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:559.69px" class="cls_006">
            <span class="cls_006">example from earlier:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:580.63px" class="cls_023">
            <span class="cls_023">adminConnection.close(function () {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:592.87px" class="cls_023">
            <span class="cls_023">console.log('Mongoose connection adminConnection closed');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:605.11px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 25 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:30476px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background039.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Establishing a Database Connection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Closing when the Node process ends</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">As a rule you should tidy up the connections when your Node application stops,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">whether this is an intentional process termination or not. To do this, you can send</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">your disconnections as a callback to Node's </span>
            <span class="cls_007">process.on('SIGINT')</span>
            <span class="cls_006"> event as shown</span>
        </div>
        <div style="position:absolute;left:108.00px;top:173.24px" class="cls_006">
            <span class="cls_006">in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:194.18px" class="cls_023">
            <span class="cls_023">process.on('SIGINT', function() {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:206.42px" class="cls_023">
            <span class="cls_023">mongoose.connection.close(function () {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:218.66px" class="cls_023">
            <span class="cls_023">console.log('Mongoose disconnected through app termination');</span>
        </div>
        <div style="position:absolute;left:147.60px;top:230.90px" class="cls_023">
            <span class="cls_023">process.exit(0);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:243.14px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:255.38px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:286.38px" class="cls_022">
            <span class="cls_022">Connection events</span>
        </div>
        <div style="position:absolute;left:108.00px;top:311.36px" class="cls_006">
            <span class="cls_006">The connection process in Mongoose inherits the Node </span>
            <span class="cls_007">EventEmitter</span>
            <span class="cls_006"> class,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:323.96px" class="cls_006">
            <span class="cls_006">meaning that we can set certain code to run following specific events. We can—and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:336.56px" class="cls_006">
            <span class="cls_006">will—work with some of the connection events, such as </span>
            <span class="cls_007">connected</span>
            <span class="cls_006">, </span>
            <span class="cls_007">disconnected</span>
            <span class="cls_006">,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:349.16px" class="cls_006">
            <span class="cls_006">and </span>
            <span class="cls_007">error</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:370.41px" class="cls_006">
            <span class="cls_006">The connection events are all used in the same way, sending a callback to the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:383.00px" class="cls_007">
            <span class="cls_007">connection.on</span>
            <span class="cls_006"> event listener. For example, if we wanted to log to the console</span>
        </div>
        <div style="position:absolute;left:108.00px;top:395.60px" class="cls_006">
            <span class="cls_006">when a connection error occurs we could do this in the following code:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:416.54px" class="cls_023">
            <span class="cls_023">mongoose.connection.on('error',function (err) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:428.78px" class="cls_023">
            <span class="cls_023">console.log('Mongoose connection error: ' + err);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:441.02px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:472.02px" class="cls_022">
            <span class="cls_022">Connecting our project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:497.00px" class="cls_006">
            <span class="cls_006">Now we know what we're doing, let's connect our project to a database using the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:509.60px" class="cls_006">
            <span class="cls_006">default Mongoose connection.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:539.54px" class="cls_027">
            <span class="cls_027">Creating the connection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:562.52px" class="cls_006">
            <span class="cls_006">For the sake of well organized code, let's create a folder called </span>
            <span class="cls_007">model</span>
            <span class="cls_006">, and in that,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:575.12px" class="cls_006">
            <span class="cls_006">an empty JavaScript file called </span>
            <span class="cls_007">db.js</span>
            <span class="cls_006">. We'll use this for managing the Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:587.72px" class="cls_006">
            <span class="cls_006">connection, and will add to it in later chapters.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:608.97px" class="cls_006">
            <span class="cls_006">At this stage the file needs to do three things:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:630.21px" class="cls_006">
            <span class="cls_006">1. Bring in the Mongoose module</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 26 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:31278px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background040.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 2</span>
        </div>
        <div style="position:absolute;left:126.00px;top:114.49px" class="cls_006">
            <span class="cls_006">2. Build the connection string for the database</span>
        </div>
        <div style="position:absolute;left:126.00px;top:131.41px" class="cls_006">
            <span class="cls_006">3. Open the Mongoose connection to the database</span>
        </div>
        <div style="position:absolute;left:107.99px;top:152.65px" class="cls_006">
            <span class="cls_006">So in your </span>
            <span class="cls_007">/model/db.js</span>
            <span class="cls_006"> file, enter the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:173.59px" class="cls_023">
            <span class="cls_023">// Bring Mongoose into the project</span>
        </div>
        <div style="position:absolute;left:126.00px;top:185.83px" class="cls_023">
            <span class="cls_023">var mongoose = require( 'mongoose' );</span>
        </div>
        <div style="position:absolute;left:126.00px;top:210.31px" class="cls_023">
            <span class="cls_023">// Build the connection string</span>
        </div>
        <div style="position:absolute;left:126.00px;top:222.55px" class="cls_023">
            <span class="cls_023">var dbURI = 'mongodb://localhost/MongoosePM';</span>
        </div>
        <div style="position:absolute;left:126.00px;top:247.03px" class="cls_023">
            <span class="cls_023">// Create the database connection</span>
        </div>
        <div style="position:absolute;left:126.00px;top:259.27px" class="cls_023">
            <span class="cls_023">mongoose.connect(dbURI);</span>
        </div>
        <div style="position:absolute;left:108.00px;top:279.01px" class="cls_006">
            <span class="cls_006">Each of the three objectives is achieved with just one line of code—pretty simple</span>
        </div>
        <div style="position:absolute;left:108.00px;top:291.61px" class="cls_006">
            <span class="cls_006">don't you think!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:326.05px" class="cls_027">
            <span class="cls_027">Catching the events</span>
        </div>
        <div style="position:absolute;left:108.00px;top:349.03px" class="cls_006">
            <span class="cls_006">Next up we want to set up our event handlers. At this stage, we are just going</span>
        </div>
        <div style="position:absolute;left:108.00px;top:361.63px" class="cls_006">
            <span class="cls_006">to log messages to the console, but they are useful containers, and important to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:374.23px" class="cls_006">
            <span class="cls_006">understand. We will also catch when the Node process is ending and close the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:386.83px" class="cls_006">
            <span class="cls_006">Mongoose connection.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:408.07px" class="cls_006">
            <span class="cls_006">So, still in </span>
            <span class="cls_007">db.js</span>
            <span class="cls_006">, after the connection code add the following snippets:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:429.01px" class="cls_023">
            <span class="cls_023">mongoose.connection.on('connected', function () {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:441.25px" class="cls_023">
            <span class="cls_023">console.log('Mongoose connected to ' + dbURI);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:453.49px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:477.97px" class="cls_023">
            <span class="cls_023">mongoose.connection.on('error',function (err) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:490.21px" class="cls_023">
            <span class="cls_023">console.log('Mongoose connection error: ' + err);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:502.45px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:526.93px" class="cls_023">
            <span class="cls_023">mongoose.connection.on('disconnected', function () {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:539.17px" class="cls_023">
            <span class="cls_023">console.log('Mongoose disconnected');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:551.41px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:575.89px" class="cls_023">
            <span class="cls_023">process.on('SIGINT', function() {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:588.13px" class="cls_023">
            <span class="cls_023">mongoose.connection.close(function () {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:600.37px" class="cls_023">
            <span class="cls_023">console.log('Mongoose disconnected through app termination');</span>
        </div>
        <div style="position:absolute;left:147.60px;top:612.61px" class="cls_023">
            <span class="cls_023">process.exit(0);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:624.85px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:637.09px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 27 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:32080px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background041.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Establishing a Database Connection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Opening the connection at application start</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">Now we need to tell the project to use this file, so that we can connect to the database</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">when the application starts. This is as simple as requiring our new file in </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006">—</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">you may remember that this is the file we run to start the application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:181.88px" class="cls_006">
            <span class="cls_006">At the top of your </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006"> file you should see some of the default modules being</span>
        </div>
        <div style="position:absolute;left:108.00px;top:194.48px" class="cls_006">
            <span class="cls_006">required like in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:215.42px" class="cls_023">
            <span class="cls_023">var express = require('express')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:227.66px" class="cls_023">
            <span class="cls_023">, routes = require('./routes')</span>
        </div>
        <div style="position:absolute;left:108.00px;top:247.40px" class="cls_006">
            <span class="cls_006">We are simply going to add one line in here, to require our </span>
            <span class="cls_007">model/db.js</span>
            <span class="cls_006"> file</span>
        </div>
        <div style="position:absolute;left:108.00px;top:260.00px" class="cls_006">
            <span class="cls_006">immediately after </span>
            <span class="cls_007">express</span>
            <span class="cls_006"> is required. You should end up with something</span>
        </div>
        <div style="position:absolute;left:108.00px;top:272.60px" class="cls_006">
            <span class="cls_006">resembling this following code:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:293.54px" class="cls_023">
            <span class="cls_023">var express = require('express')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:305.78px" class="cls_023">
            <span class="cls_023">, db = require('./model/db')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:318.02px" class="cls_023">
            <span class="cls_023">, routes = require('./routes')</span>
        </div>
        <div style="position:absolute;left:108.00px;top:346.46px" class="cls_027">
            <span class="cls_027">Creating the database</span>
        </div>
        <div style="position:absolute;left:108.00px;top:369.44px" class="cls_006">
            <span class="cls_006">You will notice that we haven't actually created a MongoDB database yet. The</span>
        </div>
        <div style="position:absolute;left:108.00px;top:382.04px" class="cls_006">
            <span class="cls_006">good—and perhaps surprizing—news is that we don't have to. Nor do we have to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:394.64px" class="cls_006">
            <span class="cls_006">explicitly create any collections.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:415.89px" class="cls_006">
            <span class="cls_006">MongoDB will create a database the first time anything is saved to it, and the same</span>
        </div>
        <div style="position:absolute;left:108.00px;top:428.49px" class="cls_006">
            <span class="cls_006">for collections.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:449.73px" class="cls_006">
            <span class="cls_006">I love this approach. This is one of the aspects that I find really speeds up application</span>
        </div>
        <div style="position:absolute;left:108.00px;top:462.33px" class="cls_006">
            <span class="cls_006">development and prototyping.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:483.57px" class="cls_006">
            <span class="cls_006">You can of course connect to an existing database, if you already have one.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 28 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:32882px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background042.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 2</span>
        </div>
        <div style="position:absolute;left:108.00px;top:111.92px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:136.90px" class="cls_006">
            <span class="cls_006">In this chapter, we have looked at the two methods of creating a Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:149.50px" class="cls_006">
            <span class="cls_006">connection to a MongoDB database, and when you would use each method.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:170.74px" class="cls_006">
            <span class="cls_006">We have learned that the best practice is to create a connection when your</span>
        </div>
        <div style="position:absolute;left:108.00px;top:183.34px" class="cls_006">
            <span class="cls_006">application starts and keep it open to be re-used. Tied to this we have seen</span>
        </div>
        <div style="position:absolute;left:108.00px;top:195.94px" class="cls_006">
            <span class="cls_006">how and when to close the connection, and how to act upon events emitted</span>
        </div>
        <div style="position:absolute;left:108.00px;top:208.54px" class="cls_006">
            <span class="cls_006">by the connection process.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:229.78px" class="cls_006">
            <span class="cls_006">We have also taken a brief look at how to specify different options if you have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:242.38px" class="cls_006">
            <span class="cls_006">a more complex database setup, or want to override some defaults.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:263.63px" class="cls_006">
            <span class="cls_006">You should now have connected your MongoosePM project to the MongoosePM</span>
        </div>
        <div style="position:absolute;left:108.00px;top:276.23px" class="cls_006">
            <span class="cls_006">database, even though the database doesn't exist yet!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:297.47px" class="cls_006">
            <span class="cls_006">In the next chapter, we're going to start getting stuck into the real meat of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:310.07px" class="cls_006">
            <span class="cls_006">Mongoose, by defining schemas and models.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 29 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:33684px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background043.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:34486px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background044.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:215.51px;top:218.71px" class="cls_015">
            <span class="cls_015">Schemas and Models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:272.41px" class="cls_006">
            <span class="cls_006">We are going to look at the two building blocks of Mongoose, schemas, and models.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:285.01px" class="cls_006">
            <span class="cls_006">We will look at their relationship to the data and how they can be used to maximize</span>
        </div>
        <div style="position:absolute;left:108.00px;top:297.61px" class="cls_006">
            <span class="cls_006">the effectiveness of Mongoose. This chapter covers fairly simple schemas; more</span>
        </div>
        <div style="position:absolute;left:108.00px;top:310.21px" class="cls_006">
            <span class="cls_006">complex schemas will be explored in </span>
            <span class="cls_021">Chapter 10</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Complex Schemas</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.46px" class="cls_006">
            <span class="cls_006">By the end of this chapter, you will understand the roles of schemas and models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.06px" class="cls_006">
            <span class="cls_006">and their relationship to the data. We will also add schemas and models to the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:356.66px" class="cls_006">
            <span class="cls_006">MongoosePM example project.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:389.15px" class="cls_022">
            <span class="cls_022">Introducing schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:414.13px" class="cls_006">
            <span class="cls_006">So what is a schema? At its simplest, a </span>
            <span class="cls_025">schema</span>
            <span class="cls_006"> is a way to describe the structure of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:426.73px" class="cls_006">
            <span class="cls_006">data. Typically this involves giving each piece of data a label, and stating what type</span>
        </div>
        <div style="position:absolute;left:108.00px;top:439.33px" class="cls_006">
            <span class="cls_006">of data it is, for example, a number, date, string, and so on.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:460.58px" class="cls_006">
            <span class="cls_006">As we have already seen in </span>
            <span class="cls_021">Chapter 1</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Introducing Mongoose to the Technology Stack</span>
            <span class="cls_006">, a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:473.18px" class="cls_006">
            <span class="cls_006">schema definition in Mongoose is a JSON object. In the following example, we are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:485.77px" class="cls_006">
            <span class="cls_006">creating a new Mongoose schema called </span>
            <span class="cls_007">userSchema</span>
            <span class="cls_006">. We are stating that a database</span>
        </div>
        <div style="position:absolute;left:108.01px;top:498.37px" class="cls_006">
            <span class="cls_006">document using this schema will have three pieces of data, which are as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:519.61px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> name</span>
            <span class="cls_006">: This data will contain a string</span>
        </div>
        <div style="position:absolute;left:126.00px;top:536.53px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> email</span>
            <span class="cls_006">: This will also contain a string value</span>
        </div>
        <div style="position:absolute;left:126.00px;top:553.45px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> createdOn</span>
            <span class="cls_006">: This data will contain a date</span>
        </div>
        <div style="position:absolute;left:108.00px;top:574.70px" class="cls_006">
            <span class="cls_006">The following is the schema definition:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:595.63px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:607.87px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:620.11px" class="cls_023">
            <span class="cls_023">email: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:632.35px" class="cls_023">
            <span class="cls_023">createdOn: Date</span>
        </div>
        <div style="position:absolute;left:126.00px;top:644.59px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:35288px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background045.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Schemas and Models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Field sizes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">Note that, unlike some other systems there is no need to set the field size. This can</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">be useful if you need to change the amount of data stored in a particular object.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">For example, your system might impose a 16-character limit on usernames, so you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:173.24px" class="cls_006">
            <span class="cls_006">set the size of the field to </span>
            <span class="cls_007">16</span>
            <span class="cls_006"> characters. Later, you realize that you want to encrypt</span>
        </div>
        <div style="position:absolute;left:108.00px;top:185.84px" class="cls_006">
            <span class="cls_006">the usernames, but this will double the length of the data stored. If your database</span>
        </div>
        <div style="position:absolute;left:108.00px;top:198.44px" class="cls_006">
            <span class="cls_006">schema uses fixed field sizes, you will need to refactor it, which can take a long time</span>
        </div>
        <div style="position:absolute;left:108.00px;top:211.04px" class="cls_006">
            <span class="cls_006">on a large database. With Mongoose, you can just start encrypting that data object</span>
        </div>
        <div style="position:absolute;left:108.00px;top:223.64px" class="cls_006">
            <span class="cls_006">without worrying about it.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:244.89px" class="cls_006">
            <span class="cls_006">If you're storing large documents, you should bear in mind that MongoDB imposes a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:257.49px" class="cls_006">
            <span class="cls_006">maximum document size of 16 MB. There are ways around even this limit, using the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:270.09px" class="cls_006">
            <span class="cls_006">MongoDB GridFS API.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:302.58px" class="cls_022">
            <span class="cls_022">Data types allowed in schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:327.56px" class="cls_006">
            <span class="cls_006">There are eight types of data that can—by default—be set in a Mongoose schema.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:340.16px" class="cls_006">
            <span class="cls_006">These are also referred to as SchemaTypes; they are:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:361.41px" class="cls_006">
            <span class="cls_006">• String</span>
        </div>
        <div style="position:absolute;left:126.00px;top:378.32px" class="cls_006">
            <span class="cls_006">• Number</span>
        </div>
        <div style="position:absolute;left:126.00px;top:395.24px" class="cls_006">
            <span class="cls_006">• Date</span>
        </div>
        <div style="position:absolute;left:126.00px;top:412.15px" class="cls_006">
            <span class="cls_006">• Boolean</span>
        </div>
        <div style="position:absolute;left:126.00px;top:429.07px" class="cls_006">
            <span class="cls_006">• Buffer</span>
        </div>
        <div style="position:absolute;left:126.00px;top:445.98px" class="cls_006">
            <span class="cls_006">• ObjectId</span>
        </div>
        <div style="position:absolute;left:126.00px;top:462.90px" class="cls_006">
            <span class="cls_006">• Mixed</span>
        </div>
        <div style="position:absolute;left:126.00px;top:479.81px" class="cls_006">
            <span class="cls_006">• Array</span>
        </div>
        <div style="position:absolute;left:107.99px;top:501.06px" class="cls_006">
            <span class="cls_006">The first four SchemaTypes are self-explanatory, but let's take a quick look at</span>
        </div>
        <div style="position:absolute;left:107.99px;top:513.66px" class="cls_006">
            <span class="cls_006">them all.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:543.62px" class="cls_027">
            <span class="cls_027">String</span>
        </div>
        <div style="position:absolute;left:108.00px;top:566.60px" class="cls_006">
            <span class="cls_006">This SchemaType stores a string value, UTF-8 encoded.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 32 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:36090px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background046.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 3</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Number</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">This SchemaType stores a number value, with restrictions. Mongoose does not</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">natively support </span>
            <span class="cls_007">long</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">double</span>
            <span class="cls_006"> datatypes for example, although MongoDB</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">does. However, Mongoose can be extended using plugins to support these other</span>
        </div>
        <div style="position:absolute;left:108.00px;top:173.24px" class="cls_006">
            <span class="cls_006">types. See </span>
            <span class="cls_021">Chapter 11</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Plugins - Re-using Code</span>
            <span class="cls_006"> for more on plugins.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:203.18px" class="cls_027">
            <span class="cls_027">Date</span>
        </div>
        <div style="position:absolute;left:108.00px;top:226.16px" class="cls_006">
            <span class="cls_006">This SchemaType holds a date and time object, typically returned from MongoDB</span>
        </div>
        <div style="position:absolute;left:108.00px;top:238.76px" class="cls_006">
            <span class="cls_006">as an ISODate object, for example, </span>
            <span class="cls_007">ISODate("2013-04-03T12:56:26.009Z")</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:268.70px" class="cls_027">
            <span class="cls_027">Boolean</span>
        </div>
        <div style="position:absolute;left:108.00px;top:291.68px" class="cls_006">
            <span class="cls_006">This SchemaType has only two values: </span>
            <span class="cls_007">true</span>
            <span class="cls_006"> or </span>
            <span class="cls_007">false</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:321.62px" class="cls_027">
            <span class="cls_027">Buffer</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.60px" class="cls_006">
            <span class="cls_006">This SchemaType is primarily used for storing binary information, for example,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:357.20px" class="cls_006">
            <span class="cls_006">images stored in MongoDB.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:387.14px" class="cls_027">
            <span class="cls_027">ObjectId</span>
        </div>
        <div style="position:absolute;left:108.00px;top:410.12px" class="cls_006">
            <span class="cls_006">This SchemaType is used to assign a unique identifier to a key other than </span>
            <span class="cls_007">_id</span>
            <span class="cls_006">, for</span>
        </div>
        <div style="position:absolute;left:108.00px;top:422.72px" class="cls_006">
            <span class="cls_006">example, a foreign key for referencing another document (see </span>
            <span class="cls_021">Chapter 10</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Complex</span>
        </div>
        <div style="position:absolute;left:108.00px;top:435.32px" class="cls_021">
            <span class="cls_021">Schemas</span>
            <span class="cls_006"> for more about this). Rather than just specifying the type of </span>
            <span class="cls_007">ObjectId</span>
            <span class="cls_006"> you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:447.92px" class="cls_006">
            <span class="cls_006">need to specify the fully qualified version </span>
            <span class="cls_007">Schema.Types.ObjectId</span>
            <span class="cls_006">. For example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:468.86px" class="cls_023">
            <span class="cls_023">projectSchema.add({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:480.38px" class="cls_023">
            <span class="cls_023">owner: mongoose.Schema.Types.ObjectId</span>
        </div>
        <div style="position:absolute;left:126.00px;top:491.90px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:520.34px" class="cls_027">
            <span class="cls_027">Mixed</span>
        </div>
        <div style="position:absolute;left:108.00px;top:543.32px" class="cls_006">
            <span class="cls_006">A </span>
            <span class="cls_007">mixed</span>
            <span class="cls_006"> data object can contain any type of data. It can be declared either by</span>
        </div>
        <div style="position:absolute;left:108.00px;top:555.92px" class="cls_006">
            <span class="cls_006">setting an empty object, or by using the fully qualified </span>
            <span class="cls_007">Schema.Types.Mixed</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:568.52px" class="cls_006">
            <span class="cls_006">These following two commands will do the same thing:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:589.46px" class="cls_023">
            <span class="cls_023">vardjSchema= new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:600.98px" class="cls_023">
            <span class="cls_023">mixedUp: {}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:612.50px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:624.02px" class="cls_023">
            <span class="cls_023">vardjSchema= new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:635.54px" class="cls_023">
            <span class="cls_023">mixedUp: Schema.Types.Mixed</span>
        </div>
        <div style="position:absolute;left:126.00px;top:647.06px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 33 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:36892px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background047.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Schemas and Models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">While this sounds like it might be great, there is a big caveat. Changes to data of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_007">
            <span class="cls_007">mixed</span>
            <span class="cls_006"> type cannot be automatically detected by Mongoose, so it doesn't know that it</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">needs to save them.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:167.79px" class="cls_013">
            <span class="cls_013">Tracking changes to Mixed type</span>
        </div>
        <div style="position:absolute;left:108.00px;top:188.77px" class="cls_006">
            <span class="cls_006">As Mongoose can't automatically see changes made to </span>
            <span class="cls_007">mixed</span>
            <span class="cls_006"> type of data, you have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:201.37px" class="cls_006">
            <span class="cls_006">to manually declare when the data has changed. Fortunately, Mongoose exposes a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:213.97px" class="cls_006">
            <span class="cls_006">method called </span>
            <span class="cls_007">markModified</span>
            <span class="cls_006"> to do just this, passing it the path of the data object that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:226.57px" class="cls_006">
            <span class="cls_006">has changed.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:247.51px" class="cls_023">
            <span class="cls_023">dj.mixedUp = { valueone: "a new value" };</span>
        </div>
        <div style="position:absolute;left:126.00px;top:259.75px" class="cls_023">
            <span class="cls_023">dj.markModified('mixedUp');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:271.99px" class="cls_023">
            <span class="cls_023">dj.save();</span>
        </div>
        <div style="position:absolute;left:108.00px;top:300.43px" class="cls_027">
            <span class="cls_027">Array</span>
        </div>
        <div style="position:absolute;left:108.00px;top:323.41px" class="cls_006">
            <span class="cls_006">The </span>
            <span class="cls_007">array</span>
            <span class="cls_006"> datatype can be used in two ways. First, a simple array of values of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:336.01px" class="cls_006">
            <span class="cls_006">same data type, as shown in the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:356.95px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:369.19px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:381.43px" class="cls_023">
            <span class="cls_023">emailAddresses: [String]</span>
        </div>
        <div style="position:absolute;left:126.00px;top:393.67px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:413.41px" class="cls_006">
            <span class="cls_006">Second, the array datatype can be used to store a collection of subdocuments using</span>
        </div>
        <div style="position:absolute;left:108.00px;top:426.01px" class="cls_006">
            <span class="cls_006">nested schemas. We'll explore this concept further in </span>
            <span class="cls_021">Chapter 10</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Complex Schemas</span>
            <span class="cls_006">, but</span>
        </div>
        <div style="position:absolute;left:108.00px;top:438.61px" class="cls_006">
            <span class="cls_006">for now here's an example in the following of how this can work:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:459.55px" class="cls_023">
            <span class="cls_023">var emailSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:471.79px" class="cls_023">
            <span class="cls_023">email: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:484.03px" class="cls_023">
            <span class="cls_023">verified: Boolean</span>
        </div>
        <div style="position:absolute;left:126.00px;top:496.27px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:508.51px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:520.75px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:532.99px" class="cls_023">
            <span class="cls_023">emailAddresses: [emailSchema]</span>
        </div>
        <div style="position:absolute;left:126.00px;top:545.23px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:571.83px" class="cls_013">
            <span class="cls_013">Warning - array defined as mixed type</span>
        </div>
        <div style="position:absolute;left:108.00px;top:592.81px" class="cls_006">
            <span class="cls_006">A word of caution. If you declare an empty array it will be treated as </span>
            <span class="cls_007">mixed</span>
            <span class="cls_006"> type,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:605.41px" class="cls_006">
            <span class="cls_006">meaning that Mongoose will not be able to automatically detect any changes made to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:618.01px" class="cls_006">
            <span class="cls_006">the data. So avoid these two types of array declaration, unless you intentionally want</span>
        </div>
        <div style="position:absolute;left:108.00px;top:630.61px" class="cls_006">
            <span class="cls_006">a </span>
            <span class="cls_007">mixed</span>
            <span class="cls_006"> type.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 34 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:37694px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background048.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 3</span>
        </div>
        <div style="position:absolute;left:126.00px;top:114.01px" class="cls_023">
            <span class="cls_023">var emailSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:126.25px" class="cls_023">
            <span class="cls_023">addresses: []</span>
        </div>
        <div style="position:absolute;left:126.00px;top:138.49px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:150.73px" class="cls_023">
            <span class="cls_023">var emailSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:162.97px" class="cls_023">
            <span class="cls_023">addresses: Array</span>
        </div>
        <div style="position:absolute;left:126.00px;top:175.21px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:203.64px" class="cls_027">
            <span class="cls_027">Custom SchemaTypes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:226.62px" class="cls_006">
            <span class="cls_006">If your data requires a different datatype which is not covered earlier in this chapter,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:239.22px" class="cls_006">
            <span class="cls_006">Mongoose offers the option of extending it with custom SchemaTypes. The extension</span>
        </div>
        <div style="position:absolute;left:108.00px;top:251.82px" class="cls_006">
            <span class="cls_006">method is managed using Mongoose plugins, which we'll look at in detail in </span>
            <span class="cls_021">Chapter</span>
        </div>
        <div style="position:absolute;left:108.00px;top:264.42px" class="cls_021">
            <span class="cls_021">11</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Plugins - Re-using Code</span>
            <span class="cls_006">. Some examples of SchemaType extensions that have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:277.02px" class="cls_006">
            <span class="cls_006">already been created are: </span>
            <span class="cls_007">long</span>
            <span class="cls_006">, </span>
            <span class="cls_007">double</span>
            <span class="cls_006">, </span>
            <span class="cls_007">RegEx</span>
            <span class="cls_006">, and even </span>
            <span class="cls_007">email</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:309.52px" class="cls_022">
            <span class="cls_022">Where to write the schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:334.50px" class="cls_006">
            <span class="cls_006">As your schemas sit on top of Mongoose, the only absolute is that they need to be</span>
        </div>
        <div style="position:absolute;left:108.00px;top:347.10px" class="cls_006">
            <span class="cls_006">defined after Mongoose is </span>
            <span class="cls_021">required</span>
            <span class="cls_006">. You don't need an active or open connection to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:359.70px" class="cls_006">
            <span class="cls_006">define your schemas.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:380.94px" class="cls_006">
            <span class="cls_006">That being said it is advisable to make your connection early on, so that it is available</span>
        </div>
        <div style="position:absolute;left:108.00px;top:393.54px" class="cls_006">
            <span class="cls_006">as soon as possible, bearing in mind that remote database or replica sets may take</span>
        </div>
        <div style="position:absolute;left:108.00px;top:406.14px" class="cls_006">
            <span class="cls_006">longer to connect than your localhost development server.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:427.39px" class="cls_006">
            <span class="cls_006">While no action can be taken on the database through the schemas and models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:439.99px" class="cls_006">
            <span class="cls_006">until the connection is open, Mongoose can buffer requests made from when the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:452.59px" class="cls_006">
            <span class="cls_006">connection is defined. Mongoose models also rely on the connection being defined,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:465.19px" class="cls_006">
            <span class="cls_006">so there's another reason to get the connection set up early in the code and then</span>
        </div>
        <div style="position:absolute;left:108.00px;top:477.79px" class="cls_006">
            <span class="cls_006">define the schemas and models.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:510.28px" class="cls_022">
            <span class="cls_022">Writing a schema</span>
        </div>
        <div style="position:absolute;left:108.00px;top:535.26px" class="cls_006">
            <span class="cls_006">Let's write the schema for a User in our MongoosePM application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:556.50px" class="cls_006">
            <span class="cls_006">The first thing we have to do is declare a variable to hold the schema. I recommend</span>
        </div>
        <div style="position:absolute;left:108.00px;top:569.10px" class="cls_006">
            <span class="cls_006">taking the object name (for example, </span>
            <span class="cls_007">user</span>
            <span class="cls_006"> or </span>
            <span class="cls_007">project</span>
            <span class="cls_006">) and adding </span>
            <span class="cls_007">Schema</span>
            <span class="cls_006"> to the end</span>
        </div>
        <div style="position:absolute;left:108.00px;top:581.70px" class="cls_006">
            <span class="cls_006">of it. This makes following the code later on super easy.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:602.94px" class="cls_006">
            <span class="cls_006">The second thing we need to do is create a new Mongoose schema object to assign to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:615.54px" class="cls_006">
            <span class="cls_006">this variable. The skeleton of this is as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:636.48px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({ });</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 35 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:38496px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background049.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Schemas and Models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">We can add in the basic values of </span>
            <span class="cls_007">name</span>
            <span class="cls_006">, </span>
            <span class="cls_007">email</span>
            <span class="cls_006">, and </span>
            <span class="cls_007">createdOn</span>
            <span class="cls_006"> that we looked at</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">earlier, giving us our first user schema definition.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.03px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:160.27px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:172.51px" class="cls_023">
            <span class="cls_023">email: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:184.75px" class="cls_023">
            <span class="cls_023">createdOn: Date</span>
        </div>
        <div style="position:absolute;left:126.00px;top:196.99px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:225.43px" class="cls_027">
            <span class="cls_027">Modifying an existing schema</span>
        </div>
        <div style="position:absolute;left:108.00px;top:248.41px" class="cls_006">
            <span class="cls_006">Suppose we run the application with this for a while, and then decide that we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:261.01px" class="cls_006">
            <span class="cls_006">want to record the last time each user logged on, and the last time their record</span>
        </div>
        <div style="position:absolute;left:108.00px;top:273.61px" class="cls_006">
            <span class="cls_006">was modified. No problem!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:294.86px" class="cls_006">
            <span class="cls_006">We don't have to refactor the database or take it offline while we upgrade the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:307.46px" class="cls_006">
            <span class="cls_006">schema, we simply add a couple of entries to the Mongoose schema. If a key</span>
        </div>
        <div style="position:absolute;left:108.00px;top:320.06px" class="cls_006">
            <span class="cls_006">requested in the schema doesn't exist, neither Mongoose nor MongoDB will</span>
        </div>
        <div style="position:absolute;left:108.00px;top:332.66px" class="cls_006">
            <span class="cls_006">throw errors, Mongoose will just return null values. When saving the MongoDB</span>
        </div>
        <div style="position:absolute;left:108.00px;top:345.26px" class="cls_006">
            <span class="cls_006">documents, the new keys and values will be added and stored as required. If the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:357.86px" class="cls_006">
            <span class="cls_006">value is null, then the key is not added.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:379.09px" class="cls_006">
            <span class="cls_006">So let's add </span>
            <span class="cls_007">modifiedOn</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">lastLogin</span>
            <span class="cls_006"> to our </span>
            <span class="cls_007">userSchema</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:400.03px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:412.27px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:424.51px" class="cls_023">
            <span class="cls_023">email: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:436.75px" class="cls_023">
            <span class="cls_023">createdOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:448.99px" class="cls_023">
            <span class="cls_023">modifiedOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:461.23px" class="cls_023">
            <span class="cls_023">lastLogin: Date</span>
        </div>
        <div style="position:absolute;left:126.00px;top:473.47px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:501.91px" class="cls_027">
            <span class="cls_027">Setting a default value</span>
        </div>
        <div style="position:absolute;left:108.00px;top:524.89px" class="cls_006">
            <span class="cls_006">Mongoose allows us to set a default value for a data key when the document is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:537.49px" class="cls_006">
            <span class="cls_006">first created. Looking at our schema created earlier, a possible candidate for this is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:550.09px" class="cls_007">
            <span class="cls_007">createdOn</span>
            <span class="cls_006">. When a user first signs up, we want the date and time to be set.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:571.34px" class="cls_006">
            <span class="cls_006">We could do this by adding a timestamp to the controller function when we create a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:583.94px" class="cls_006">
            <span class="cls_006">user, or to make a point we can modify the schema to set a default value.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:605.17px" class="cls_006">
            <span class="cls_006">To do this, we need to change the information we are sending about the </span>
            <span class="cls_007">createdOn</span>
        </div>
        <div style="position:absolute;left:108.00px;top:617.77px" class="cls_006">
            <span class="cls_006">data object.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 36 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:39298px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background050.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 3</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">What we have currently is:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">createdOn: Date</span>
        </div>
        <div style="position:absolute;left:108.00px;top:155.17px" class="cls_006">
            <span class="cls_006">This is short for:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:176.11px" class="cls_023">
            <span class="cls_023">createdOn: { type: Date }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:195.85px" class="cls_006">
            <span class="cls_006">We can add another entry to this object to set a default value here, using the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:208.45px" class="cls_006">
            <span class="cls_006">JavaScript </span>
            <span class="cls_007">Date</span>
            <span class="cls_006"> object:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:229.39px" class="cls_023">
            <span class="cls_023">createdOn: { type: Date, default: Date.now }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.13px" class="cls_006">
            <span class="cls_006">Now every time a new user is created its </span>
            <span class="cls_007">createdOn</span>
            <span class="cls_006"> value will be set to the current</span>
        </div>
        <div style="position:absolute;left:108.00px;top:261.73px" class="cls_006">
            <span class="cls_006">date and time.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:282.97px" class="cls_006">
            <span class="cls_006">Note that in JavaScript </span>
            <span class="cls_007">default</span>
            <span class="cls_006"> is a reserved word. While the language allows</span>
        </div>
        <div style="position:absolute;left:108.00px;top:295.57px" class="cls_006">
            <span class="cls_006">reserved words to be used as keys, some IDEs and linters regard it as an error. If</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.17px" class="cls_006">
            <span class="cls_006">this causes issues for you or your environment, you can wrap it in quotes, like in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:320.77px" class="cls_006">
            <span class="cls_006">the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:341.71px" class="cls_023">
            <span class="cls_023">createdOn: { type: Date, 'default': Date.now }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:370.15px" class="cls_027">
            <span class="cls_027">Only allowing unique entries</span>
        </div>
        <div style="position:absolute;left:108.00px;top:393.13px" class="cls_006">
            <span class="cls_006">In </span>
            <span class="cls_021">Chapter 9</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Validating Data</span>
            <span class="cls_006">, we will be looking at how we can use Mongoose to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:405.73px" class="cls_006">
            <span class="cls_006">validate data, but here is a quick way to ensure that there are no duplicates for a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:418.33px" class="cls_006">
            <span class="cls_006">specific data item.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:439.58px" class="cls_006">
            <span class="cls_006">For example, if we want to ensure that there is only ever one user per e-mail address,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:452.17px" class="cls_006">
            <span class="cls_006">we can specify that the </span>
            <span class="cls_007">email</span>
            <span class="cls_006"> field should be unique.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:473.11px" class="cls_023">
            <span class="cls_023">email: {type: String, unique:true}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:492.85px" class="cls_006">
            <span class="cls_006">With this in place, when saving to the database, MongoDB will check to see if</span>
        </div>
        <div style="position:absolute;left:108.00px;top:505.45px" class="cls_006">
            <span class="cls_006">the e-mail value already exists in another document. If it finds it, MongoDB (not</span>
        </div>
        <div style="position:absolute;left:108.00px;top:518.05px" class="cls_006">
            <span class="cls_006">Mongoose) will return an </span>
            <span class="cls_025">E11000</span>
            <span class="cls_006"> error. Note that this approach also defines a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:530.65px" class="cls_006">
            <span class="cls_006">MongoDB index on the </span>
            <span class="cls_007">email</span>
            <span class="cls_006"> field.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:551.90px" class="cls_006">
            <span class="cls_006">We'll look at more validation techniques in </span>
            <span class="cls_021">Chapter 9</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Validating Data</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 37 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:40100px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background051.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Schemas and Models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Our final User schema</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">Your </span>
            <span class="cls_007">userSchema</span>
            <span class="cls_006"> should now look like the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:156.38px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:168.62px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:180.86px" class="cls_023">
            <span class="cls_023">email: {type: String, unique:true},</span>
        </div>
        <div style="position:absolute;left:136.80px;top:193.10px" class="cls_023">
            <span class="cls_023">createdOn: { type: Date, default: Date.now },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:205.34px" class="cls_023">
            <span class="cls_023">modifiedOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:217.58px" class="cls_023">
            <span class="cls_023">lastLogin: Date</span>
        </div>
        <div style="position:absolute;left:126.00px;top:229.82px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.56px" class="cls_006">
            <span class="cls_006">A corresponding document from the database would look like the following (line</span>
        </div>
        <div style="position:absolute;left:108.00px;top:262.16px" class="cls_006">
            <span class="cls_006">breaks are added for readability):</span>
        </div>
        <div style="position:absolute;left:126.00px;top:283.10px" class="cls_023">
            <span class="cls_023">{ "__v" : 0,</span>
        </div>
        <div style="position:absolute;left:126.00px;top:295.34px" class="cls_023">
            <span class="cls_023">"_id" : ObjectId("5126b7a1f8a44d1e32000001"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:307.58px" class="cls_023">
            <span class="cls_023">"createdOn" : ISODate("2013-02-22T00:11:13.436Z"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:319.82px" class="cls_023">
            <span class="cls_023">"email" : "simon@theholmesoffice.com",</span>
        </div>
        <div style="position:absolute;left:126.00px;top:332.06px" class="cls_023">
            <span class="cls_023">"lastLogin" : ISODate("2013-04-03T12:54:42.734Z"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:344.30px" class="cls_023">
            <span class="cls_023">"modifiedOn" : ISODate("2013-04-03T12:56:26.009Z"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:356.54px" class="cls_023">
            <span class="cls_023">"name" : "Simon Holmes" }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:384.98px" class="cls_027">
            <span class="cls_027">What's that "__v" thing?</span>
        </div>
        <div style="position:absolute;left:108.00px;top:407.96px" class="cls_006">
            <span class="cls_006">You may have noticed a data entity in the document that we didn't set: </span>
            <span class="cls_007">__v</span>
            <span class="cls_006">. This is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:420.56px" class="cls_006">
            <span class="cls_006">an internal versioning number automatically set by Mongoose when a document is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:433.16px" class="cls_006">
            <span class="cls_006">created. It doesn't increment when a document is changed, but instead is automatically</span>
        </div>
        <div style="position:absolute;left:108.00px;top:445.76px" class="cls_006">
            <span class="cls_006">incremented whenever an array within the document is updated in such a way that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:458.36px" class="cls_006">
            <span class="cls_006">might cause the indexed position of some of the entries to have changed.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:486.46px" class="cls_013">
            <span class="cls_013">Why is this needed?</span>
        </div>
        <div style="position:absolute;left:108.00px;top:507.44px" class="cls_006">
            <span class="cls_006">When working with an array you will typically access the individual elements</span>
        </div>
        <div style="position:absolute;left:108.00px;top:520.04px" class="cls_006">
            <span class="cls_006">through their positional index, for example, </span>
            <span class="cls_007">myArray[3]</span>
            <span class="cls_006">. But what happens if</span>
        </div>
        <div style="position:absolute;left:108.00px;top:532.64px" class="cls_006">
            <span class="cls_006">somebody else deletes the element in </span>
            <span class="cls_007">myArray[2]</span>
            <span class="cls_006"> while you are editing the data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:545.24px" class="cls_006">
            <span class="cls_006">in </span>
            <span class="cls_007">myArray[3]</span>
            <span class="cls_006">? Your original data is now contained in </span>
            <span class="cls_007">myArray[2]</span>
            <span class="cls_006"> but you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:557.84px" class="cls_006">
            <span class="cls_006">don't know this, so you quite happily overwrite whatever data is now stored in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:570.44px" class="cls_007">
            <span class="cls_007">myArray[3]</span>
            <span class="cls_006">.The </span>
            <span class="cls_007">__v</span>
            <span class="cls_006"> gives you a method to be able to sanity check this, and prevent</span>
        </div>
        <div style="position:absolute;left:108.00px;top:583.04px" class="cls_006">
            <span class="cls_006">this scenario from happening.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 38 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:40902px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background052.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 3</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Defining the Project schema</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">As part of our MongoosePM application we also need to think about Projects. After</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">all, PM here does stand for Project Manager.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:169.29px" class="cls_006">
            <span class="cls_006">Let's take what we've learned and create the Project schema. We are going to want a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:181.89px" class="cls_006">
            <span class="cls_006">few types of data to start with:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:203.12px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> projectName</span>
            <span class="cls_006">: A string containing the name of the project.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:220.04px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> createdOn</span>
            <span class="cls_006">: The date when the document was first created and saved. This</span>
        </div>
        <div style="position:absolute;left:144.00px;top:232.64px" class="cls_006">
            <span class="cls_006">option is set to automatically save the current date and time..</span>
        </div>
        <div style="position:absolute;left:126.00px;top:249.56px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> modifiedOn</span>
            <span class="cls_006">: The date and time when the document was last changed.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:266.48px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> createdBy</span>
            <span class="cls_006">: A string that will for now contain the unique ID of the user who</span>
        </div>
        <div style="position:absolute;left:144.00px;top:279.08px" class="cls_006">
            <span class="cls_006">created the project.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:296.00px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> tasks</span>
            <span class="cls_006">: A string to hold task information.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:317.25px" class="cls_006">
            <span class="cls_006">Transforming these requirements into a Mongoose schema definition, we create this</span>
        </div>
        <div style="position:absolute;left:108.00px;top:329.85px" class="cls_006">
            <span class="cls_006">in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:350.78px" class="cls_023">
            <span class="cls_023">varprojectSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:363.02px" class="cls_023">
            <span class="cls_023">projectName: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:375.26px" class="cls_023">
            <span class="cls_023">createdOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:387.50px" class="cls_023">
            <span class="cls_023">modifiedOn: { type: Date, default: Date.now },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:399.74px" class="cls_023">
            <span class="cls_023">createdBy: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:411.98px" class="cls_023">
            <span class="cls_023">tasks: String</span>
        </div>
        <div style="position:absolute;left:126.00px;top:424.22px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:443.96px" class="cls_006">
            <span class="cls_006">This is our starting point, and we will build upon it when we look at more complex</span>
        </div>
        <div style="position:absolute;left:108.00px;top:456.56px" class="cls_006">
            <span class="cls_006">schemas in </span>
            <span class="cls_021">Chapter 10</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Complex Schemas</span>
            <span class="cls_006">. For now we have these basic data objects as</span>
        </div>
        <div style="position:absolute;left:108.00px;top:469.16px" class="cls_006">
            <span class="cls_006">mentioned previously in this chapter.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:490.41px" class="cls_006">
            <span class="cls_006">Here's an example of a corresponding document from the database (line breaks</span>
        </div>
        <div style="position:absolute;left:108.00px;top:503.01px" class="cls_006">
            <span class="cls_006">added for readability):</span>
        </div>
        <div style="position:absolute;left:126.00px;top:523.94px" class="cls_023">
            <span class="cls_023">{ "projectName" : "Another test",</span>
        </div>
        <div style="position:absolute;left:126.00px;top:536.18px" class="cls_023">
            <span class="cls_023">"createdBy" : "5126b7a1f8a44d1e32000001",</span>
        </div>
        <div style="position:absolute;left:126.00px;top:548.42px" class="cls_023">
            <span class="cls_023">"createdOn" : ISODate("2013-04-03T17:47:51.031Z"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:560.66px" class="cls_023">
            <span class="cls_023">"tasks" : "Just a simple task",</span>
        </div>
        <div style="position:absolute;left:126.00px;top:572.90px" class="cls_023">
            <span class="cls_023">"_id" : ObjectId("515c6b47596acf8e35000001"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:585.14px" class="cls_023">
            <span class="cls_023">"modifiedOn" : ISODate("2013-04-03T17:47:51.032Z"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:597.38px" class="cls_023">
            <span class="cls_023">"__v" : 0 }</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 39 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:41704px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background053.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Schemas and Models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Improving the Project schema</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">Throughout the rest of the book we will be improving this schema, but the beauty</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">of using Mongoose is that we can do this relatively easily. Putting together a basic</span>
        </div>
        <div style="position:absolute;left:108.00px;top:159.19px" class="cls_006">
            <span class="cls_006">schema like this to build upon is a great approach for prototyping—you have the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:171.79px" class="cls_006">
            <span class="cls_006">data you need there, and can add complexity where you need, when you need it.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:204.29px" class="cls_022">
            <span class="cls_022">Building models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:229.27px" class="cls_006">
            <span class="cls_006">If you remember from </span>
            <span class="cls_021">Chapter 1</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Introducing Mongoose to the Technology Stack</span>
            <span class="cls_006">, a model</span>
        </div>
        <div style="position:absolute;left:108.00px;top:241.87px" class="cls_006">
            <span class="cls_006">is a compiled version of the schema.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:263.11px" class="cls_006">
            <span class="cls_006">A single instance of a model maps directly to a single document in the database.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:275.71px" class="cls_006">
            <span class="cls_006">With this 1:1 relationship, it is the model that handles all document interaction—</span>
        </div>
        <div style="position:absolute;left:108.00px;top:288.31px" class="cls_006">
            <span class="cls_006">creating, reading, saving, and deleting.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:309.55px" class="cls_006">
            <span class="cls_006">This makes the model a very powerful tool.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:330.79px" class="cls_006">
            <span class="cls_006">Building the model, as we have seen, is pretty straightforward. When using the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:343.39px" class="cls_006">
            <span class="cls_006">default Mongoose connection we can call the </span>
            <span class="cls_007">mongoose.model</span>
            <span class="cls_006"> command, passing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:355.99px" class="cls_006">
            <span class="cls_006">it two arguments:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:377.23px" class="cls_006">
            <span class="cls_006">• The name of the model</span>
        </div>
        <div style="position:absolute;left:126.00px;top:394.15px" class="cls_006">
            <span class="cls_006">• The name of the schema to compile</span>
        </div>
        <div style="position:absolute;left:107.99px;top:415.39px" class="cls_006">
            <span class="cls_006">So if we were to build a model from our user schema we would use this line:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:436.33px" class="cls_023">
            <span class="cls_023">mongoose.model( 'User', userSchema );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:456.07px" class="cls_006">
            <span class="cls_006">If using a named Mongoose connection, the approach is very similar. Using the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:468.67px" class="cls_007">
            <span class="cls_007">adminConnection</span>
            <span class="cls_006"> example from </span>
            <span class="cls_021">Chapter 2</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Establishing a Database Connection</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:489.71px" class="cls_007">
            <span class="cls_007">adminConnection</span>
            <span class="cls_023">.model( 'User', userSchema );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:518.65px" class="cls_027">
            <span class="cls_027">Instances</span>
        </div>
        <div style="position:absolute;left:108.00px;top:541.63px" class="cls_006">
            <span class="cls_006">We'll be looking at how we interact with the data in the next chapter, but it is useful</span>
        </div>
        <div style="position:absolute;left:108.00px;top:554.23px" class="cls_006">
            <span class="cls_006">to have a good understanding of how a model works.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:575.47px" class="cls_006">
            <span class="cls_006">After building the </span>
            <span class="cls_007">User</span>
            <span class="cls_006"> model, using the previous line we could create two instances.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:596.41px" class="cls_023">
            <span class="cls_023">var userOne = new User({ name: 'Simon' });</span>
        </div>
        <div style="position:absolute;left:126.00px;top:608.65px" class="cls_023">
            <span class="cls_023">var userTwo = new User({ name: 'Sally' });</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 40 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:42506px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background054.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 3</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Interacting with instances</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">Each instance is a JavaScript object that we can interact with.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:154.93px" class="cls_023">
            <span class="cls_023">console.log(userOne.name); // 'Simon'</span>
        </div>
        <div style="position:absolute;left:126.00px;top:167.17px" class="cls_023">
            <span class="cls_023">userOne.name = 'Simon Holmes';</span>
        </div>
        <div style="position:absolute;left:126.00px;top:179.41px" class="cls_023">
            <span class="cls_023">console.log(userOne.name); // 'Simon Holmes'</span>
        </div>
        <div style="position:absolute;left:108.00px;top:199.15px" class="cls_006">
            <span class="cls_006">As each new </span>
            <span class="cls_007">User</span>
            <span class="cls_006"> is an instance of the model, we are able to use the power of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:211.75px" class="cls_006">
            <span class="cls_006">model to save it to the database as shown in the following code:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:232.69px" class="cls_023">
            <span class="cls_023">userTwo.save(function (err) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:244.21px" class="cls_023">
            <span class="cls_023">if (err) return handleError(err);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:255.73px" class="cls_023">
            <span class="cls_023">// userTwo (Sally) is saved!</span>
        </div>
        <div style="position:absolute;left:126.00px;top:267.25px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:278.77px" class="cls_023">
            <span class="cls_023">userOne.save(function (err) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:290.29px" class="cls_023">
            <span class="cls_023">if (err) return handleError(err);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:301.81px" class="cls_023">
            <span class="cls_023">// userOne (Simon Holmes) is saved!</span>
        </div>
        <div style="position:absolute;left:126.00px;top:313.33px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:339.93px" class="cls_013">
            <span class="cls_013">Finding a single instance</span>
        </div>
        <div style="position:absolute;left:108.00px;top:360.91px" class="cls_006">
            <span class="cls_006">If we ask Mongoose to "find one", we expect a single instance to be returned. This</span>
        </div>
        <div style="position:absolute;left:108.00px;top:373.51px" class="cls_006">
            <span class="cls_006">looks like the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:394.45px" class="cls_023">
            <span class="cls_023">User.findOne({'name' : 'Sally', function(err,user) {</span>
        </div>
        <div style="position:absolute;left:126.00px;top:405.97px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:417.49px" class="cls_023">
            <span class="cls_023">console.log(user);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:429.01px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:440.53px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:460.27px" class="cls_006">
            <span class="cls_006">The output of this </span>
            <span class="cls_007">console.log</span>
            <span class="cls_006"> is a single instance:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:481.21px" class="cls_023">
            <span class="cls_023">{</span>
        </div>
        <div style="position:absolute;left:136.80px;top:492.73px" class="cls_023">
            <span class="cls_023">name: 'Sally',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:504.25px" class="cls_023">
            <span class="cls_023">_id: 515c6b47596acf8e35000001,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:515.77px" class="cls_023">
            <span class="cls_023">__v: 0</span>
        </div>
        <div style="position:absolute;left:126.00px;top:527.29px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:553.89px" class="cls_013">
            <span class="cls_013">Finding many instances</span>
        </div>
        <div style="position:absolute;left:108.00px;top:574.87px" class="cls_006">
            <span class="cls_006">If we use a "find many" command, we expect to get an array of instances:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:595.81px" class="cls_023">
            <span class="cls_023">User.find({}, function(err, users) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:608.05px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:620.29px" class="cls_023">
            <span class="cls_023">console.log(users);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:632.53px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:644.77px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 41 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:43308px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background055.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Schemas and Models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">The output of this </span>
            <span class="cls_007">console.log</span>
            <span class="cls_006"> is an array of instances:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">[ {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:147.67px" class="cls_023">
            <span class="cls_023">name: 'Sally',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:159.91px" class="cls_023">
            <span class="cls_023">_id: 515c6b47596acf8e35000001,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:172.15px" class="cls_023">
            <span class="cls_023">__v: 0 },</span>
        </div>
        <div style="position:absolute;left:126.00px;top:184.39px" class="cls_023">
            <span class="cls_023">{</span>
        </div>
        <div style="position:absolute;left:136.80px;top:196.63px" class="cls_023">
            <span class="cls_023">name: 'Simon Holmes',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:208.87px" class="cls_023">
            <span class="cls_023">_id: 515c6b47596acf8e35000002,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:221.11px" class="cls_023">
            <span class="cls_023">__v: 0</span>
        </div>
        <div style="position:absolute;left:126.00px;top:233.35px" class="cls_023">
            <span class="cls_023">} ]</span>
        </div>
        <div style="position:absolute;left:108.00px;top:261.79px" class="cls_027">
            <span class="cls_027">Considerations when choosing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:283.39px" class="cls_027">
            <span class="cls_027">your model name</span>
        </div>
        <div style="position:absolute;left:108.00px;top:306.37px" class="cls_006">
            <span class="cls_006">Unless specified, the MongoDB collection will be a pluralized (lowercase) version of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:318.97px" class="cls_006">
            <span class="cls_006">the model name. See the following for example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:339.91px" class="cls_023">
            <span class="cls_023">mongoose.model( 'User', userSchema );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:359.65px" class="cls_006">
            <span class="cls_006">The previous line will reference a collection called </span>
            <span class="cls_007">users</span>
            <span class="cls_006">. If the collection doesn't</span>
        </div>
        <div style="position:absolute;left:108.00px;top:372.25px" class="cls_006">
            <span class="cls_006">exist it will create it the first time a document is saved using the model.</span>
        </div>
        <div style="position:absolute;left:188.87px;top:404.51px" class="cls_026">
            <span class="cls_026">The collection name defaults to a pluralization of the Mongoose</span>
        </div>
        <div style="position:absolute;left:188.87px;top:415.91px" class="cls_026">
            <span class="cls_026">model name.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:454.75px" class="cls_022">
            <span class="cls_022">Setting the collection name</span>
        </div>
        <div style="position:absolute;left:108.00px;top:479.73px" class="cls_006">
            <span class="cls_006">Having a default collection name is great when you're creating an application from</span>
        </div>
        <div style="position:absolute;left:108.00px;top:492.33px" class="cls_006">
            <span class="cls_006">scratch, but what if you're using an existing database with collection names that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:504.93px" class="cls_006">
            <span class="cls_006">don't match this approach?</span>
        </div>
        <div style="position:absolute;left:108.00px;top:526.18px" class="cls_006">
            <span class="cls_006">There are two ways of specifying a different collection name</span>
        </div>
        <div style="position:absolute;left:126.00px;top:547.42px" class="cls_006">
            <span class="cls_006">• Using either the schema declaration, or</span>
        </div>
        <div style="position:absolute;left:126.00px;top:564.33px" class="cls_006">
            <span class="cls_006">• The model command</span>
        </div>
        <div style="position:absolute;left:108.00px;top:594.27px" class="cls_027">
            <span class="cls_027">Overriding the collection name in the schema</span>
        </div>
        <div style="position:absolute;left:108.00px;top:617.25px" class="cls_006">
            <span class="cls_006">To specify a collection name when defining a schema you need to send a second</span>
        </div>
        <div style="position:absolute;left:108.00px;top:629.85px" class="cls_006">
            <span class="cls_006">argument to the </span>
            <span class="cls_007">new mongoose.Schema</span>
            <span class="cls_006"> call.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 42 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:44110px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background056.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 3</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Say we have an existing collection called </span>
            <span class="cls_007">myuserlist</span>
            <span class="cls_006"> that we want to use with our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_007">
            <span class="cls_007">userSchema</span>
            <span class="cls_006">, the following snippet is how we would do it:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.03px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:160.27px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:172.51px" class="cls_023">
            <span class="cls_023">email: {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:184.75px" class="cls_023">
            <span class="cls_023">type: String, unique:true</span>
        </div>
        <div style="position:absolute;left:136.80px;top:196.99px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:209.23px" class="cls_023">
            <span class="cls_023">},</span>
        </div>
        <div style="position:absolute;left:126.00px;top:221.47px" class="cls_023">
            <span class="cls_023">{</span>
        </div>
        <div style="position:absolute;left:136.80px;top:233.71px" class="cls_023">
            <span class="cls_023">collection: 'myuserlist'</span>
        </div>
        <div style="position:absolute;left:126.00px;top:245.95px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:274.39px" class="cls_027">
            <span class="cls_027">Overriding the collection name in the model</span>
        </div>
        <div style="position:absolute;left:108.00px;top:297.37px" class="cls_006">
            <span class="cls_006">To specify the collection name when building a model you send a third argument to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:309.97px" class="cls_006">
            <span class="cls_006">the </span>
            <span class="cls_007">mongoose.model</span>
            <span class="cls_006"> command.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.22px" class="cls_006">
            <span class="cls_006">Using the same example as before, here's how it looks when setting the collection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:343.82px" class="cls_006">
            <span class="cls_006">name through the model command:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:364.75px" class="cls_023">
            <span class="cls_023">mongoose.model( 'User', userSchema, 'myuserlist' );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:393.19px" class="cls_027">
            <span class="cls_027">Building models from our schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:416.17px" class="cls_006">
            <span class="cls_006">Now let's put the theory into action, and build the models from our User and Project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:428.77px" class="cls_006">
            <span class="cls_006">schemas.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:450.01px" class="cls_006">
            <span class="cls_006">In the </span>
            <span class="cls_007">/model/db.js</span>
            <span class="cls_006"> file, add the following after the </span>
            <span class="cls_007">userSchema</span>
            <span class="cls_006"> is defined:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:470.95px" class="cls_023">
            <span class="cls_023">// Build the User model</span>
        </div>
        <div style="position:absolute;left:126.00px;top:483.19px" class="cls_023">
            <span class="cls_023">mongoose.model( 'User', userSchema );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:502.93px" class="cls_006">
            <span class="cls_006">And add the following after the </span>
            <span class="cls_007">projectSchema</span>
            <span class="cls_006"> is defined:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:523.87px" class="cls_023">
            <span class="cls_023">// Build the Project model</span>
        </div>
        <div style="position:absolute;left:126.00px;top:536.11px" class="cls_023">
            <span class="cls_023">mongoose.model( 'Project', projectSchema );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:555.85px" class="cls_006">
            <span class="cls_006">This will give us everything we need to start interacting with data in our application,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:568.45px" class="cls_006">
            <span class="cls_006">which we will start doing very soon, in the next chapter.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 43 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:44912px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background057.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Schemas and Models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:111.92px" class="cls_022">
            <span class="cls_022">Our complete code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:136.90px" class="cls_006">
            <span class="cls_006">Now that we have defined our schemas and compiled the models, let's take a look at</span>
        </div>
        <div style="position:absolute;left:108.00px;top:149.50px" class="cls_006">
            <span class="cls_006">our </span>
            <span class="cls_007">/model/db.js</span>
            <span class="cls_006"> file.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:170.44px" class="cls_023">
            <span class="cls_023">var mongoose = require( 'mongoose' ),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:182.68px" class="cls_023">
            <span class="cls_023">dbURI = 'mongodb://localhost/MongoosePM';</span>
        </div>
        <div style="position:absolute;left:126.00px;top:194.92px" class="cls_023">
            <span class="cls_023">mongoose.connect(dbURI);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:207.16px" class="cls_023">
            <span class="cls_023">// Connection events snipped out for brevity</span>
        </div>
        <div style="position:absolute;left:126.00px;top:231.64px" class="cls_023">
            <span class="cls_023">/* ********************************************</span>
        </div>
        <div style="position:absolute;left:158.40px;top:243.88px" class="cls_023">
            <span class="cls_023">USER SCHEMA</span>
        </div>
        <div style="position:absolute;left:142.20px;top:256.12px" class="cls_023">
            <span class="cls_023">******************************************** */</span>
        </div>
        <div style="position:absolute;left:126.00px;top:268.36px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:280.60px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:292.84px" class="cls_023">
            <span class="cls_023">email: {type: String, unique:true},</span>
        </div>
        <div style="position:absolute;left:136.80px;top:305.08px" class="cls_023">
            <span class="cls_023">createdOn: { type: Date, default: Date.now },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:317.32px" class="cls_023">
            <span class="cls_023">modifiedOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:329.56px" class="cls_023">
            <span class="cls_023">lastLogin: Date</span>
        </div>
        <div style="position:absolute;left:126.00px;top:341.80px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:366.28px" class="cls_023">
            <span class="cls_023">// Build the User model</span>
        </div>
        <div style="position:absolute;left:126.00px;top:378.52px" class="cls_023">
            <span class="cls_023">mongoose.model( 'User', userSchema );</span>
        </div>
        <div style="position:absolute;left:126.00px;top:403.00px" class="cls_023">
            <span class="cls_023">/* ********************************************</span>
        </div>
        <div style="position:absolute;left:158.40px;top:415.24px" class="cls_023">
            <span class="cls_023">PROJECT SCHEMA</span>
        </div>
        <div style="position:absolute;left:142.20px;top:427.48px" class="cls_023">
            <span class="cls_023">******************************************** */</span>
        </div>
        <div style="position:absolute;left:126.00px;top:439.72px" class="cls_023">
            <span class="cls_023">var projectSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:451.96px" class="cls_023">
            <span class="cls_023">projectName: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:464.20px" class="cls_023">
            <span class="cls_023">createdOn: { type: Date, default: Date.now },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:476.44px" class="cls_023">
            <span class="cls_023">modifiedOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:488.68px" class="cls_023">
            <span class="cls_023">createdBy: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:500.92px" class="cls_023">
            <span class="cls_023">contributors: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:513.16px" class="cls_023">
            <span class="cls_023">tasks: String</span>
        </div>
        <div style="position:absolute;left:126.00px;top:525.40px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:549.88px" class="cls_023">
            <span class="cls_023">// Build the Project model</span>
        </div>
        <div style="position:absolute;left:126.00px;top:562.12px" class="cls_023">
            <span class="cls_023">mongoose.model( 'Project', projectSchema );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:581.86px" class="cls_006">
            <span class="cls_006">In this code we have done everything we need to before moving on. These are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:594.46px" class="cls_006">
            <span class="cls_006">as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:615.70px" class="cls_006">
            <span class="cls_006">• We </span>
            <span class="cls_021">required</span>
            <span class="cls_006"> Mongoose</span>
        </div>
        <div style="position:absolute;left:126.00px;top:632.62px" class="cls_006">
            <span class="cls_006">• We set the connection string for the MongoDB database</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 44 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:45714px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background058.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 3</span>
        </div>
        <div style="position:absolute;left:126.00px;top:114.49px" class="cls_006">
            <span class="cls_006">• We defined the User schema</span>
        </div>
        <div style="position:absolute;left:126.00px;top:131.41px" class="cls_006">
            <span class="cls_006">• We built the User model</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.32px" class="cls_006">
            <span class="cls_006">• We defined the Project schema</span>
        </div>
        <div style="position:absolute;left:126.00px;top:165.24px" class="cls_006">
            <span class="cls_006">• We built the Project model</span>
        </div>
        <div style="position:absolute;left:126.00px;top:182.16px" class="cls_006">
            <span class="cls_006">• We opened the Mongoose connection to the database</span>
        </div>
        <div style="position:absolute;left:107.99px;top:203.40px" class="cls_006">
            <span class="cls_006">Note that if you have large complex schemas and models, you may want to have</span>
        </div>
        <div style="position:absolute;left:107.99px;top:216.00px" class="cls_006">
            <span class="cls_006">separate files for each, and just export the models.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:248.51px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:273.49px" class="cls_006">
            <span class="cls_006">In this chapter, we have looked at how schemas and models relate to your data.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:286.09px" class="cls_006">
            <span class="cls_006">You should now understand the roles of both schemas and models.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:307.34px" class="cls_006">
            <span class="cls_006">We have looked at how to create simple schemas and the types of data they can</span>
        </div>
        <div style="position:absolute;left:108.00px;top:319.94px" class="cls_006">
            <span class="cls_006">contain. We have also seen that it is possible to extend this if the native types are not</span>
        </div>
        <div style="position:absolute;left:108.00px;top:332.54px" class="cls_006">
            <span class="cls_006">enough. On top of this we have learned about compiling the schemas into models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:345.14px" class="cls_006">
            <span class="cls_006">and had a glimpse at how powerful this set of tools can be.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:366.38px" class="cls_006">
            <span class="cls_006">In the MongoosePM project, you should now have added a User schema and a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:378.98px" class="cls_006">
            <span class="cls_006">Project schema, and built models of both of these.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:400.22px" class="cls_006">
            <span class="cls_006">In the next chapter, we're going to see how we use these schemas and models to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:412.82px" class="cls_006">
            <span class="cls_006">create, read, update, and delete data.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 45 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:46516px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background059.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:47318px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background060.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:302.23px;top:218.71px" class="cls_015">
            <span class="cls_015">Interacting with</span>
        </div>
        <div style="position:absolute;left:208.81px;top:254.71px" class="cls_015">
            <span class="cls_015">Data - an Introduction</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.41px" class="cls_006">
            <span class="cls_006">We have seen how to define our data structure, but now we want to interact with it.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:321.01px" class="cls_006">
            <span class="cls_006">We want to be able to create database entries, read them, update them, and delete</span>
        </div>
        <div style="position:absolute;left:108.00px;top:333.61px" class="cls_006">
            <span class="cls_006">them. To handle these interactions, Mongoose uses methods added to models. This</span>
        </div>
        <div style="position:absolute;left:108.00px;top:346.21px" class="cls_006">
            <span class="cls_006">chapter introduces the concept and will look at how to organize our code to best</span>
        </div>
        <div style="position:absolute;left:108.00px;top:358.81px" class="cls_006">
            <span class="cls_006">work with this approach.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:380.06px" class="cls_006">
            <span class="cls_006">By the end of this chapter, you will have had a glimpse of how Mongoose helps you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:392.66px" class="cls_006">
            <span class="cls_006">to easily interact with your data. You will also have prepared the sample project so</span>
        </div>
        <div style="position:absolute;left:108.00px;top:405.26px" class="cls_006">
            <span class="cls_006">that we can dive into practical examples in later chapters.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:437.75px" class="cls_022">
            <span class="cls_022">Model methods and instance methods</span>
        </div>
        <div style="position:absolute;left:108.00px;top:462.73px" class="cls_006">
            <span class="cls_006">As we have seen in </span>
            <span class="cls_021">Chapter 3</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Schemas and Models</span>
            <span class="cls_006">, a document in a Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:475.33px" class="cls_006">
            <span class="cls_006">collection is a single instance of a model. So it makes sense that if we're going to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:487.93px" class="cls_006">
            <span class="cls_006">work with our data then it will be through the model.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:509.17px" class="cls_006">
            <span class="cls_006">So what do we mean by model methods? Well, if we have a model called </span>
            <span class="cls_007">User</span>
            <span class="cls_006">, some</span>
        </div>
        <div style="position:absolute;left:108.00px;top:521.77px" class="cls_006">
            <span class="cls_006">of the methods provided by Mongoose are </span>
            <span class="cls_007">User.create</span>
            <span class="cls_006">, </span>
            <span class="cls_007">User.find</span>
            <span class="cls_006">, </span>
            <span class="cls_007">User.update</span>
            <span class="cls_006">,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:534.37px" class="cls_006">
            <span class="cls_006">and </span>
            <span class="cls_007">User.remove</span>
            <span class="cls_006">. The method names may be slightly different, but out of the box</span>
        </div>
        <div style="position:absolute;left:108.00px;top:546.97px" class="cls_006">
            <span class="cls_006">we've got methods for all four CRUD (Create, Read, Update, and Delete) operations</span>
        </div>
        <div style="position:absolute;left:108.00px;top:559.57px" class="cls_006">
            <span class="cls_006">right there.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:580.82px" class="cls_006">
            <span class="cls_006">Instance methods are the same concept, except that they are applied to specific</span>
        </div>
        <div style="position:absolute;left:108.00px;top:593.42px" class="cls_006">
            <span class="cls_006">instances instead. We will look at a good example of this soon, with the </span>
            <span class="cls_007">instance.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:606.01px" class="cls_007">
            <span class="cls_007">save</span>
            <span class="cls_006"> method.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:48120px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background061.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - an Introduction</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Mongoose also allows you to define your own model methods, giving you the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">flexibility to create the functionality you want. We'll see more about these static</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">methods and create one ourselves in </span>
            <span class="cls_021">Chapter 6</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Interacting with Data - Reading,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.29px" class="cls_021">
            <span class="cls_021">Querying, and Finding</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:173.53px" class="cls_006">
            <span class="cls_006">Before we look at some examples, first let's remind ourselves of our </span>
            <span class="cls_007">User</span>
            <span class="cls_006"> schema</span>
        </div>
        <div style="position:absolute;left:108.01px;top:186.13px" class="cls_006">
            <span class="cls_006">and model so that we can use this as the basis.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:207.07px" class="cls_023">
            <span class="cls_023">var userSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:219.31px" class="cls_023">
            <span class="cls_023">name: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:231.55px" class="cls_023">
            <span class="cls_023">email: {type: String, unique:true},</span>
        </div>
        <div style="position:absolute;left:136.80px;top:243.79px" class="cls_023">
            <span class="cls_023">createdOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:256.03px" class="cls_023">
            <span class="cls_023">modifiedOn: { type: Date, default: Date.now },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:268.27px" class="cls_023">
            <span class="cls_023">lastLogin: Date</span>
        </div>
        <div style="position:absolute;left:126.00px;top:280.51px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:304.99px" class="cls_023">
            <span class="cls_023">// Build the User model</span>
        </div>
        <div style="position:absolute;left:126.00px;top:317.23px" class="cls_023">
            <span class="cls_023">mongoose.model( 'User', userSchema );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:336.97px" class="cls_006">
            <span class="cls_006">So we have our model called </span>
            <span class="cls_007">User</span>
            <span class="cls_006">, compiled from the schema </span>
            <span class="cls_007">userSchema</span>
            <span class="cls_006">. Got it?</span>
        </div>
        <div style="position:absolute;left:108.00px;top:349.57px" class="cls_006">
            <span class="cls_006">Good. Now let's get our project ready so that we can use the examples as we go!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:382.07px" class="cls_022">
            <span class="cls_022">Setting up the project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:407.05px" class="cls_006">
            <span class="cls_006">Before we get going on the Mongoose code, we need to get a couple of things in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:419.65px" class="cls_006">
            <span class="cls_006">order in our project:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:440.90px" class="cls_006">
            <span class="cls_006">• Our approach to code structure</span>
        </div>
        <div style="position:absolute;left:126.00px;top:457.81px" class="cls_006">
            <span class="cls_006">• The URLs/routes we'll need</span>
        </div>
        <div style="position:absolute;left:108.00px;top:487.75px" class="cls_027">
            <span class="cls_027">Code structure</span>
        </div>
        <div style="position:absolute;left:108.00px;top:510.73px" class="cls_006">
            <span class="cls_006">If we think in an MVC way, our Express project already has a model folder and a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:523.33px" class="cls_006">
            <span class="cls_006">views folder. The model folder holds our schema definitions, Mongoose models and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:535.93px" class="cls_006">
            <span class="cls_006">Mongoose connection. The views folder contains Jade templates for page layout. The</span>
        </div>
        <div style="position:absolute;left:108.00px;top:548.53px" class="cls_006">
            <span class="cls_006">controller aspect sits in the routes folder of a standard express installation. We could</span>
        </div>
        <div style="position:absolute;left:108.00px;top:561.13px" class="cls_006">
            <span class="cls_006">separate it out or move it around, but as the focus of this book is on using Mongoose,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:573.73px" class="cls_006">
            <span class="cls_006">but not on MVC best practices, let's work with the default setup.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 48 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:48922px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background062.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 4</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Adding the routes files</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">A good starting point when thinking about setting up your routes is to have one</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_007">
            <span class="cls_007">routes</span>
            <span class="cls_006"> file for each Mongoose model. Given the non-normalized data structure</span>
        </div>
        <div style="position:absolute;left:108.00px;top:159.19px" class="cls_006">
            <span class="cls_006">of MongoDB there aren't generally too many of these—we're not talking about</span>
        </div>
        <div style="position:absolute;left:108.00px;top:171.79px" class="cls_006">
            <span class="cls_006">individual tables in a relational database here! Also, as we saw earlier in this chapter,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:184.39px" class="cls_006">
            <span class="cls_006">we are generally working with model methods, and instances of that model. So it</span>
        </div>
        <div style="position:absolute;left:108.00px;top:196.99px" class="cls_006">
            <span class="cls_006">seems like a sensible way to separate out our code in the first instance.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:218.23px" class="cls_006">
            <span class="cls_006">So with that in mind, create two empty text files in the </span>
            <span class="cls_007">routes</span>
            <span class="cls_006"> folder, </span>
            <span class="cls_007">user.js</span>
            <span class="cls_006"> and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:230.83px" class="cls_007">
            <span class="cls_007">project.js</span>
            <span class="cls_006">. You may find that your installation of Express has already created the</span>
        </div>
        <div style="position:absolute;left:108.01px;top:243.43px" class="cls_006">
            <span class="cls_006">file </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">—this is fine, you can just open it and delete the contents.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:264.67px" class="cls_006">
            <span class="cls_006">Bear in mind that as your applications grow in complexity, these files can get very</span>
        </div>
        <div style="position:absolute;left:108.00px;top:277.27px" class="cls_006">
            <span class="cls_006">large, in this case you may want to divide them in a logical way for your application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:305.37px" class="cls_013">
            <span class="cls_013">Tying the routes to Mongoose models</span>
        </div>
        <div style="position:absolute;left:108.00px;top:326.35px" class="cls_006">
            <span class="cls_006">In each of these files, we need to require Mongoose and the relevant model. So at the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:338.95px" class="cls_006">
            <span class="cls_006">top of the </span>
            <span class="cls_007">user.js</span>
            <span class="cls_006"> file add the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:359.89px" class="cls_023">
            <span class="cls_023">var mongoose = require( 'mongoose' );</span>
        </div>
        <div style="position:absolute;left:126.00px;top:372.13px" class="cls_023">
            <span class="cls_023">var User = mongoose.model( 'User' );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:391.87px" class="cls_006">
            <span class="cls_006">And add the following to </span>
            <span class="cls_007">project.js</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:412.81px" class="cls_023">
            <span class="cls_023">var mongoose = require( 'mongoose' );</span>
        </div>
        <div style="position:absolute;left:126.00px;top:425.05px" class="cls_023">
            <span class="cls_023">var Project = mongoose.model( 'Project' );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:444.79px" class="cls_006">
            <span class="cls_006">We need to get these files into the application, so we'll </span>
            <span class="cls_007">require</span>
            <span class="cls_006"> them in </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:457.39px" class="cls_006">
            <span class="cls_006">You'll see that </span>
            <span class="cls_007">routes</span>
            <span class="cls_006"> is already required, and we'll keep that to hold our index</span>
        </div>
        <div style="position:absolute;left:108.00px;top:469.99px" class="cls_006">
            <span class="cls_006">page. Let's add our two new files </span>
            <span class="cls_007">user</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">project</span>
            <span class="cls_006"> directly after it.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:490.93px" class="cls_023">
            <span class="cls_023">var express = require('express')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:503.17px" class="cls_023">
            <span class="cls_023">, db = require('./model/db')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:515.41px" class="cls_023">
            <span class="cls_023">, routes = require('./routes')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:527.65px" class="cls_024">
            <span class="cls_024">, user = require('./routes/user')</span>
        </div>
        <div style="position:absolute;left:136.80px;top:539.89px" class="cls_024">
            <span class="cls_024">, project = require('./routes/project')</span>
        </div>
        <div style="position:absolute;left:108.00px;top:568.33px" class="cls_027">
            <span class="cls_027">URLs and routes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:591.31px" class="cls_006">
            <span class="cls_006">Next up we need to think about how we're going to interact with the data and the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:603.91px" class="cls_006">
            <span class="cls_006">URLs we're going to use to do it. These will all go into </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006"> immediately after the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:616.51px" class="cls_006">
            <span class="cls_006">homepage route.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 49 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:49724px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background063.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - an Introduction</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Routes for user management</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">We will concentrate on the user management first, so we will want to have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:167.83px" class="cls_006">
            <span class="cls_006">• User homepage or profile page at </span>
            <span class="cls_007">/user</span>
        </div>
        <div style="position:absolute;left:126.00px;top:184.75px" class="cls_006">
            <span class="cls_006">• Login page at </span>
            <span class="cls_007">/login</span>
        </div>
        <div style="position:absolute;left:126.00px;top:201.67px" class="cls_006">
            <span class="cls_006">• New user form at </span>
            <span class="cls_007">/user/new</span>
        </div>
        <div style="position:absolute;left:126.00px;top:218.59px" class="cls_006">
            <span class="cls_006">• Edit current user details form at </span>
            <span class="cls_007">/user/edit</span>
        </div>
        <div style="position:absolute;left:126.00px;top:235.51px" class="cls_006">
            <span class="cls_006">• Delete user confirmation form at </span>
            <span class="cls_007">/user/delete</span>
        </div>
        <div style="position:absolute;left:126.00px;top:252.43px" class="cls_006">
            <span class="cls_006">• Logout user action at </span>
            <span class="cls_007">/logout</span>
        </div>
        <div style="position:absolute;left:108.00px;top:273.67px" class="cls_006">
            <span class="cls_006">In most of these options, we want a form and an action to do something, so we will</span>
        </div>
        <div style="position:absolute;left:108.00px;top:286.27px" class="cls_006">
            <span class="cls_006">use both </span>
            <span class="cls_007">app.get</span>
            <span class="cls_006"> for displaying forms and </span>
            <span class="cls_007">app.post</span>
            <span class="cls_006"> for form handling. So let's add</span>
        </div>
        <div style="position:absolute;left:108.00px;top:298.87px" class="cls_006">
            <span class="cls_006">these routes in to </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006"> below the following </span>
            <span class="cls_007">app.get('/', routes.index)</span>
            <span class="cls_006"> in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:311.47px" class="cls_007">
            <span class="cls_007">app.js</span>
            <span class="cls_006">, defining our route function names as we go. See the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:332.41px" class="cls_023">
            <span class="cls_023">app.get('/', routes.index);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:344.65px" class="cls_023">
            <span class="cls_023">// USER ROUTES</span>
        </div>
        <div style="position:absolute;left:126.00px;top:356.89px" class="cls_023">
            <span class="cls_023">app.get('/user', user.index);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:356.89px" class="cls_023">
            <span class="cls_023">// Current user profile</span>
        </div>
        <div style="position:absolute;left:126.00px;top:369.13px" class="cls_023">
            <span class="cls_023">app.get('/user/new', user.create);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:369.13px" class="cls_023">
            <span class="cls_023">// Create new user form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:381.37px" class="cls_023">
            <span class="cls_023">app.post('/user/new', user.doCreate);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:381.37px" class="cls_023">
            <span class="cls_023">// Create new user action</span>
        </div>
        <div style="position:absolute;left:126.00px;top:393.61px" class="cls_023">
            <span class="cls_023">app.get('/user/edit', user.edit);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:393.61px" class="cls_023">
            <span class="cls_023">// Edit current user form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:405.85px" class="cls_023">
            <span class="cls_023">app.post('/user/edit', user.doEdit);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:405.85px" class="cls_023">
            <span class="cls_023">// Edit current user action</span>
        </div>
        <div style="position:absolute;left:126.00px;top:418.09px" class="cls_023">
            <span class="cls_023">app.get('/user/delete', user.confirmDelete); // delete current</span>
        </div>
        <div style="position:absolute;left:363.60px;top:428.89px" class="cls_023">
            <span class="cls_023">//user form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:441.13px" class="cls_023">
            <span class="cls_023">app.post('/user/delete', user.doDelete);</span>
        </div>
        <div style="position:absolute;left:369.00px;top:441.13px" class="cls_023">
            <span class="cls_023">// Delete current</span>
        </div>
        <div style="position:absolute;left:363.60px;top:451.93px" class="cls_023">
            <span class="cls_023">//user action</span>
        </div>
        <div style="position:absolute;left:126.00px;top:464.17px" class="cls_023">
            <span class="cls_023">app.get('/login', user.login);</span>
        </div>
        <div style="position:absolute;left:342.00px;top:464.17px" class="cls_023">
            <span class="cls_023">// Login form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:476.41px" class="cls_023">
            <span class="cls_023">app.post('/login', user.doLogin);</span>
        </div>
        <div style="position:absolute;left:342.00px;top:476.41px" class="cls_023">
            <span class="cls_023">// Login action</span>
        </div>
        <div style="position:absolute;left:126.00px;top:488.65px" class="cls_023">
            <span class="cls_023">app.get('/logout', user.doLogout);</span>
        </div>
        <div style="position:absolute;left:342.00px;top:488.65px" class="cls_023">
            <span class="cls_023">// Logout current user</span>
        </div>
        <div style="position:absolute;left:108.00px;top:515.25px" class="cls_013">
            <span class="cls_013">Routes for project management</span>
        </div>
        <div style="position:absolute;left:108.00px;top:536.23px" class="cls_006">
            <span class="cls_006">We are going to take a similar approach for dealing with projects, except that project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:548.83px" class="cls_006">
            <span class="cls_006">information won't be stored in a session. So to tell a page which project we are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:561.43px" class="cls_006">
            <span class="cls_006">working with, we will include the unique ID in the URL. Add the following code to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:574.03px" class="cls_006">
            <span class="cls_006">app.js below the user routes that we have just added:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:594.97px" class="cls_023">
            <span class="cls_023">// PROJECT ROUTES</span>
        </div>
        <div style="position:absolute;left:126.00px;top:607.21px" class="cls_023">
            <span class="cls_023">app.get('/project/new', project.create);</span>
        </div>
        <div style="position:absolute;left:374.40px;top:607.21px" class="cls_023">
            <span class="cls_023">// Create new</span>
        </div>
        <div style="position:absolute;left:369.00px;top:618.01px" class="cls_023">
            <span class="cls_023">//project form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:630.25px" class="cls_023">
            <span class="cls_023">app.post('/project/new', project.doCreate);</span>
        </div>
        <div style="position:absolute;left:374.40px;top:630.25px" class="cls_023">
            <span class="cls_023">// Create new</span>
        </div>
        <div style="position:absolute;left:369.00px;top:641.05px" class="cls_023">
            <span class="cls_023">//project action</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 50 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:50526px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background064.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 4</span>
        </div>
        <div style="position:absolute;left:126.00px;top:114.01px" class="cls_023">
            <span class="cls_023">app.get('/project/:id', project.displayInfo); // Display project</span>
        </div>
        <div style="position:absolute;left:369.00px;top:124.81px" class="cls_023">
            <span class="cls_023">//info</span>
        </div>
        <div style="position:absolute;left:126.00px;top:137.05px" class="cls_023">
            <span class="cls_023">app.get('/project/edit/:id', project.edit);</span>
        </div>
        <div style="position:absolute;left:374.40px;top:137.05px" class="cls_023">
            <span class="cls_023">// Edit selected</span>
        </div>
        <div style="position:absolute;left:369.00px;top:147.85px" class="cls_023">
            <span class="cls_023">//project form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:160.09px" class="cls_023">
            <span class="cls_023">app.post('/project/edit/:id', project.doEdit);// Edit selected</span>
        </div>
        <div style="position:absolute;left:369.00px;top:170.89px" class="cls_023">
            <span class="cls_023">//project action</span>
        </div>
        <div style="position:absolute;left:126.00px;top:183.13px" class="cls_023">
            <span class="cls_023">app.get('/project/delete/:id', project.confirmDelete);// Delete</span>
        </div>
        <div style="position:absolute;left:363.60px;top:193.93px" class="cls_023">
            <span class="cls_023">// selected product form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:206.17px" class="cls_023">
            <span class="cls_023">app.post('/project/delete/:id', project.doDelete);</span>
        </div>
        <div style="position:absolute;left:417.60px;top:206.17px" class="cls_023">
            <span class="cls_023">// Delete</span>
        </div>
        <div style="position:absolute;left:342.00px;top:216.97px" class="cls_023">
            <span class="cls_023">//selected project action</span>
        </div>
        <div style="position:absolute;left:108.00px;top:247.96px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:272.94px" class="cls_006">
            <span class="cls_006">In this chapter, we have had a very quick glance at how Mongoose provides</span>
        </div>
        <div style="position:absolute;left:108.00px;top:285.54px" class="cls_006">
            <span class="cls_006">methods for us to interact with our data. We have also seen how to set up our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:298.14px" class="cls_006">
            <span class="cls_006">project to work with Mongoose, attaching our schemas and models to the actual</span>
        </div>
        <div style="position:absolute;left:108.00px;top:310.74px" class="cls_006">
            <span class="cls_006">back end of the application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.98px" class="cls_006">
            <span class="cls_006">In the next four chapters, we will be exploring the Mongoose data methods in much</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.58px" class="cls_006">
            <span class="cls_006">greater detail, focusing around the cornerstones of CRUD operations. First up,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:357.18px" class="cls_021">
            <span class="cls_021">Chapter 5</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Interacting with Data - Creation</span>
            <span class="cls_006">, for creating data.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 51 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:51328px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background065.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:52130px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background066.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:302.23px;top:218.71px" class="cls_015">
            <span class="cls_015">Interacting with</span>
        </div>
        <div style="position:absolute;left:293.89px;top:254.71px" class="cls_015">
            <span class="cls_015">Data - Creation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.41px" class="cls_006">
            <span class="cls_006">As we are building an application from the ground up, our first work with data will</span>
        </div>
        <div style="position:absolute;left:108.00px;top:321.01px" class="cls_006">
            <span class="cls_006">be creating some and saving it to the database. In this chapter we will:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:342.26px" class="cls_006">
            <span class="cls_006">• Learn about creating an instance</span>
        </div>
        <div style="position:absolute;left:126.00px;top:359.17px" class="cls_006">
            <span class="cls_006">• Learn about saving an instance</span>
        </div>
        <div style="position:absolute;left:126.00px;top:376.09px" class="cls_006">
            <span class="cls_006">• Learn when to use different approaches</span>
        </div>
        <div style="position:absolute;left:126.00px;top:393.00px" class="cls_006">
            <span class="cls_006">• Add the ability for users to sign up to our MongoosePM application by:</span>
        </div>
        <div style="position:absolute;left:161.99px;top:409.92px" class="cls_029">
            <span class="cls_029">°</span>
            <span class="cls_006">°</span>
        </div>
        <div style="position:absolute;left:179.99px;top:409.92px" class="cls_006">
            <span class="cls_006">Adding new routes</span>
        </div>
        <div style="position:absolute;left:161.99px;top:426.83px" class="cls_029">
            <span class="cls_029">°</span>
            <span class="cls_006">°</span>
        </div>
        <div style="position:absolute;left:179.99px;top:426.83px" class="cls_006">
            <span class="cls_006">Adding new views</span>
        </div>
        <div style="position:absolute;left:161.99px;top:443.75px" class="cls_029">
            <span class="cls_029">°</span>
            <span class="cls_006">°</span>
        </div>
        <div style="position:absolute;left:179.99px;top:443.75px" class="cls_006">
            <span class="cls_006">Adding new controller code</span>
        </div>
        <div style="position:absolute;left:161.99px;top:460.66px" class="cls_029">
            <span class="cls_029">°</span>
            <span class="cls_006">°</span>
        </div>
        <div style="position:absolute;left:179.99px;top:460.66px" class="cls_006">
            <span class="cls_006">Saving the user details in a session so that they stay logged in</span>
        </div>
        <div style="position:absolute;left:125.99px;top:481.91px" class="cls_006">
            <span class="cls_006">• Outline the steps required to add the ability to create new projects, but let</span>
        </div>
        <div style="position:absolute;left:143.98px;top:494.51px" class="cls_006">
            <span class="cls_006">you go for it alone! If you get stuck, you can always download the complete</span>
        </div>
        <div style="position:absolute;left:143.98px;top:507.11px" class="cls_006">
            <span class="cls_006">source code to take a look.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:539.63px" class="cls_022">
            <span class="cls_022">Creating an instance</span>
        </div>
        <div style="position:absolute;left:108.00px;top:564.61px" class="cls_006">
            <span class="cls_006">Now that </span>
            <span class="cls_021">Chapter 4</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Interacting with Data - An Introduction</span>
            <span class="cls_006"> has taken care of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:577.21px" class="cls_006">
            <span class="cls_006">housekeeping, it's time to get going and do stuff with data. Theory first, then action!</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:52932px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background067.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Creation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">To do anything meaningful at all, we will have to create an instance. This could be</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">done by retrieving an object from a database, but let's start by creating a new empty</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">instance. We do this by using the </span>
            <span class="cls_007">new ModelName</span>
            <span class="cls_006"> expression. As our model is called</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.29px" class="cls_007">
            <span class="cls_007">User</span>
            <span class="cls_006">, to create a new instance we invoke the </span>
            <span class="cls_007">new User</span>
            <span class="cls_006"> expression.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:173.23px" class="cls_023">
            <span class="cls_023">var newUser = new User();</span>
        </div>
        <div style="position:absolute;left:108.00px;top:201.67px" class="cls_027">
            <span class="cls_027">Adding data to the instance</span>
        </div>
        <div style="position:absolute;left:108.00px;top:224.65px" class="cls_006">
            <span class="cls_006">When creating an instance, you will generally want to add some data to it. The</span>
        </div>
        <div style="position:absolute;left:108.00px;top:237.25px" class="cls_006">
            <span class="cls_006">default way of adding data is to pass it to the model constructor as a JavaScript</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.85px" class="cls_006">
            <span class="cls_006">object. For example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:270.79px" class="cls_023">
            <span class="cls_023">var newUser = new User({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:283.03px" class="cls_023">
            <span class="cls_023">name: 'Simon Holmes',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:295.27px" class="cls_023">
            <span class="cls_023">email: 'simon@theholmesoffice.com',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:307.51px" class="cls_023">
            <span class="cls_023">lastLogin : Date.now()</span>
        </div>
        <div style="position:absolute;left:126.00px;top:319.75px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:339.49px" class="cls_006">
            <span class="cls_006">Although you can also add data to the instance after it has been created, as shown in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:352.09px" class="cls_006">
            <span class="cls_006">the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:373.03px" class="cls_023">
            <span class="cls_023">var newUser = new User();</span>
        </div>
        <div style="position:absolute;left:126.00px;top:385.27px" class="cls_023">
            <span class="cls_023">newUser.name = 'Simon Holmes';</span>
        </div>
        <div style="position:absolute;left:108.00px;top:405.01px" class="cls_006">
            <span class="cls_006">Or you can use a combination, setting some data when the object is created, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:417.61px" class="cls_006">
            <span class="cls_006">adding additional data afterwards:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:438.55px" class="cls_023">
            <span class="cls_023">var newUser = new User({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:450.79px" class="cls_023">
            <span class="cls_023">email: 'simon@theholmesoffice.com',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:463.03px" class="cls_023">
            <span class="cls_023">lastLogin : Date.now()</span>
        </div>
        <div style="position:absolute;left:126.00px;top:475.27px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:487.51px" class="cls_023">
            <span class="cls_023">newUser.name = 'Simon Holmes';</span>
        </div>
        <div style="position:absolute;left:108.00px;top:518.51px" class="cls_022">
            <span class="cls_022">Saving an instance</span>
        </div>
        <div style="position:absolute;left:108.00px;top:543.49px" class="cls_006">
            <span class="cls_006">So far we have created an instance, and put some data to it, but it only exists in the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:556.09px" class="cls_006">
            <span class="cls_006">application. Saving it to the database is a really simple operation.</span>
        </div>
        <div style="position:absolute;left:194.97px;top:594.05px" class="cls_026">
            <span class="cls_026">Your Mongoose connection must be open for this to work.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 54 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:53734px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background068.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 5</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">After we have created our </span>
            <span class="cls_007">newUser</span>
            <span class="cls_006"> and given it some data, we save it in the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">following way:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.03px" class="cls_023">
            <span class="cls_023">newUser.save( function( err ){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:160.27px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:172.51px" class="cls_023">
            <span class="cls_023">console.log('User saved!');</span>
        </div>
        <div style="position:absolute;left:136.80px;top:184.75px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:196.99px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:216.73px" class="cls_006">
            <span class="cls_006">This </span>
            <span class="cls_007">.save</span>
            <span class="cls_006"> method is an example of an instance method, because it operates directly</span>
        </div>
        <div style="position:absolute;left:108.00px;top:229.33px" class="cls_006">
            <span class="cls_006">on the instance, rather than the model. Note that the parameter it takes is a callback</span>
        </div>
        <div style="position:absolute;left:108.00px;top:241.93px" class="cls_006">
            <span class="cls_006">function to run when the save operation has been made to the database. As we saw</span>
        </div>
        <div style="position:absolute;left:108.00px;top:254.53px" class="cls_006">
            <span class="cls_006">back in </span>
            <span class="cls_021">Chapter 1</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Introducing Mongoose to the Technology Stack</span>
            <span class="cls_006">, writing to a database is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:267.13px" class="cls_006">
            <span class="cls_006">a blocking operation, but the </span>
            <span class="cls_007">.save</span>
            <span class="cls_006"> method provides a non-blocking asynchronous</span>
        </div>
        <div style="position:absolute;left:108.00px;top:279.73px" class="cls_006">
            <span class="cls_006">way of doing this, allowing the Node process to carry on and deal with other requests.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:300.98px" class="cls_006">
            <span class="cls_006">This is a good thing for our application, but it means that any operations that you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:313.58px" class="cls_006">
            <span class="cls_006">want to do </span>
            <span class="cls_021">after</span>
            <span class="cls_006"> the instance is saved must come </span>
            <span class="cls_021">inside</span>
            <span class="cls_006"> the callback function.</span>
        </div>
        <div style="position:absolute;left:175.32px;top:349.33px" class="cls_026">
            <span class="cls_026">Any default values set in the schema are automatically applied when</span>
        </div>
        <div style="position:absolute;left:175.32px;top:360.73px" class="cls_007">
            <span class="cls_007">.save</span>
            <span class="cls_026"> is called, before the data is saved to the database.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:400.51px" class="cls_027">
            <span class="cls_027">Using the saved data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:423.49px" class="cls_006">
            <span class="cls_006">The </span>
            <span class="cls_007">.save</span>
            <span class="cls_006"> method allows you to specify a second parameter to the callback, which</span>
        </div>
        <div style="position:absolute;left:108.00px;top:436.09px" class="cls_006">
            <span class="cls_006">will contain the saved object. Your callback function can then use this object. This</span>
        </div>
        <div style="position:absolute;left:108.00px;top:448.69px" class="cls_006">
            <span class="cls_006">can be useful in many ways, for example, if you want to find out the unique ID of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:461.29px" class="cls_006">
            <span class="cls_006">the database entry you have just created. The code to do that looks like this:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:482.23px" class="cls_023">
            <span class="cls_023">newUser.save( function( err, user ){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:494.47px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:506.71px" class="cls_023">
            <span class="cls_023">console.log('Saved user name: ' + user.name);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:518.95px" class="cls_023">
            <span class="cls_023">console.log('_id of saved user: ' + user._id);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:531.19px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:543.43px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:563.17px" class="cls_006">
            <span class="cls_006">Here we are returning the saved user information in the </span>
            <span class="cls_007">user</span>
            <span class="cls_006"> object, which would</span>
        </div>
        <div style="position:absolute;left:108.00px;top:575.77px" class="cls_006">
            <span class="cls_006">look like the following lines (line breaks added for readability):</span>
        </div>
        <div style="position:absolute;left:126.00px;top:596.71px" class="cls_023">
            <span class="cls_023">{ "__v" : 0,</span>
        </div>
        <div style="position:absolute;left:126.00px;top:608.95px" class="cls_023">
            <span class="cls_023">"_id" : ObjectId("5126b7a1f8a44d1e32000001"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:621.19px" class="cls_023">
            <span class="cls_023">"createdOn" : ISODate("2013-02-22T00:11:13.436Z"),</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 55 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:54536px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background069.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Creation</span>
        </div>
        <div style="position:absolute;left:126.00px;top:114.01px" class="cls_023">
            <span class="cls_023">"email" : "simon@theholmesoffice.com",</span>
        </div>
        <div style="position:absolute;left:126.00px;top:126.25px" class="cls_023">
            <span class="cls_023">"lastLogin" : ISODate("2013-04-03T12:54:42.734Z"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:138.49px" class="cls_023">
            <span class="cls_023">"modifiedOn" : ISODate("2013-04-03T12:56:26.009Z"),</span>
        </div>
        <div style="position:absolute;left:126.00px;top:150.73px" class="cls_023">
            <span class="cls_023">"name" : "Simon Holmes" }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:170.46px" class="cls_006">
            <span class="cls_006">In our callback function, we can use any of this data using standard dot syntax. In</span>
        </div>
        <div style="position:absolute;left:108.00px;top:183.06px" class="cls_006">
            <span class="cls_006">the case of this example code we've gone for </span>
            <span class="cls_007">user.name</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">user._id</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:204.30px" class="cls_007">
            <span class="cls_007">_id</span>
            <span class="cls_006"> is an </span>
            <span class="cls_007">ObjectId</span>
            <span class="cls_006"> SchemaType (see </span>
            <span class="cls_021">Chapter 3</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Schemas and Models</span>
            <span class="cls_006">) that is unique</span>
        </div>
        <div style="position:absolute;left:107.99px;top:216.90px" class="cls_006">
            <span class="cls_006">and automatically added by Mongoose. You can also access a string representation</span>
        </div>
        <div style="position:absolute;left:107.99px;top:229.50px" class="cls_006">
            <span class="cls_006">of it by removing the underscore. This means we could also have the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:250.44px" class="cls_023">
            <span class="cls_023">console.log('id of saved user: ' + user.id);</span>
        </div>
        <div style="position:absolute;left:108.00px;top:270.18px" class="cls_006">
            <span class="cls_006">This can cause confusion when comparing the two, as while these may look the same</span>
        </div>
        <div style="position:absolute;left:108.00px;top:282.78px" class="cls_006">
            <span class="cls_006">when sent to the console, one is an </span>
            <span class="cls_007">ObjectId</span>
            <span class="cls_006"> and the other is a string.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:315.28px" class="cls_022">
            <span class="cls_022">Creating and saving database entry in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:339.28px" class="cls_022">
            <span class="cls_022">one step</span>
        </div>
        <div style="position:absolute;left:108.00px;top:364.26px" class="cls_006">
            <span class="cls_006">We don't always need to run all the commands separately and can simplify do</span>
        </div>
        <div style="position:absolute;left:108.00px;top:376.86px" class="cls_006">
            <span class="cls_006">things by creating and saving the database entry in one step. There are two ways</span>
        </div>
        <div style="position:absolute;left:108.00px;top:389.46px" class="cls_006">
            <span class="cls_006">of doing this.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:419.40px" class="cls_027">
            <span class="cls_027">Chaining methods</span>
        </div>
        <div style="position:absolute;left:108.00px;top:442.38px" class="cls_006">
            <span class="cls_006">The first way is to chain the </span>
            <span class="cls_007">newUser</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">.save</span>
            <span class="cls_006"> commands into one line, for example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:463.32px" class="cls_023">
            <span class="cls_023">var newUser = new User({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:474.84px" class="cls_023">
            <span class="cls_023">name: 'Simon Holmes',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:486.36px" class="cls_023">
            <span class="cls_023">email: 'simon@theholmesoffice.com',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:497.88px" class="cls_023">
            <span class="cls_023">lastLogin : Date.now()</span>
        </div>
        <div style="position:absolute;left:126.00px;top:509.40px" class="cls_023">
            <span class="cls_023">}).save( function( err ){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:520.92px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:532.44px" class="cls_023">
            <span class="cls_023">console.log('User saved!');</span>
        </div>
        <div style="position:absolute;left:136.80px;top:543.96px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:555.48px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:583.92px" class="cls_027">
            <span class="cls_027">The Model.create() method</span>
        </div>
        <div style="position:absolute;left:108.00px;top:606.90px" class="cls_006">
            <span class="cls_006">The second way is to use a single-model method, which combines the </span>
            <span class="cls_007">new</span>
            <span class="cls_006"> and the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:619.50px" class="cls_007">
            <span class="cls_007">save</span>
            <span class="cls_006"> operations into one command. This method takes two parameters. First is the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:632.10px" class="cls_006">
            <span class="cls_006">data object, and the second is the callback function that is to be executed after the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:644.70px" class="cls_006">
            <span class="cls_006">instance has been saved to the database.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 56 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:55338px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background070.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 5</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">So the blueprint for this method is:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.53px" class="cls_007">
            <span class="cls_007">ModelName.create(dataObject,callback)</span>
        </div>
        <div style="position:absolute;left:108.00px;top:155.77px" class="cls_006">
            <span class="cls_006">Let's see this in operation, using our trusty </span>
            <span class="cls_007">User</span>
            <span class="cls_006"> model:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:176.71px" class="cls_023">
            <span class="cls_023">User.create({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:188.95px" class="cls_023">
            <span class="cls_023">name: 'Simon Holmes',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:201.19px" class="cls_023">
            <span class="cls_023">email: 'simon@theholmesoffice.com',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:213.43px" class="cls_023">
            <span class="cls_023">lastLogin : Date.now()</span>
        </div>
        <div style="position:absolute;left:126.00px;top:225.67px" class="cls_023">
            <span class="cls_023">}, function( err, user ){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:237.91px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:250.15px" class="cls_023">
            <span class="cls_023">console.log('User saved!');</span>
        </div>
        <div style="position:absolute;left:147.60px;top:262.39px" class="cls_023">
            <span class="cls_023">console.log('Saved user name: ' + user.name);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:274.63px" class="cls_023">
            <span class="cls_023">console.log('_id of saved user: ' + user._id);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:286.87px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:299.11px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:318.85px" class="cls_006">
            <span class="cls_006">This is arguably the neater way of doing a brand new create and save operation, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.45px" class="cls_006">
            <span class="cls_006">is the approach we'll be using in our MongoosePM application later. The cost of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.05px" class="cls_006">
            <span class="cls_006">compact nature of this approach is that it is less flexible, as we can't do anything with</span>
        </div>
        <div style="position:absolute;left:108.00px;top:356.65px" class="cls_006">
            <span class="cls_006">the </span>
            <span class="cls_007">newUser</span>
            <span class="cls_006"> instance between creating it and saving it. If you need this flexibility,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:369.25px" class="cls_006">
            <span class="cls_006">then go for the </span>
            <span class="cls_007">new</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">save</span>
            <span class="cls_006"> approach, like in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:390.19px" class="cls_023">
            <span class="cls_023">var newUser = new User({name: 'Simon Holmes'})</span>
        </div>
        <div style="position:absolute;left:126.00px;top:402.43px" class="cls_023">
            <span class="cls_023">newUser.email = 'simon@theholmesoffice.com';</span>
        </div>
        <div style="position:absolute;left:126.00px;top:414.67px" class="cls_023">
            <span class="cls_023">var rightNow = Date.now();</span>
        </div>
        <div style="position:absolute;left:126.00px;top:426.91px" class="cls_023">
            <span class="cls_023">newUser.createdOn = rightNow;</span>
        </div>
        <div style="position:absolute;left:126.00px;top:439.15px" class="cls_023">
            <span class="cls_023">newUser.lastLogin = rightNow;</span>
        </div>
        <div style="position:absolute;left:174.60px;top:451.39px" class="cls_023">
            <span class="cls_023">// some more operations on newUser</span>
        </div>
        <div style="position:absolute;left:126.00px;top:463.63px" class="cls_023">
            <span class="cls_023">newUser.save( function( err, user ){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:475.87px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:488.11px" class="cls_023">
            <span class="cls_023">console.log('_id of saved user: ' + user._id);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:500.35px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:512.59px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:543.59px" class="cls_022">
            <span class="cls_022">CRUD - create data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:568.57px" class="cls_006">
            <span class="cls_006">Now we're going to take what we've just learned, and use it to add the ability to create</span>
        </div>
        <div style="position:absolute;left:108.00px;top:581.17px" class="cls_006">
            <span class="cls_006">users in our application. If we look back to the routes we set up in </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006">, we can see</span>
        </div>
        <div style="position:absolute;left:108.00px;top:593.77px" class="cls_006">
            <span class="cls_006">that we have two routes for creating a user, the form itself and the form action.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:614.71px" class="cls_023">
            <span class="cls_023">app.get('/user/new', user.create);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:614.71px" class="cls_023">
            <span class="cls_023">// Create new user form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:626.95px" class="cls_023">
            <span class="cls_023">app.post('/user/new', user.doCreate);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:626.95px" class="cls_023">
            <span class="cls_023">// Create new user action</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 57 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:56140px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background071.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Creation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Adding a new user form</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">To display the form in an HTML page, we need to do two things:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:156.69px" class="cls_006">
            <span class="cls_006">• Create the Jade template</span>
        </div>
        <div style="position:absolute;left:126.00px;top:173.60px" class="cls_006">
            <span class="cls_006">• Link the template to the route</span>
        </div>
        <div style="position:absolute;left:108.00px;top:201.70px" class="cls_013">
            <span class="cls_013">Adding the Jade template</span>
        </div>
        <div style="position:absolute;left:108.00px;top:222.68px" class="cls_006">
            <span class="cls_006">By default Express will install with two Jade template files, </span>
            <span class="cls_007">layout.jade</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">index.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:235.28px" class="cls_007">
            <span class="cls_007">jade</span>
            <span class="cls_006">. The layout template contains the HTML skeleton, including the </span>
            <span class="cls_007">DTD</span>
            <span class="cls_006">, </span>
            <span class="cls_007">&lt;head></span>
            <span class="cls_006">, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:247.88px" class="cls_007">
            <span class="cls_007">&lt;body></span>
            <span class="cls_006"> tags. The index template extends the layout template inside the </span>
            <span class="cls_007">&lt;body></span>
            <span class="cls_006"> tag.</span>
        </div>
        <div style="position:absolute;left:108.01px;top:269.13px" class="cls_006">
            <span class="cls_006">For our MongoosePM application, we will keep this simple approach, and create a new</span>
        </div>
        <div style="position:absolute;left:108.01px;top:281.73px" class="cls_006">
            <span class="cls_006">extension template for each new page template we need. This is a great approach for</span>
        </div>
        <div style="position:absolute;left:108.01px;top:294.33px" class="cls_006">
            <span class="cls_006">rapid prototyping and development of a proof of concept. But before releasing an app,</span>
        </div>
        <div style="position:absolute;left:108.01px;top:306.93px" class="cls_006">
            <span class="cls_006">you'll probably want to spend more time on the templates and layout.</span>
        </div>
        <div style="position:absolute;left:108.01px;top:328.17px" class="cls_006">
            <span class="cls_006">Let's get started and create the template file for our user sign-up form. In the views</span>
        </div>
        <div style="position:absolute;left:108.01px;top:340.76px" class="cls_006">
            <span class="cls_006">folder either copy </span>
            <span class="cls_007">index.jade</span>
            <span class="cls_006"> or create a blank text file and call it </span>
            <span class="cls_007">user-form.jade</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:353.36px" class="cls_006">
            <span class="cls_006">In that file, enter the following lines and save it:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:374.30px" class="cls_023">
            <span class="cls_023">extends layout</span>
        </div>
        <div style="position:absolute;left:126.00px;top:398.78px" class="cls_023">
            <span class="cls_023">block content</span>
        </div>
        <div style="position:absolute;left:136.80px;top:411.02px" class="cls_023">
            <span class="cls_023">h1= title</span>
        </div>
        <div style="position:absolute;left:136.80px;top:423.26px" class="cls_023">
            <span class="cls_023">form(id="frmUserProfile", method="post", action="")</span>
        </div>
        <div style="position:absolute;left:147.60px;top:435.50px" class="cls_023">
            <span class="cls_023">label(for="FullName") Full name</span>
        </div>
        <div style="position:absolute;left:147.60px;top:447.74px" class="cls_023">
            <span class="cls_023">input(type="text", name="FullName", id="FullName")</span>
        </div>
        <div style="position:absolute;left:147.60px;top:459.98px" class="cls_023">
            <span class="cls_023">label(for="Email") Email</span>
        </div>
        <div style="position:absolute;left:147.60px;top:472.22px" class="cls_023">
            <span class="cls_023">input(type="email", name="Email", id="Email")</span>
        </div>
        <div style="position:absolute;left:147.60px;top:484.46px" class="cls_023">
            <span class="cls_023">input(type="submit", value="#{buttonText}")</span>
        </div>
        <div style="position:absolute;left:108.00px;top:504.20px" class="cls_006">
            <span class="cls_006">Here you can see that we are extending the template </span>
            <span class="cls_007">layout</span>
            <span class="cls_006">, and defining a block</span>
        </div>
        <div style="position:absolute;left:108.00px;top:516.80px" class="cls_006">
            <span class="cls_006">of code for the </span>
            <span class="cls_007">content</span>
            <span class="cls_006"> section of the layout template.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 58 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:56942px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background072.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 5</span>
        </div>
        <div style="position:absolute;left:171.00px;top:123.91px" class="cls_026">
            <span class="cls_026">For the rest of the templates in this book, we will omit the </span>
            <span class="cls_007">extends</span>
        </div>
        <div style="position:absolute;left:171.00px;top:135.31px" class="cls_007">
            <span class="cls_007">layout</span>
            <span class="cls_026"> and </span>
            <span class="cls_007">block content</span>
            <span class="cls_026"> lines for brevity, unless they are required</span>
        </div>
        <div style="position:absolute;left:171.00px;top:146.71px" class="cls_026">
            <span class="cls_026">to set context.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:172.46px" class="cls_006">
            <span class="cls_006">This page is going to be pretty minimal, having a </span>
            <span class="cls_007">&lt;h1></span>
            <span class="cls_006"> tag containing the page title</span>
        </div>
        <div style="position:absolute;left:108.00px;top:185.06px" class="cls_006">
            <span class="cls_006">that we'll pass through as the variable title, and a blank form. The form only asks for</span>
        </div>
        <div style="position:absolute;left:108.00px;top:197.66px" class="cls_006">
            <span class="cls_006">the full name and e-mail address; the submit button expects a variable </span>
            <span class="cls_007">buttonText</span>
        </div>
        <div style="position:absolute;left:108.00px;top:210.26px" class="cls_006">
            <span class="cls_006">to be passed to the template and will use it for the </span>
            <span class="cls_007">value</span>
            <span class="cls_006">. We have set the form</span>
        </div>
        <div style="position:absolute;left:108.00px;top:222.86px" class="cls_006">
            <span class="cls_006">method to </span>
            <span class="cls_007">POST</span>
            <span class="cls_006"> and left action blank. This means that the form will post to the same</span>
        </div>
        <div style="position:absolute;left:108.00px;top:235.46px" class="cls_006">
            <span class="cls_006">URL that is displaying the form. If we look back at our routes this is the behavior we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:248.06px" class="cls_006">
            <span class="cls_006">are looking for:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:269.00px" class="cls_023">
            <span class="cls_023">app.get('/user/new', user.create);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:269.00px" class="cls_023">
            <span class="cls_023">// Create new user form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:281.24px" class="cls_023">
            <span class="cls_023">app.post('/user/new', user.doCreate);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:281.24px" class="cls_023">
            <span class="cls_023">// Create new user action</span>
        </div>
        <div style="position:absolute;left:108.00px;top:300.98px" class="cls_006">
            <span class="cls_006">This is a technique we'll be using a few more times in this application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:329.08px" class="cls_013">
            <span class="cls_013">Linking the view to the URL</span>
        </div>
        <div style="position:absolute;left:108.00px;top:350.06px" class="cls_006">
            <span class="cls_006">Now that we have our display template ready, we need to link it to the routing. Our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:362.66px" class="cls_006">
            <span class="cls_006">routing maps a GET request of the URL </span>
            <span class="cls_007">/user/new</span>
            <span class="cls_006"> to the route </span>
            <span class="cls_007">user.create</span>
            <span class="cls_006">. So in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:375.26px" class="cls_006">
            <span class="cls_006">our </span>
            <span class="cls_007">/routes/user.js</span>
            <span class="cls_006"> file we need to create an export function called </span>
            <span class="cls_007">create</span>
            <span class="cls_006">. As</span>
        </div>
        <div style="position:absolute;left:108.00px;top:387.86px" class="cls_006">
            <span class="cls_006">part of this, we need to send the variables that the Jade template is expecting: </span>
            <span class="cls_007">title</span>
        </div>
        <div style="position:absolute;left:108.00px;top:400.46px" class="cls_006">
            <span class="cls_006">and </span>
            <span class="cls_007">buttonText</span>
            <span class="cls_006">. Your function should look something like the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:421.40px" class="cls_023">
            <span class="cls_023">// GET user creation form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:433.64px" class="cls_023">
            <span class="cls_023">exports.create = function(req, res){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:445.88px" class="cls_023">
            <span class="cls_023">res.render('user-form', {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:458.12px" class="cls_023">
            <span class="cls_023">title: 'Create user',</span>
        </div>
        <div style="position:absolute;left:147.60px;top:470.36px" class="cls_023">
            <span class="cls_023">buttonText: "Join!"</span>
        </div>
        <div style="position:absolute;left:136.80px;top:482.60px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:494.84px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:514.58px" class="cls_006">
            <span class="cls_006">That's pretty straightforward right? We can easily see this in action by running</span>
        </div>
        <div style="position:absolute;left:108.00px;top:527.18px" class="cls_006">
            <span class="cls_006">our application.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 59 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:57744px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background073.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Creation</span>
        </div>
        <div style="position:absolute;left:168.97px;top:125.75px" class="cls_028">
            <span class="cls_028">Restarting the application</span>
        </div>
        <div style="position:absolute;left:168.97px;top:141.48px" class="cls_026">
            <span class="cls_026">If your application is still running, then refreshing the page in the browser</span>
        </div>
        <div style="position:absolute;left:168.97px;top:152.88px" class="cls_026">
            <span class="cls_026">will not reflect changes made to Node.js code, although you will generally</span>
        </div>
        <div style="position:absolute;left:168.97px;top:164.28px" class="cls_026">
            <span class="cls_026">see changes made to Jade and CSS files. To restart the application, go</span>
        </div>
        <div style="position:absolute;left:168.97px;top:175.68px" class="cls_026">
            <span class="cls_026">to the terminal window running the process and hit </span>
            <span class="cls_030">Ctrl</span>
            <span class="cls_026"> + </span>
            <span class="cls_030">C</span>
            <span class="cls_026"> to kill the</span>
        </div>
        <div style="position:absolute;left:168.97px;top:187.08px" class="cls_026">
            <span class="cls_026">process. Then run the following command ensuring that you are in the</span>
        </div>
        <div style="position:absolute;left:168.97px;top:198.48px" class="cls_026">
            <span class="cls_026">root folder of the application:</span>
        </div>
        <div style="position:absolute;left:168.97px;top:214.09px" class="cls_024">
            <span class="cls_024">$ node app</span>
        </div>
        <div style="position:absolute;left:168.97px;top:229.31px" class="cls_026">
            <span class="cls_026">Alternatively there are a few tools available to monitor and restart your</span>
        </div>
        <div style="position:absolute;left:168.97px;top:240.71px" class="cls_026">
            <span class="cls_026">Node server automatically, such as </span>
            <span class="cls_028">Nodemon</span>
            <span class="cls_026"> and </span>
            <span class="cls_028">Supervisor</span>
            <span class="cls_026">, which are</span>
        </div>
        <div style="position:absolute;left:168.97px;top:252.11px" class="cls_026">
            <span class="cls_026">available at the following links:</span>
        </div>
        <div style="position:absolute;left:168.97px;top:267.84px" class="cls_007">
            <span class="cls_007"> </span>
            <A HREF="https://github.com/remy/nodemon/">https://github.com/remy/nodemon</A>
        </div>
        <div style="position:absolute;left:168.97px;top:283.56px" class="cls_026">
            <span class="cls_026">and</span>
        </div>
        <div style="position:absolute;left:168.97px;top:299.28px" class="cls_007">
            <span class="cls_007"> </span>
            <A HREF="https://github.com/isaacs/node-supervisor/">https://github.com/isaacs/node-supervisor</A>
        </div>
        <div style="position:absolute;left:108.00px;top:326.86px" class="cls_006">
            <span class="cls_006">Head back over to your browser and point it to </span>
            <A HREF="http://localhost:3000/user/">http://localhost:3000/user/</A>
            </span>
        </div>
        <div style="position:absolute;left:108.00px;top:339.46px" class="cls_007">
            <span class="cls_007">new</span>
            <span class="cls_006">—you should see something like the following screenshot:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:550.04px" class="cls_006">
            <span class="cls_006">Now, we're not going to win any design awards with this, but still, our form is up</span>
        </div>
        <div style="position:absolute;left:108.00px;top:562.64px" class="cls_006">
            <span class="cls_006">there with very little effort. Unfortunately, it doesn't do anything yet, so let's fix that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:575.24px" class="cls_006">
            <span class="cls_006">right now!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:605.18px" class="cls_027">
            <span class="cls_027">Adding the create user function</span>
        </div>
        <div style="position:absolute;left:108.00px;top:628.16px" class="cls_006">
            <span class="cls_006">The route we've declared to use—to handle the new user form—is </span>
            <span class="cls_007">user.doCreate</span>
            <span class="cls_006">,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:640.76px" class="cls_006">
            <span class="cls_006">so we will create the </span>
            <span class="cls_007">doCreate</span>
            <span class="cls_006"> export function in </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 60 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:58546px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background074.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 5</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">The bare bones of what we want to do are:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.74px" class="cls_006">
            <span class="cls_006">1. Take the name and e-mail address from the new user form.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:152.65px" class="cls_006">
            <span class="cls_006">2. Add the current date and time for </span>
            <span class="cls_007">modifiedOn</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">lastLogin</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:169.57px" class="cls_006">
            <span class="cls_006">3. Create the new user.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:186.49px" class="cls_006">
            <span class="cls_006">4. Save the new user to the database.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:203.40px" class="cls_006">
            <span class="cls_006">5. Confirm the save operation to the console.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:224.64px" class="cls_006">
            <span class="cls_006">We will flesh this out soon, but that's the minimum functionality we're after.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:237.24px" class="cls_006">
            <span class="cls_006">We'll use the </span>
            <span class="cls_007">Model.create()</span>
            <span class="cls_006"> method we looked at before, to create and save</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.85px" class="cls_006">
            <span class="cls_006">the document in one go, so add the following lines to your </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006"> file:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:270.79px" class="cls_023">
            <span class="cls_023">// POST new user creation form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:283.03px" class="cls_023">
            <span class="cls_023">exports.doCreate = function(req, res){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:295.27px" class="cls_023">
            <span class="cls_023">User.create({</span>
        </div>
        <div style="position:absolute;left:147.60px;top:307.51px" class="cls_023">
            <span class="cls_023">name: req.body.FullName,</span>
        </div>
        <div style="position:absolute;left:147.60px;top:319.75px" class="cls_023">
            <span class="cls_023">email: req.body.Email,</span>
        </div>
        <div style="position:absolute;left:147.60px;top:331.99px" class="cls_023">
            <span class="cls_023">modifiedOn : Date.now(),</span>
        </div>
        <div style="position:absolute;left:147.60px;top:344.23px" class="cls_023">
            <span class="cls_023">lastLogin : Date.now()</span>
        </div>
        <div style="position:absolute;left:136.80px;top:356.47px" class="cls_023">
            <span class="cls_023">}, function( err, user ){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:368.71px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:158.40px;top:380.95px" class="cls_023">
            <span class="cls_023">console.log("User created and saved: " + user);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:393.19px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:405.43px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:417.67px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:437.41px" class="cls_006">
            <span class="cls_006">Remember that if the operation is successful, then the saved object is returned to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:450.01px" class="cls_006">
            <span class="cls_006">the callback function. So if you were to run this successfully you could expect to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:462.61px" class="cls_006">
            <span class="cls_006">see something like the following returned to the console:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:483.55px" class="cls_023">
            <span class="cls_023">User created and saved: { __v: 0,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:495.79px" class="cls_023">
            <span class="cls_023">name: 'Simon Holmes',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:508.03px" class="cls_023">
            <span class="cls_023">email: 'simon@theholmesoffice.com',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:520.27px" class="cls_023">
            <span class="cls_023">createdOn: Sun Apr 21 2013 15:53:07 GMT+0100 (BST),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:532.51px" class="cls_023">
            <span class="cls_023">lastLogin: Sun Apr 21 2013 15:53:07 GMT+0100 (BST),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:544.75px" class="cls_023">
            <span class="cls_023">_id: 5173fd53aef1909b49000001,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:556.99px" class="cls_023">
            <span class="cls_023">modifiedOn: Sun Apr 21 2013 15:53:07 GMT+0100 (BST) }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:576.73px" class="cls_006">
            <span class="cls_006">Note how the </span>
            <span class="cls_007">createdOn</span>
            <span class="cls_006"> value has been set using the default specified in the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:589.33px" class="cls_006">
            <span class="cls_006">schema, and the unique key </span>
            <span class="cls_007">_id</span>
            <span class="cls_006"> has been added, created, and returned to us.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 61 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:59348px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background075.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Creation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Error trapping</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">This is all very well and good, but what if the save operation isn't successful? Well,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">we'll get an error object returned that we can look out for. We will first check if that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:159.19px" class="cls_006">
            <span class="cls_006">error exists, and log it to the console for now. We will then check for the error code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:171.79px" class="cls_025">
            <span class="cls_025">11000</span>
            <span class="cls_006">. You may recall from </span>
            <span class="cls_021">Chapter 3</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Schemas and Models</span>
            <span class="cls_006"> that this is the error which</span>
        </div>
        <div style="position:absolute;left:108.00px;top:184.39px" class="cls_006">
            <span class="cls_006">MongoDB will return if the e-mail address already exists in the database.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:205.63px" class="cls_006">
            <span class="cls_006">Our callback function now looks like the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:226.57px" class="cls_023">
            <span class="cls_023">function( err, user ){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:238.81px" class="cls_023">
            <span class="cls_023">if(err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:251.05px" class="cls_023">
            <span class="cls_023">console.log(err);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:263.29px" class="cls_023">
            <span class="cls_023">if(err.code===11000){</span>
        </div>
        <div style="position:absolute;left:158.40px;top:275.53px" class="cls_023">
            <span class="cls_023">res.redirect( '/user/new?exists=true' );</span>
        </div>
        <div style="position:absolute;left:147.60px;top:287.77px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:158.40px;top:300.01px" class="cls_023">
            <span class="cls_023">res.redirect('/?error=true');</span>
        </div>
        <div style="position:absolute;left:147.60px;top:312.25px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:324.49px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:147.60px;top:336.73px" class="cls_023">
            <span class="cls_023">// Success</span>
        </div>
        <div style="position:absolute;left:147.60px;top:348.97px" class="cls_023">
            <span class="cls_023">console.log("User created and saved: " + user);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:361.21px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:373.45px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:393.19px" class="cls_006">
            <span class="cls_006">So if an error is thrown while creating and saving the user we'll output it to the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:405.79px" class="cls_006">
            <span class="cls_006">console, and redirect the visitor to </span>
            <span class="cls_007">/?error=true</span>
            <span class="cls_006">, except if the error code is </span>
            <span class="cls_025">11000</span>
        </div>
        <div style="position:absolute;left:108.00px;top:418.39px" class="cls_006">
            <span class="cls_006">when we redirect the user to </span>
            <span class="cls_007">/user/new?exists=true</span>
            <span class="cls_006">. We could use both of these</span>
        </div>
        <div style="position:absolute;left:108.00px;top:430.99px" class="cls_006">
            <span class="cls_006">techniques to let the visitor know what has happened.</span>
        </div>
        <div style="position:absolute;left:177.77px;top:458.95px" class="cls_026">
            <span class="cls_026">There are several other MongoDB error codes that you can check for,</span>
        </div>
        <div style="position:absolute;left:177.77px;top:470.35px" class="cls_026">
            <span class="cls_026">allowing you to be as specific and granular as you want. You can</span>
        </div>
        <div style="position:absolute;left:177.77px;top:481.75px" class="cls_026">
            <span class="cls_026">find them in the following link:</span>
        </div>
        <div style="position:absolute;left:177.77px;top:495.53px" class="cls_007">
            <span class="cls_007"> </span>
            <A HREF="http://www.mongodb.org/about/contributors/error-/">http://www.mongodb.org/about/contributors/error-</A>
        </div>
        <div style="position:absolute;left:177.77px;top:506.93px" class="cls_007">
            <span class="cls_007">codes/</span>
        </div>
        <div style="position:absolute;left:108.00px;top:537.09px" class="cls_013">
            <span class="cls_013">Creating a user session</span>
        </div>
        <div style="position:absolute;left:108.00px;top:558.07px" class="cls_006">
            <span class="cls_006">Now that we've error trapped, we need to do something more useful with the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:570.67px" class="cls_006">
            <span class="cls_006">new user information than just log it to the console. In order to keep using the site</span>
        </div>
        <div style="position:absolute;left:108.00px;top:583.27px" class="cls_006">
            <span class="cls_006">we will need to store some of the user information in a session cookie, so that the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:595.87px" class="cls_006">
            <span class="cls_006">application can tell who each visitor is. We will also set a </span>
            <span class="cls_007">Boolean</span>
            <span class="cls_006"> session variable</span>
        </div>
        <div style="position:absolute;left:108.01px;top:608.47px" class="cls_006">
            <span class="cls_006">named </span>
            <span class="cls_007">loggedIn</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 62 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:60150px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background076.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 5</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">By updating the </span>
            <span class="cls_007">success</span>
            <span class="cls_006"> section of our callback, we now have the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">// Success</span>
        </div>
        <div style="position:absolute;left:126.00px;top:147.67px" class="cls_023">
            <span class="cls_023">console.log("User created and saved: " + user);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:159.91px" class="cls_023">
            <span class="cls_023">req.session.user = { "name" : user.name, "email": user.email, "_id":</span>
        </div>
        <div style="position:absolute;left:126.00px;top:170.71px" class="cls_023">
            <span class="cls_023">user._id };</span>
        </div>
        <div style="position:absolute;left:126.00px;top:182.95px" class="cls_023">
            <span class="cls_023">req.session.loggedIn = true;</span>
        </div>
        <div style="position:absolute;left:126.00px;top:195.19px" class="cls_023">
            <span class="cls_023">res.redirect( '/user' );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:214.93px" class="cls_006">
            <span class="cls_006">We have used the session capabilities of Express to store some useful information</span>
        </div>
        <div style="position:absolute;left:108.00px;top:227.53px" class="cls_006">
            <span class="cls_006">about the current user that we will use soon. You'll see that the final thing we do is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:240.13px" class="cls_006">
            <span class="cls_006">to redirect the visitor to the user profile page </span>
            <span class="cls_007">/user</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:171.72px;top:269.29px" class="cls_026">
            <span class="cls_026">You will notice that at the time of restarting the application, all existing</span>
        </div>
        <div style="position:absolute;left:171.72px;top:280.69px" class="cls_026">
            <span class="cls_026">sessions are lost as the default Express memory store does not persist</span>
        </div>
        <div style="position:absolute;left:171.72px;top:292.09px" class="cls_026">
            <span class="cls_026">outside of the running process. This can present a problem in live</span>
        </div>
        <div style="position:absolute;left:171.72px;top:303.49px" class="cls_026">
            <span class="cls_026">environments, but can be solved quite easily by using an external</span>
        </div>
        <div style="position:absolute;left:171.72px;top:314.89px" class="cls_026">
            <span class="cls_026">memory store to hold the session data.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:348.07px" class="cls_027">
            <span class="cls_027">Displaying the confirmation page</span>
        </div>
        <div style="position:absolute;left:108.00px;top:371.05px" class="cls_006">
            <span class="cls_006">To keep things simple, we are going to use the user profile page as the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:383.65px" class="cls_006">
            <span class="cls_006">confirmation page.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:404.90px" class="cls_006">
            <span class="cls_006">For now we will have a super-simple Jade template. For this create a template </span>
            <span class="cls_007">/</span>
        </div>
        <div style="position:absolute;left:108.00px;top:417.49px" class="cls_007">
            <span class="cls_007">views/user-page.jade</span>
            <span class="cls_006"> and add the following under the </span>
            <span class="cls_007">block content</span>
            <span class="cls_006"> section:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:438.43px" class="cls_023">
            <span class="cls_023">h1 Mongoose Project Management</span>
        </div>
        <div style="position:absolute;left:126.00px;top:450.67px" class="cls_023">
            <span class="cls_023">h2= name</span>
        </div>
        <div style="position:absolute;left:126.00px;top:462.91px" class="cls_023">
            <span class="cls_023">p Email: #{email}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:475.15px" class="cls_023">
            <span class="cls_023">h3 Actions</span>
        </div>
        <div style="position:absolute;left:136.80px;top:487.39px" class="cls_023">
            <span class="cls_023">ul</span>
        </div>
        <div style="position:absolute;left:147.60px;top:499.63px" class="cls_023">
            <span class="cls_023">li</span>
        </div>
        <div style="position:absolute;left:158.40px;top:511.87px" class="cls_023">
            <span class="cls_023">a(href="/project/new") Create a new project</span>
        </div>
        <div style="position:absolute;left:147.60px;top:524.11px" class="cls_023">
            <span class="cls_023">li</span>
        </div>
        <div style="position:absolute;left:158.40px;top:536.35px" class="cls_023">
            <span class="cls_023">a(href="/user/edit") Edit user info</span>
        </div>
        <div style="position:absolute;left:147.60px;top:548.59px" class="cls_023">
            <span class="cls_023">li</span>
        </div>
        <div style="position:absolute;left:158.40px;top:560.83px" class="cls_023">
            <span class="cls_023">a(href="/user/delete") Delete #{name}</span>
        </div>
        <div style="position:absolute;left:147.60px;top:573.07px" class="cls_023">
            <span class="cls_023">li</span>
        </div>
        <div style="position:absolute;left:158.40px;top:585.31px" class="cls_023">
            <span class="cls_023">a(href="/logout") Logout #{name}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:605.05px" class="cls_006">
            <span class="cls_006">We have also added a section for page specific navigation, allowing the user to take</span>
        </div>
        <div style="position:absolute;left:108.00px;top:617.65px" class="cls_006">
            <span class="cls_006">specific actions. We will tie these up to code as we go along.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 63 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:60952px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background077.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Creation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Next add the new export function to </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">// GET logged in user page</span>
        </div>
        <div style="position:absolute;left:126.00px;top:147.67px" class="cls_023">
            <span class="cls_023">exports.index = function (req, res) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:159.91px" class="cls_023">
            <span class="cls_023">if(req.session.loggedIn === true){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:172.15px" class="cls_023">
            <span class="cls_023">res.render('user-page', {</span>
        </div>
        <div style="position:absolute;left:158.40px;top:184.39px" class="cls_023">
            <span class="cls_023">title: req.session.user.name,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:196.63px" class="cls_023">
            <span class="cls_023">name: req.session.user.name,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:208.87px" class="cls_023">
            <span class="cls_023">email: req.session.user.email,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:221.11px" class="cls_023">
            <span class="cls_023">userID: req.session.user._id</span>
        </div>
        <div style="position:absolute;left:147.60px;top:233.35px" class="cls_023">
            <span class="cls_023">})</span>
        </div>
        <div style="position:absolute;left:136.80px;top:245.59px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:147.60px;top:257.83px" class="cls_023">
            <span class="cls_023">res.redirect('/login');</span>
        </div>
        <div style="position:absolute;left:136.80px;top:270.07px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:282.31px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:302.05px" class="cls_006">
            <span class="cls_006">Note that we are checking to see if a user is logged in before rendering the user</span>
        </div>
        <div style="position:absolute;left:108.00px;top:314.65px" class="cls_006">
            <span class="cls_006">page template, sending it some user data from the session object. If there is no</span>
        </div>
        <div style="position:absolute;left:108.00px;top:327.25px" class="cls_006">
            <span class="cls_006">active session then the visitor will be redirected to the login page. We will create</span>
        </div>
        <div style="position:absolute;left:108.00px;top:339.85px" class="cls_006">
            <span class="cls_006">the login page when we have looked at how to use Mongoose to read data.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:369.79px" class="cls_027">
            <span class="cls_027">Try it out!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:392.77px" class="cls_006">
            <span class="cls_006">You can now save the files, restart the application, and head to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:405.37px" class="cls_007">
            <span class="cls_007">http://localhost:3000/user/new</span>
            <span class="cls_006">. Try creating a few new users, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:417.97px" class="cls_006">
            <span class="cls_006">try registering a few with the same e-mail address to see the error trapping</span>
        </div>
        <div style="position:absolute;left:108.00px;top:430.57px" class="cls_006">
            <span class="cls_006">in progress. See how it works without having to do anything so mundane as</span>
        </div>
        <div style="position:absolute;left:108.00px;top:443.17px" class="cls_006">
            <span class="cls_006">creating a database? Refreshing isn't it!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:473.11px" class="cls_027">
            <span class="cls_027">Adding create project functionality</span>
        </div>
        <div style="position:absolute;left:108.00px;top:496.09px" class="cls_006">
            <span class="cls_006">Managing projects in our application is similar to how we manage the users, so we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:508.69px" class="cls_006">
            <span class="cls_006">won't go through it in great detail here. I will just point out the highlights and any</span>
        </div>
        <div style="position:absolute;left:108.00px;top:521.29px" class="cls_006">
            <span class="cls_006">differences. You can get the full code from the download that accompanies this book.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:549.39px" class="cls_013">
            <span class="cls_013">Routes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:570.37px" class="cls_006">
            <span class="cls_006">The following are the two main routes, to be added to </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:591.31px" class="cls_023">
            <span class="cls_023">// PROJECT ROUTES</span>
        </div>
        <div style="position:absolute;left:126.00px;top:603.55px" class="cls_023">
            <span class="cls_023">app.get('/project/new', project.create);</span>
        </div>
        <div style="position:absolute;left:374.40px;top:603.55px" class="cls_023">
            <span class="cls_023">// Create new</span>
        </div>
        <div style="position:absolute;left:363.60px;top:614.35px" class="cls_023">
            <span class="cls_023">//project form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:626.59px" class="cls_023">
            <span class="cls_023">app.post('/project/new', project.doCreate);</span>
        </div>
        <div style="position:absolute;left:374.40px;top:626.59px" class="cls_023">
            <span class="cls_023">// Create new</span>
        </div>
        <div style="position:absolute;left:363.60px;top:637.39px" class="cls_023">
            <span class="cls_023">//project action</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 64 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:61754px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background078.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 5</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">New files and functions</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">You will need to create some new files and functions to build the functionality,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">and to display it in the browser. As a starting point you'll be looking at the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:159.19px" class="cls_006">
            <span class="cls_006">following files:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:180.43px" class="cls_006">
            <span class="cls_006">• Routing: You will need to create a new controller file</span>
        </div>
        <div style="position:absolute;left:144.00px;top:193.03px" class="cls_007">
            <span class="cls_007">/routes/project.js</span>
            <span class="cls_006"> and two new functions </span>
            <span class="cls_007">exports.create()</span>
        </div>
        <div style="position:absolute;left:144.00px;top:205.63px" class="cls_006">
            <span class="cls_006">and </span>
            <span class="cls_007">exports.doCreate()</span>
        </div>
        <div style="position:absolute;left:126.00px;top:222.55px" class="cls_006">
            <span class="cls_006">• Display: You will need to create a new template file</span>
        </div>
        <div style="position:absolute;left:144.00px;top:236.15px" class="cls_007">
            <span class="cls_007">views/project-form.jade</span>
        </div>
        <div style="position:absolute;left:108.00px;top:256.39px" class="cls_006">
            <span class="cls_006">At this point we will not be displaying the new project information on a webpage,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:268.99px" class="cls_006">
            <span class="cls_006">just outputting to a </span>
            <span class="cls_007">console.log</span>
            <span class="cls_006">. Before we can view it on a page we need to learn</span>
        </div>
        <div style="position:absolute;left:108.00px;top:281.59px" class="cls_006">
            <span class="cls_006">how to query the database to find the correct information, as project data is not</span>
        </div>
        <div style="position:absolute;left:108.00px;top:294.19px" class="cls_006">
            <span class="cls_006">stored in a session in the same way as the user information.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:326.69px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:351.67px" class="cls_006">
            <span class="cls_006">In this chapter, we have learned how to use the default methods provided by</span>
        </div>
        <div style="position:absolute;left:108.00px;top:364.27px" class="cls_006">
            <span class="cls_006">Mongoose to create and save new database entries, based on our schemas and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:376.87px" class="cls_006">
            <span class="cls_006">models. We have seen that you can run a quick single command, or have greater</span>
        </div>
        <div style="position:absolute;left:108.00px;top:389.47px" class="cls_006">
            <span class="cls_006">control and flexibility through issuing a series of separate commands.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:410.71px" class="cls_006">
            <span class="cls_006">In our project, we have now added the ability to create users and projects.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:431.95px" class="cls_006">
            <span class="cls_006">Coming up in the next chapter, we're going to look at how to use Mongoose to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:444.55px" class="cls_006">
            <span class="cls_006">query the database, to find the data we want and use it to populate a web page.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 65 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:62556px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background079.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:63358px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background080.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:302.23px;top:218.71px" class="cls_015">
            <span class="cls_015">Interacting with</span>
        </div>
        <div style="position:absolute;left:287.20px;top:254.71px" class="cls_015">
            <span class="cls_015">Data - Reading,</span>
        </div>
        <div style="position:absolute;left:208.84px;top:290.71px" class="cls_015">
            <span class="cls_015">Querying, and Finding</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.41px" class="cls_006">
            <span class="cls_006">So we've seen how Mongoose provides simple static methods for adding data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:357.01px" class="cls_006">
            <span class="cls_006">to the database. Now let's see what Mongoose offers to help us find the data we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:369.61px" class="cls_006">
            <span class="cls_006">want by querying the database and reading the data back into model instances in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:382.21px" class="cls_006">
            <span class="cls_006">our application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:403.46px" class="cls_006">
            <span class="cls_006">In this chapter we will:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:424.70px" class="cls_006">
            <span class="cls_006">• Learn about the built-in options for querying MongoDB through Mongoose</span>
        </div>
        <div style="position:absolute;left:126.00px;top:441.61px" class="cls_006">
            <span class="cls_006">• Get practical by updating our application, letting us find individual users,</span>
        </div>
        <div style="position:absolute;left:143.99px;top:454.21px" class="cls_006">
            <span class="cls_006">individual projects and lists of projects</span>
        </div>
        <div style="position:absolute;left:126.00px;top:471.13px" class="cls_006">
            <span class="cls_006">• Extend on the default functionality by creating our own static method</span>
        </div>
        <div style="position:absolute;left:108.00px;top:503.63px" class="cls_022">
            <span class="cls_022">Approaches to find and read data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:528.61px" class="cls_006">
            <span class="cls_006">Mongoose offers many ways of querying data, but much like what we saw in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:541.21px" class="cls_021">
            <span class="cls_021">Chapter 5</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Interacting with Data - Creation</span>
            <span class="cls_006">, there is more than one way to execute</span>
        </div>
        <div style="position:absolute;left:108.00px;top:553.81px" class="cls_006">
            <span class="cls_006">your command.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:575.06px" class="cls_006">
            <span class="cls_006">• Using the QueryBuilder interface to build a query step by step before</span>
        </div>
        <div style="position:absolute;left:143.99px;top:587.66px" class="cls_006">
            <span class="cls_006">executing it at a specific point in your code</span>
        </div>
        <div style="position:absolute;left:126.00px;top:604.57px" class="cls_006">
            <span class="cls_006">• Immediately with a single command</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:64160px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background081.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Reading, Querying, and Finding</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Here we have the best of both worlds. Using the QueryBuilder interface offers a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">greater level of flexibility and complexity, whereas the immediate execution option</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">gives us a nice and easy way to quickly run simple queries.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.94px" class="cls_006">
            <span class="cls_006">There are a number of static model methods provided by Mongoose to assist in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:173.53px" class="cls_006">
            <span class="cls_006">the bulk of </span>
            <span class="cls_007">find</span>
            <span class="cls_006"> operations, including </span>
            <span class="cls_007">Model.find</span>
            <span class="cls_006">, </span>
            <span class="cls_007">Model.findOne</span>
            <span class="cls_006">, and </span>
            <span class="cls_007">Model.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:186.13px" class="cls_007">
            <span class="cls_007">findById</span>
            <span class="cls_006">. We will look at these static model methods in more detail very soon,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:198.73px" class="cls_006">
            <span class="cls_006">and we'll also see how we can create our own.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:228.67px" class="cls_027">
            <span class="cls_027">Using the QueryBuilder</span>
        </div>
        <div style="position:absolute;left:108.00px;top:251.65px" class="cls_006">
            <span class="cls_006">Mongoose provides a simple QueryBuilder interface for when you want to build up</span>
        </div>
        <div style="position:absolute;left:108.00px;top:264.25px" class="cls_006">
            <span class="cls_006">the query over multiple steps before executing it at a certain point in your code. Look</span>
        </div>
        <div style="position:absolute;left:108.00px;top:276.85px" class="cls_006">
            <span class="cls_006">at the example in the following snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:297.79px" class="cls_023">
            <span class="cls_023">var myQuery = User.find({'name' : 'Simon Holmes'});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:310.03px" class="cls_023">
            <span class="cls_023">myQuery.where('age').gt(18);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:322.27px" class="cls_023">
            <span class="cls_023">myQuery.sort('-lastLogin');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:334.51px" class="cls_023">
            <span class="cls_023">myQuery.select('_id name email');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:346.75px" class="cls_023">
            <span class="cls_023">myQuery.exec(function (err, users){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:358.99px" class="cls_023">
            <span class="cls_023">if (!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:371.23px" class="cls_023">
            <span class="cls_023">console.log(users); // output array of users found</span>
        </div>
        <div style="position:absolute;left:136.80px;top:383.47px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:395.71px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:415.45px" class="cls_006">
            <span class="cls_006">You can probably figure out what this code is doing. Assuming we already have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:428.05px" class="cls_006">
            <span class="cls_006">a compiled model called </span>
            <span class="cls_007">User</span>
            <span class="cls_006">, we are looking for all users whose name is "Simon</span>
        </div>
        <div style="position:absolute;left:108.00px;top:440.65px" class="cls_006">
            <span class="cls_006">Holmes" and who are older than 18 years. We want to order them by </span>
            <span class="cls_007">lastLogin</span>
            <span class="cls_006"> in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:453.25px" class="cls_006">
            <span class="cls_006">a descending order (that is, most recent first), and only return the three document</span>
        </div>
        <div style="position:absolute;left:108.00px;top:465.85px" class="cls_006">
            <span class="cls_006">fields </span>
            <span class="cls_007">_id</span>
            <span class="cls_006">, </span>
            <span class="cls_007">name</span>
            <span class="cls_006">, and </span>
            <span class="cls_007">email</span>
            <span class="cls_006">. When the query result is returned, we do something</span>
        </div>
        <div style="position:absolute;left:108.00px;top:478.45px" class="cls_006">
            <span class="cls_006">with it in a callback function passed to the </span>
            <span class="cls_007">.exec</span>
            <span class="cls_006"> call.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:499.70px" class="cls_006">
            <span class="cls_006">If you prefer you can chain the commands using dot syntax. The earlier code could</span>
        </div>
        <div style="position:absolute;left:108.00px;top:512.30px" class="cls_006">
            <span class="cls_006">be rewritten using the dot syntax method as in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:533.23px" class="cls_023">
            <span class="cls_023">User.find({'name' : 'Simon Holmes'})</span>
        </div>
        <div style="position:absolute;left:126.00px;top:545.47px" class="cls_023">
            <span class="cls_023">.where('age').gt(18)</span>
        </div>
        <div style="position:absolute;left:126.00px;top:557.71px" class="cls_023">
            <span class="cls_023">.sort('-lastLogin')</span>
        </div>
        <div style="position:absolute;left:126.00px;top:569.95px" class="cls_023">
            <span class="cls_023">.select('_id name email')</span>
        </div>
        <div style="position:absolute;left:126.00px;top:582.19px" class="cls_023">
            <span class="cls_023">.exec(function (err, users){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:594.43px" class="cls_023">
            <span class="cls_023">if (!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:606.67px" class="cls_023">
            <span class="cls_023">console.log(users); // output array of users found</span>
        </div>
        <div style="position:absolute;left:136.80px;top:618.91px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:631.15px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 68 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:64962px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background082.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 6</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Or we can create a combination of the previous two:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">var myQuery = User.find({'name' : 'Simon Holmes'})</span>
        </div>
        <div style="position:absolute;left:126.00px;top:147.67px" class="cls_023">
            <span class="cls_023">.where('age').gt(18)</span>
        </div>
        <div style="position:absolute;left:126.00px;top:159.91px" class="cls_023">
            <span class="cls_023">.sort('-lastLogin')</span>
        </div>
        <div style="position:absolute;left:126.00px;top:172.15px" class="cls_023">
            <span class="cls_023">.select('_id name email');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:184.39px" class="cls_023">
            <span class="cls_023">// do some other operations</span>
        </div>
        <div style="position:absolute;left:126.00px;top:196.63px" class="cls_023">
            <span class="cls_023">// and then…</span>
        </div>
        <div style="position:absolute;left:126.00px;top:208.87px" class="cls_023">
            <span class="cls_023">myQuery.exec(function (err, users){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:221.11px" class="cls_023">
            <span class="cls_023">if (!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:233.35px" class="cls_023">
            <span class="cls_023">console.log(users); // output array of users found</span>
        </div>
        <div style="position:absolute;left:136.80px;top:245.59px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:257.83px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:277.57px" class="cls_006">
            <span class="cls_006">There are far too many options for the QueryBuilder interface for us to cover in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:290.17px" class="cls_006">
            <span class="cls_006">this book. Many of the query capabilities of MongoDB have been given helper</span>
        </div>
        <div style="position:absolute;left:108.00px;top:302.77px" class="cls_006">
            <span class="cls_006">methods in Mongoose. So there are all types of queries you can put together, such</span>
        </div>
        <div style="position:absolute;left:108.00px;top:315.37px" class="cls_006">
            <span class="cls_006">as geospatial distance queries for map data, and skipping and limiting records to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:327.97px" class="cls_006">
            <span class="cls_006">perform the pagination of results.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:357.91px" class="cls_027">
            <span class="cls_027">Single query operation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:380.89px" class="cls_006">
            <span class="cls_006">The QueryBuilder interface is great for putting together complex queries and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:393.49px" class="cls_006">
            <span class="cls_006">requests. It helps the code maintain better readability and is easy to understand</span>
        </div>
        <div style="position:absolute;left:108.00px;top:406.09px" class="cls_006">
            <span class="cls_006">when you come back to the code after a few months. Sometimes however, all you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:418.69px" class="cls_006">
            <span class="cls_006">need is a pretty simple query that will be perfectly readable if you just format your</span>
        </div>
        <div style="position:absolute;left:108.00px;top:431.29px" class="cls_006">
            <span class="cls_006">code nicely.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:452.53px" class="cls_006">
            <span class="cls_006">This is where we use a single-query operation. The construct for a single </span>
            <span class="cls_007">find</span>
        </div>
        <div style="position:absolute;left:108.00px;top:465.13px" class="cls_006">
            <span class="cls_006">operation is the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:486.07px" class="cls_023">
            <span class="cls_023">Model.find(conditions, [fields], [options], [callback])</span>
        </div>
        <div style="position:absolute;left:172.98px;top:515.81px" class="cls_028">
            <span class="cls_028">Tips and gotchas</span>
        </div>
        <div style="position:absolute;left:172.98px;top:531.53px" class="cls_026">
            <span class="cls_026">In this construct, </span>
            <span class="cls_007">fields</span>
            <span class="cls_026"> and </span>
            <span class="cls_007">options</span>
            <span class="cls_026"> are both optional, but if you</span>
        </div>
        <div style="position:absolute;left:172.98px;top:542.93px" class="cls_026">
            <span class="cls_026">want to specify </span>
            <span class="cls_007">options</span>
            <span class="cls_026"> then you must specify </span>
            <span class="cls_007">fields</span>
            <span class="cls_026">, even if you</span>
        </div>
        <div style="position:absolute;left:172.98px;top:554.33px" class="cls_026">
            <span class="cls_026">send it as </span>
            <span class="cls_007">null</span>
            <span class="cls_026">.</span>
        </div>
        <div style="position:absolute;left:172.98px;top:570.05px" class="cls_026">
            <span class="cls_026">Mongoose will run the callback function when the operation has been</span>
        </div>
        <div style="position:absolute;left:172.98px;top:581.45px" class="cls_026">
            <span class="cls_026">completed. If no callback function is defined then the query will not</span>
        </div>
        <div style="position:absolute;left:172.98px;top:592.85px" class="cls_026">
            <span class="cls_026">be executed. It can however be called explicitly by using the </span>
            <span class="cls_007">.exec()</span>
        </div>
        <div style="position:absolute;left:172.98px;top:604.25px" class="cls_026">
            <span class="cls_026">method we saw earlier.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 69 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:65764px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background083.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Reading, Querying, and Finding</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Let's look at some examples. The most basic approach, supplying just the conditions</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">and the callback function, is as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.03px" class="cls_023">
            <span class="cls_023">User.find(</span>
        </div>
        <div style="position:absolute;left:136.80px;top:160.27px" class="cls_023">
            <span class="cls_023">{'name' : 'Simon Holmes'}, // users called Simon Holmes</span>
        </div>
        <div style="position:absolute;left:136.80px;top:172.51px" class="cls_023">
            <span class="cls_023">function (err, users){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:184.75px" class="cls_023">
            <span class="cls_023">if (!err){console.log(users);}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:196.99px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:216.73px" class="cls_006">
            <span class="cls_006">Also specifying which fields we want to be returned as in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:237.67px" class="cls_023">
            <span class="cls_023">User.find(</span>
        </div>
        <div style="position:absolute;left:136.80px;top:249.91px" class="cls_023">
            <span class="cls_023">{'name' : 'Simon Holmes'}, // users called Simon Holmes</span>
        </div>
        <div style="position:absolute;left:136.80px;top:262.15px" class="cls_023">
            <span class="cls_023">'name email', // returning just the name and email fields</span>
        </div>
        <div style="position:absolute;left:136.80px;top:274.39px" class="cls_023">
            <span class="cls_023">function (err, users){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:286.63px" class="cls_023">
            <span class="cls_023">if (!err){console.log(users);}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:298.87px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:318.61px" class="cls_006">
            <span class="cls_006">Or using the options to specify a sort order as in the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:339.55px" class="cls_023">
            <span class="cls_023">User.find(</span>
        </div>
        <div style="position:absolute;left:136.80px;top:351.79px" class="cls_023">
            <span class="cls_023">{'name' : 'Simon Holmes'}, // users called Simon Holmes</span>
        </div>
        <div style="position:absolute;left:136.80px;top:364.03px" class="cls_023">
            <span class="cls_023">null, // returning all fields in model</span>
        </div>
        <div style="position:absolute;left:136.80px;top:376.27px" class="cls_023">
            <span class="cls_023">{sort : {lastLogin : -1}}, // sorted by lastLogin descending</span>
        </div>
        <div style="position:absolute;left:136.80px;top:388.51px" class="cls_023">
            <span class="cls_023">function (err, users){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:400.75px" class="cls_023">
            <span class="cls_023">if (!err){console.log(users);}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:412.99px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:441.43px" class="cls_027">
            <span class="cls_027">Static helper methods - finding data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:464.41px" class="cls_006">
            <span class="cls_006">Each of the two approaches makes use of a number of static helper methods that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:477.01px" class="cls_006">
            <span class="cls_006">Mongoose provides. Some of the static methods that can use both approaches are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:489.61px" class="cls_006">
            <span class="cls_006">as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:510.85px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> Model.find(query)</span>
            <span class="cls_006"> to return an array of instances matching the query</span>
        </div>
        <div style="position:absolute;left:126.00px;top:527.77px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> Model.findOne(query)</span>
            <span class="cls_006"> to return the first instance found that matches</span>
        </div>
        <div style="position:absolute;left:144.00px;top:540.37px" class="cls_006">
            <span class="cls_006">the query</span>
        </div>
        <div style="position:absolute;left:126.00px;top:557.29px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> Model.findById(ObjectID)</span>
            <span class="cls_006"> to return a single instance matching the given</span>
        </div>
        <div style="position:absolute;left:144.00px;top:569.89px" class="cls_006">
            <span class="cls_006">ObjectID</span>
        </div>
        <div style="position:absolute;left:108.00px;top:591.14px" class="cls_006">
            <span class="cls_006">As we have already seen, there are various parameters that can be added to the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:603.73px" class="cls_007">
            <span class="cls_007">Model.find</span>
            <span class="cls_006"> method. The same applies for each of these static methods.</span>
        </div>
        <div style="position:absolute;left:108.01px;top:624.98px" class="cls_006">
            <span class="cls_006">We need to use each of them in our project, as well as creating our own static</span>
        </div>
        <div style="position:absolute;left:108.01px;top:637.58px" class="cls_006">
            <span class="cls_006">method. So let's learn by doing.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 70 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:66566px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background084.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 6</span>
        </div>
        <div style="position:absolute;left:108.00px;top:111.92px" class="cls_022">
            <span class="cls_022">CRUD - reading user and project data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:136.90px" class="cls_006">
            <span class="cls_006">Now we're going to go through the main three static methods for a specific use case</span>
        </div>
        <div style="position:absolute;left:108.00px;top:149.50px" class="cls_006">
            <span class="cls_006">in our application. We'll also wrap one of these inside a custom static method that we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:162.10px" class="cls_006">
            <span class="cls_006">are going to create.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:192.04px" class="cls_027">
            <span class="cls_027">findOne() - finding a single user</span>
        </div>
        <div style="position:absolute;left:108.00px;top:215.02px" class="cls_006">
            <span class="cls_006">First up, let's add the ability for a returning user to log in. At this moment we are not</span>
        </div>
        <div style="position:absolute;left:108.00px;top:227.62px" class="cls_006">
            <span class="cls_006">using any type of authentication. This is intentional as there is a plethora of options</span>
        </div>
        <div style="position:absolute;left:108.00px;top:240.22px" class="cls_006">
            <span class="cls_006">out there for password hashing and encryption, using OAuth or social network</span>
        </div>
        <div style="position:absolute;left:108.00px;top:252.82px" class="cls_006">
            <span class="cls_006">accounts. While there are several node modules available to help with this, it will just</span>
        </div>
        <div style="position:absolute;left:108.00px;top:265.42px" class="cls_006">
            <span class="cls_006">prove a distraction while we're building the bare bones of our app. For now, while</span>
        </div>
        <div style="position:absolute;left:108.00px;top:278.02px" class="cls_006">
            <span class="cls_006">we're putting it together we'll stick to just entering an e-mail address to enable us to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:290.62px" class="cls_006">
            <span class="cls_006">switch between users.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:311.86px" class="cls_006">
            <span class="cls_006">The routes we're going to use are in the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:332.80px" class="cls_023">
            <span class="cls_023">app.get('/login', user.login);</span>
        </div>
        <div style="position:absolute;left:342.00px;top:332.80px" class="cls_023">
            <span class="cls_023">// Login form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:345.04px" class="cls_023">
            <span class="cls_023">app.post('/login', user.doLogin);</span>
        </div>
        <div style="position:absolute;left:342.00px;top:345.04px" class="cls_023">
            <span class="cls_023">// Login action</span>
        </div>
        <div style="position:absolute;left:108.00px;top:371.64px" class="cls_013">
            <span class="cls_013">Login form</span>
        </div>
        <div style="position:absolute;left:108.00px;top:392.62px" class="cls_006">
            <span class="cls_006">The first step is to create the login form—which we'll keep simple for now. So we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:405.22px" class="cls_006">
            <span class="cls_006">need to create a new file </span>
            <span class="cls_007">view/login-form.jade</span>
            <span class="cls_006"> with the following content:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:426.16px" class="cls_023">
            <span class="cls_023">h1= title</span>
        </div>
        <div style="position:absolute;left:126.00px;top:438.40px" class="cls_023">
            <span class="cls_023">form(id="formUserLogin", method="post", action="")</span>
        </div>
        <div style="position:absolute;left:136.80px;top:450.64px" class="cls_023">
            <span class="cls_023">label(for="Email") Email</span>
        </div>
        <div style="position:absolute;left:136.80px;top:462.88px" class="cls_023">
            <span class="cls_023">input(type="email", name="Email", id="Email")</span>
        </div>
        <div style="position:absolute;left:136.80px;top:475.12px" class="cls_023">
            <span class="cls_023">input(type="submit", value="Login")</span>
        </div>
        <div style="position:absolute;left:126.00px;top:487.36px" class="cls_023">
            <span class="cls_023">p Or new users can</span>
        </div>
        <div style="position:absolute;left:136.80px;top:499.60px" class="cls_023">
            <span class="cls_023">a(href="/user/new") sign up</span>
        </div>
        <div style="position:absolute;left:108.00px;top:519.34px" class="cls_006">
            <span class="cls_006">And we need to create the corresponding controller in </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:540.28px" class="cls_023">
            <span class="cls_023">// GET login page</span>
        </div>
        <div style="position:absolute;left:126.00px;top:552.52px" class="cls_023">
            <span class="cls_023">exports.login = function (req, res) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:564.76px" class="cls_023">
            <span class="cls_023">res.render('login-form', {title: 'Log in'})</span>
        </div>
        <div style="position:absolute;left:126.00px;top:577.00px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 71 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:67368px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background085.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Reading, Querying, and Finding</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Login action</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">The second step is to create the action itself. What we are aiming to achieve with this</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">action is as follows</span>
        </div>
        <div style="position:absolute;left:126.00px;top:167.83px" class="cls_006">
            <span class="cls_006">1. Check that the </span>
            <span class="cls_007">Email</span>
            <span class="cls_006"> field from the form exists and contains a value.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:184.74px" class="cls_006">
            <span class="cls_006">2. Try to find a database entry with that e-mail address.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:201.66px" class="cls_006">
            <span class="cls_006">3. If the user doesn't exist, then:</span>
        </div>
        <div style="position:absolute;left:162.00px;top:218.57px" class="cls_006">
            <span class="cls_006">1. Send visitor back to the login screen.</span>
        </div>
        <div style="position:absolute;left:125.99px;top:239.82px" class="cls_006">
            <span class="cls_006">4. If the user does exist, then:</span>
        </div>
        <div style="position:absolute;left:161.98px;top:261.06px" class="cls_006">
            <span class="cls_006">1. Return their name, e-mail address, and unique ID.</span>
        </div>
        <div style="position:absolute;left:161.98px;top:277.97px" class="cls_006">
            <span class="cls_006">2. Save the details to the session.</span>
        </div>
        <div style="position:absolute;left:161.98px;top:294.89px" class="cls_006">
            <span class="cls_006">3. Output the user object to the console so that we can see what's</span>
        </div>
        <div style="position:absolute;left:179.98px;top:307.49px" class="cls_006">
            <span class="cls_006">going on.</span>
        </div>
        <div style="position:absolute;left:161.98px;top:324.40px" class="cls_006">
            <span class="cls_006">4. Redirect to the user profile page </span>
            <span class="cls_007">/user</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:345.67px" class="cls_006">
            <span class="cls_006">Translating this to JavaScript will result in the following code that we need to add to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:358.27px" class="cls_007">
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">. We are going to use the </span>
            <span class="cls_007">findOne()</span>
            <span class="cls_006"> method as there should only be</span>
        </div>
        <div style="position:absolute;left:108.00px;top:370.87px" class="cls_006">
            <span class="cls_006">one entry in the database with this e-mail address, as Mongoose has told MongoDB</span>
        </div>
        <div style="position:absolute;left:108.00px;top:383.47px" class="cls_006">
            <span class="cls_006">that it should be a unique field. This will speed up the query operation as it returns</span>
        </div>
        <div style="position:absolute;left:108.00px;top:396.07px" class="cls_006">
            <span class="cls_006">back with the first match, rather than continuing the search to look for others.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:417.01px" class="cls_023">
            <span class="cls_023">// POST login page</span>
        </div>
        <div style="position:absolute;left:126.00px;top:429.25px" class="cls_023">
            <span class="cls_023">exports.doLogin = function (req, res) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:441.49px" class="cls_023">
            <span class="cls_023">if (req.body.Email) {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:453.73px" class="cls_023">
            <span class="cls_023">User.findOne(</span>
        </div>
        <div style="position:absolute;left:158.40px;top:465.97px" class="cls_023">
            <span class="cls_023">{'email' : req.body.Email},</span>
        </div>
        <div style="position:absolute;left:158.40px;top:478.21px" class="cls_023">
            <span class="cls_023">'_id name email',</span>
        </div>
        <div style="position:absolute;left:158.40px;top:490.45px" class="cls_023">
            <span class="cls_023">function(err, user) {</span>
        </div>
        <div style="position:absolute;left:169.20px;top:502.69px" class="cls_023">
            <span class="cls_023">if (!err) {</span>
        </div>
        <div style="position:absolute;left:180.00px;top:514.93px" class="cls_023">
            <span class="cls_023">if (!user){</span>
        </div>
        <div style="position:absolute;left:190.80px;top:527.17px" class="cls_023">
            <span class="cls_023">res.redirect('/login?404=user');</span>
        </div>
        <div style="position:absolute;left:180.00px;top:539.41px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:190.80px;top:551.65px" class="cls_023">
            <span class="cls_023">req.session.user = {</span>
        </div>
        <div style="position:absolute;left:201.60px;top:563.89px" class="cls_023">
            <span class="cls_023">"name" : user.name,</span>
        </div>
        <div style="position:absolute;left:201.60px;top:576.13px" class="cls_023">
            <span class="cls_023">"email": user.email,</span>
        </div>
        <div style="position:absolute;left:201.60px;top:588.37px" class="cls_023">
            <span class="cls_023">"_id": user._id</span>
        </div>
        <div style="position:absolute;left:190.80px;top:600.61px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:190.80px;top:612.85px" class="cls_023">
            <span class="cls_023">req.session.loggedin = "true";</span>
        </div>
        <div style="position:absolute;left:190.80px;top:625.09px" class="cls_023">
            <span class="cls_023">console.log('Logged in user: ' + user);</span>
        </div>
        <div style="position:absolute;left:201.60px;top:637.33px" class="cls_023">
            <span class="cls_023">res.redirect( '/user' );</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 72 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:68170px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background086.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 6</span>
        </div>
        <div style="position:absolute;left:180.00px;top:114.01px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:169.20px;top:126.25px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:158.40px;top:138.49px" class="cls_023">
            <span class="cls_023">} else {</span>
        </div>
        <div style="position:absolute;left:169.20px;top:150.73px" class="cls_023">
            <span class="cls_023">res.redirect('/login?404=error');</span>
        </div>
        <div style="position:absolute;left:158.40px;top:162.97px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:147.60px;top:175.21px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:136.80px;top:187.45px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:136.80px;top:199.69px" class="cls_023">
            <span class="cls_023">} else {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:211.93px" class="cls_023">
            <span class="cls_023">res.redirect('/login?404=error');</span>
        </div>
        <div style="position:absolute;left:136.80px;top:224.17px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:236.41px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:256.14px" class="cls_006">
            <span class="cls_006">See how in the </span>
            <span class="cls_007">User.findOne</span>
            <span class="cls_006"> function we are sending through three parameters:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:277.38px" class="cls_006">
            <span class="cls_006">• The data object to query the database</span>
        </div>
        <div style="position:absolute;left:126.00px;top:294.30px" class="cls_006">
            <span class="cls_006">• The data keys we want to be returned</span>
        </div>
        <div style="position:absolute;left:126.00px;top:311.22px" class="cls_006">
            <span class="cls_006">• The callback function for when the database has finished looking</span>
        </div>
        <div style="position:absolute;left:107.99px;top:332.46px" class="cls_006">
            <span class="cls_006">The rest should be fairly easy to follow. Even if you're not familiar with using</span>
        </div>
        <div style="position:absolute;left:107.99px;top:345.06px" class="cls_006">
            <span class="cls_006">sessions in Express, the syntax makes the code nice and easy to understand.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:366.30px" class="cls_006">
            <span class="cls_006">We already created the </span>
            <span class="cls_007">/user</span>
            <span class="cls_006"> page in the previous section, so we're good to go!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:394.40px" class="cls_013">
            <span class="cls_013">Housekeeping - adding homepage links</span>
        </div>
        <div style="position:absolute;left:108.00px;top:415.38px" class="cls_006">
            <span class="cls_006">Let's take a quick moment to make our lives easier and add the </span>
            <span class="cls_007">sign up</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">login</span>
        </div>
        <div style="position:absolute;left:108.00px;top:427.98px" class="cls_006">
            <span class="cls_006">links to the homepage of our app. In </span>
            <span class="cls_007">views/index.jade</span>
            <span class="cls_006"> add the following links:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:448.92px" class="cls_023">
            <span class="cls_023">ul</span>
        </div>
        <div style="position:absolute;left:136.80px;top:461.16px" class="cls_023">
            <span class="cls_023">li</span>
        </div>
        <div style="position:absolute;left:147.60px;top:473.40px" class="cls_023">
            <span class="cls_023">a(href="/login") Login</span>
        </div>
        <div style="position:absolute;left:136.80px;top:485.64px" class="cls_023">
            <span class="cls_023">li</span>
        </div>
        <div style="position:absolute;left:147.60px;top:497.88px" class="cls_023">
            <span class="cls_023">a(href="/user/new") Sign up</span>
        </div>
        <div style="position:absolute;left:108.00px;top:524.48px" class="cls_013">
            <span class="cls_013">Try it out!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:545.46px" class="cls_006">
            <span class="cls_006">Restart your app and head over to </span>
            <A HREF="http://localhost:3000/">http://localhost:3000</A>
            </span>
            <span class="cls_006"> in your browser once</span>
        </div>
        <div style="position:absolute;left:108.00px;top:558.06px" class="cls_006">
            <span class="cls_006">again. From here you can test out the new links and add new users and log in as a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:570.66px" class="cls_006">
            <span class="cls_006">different user.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 73 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:68972px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background087.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Reading, Querying, and Finding</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">find() - finding a list of projects and returning</span>
        </div>
        <div style="position:absolute;left:108.00px;top:134.06px" class="cls_027">
            <span class="cls_027">JSON to AJAX</span>
        </div>
        <div style="position:absolute;left:108.00px;top:157.04px" class="cls_006">
            <span class="cls_006">If you are creating an API or just want an endpoint for an AJAX call, then you really</span>
        </div>
        <div style="position:absolute;left:108.00px;top:169.64px" class="cls_006">
            <span class="cls_006">want to respond to a request with JSON, not HTML.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:190.89px" class="cls_006">
            <span class="cls_006">Mongoose and Express work together nicely to make this really simple for us. In a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:203.49px" class="cls_006">
            <span class="cls_006">nutshell, once we have retrieved the Mongoose data object from a query, we can use</span>
        </div>
        <div style="position:absolute;left:108.00px;top:216.08px" class="cls_006">
            <span class="cls_006">the </span>
            <span class="cls_007">res.json()</span>
            <span class="cls_006"> method of Express to return this response as JSON, instead of being</span>
        </div>
        <div style="position:absolute;left:108.00px;top:228.68px" class="cls_006">
            <span class="cls_006">rendered as an HTML file through a templating engine.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.93px" class="cls_006">
            <span class="cls_006">Let's put together a useful example for this. On the user profile page we really want</span>
        </div>
        <div style="position:absolute;left:108.00px;top:262.53px" class="cls_006">
            <span class="cls_006">to have a list of projects that the logged in user has created. We are going to make</span>
        </div>
        <div style="position:absolute;left:108.00px;top:275.13px" class="cls_006">
            <span class="cls_006">this happen with an AJAX call.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:303.22px" class="cls_013">
            <span class="cls_013">Creating a new static find method</span>
        </div>
        <div style="position:absolute;left:108.00px;top:324.20px" class="cls_006">
            <span class="cls_006">A neat feature of Mongoose is the ability to define your own static methods to suit</span>
        </div>
        <div style="position:absolute;left:108.00px;top:336.80px" class="cls_006">
            <span class="cls_006">your needs. You do this </span>
            <span class="cls_021">after</span>
            <span class="cls_006"> the schema is declared, but </span>
            <span class="cls_021">before</span>
            <span class="cls_006"> the model is compiled.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:349.40px" class="cls_006">
            <span class="cls_006">After the model is compiled, you will be able to use your new static method in the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:362.00px" class="cls_006">
            <span class="cls_006">same way that you use the pre-built methods.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:383.25px" class="cls_006">
            <span class="cls_006">Let's use a real example that we need for our code to see how this works. In our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:395.84px" class="cls_007">
            <span class="cls_007">projectSchema</span>
            <span class="cls_006"> we store the </span>
            <span class="cls_007">_id</span>
            <span class="cls_006"> of the user who created it as </span>
            <span class="cls_007">createdBy</span>
            <span class="cls_006">. We want</span>
        </div>
        <div style="position:absolute;left:108.00px;top:408.44px" class="cls_006">
            <span class="cls_006">to do a </span>
            <span class="cls_007">find()</span>
            <span class="cls_006"> operation on this to return an array of instances.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:429.68px" class="cls_006">
            <span class="cls_006">So, here's how we define a static method by adding it to the </span>
            <span class="cls_007">statics</span>
            <span class="cls_006"> collection of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:442.28px" class="cls_006">
            <span class="cls_006">schema. Add this static method to </span>
            <span class="cls_007">model/db.js</span>
            <span class="cls_006">, again </span>
            <span class="cls_021">after</span>
            <span class="cls_006"> the schema is declared,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:454.88px" class="cls_006">
            <span class="cls_006">but </span>
            <span class="cls_021">before</span>
            <span class="cls_006"> the model is compiled.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:475.82px" class="cls_023">
            <span class="cls_023">projectSchema.statics.findByUserID = function (userid, callback) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:488.06px" class="cls_023">
            <span class="cls_023">this.find(</span>
        </div>
        <div style="position:absolute;left:147.60px;top:500.30px" class="cls_023">
            <span class="cls_023">{ createdBy: userid },</span>
        </div>
        <div style="position:absolute;left:147.60px;top:512.54px" class="cls_023">
            <span class="cls_023">'_id projectName',</span>
        </div>
        <div style="position:absolute;left:147.60px;top:524.78px" class="cls_023">
            <span class="cls_023">{sort: 'modifiedOn'}</span>
        </div>
        <div style="position:absolute;left:147.60px;top:537.02px" class="cls_023">
            <span class="cls_023">callback);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:549.26px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:569.00px" class="cls_006">
            <span class="cls_006">This creates a new model method for us, so that we will now be able to call </span>
            <span class="cls_007">Model.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:581.60px" class="cls_007">
            <span class="cls_007">findByUserID(userid,callback)</span>
            <span class="cls_006"> in the same way that we called </span>
            <span class="cls_007">Model.findOne</span>
        </div>
        <div style="position:absolute;left:108.00px;top:594.20px" class="cls_006">
            <span class="cls_006">when creating the login functionality earlier.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 74 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:69774px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background088.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 6</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">Inside our method we are calling the </span>
            <span class="cls_007">Model.find</span>
            <span class="cls_006"> method, passing it four</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">parameters:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.34px" class="cls_006">
            <span class="cls_006">• Query object</span>
        </div>
        <div style="position:absolute;left:126.00px;top:165.25px" class="cls_006">
            <span class="cls_006">• Items to select and return</span>
        </div>
        <div style="position:absolute;left:126.00px;top:182.17px" class="cls_006">
            <span class="cls_006">• Options (in this case a sort order)</span>
        </div>
        <div style="position:absolute;left:126.00px;top:199.08px" class="cls_006">
            <span class="cls_006">• A callback function</span>
        </div>
        <div style="position:absolute;left:107.99px;top:220.32px" class="cls_006">
            <span class="cls_006">All being well, this will return an array of Project instances that were created by a</span>
        </div>
        <div style="position:absolute;left:107.99px;top:232.92px" class="cls_006">
            <span class="cls_006">single user. This will look something like the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:253.87px" class="cls_023">
            <span class="cls_023">[ { _id: 51412597e8e6d3e35c000001, projectName: 'First project' },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:266.11px" class="cls_023">
            <span class="cls_023">{ projectName: 'Another test', _id: 515c6b47596acf8e35000001 },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:278.35px" class="cls_023">
            <span class="cls_023">{ projectName: 'Project 3', _id: 517d2592ebc5782c6a000001 } ]</span>
        </div>
        <div style="position:absolute;left:108.00px;top:304.95px" class="cls_013">
            <span class="cls_013">Setting up the route</span>
        </div>
        <div style="position:absolute;left:108.00px;top:325.93px" class="cls_006">
            <span class="cls_006">Now that we have the needed method in place, we need to set up the routing and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:338.53px" class="cls_006">
            <span class="cls_006">controller, so that we can use a URL to call it. First off, let's add the route to </span>
            <span class="cls_007">app.js</span>
        </div>
        <div style="position:absolute;left:108.00px;top:351.13px" class="cls_006">
            <span class="cls_006">to define the URL.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:372.07px" class="cls_023">
            <span class="cls_023">app.get('/project/byuser/:userid', project.byUser);</span>
        </div>
        <div style="position:absolute;left:417.60px;top:372.07px" class="cls_023">
            <span class="cls_023">// Projects</span>
        </div>
        <div style="position:absolute;left:374.40px;top:382.87px" class="cls_023">
            <span class="cls_023">//created by a user</span>
        </div>
        <div style="position:absolute;left:108.00px;top:402.61px" class="cls_006">
            <span class="cls_006">Now we can set the controller up in </span>
            <span class="cls_007">routes/project.js</span>
            <span class="cls_006">. We want this new</span>
        </div>
        <div style="position:absolute;left:108.01px;top:415.21px" class="cls_006">
            <span class="cls_006">controller to do the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:436.45px" class="cls_006">
            <span class="cls_006">1. Check that a </span>
            <span class="cls_007">userid</span>
            <span class="cls_006"> has been sent.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:453.37px" class="cls_006">
            <span class="cls_006">2. Call our </span>
            <span class="cls_007">findByUserID</span>
            <span class="cls_006"> method, passing it the </span>
            <span class="cls_007">userid</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:470.29px" class="cls_006">
            <span class="cls_006">3. Pass a callback to output the returned data set as JSON.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:491.53px" class="cls_006">
            <span class="cls_006">We will also error trap and console log along the way, so that we can keep track of</span>
        </div>
        <div style="position:absolute;left:107.99px;top:504.13px" class="cls_006">
            <span class="cls_006">what is going on. So, add the following to </span>
            <span class="cls_007">routes/projects.js</span>
            <span class="cls_006"> and we'll take a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:516.73px" class="cls_006">
            <span class="cls_006">look at what's going on:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:537.67px" class="cls_023">
            <span class="cls_023">// GET Projects by UserID</span>
        </div>
        <div style="position:absolute;left:126.00px;top:549.91px" class="cls_023">
            <span class="cls_023">exports.byUser = function (req, res) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:562.15px" class="cls_023">
            <span class="cls_023">console.log("Getting user projects");</span>
        </div>
        <div style="position:absolute;left:136.80px;top:574.39px" class="cls_023">
            <span class="cls_023">if (req.params.userid){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:586.63px" class="cls_023">
            <span class="cls_023">Project.findByUserID(</span>
        </div>
        <div style="position:absolute;left:158.40px;top:598.87px" class="cls_023">
            <span class="cls_023">req.params.userid,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:611.11px" class="cls_023">
            <span class="cls_023">function (err, projects) {</span>
        </div>
        <div style="position:absolute;left:169.20px;top:623.35px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:180.00px;top:635.59px" class="cls_023">
            <span class="cls_023">console.log(projects);</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 75 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:70576px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background089.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Reading, Querying, and Finding</span>
        </div>
        <div style="position:absolute;left:180.00px;top:114.01px" class="cls_023">
            <span class="cls_023">res.json(projects);</span>
        </div>
        <div style="position:absolute;left:169.20px;top:126.25px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:180.00px;top:138.49px" class="cls_023">
            <span class="cls_023">console.log(err);</span>
        </div>
        <div style="position:absolute;left:180.00px;top:150.73px" class="cls_023">
            <span class="cls_023">res.json({"status":"error", "error":"Error finding</span>
        </div>
        <div style="position:absolute;left:126.00px;top:161.53px" class="cls_023">
            <span class="cls_023">projects"});</span>
        </div>
        <div style="position:absolute;left:169.20px;top:173.77px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:147.60px;top:186.01px" class="cls_023">
            <span class="cls_023">})</span>
        </div>
        <div style="position:absolute;left:136.80px;top:198.25px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:147.60px;top:210.49px" class="cls_023">
            <span class="cls_023">console.log("No user id supplied");</span>
        </div>
        <div style="position:absolute;left:147.60px;top:222.73px" class="cls_023">
            <span class="cls_023">res.json({"status":"error", "error":"No user id supplied"});</span>
        </div>
        <div style="position:absolute;left:136.80px;top:234.97px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:247.21px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:266.94px" class="cls_006">
            <span class="cls_006">The error trapping and logging to the console makes this piece of code look longer</span>
        </div>
        <div style="position:absolute;left:108.00px;top:279.54px" class="cls_006">
            <span class="cls_006">than it is. The real trick on this one is using </span>
            <span class="cls_007">res.json</span>
            <span class="cls_006"> to return the output as JSON,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:292.14px" class="cls_006">
            <span class="cls_006">instead of rendering HTML.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:320.24px" class="cls_013">
            <span class="cls_013">Updating the view</span>
        </div>
        <div style="position:absolute;left:108.00px;top:341.22px" class="cls_006">
            <span class="cls_006">We're going to be lazy now and use jQuery to manage our AJAX call and HTML</span>
        </div>
        <div style="position:absolute;left:108.00px;top:353.82px" class="cls_006">
            <span class="cls_006">injection. In the head section of </span>
            <span class="cls_007">views/layout.jade</span>
            <span class="cls_006">, add jQuery and support for</span>
        </div>
        <div style="position:absolute;left:108.00px;top:366.42px" class="cls_006">
            <span class="cls_006">an inline JavaScript block that we'll call </span>
            <span class="cls_007">headjs</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:387.36px" class="cls_023">
            <span class="cls_023">script(src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:398.16px" class="cls_023">
            <span class="cls_023">js")</span>
        </div>
        <div style="position:absolute;left:126.00px;top:410.40px" class="cls_023">
            <span class="cls_023">block headjs</span>
        </div>
        <div style="position:absolute;left:108.00px;top:430.14px" class="cls_006">
            <span class="cls_006">Next update </span>
            <span class="cls_007">views/user-page.jade</span>
            <span class="cls_006"> to use this new </span>
            <span class="cls_007">headjs</span>
            <span class="cls_006"> section. We need to</span>
        </div>
        <div style="position:absolute;left:107.99px;top:442.74px" class="cls_006">
            <span class="cls_006">take the user ID passed to the page and turn it into a JavaScript variable. We'll put</span>
        </div>
        <div style="position:absolute;left:107.99px;top:455.34px" class="cls_006">
            <span class="cls_006">the rest of our JavaScript in an external file so that it can be cached. Here's how to</span>
        </div>
        <div style="position:absolute;left:107.99px;top:467.94px" class="cls_006">
            <span class="cls_006">do it:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:488.88px" class="cls_023">
            <span class="cls_023">block headjs</span>
        </div>
        <div style="position:absolute;left:136.80px;top:501.12px" class="cls_023">
            <span class="cls_023">script()</span>
        </div>
        <div style="position:absolute;left:147.60px;top:513.36px" class="cls_023">
            <span class="cls_023">var userID = "#{userID}";</span>
        </div>
        <div style="position:absolute;left:136.80px;top:525.60px" class="cls_023">
            <span class="cls_023">script(src="/javascripts/user.js")</span>
        </div>
        <div style="position:absolute;left:108.00px;top:545.34px" class="cls_006">
            <span class="cls_006">Finally, we'll add an additional piece of HTML into which we will inject the list</span>
        </div>
        <div style="position:absolute;left:108.00px;top:557.94px" class="cls_006">
            <span class="cls_006">of projects:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:578.88px" class="cls_023">
            <span class="cls_023">h3 My projects</span>
        </div>
        <div style="position:absolute;left:126.00px;top:591.12px" class="cls_023">
            <span class="cls_023">ul#myprojects</span>
        </div>
        <div style="position:absolute;left:136.80px;top:603.36px" class="cls_023">
            <span class="cls_023">li loading...</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 76 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:71378px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background090.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 6</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Building the AJAX call</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">Okay, we're nearly there. We just need to create the jQuery AJAX call to tie it</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">all together.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:167.83px" class="cls_006">
            <span class="cls_006">Create a new text file </span>
            <span class="cls_007">user.js</span>
            <span class="cls_006"> in </span>
            <span class="cls_007">public/javascripts/</span>
            <span class="cls_006"> with the following content:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:188.77px" class="cls_023">
            <span class="cls_023">$(document).ready(function(){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:201.01px" class="cls_023">
            <span class="cls_023">var strHTMLOutput = '';</span>
        </div>
        <div style="position:absolute;left:136.80px;top:213.25px" class="cls_023">
            <span class="cls_023">$.ajax('/project/byuser/' + userID, {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:225.49px" class="cls_023">
            <span class="cls_023">dataType: 'json',</span>
        </div>
        <div style="position:absolute;left:147.60px;top:237.73px" class="cls_023">
            <span class="cls_023">error: function(){</span>
        </div>
        <div style="position:absolute;left:158.40px;top:249.97px" class="cls_023">
            <span class="cls_023">console.log("ajax error :(");</span>
        </div>
        <div style="position:absolute;left:147.60px;top:262.21px" class="cls_023">
            <span class="cls_023">},</span>
        </div>
        <div style="position:absolute;left:147.60px;top:274.45px" class="cls_023">
            <span class="cls_023">success: function (data) {</span>
        </div>
        <div style="position:absolute;left:158.40px;top:286.69px" class="cls_023">
            <span class="cls_023">if (data.length > 0) {</span>
        </div>
        <div style="position:absolute;left:169.20px;top:298.93px" class="cls_023">
            <span class="cls_023">if (data.status && data.status === 'error'){</span>
        </div>
        <div style="position:absolute;left:180.00px;top:311.17px" class="cls_023">
            <span class="cls_023">strHTMLOutput = "&lt;li>Error: " + data.error + "&lt;/li>";</span>
        </div>
        <div style="position:absolute;left:169.20px;top:323.41px" class="cls_023">
            <span class="cls_023">} else {</span>
        </div>
        <div style="position:absolute;left:180.00px;top:335.65px" class="cls_023">
            <span class="cls_023">var intItem,</span>
        </div>
        <div style="position:absolute;left:201.60px;top:347.89px" class="cls_023">
            <span class="cls_023">totalItems = data.length,</span>
        </div>
        <div style="position:absolute;left:201.60px;top:360.13px" class="cls_023">
            <span class="cls_023">arrLI = [];</span>
        </div>
        <div style="position:absolute;left:180.00px;top:372.37px" class="cls_023">
            <span class="cls_023">for (intItem = totalItems - 1; intItem >= 0; intItem--) {</span>
        </div>
        <div style="position:absolute;left:190.80px;top:384.61px" class="cls_023">
            <span class="cls_023">arrLI.push('&lt;a href="/project/' + data[intItem]._id + '">'</span>
        </div>
        <div style="position:absolute;left:126.00px;top:395.41px" class="cls_023">
            <span class="cls_023">+ data[intItem].projectName + "&lt;/a>");</span>
        </div>
        <div style="position:absolute;left:180.00px;top:407.65px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:180.00px;top:419.89px" class="cls_023">
            <span class="cls_023">strHTMLOutput = "&lt;li>" + arrLI.join('&lt;/li>&lt;li>') + "&lt;/li>";</span>
        </div>
        <div style="position:absolute;left:169.20px;top:432.13px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:158.40px;top:444.37px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:169.20px;top:456.61px" class="cls_023">
            <span class="cls_023">strHTMLOutput = "&lt;li>You haven't created any projects yet&lt;/</span>
        </div>
        <div style="position:absolute;left:126.00px;top:467.41px" class="cls_023">
            <span class="cls_023">li>";</span>
        </div>
        <div style="position:absolute;left:158.40px;top:479.65px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:158.40px;top:491.89px" class="cls_023">
            <span class="cls_023">$('#myprojects').html(strHTMLOutput);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:504.13px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:516.37px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:528.61px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:548.35px" class="cls_006">
            <span class="cls_006">I won't break down the finer points of a jQuery AJAX call, but what we've just</span>
        </div>
        <div style="position:absolute;left:108.00px;top:560.95px" class="cls_006">
            <span class="cls_006">done is:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:582.19px" class="cls_006">
            <span class="cls_006">• Waited until the DOM has loaded</span>
        </div>
        <div style="position:absolute;left:126.00px;top:599.11px" class="cls_006">
            <span class="cls_006">• Made an AJAX call to the route </span>
            <span class="cls_007">/project/byuser/</span>
            <span class="cls_006"> adding </span>
            <span class="cls_007">userID</span>
            <span class="cls_006"> to the</span>
        </div>
        <div style="position:absolute;left:144.00px;top:611.71px" class="cls_006">
            <span class="cls_006">end for our export function to use</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 77 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:72180px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background091.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Reading, Querying, and Finding</span>
        </div>
        <div style="position:absolute;left:126.00px;top:114.49px" class="cls_006">
            <span class="cls_006">• If we get a successful response</span>
        </div>
        <div style="position:absolute;left:161.99px;top:135.74px" class="cls_029">
            <span class="cls_029">°</span>
            <span class="cls_006">°</span>
        </div>
        <div style="position:absolute;left:179.99px;top:135.74px" class="cls_006">
            <span class="cls_006">Loop through the array of instances making each one an </span>
            <span class="cls_007">&lt;li></span>
        </div>
        <div style="position:absolute;left:162.00px;top:152.65px" class="cls_029">
            <span class="cls_029">°</span>
            <span class="cls_006">°</span>
        </div>
        <div style="position:absolute;left:180.00px;top:152.65px" class="cls_006">
            <span class="cls_006">Inject the resulting HTML into the page</span>
        </div>
        <div style="position:absolute;left:108.00px;top:180.75px" class="cls_013">
            <span class="cls_013">Try it out!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:201.73px" class="cls_006">
            <span class="cls_006">Restart your app and head over to </span>
            <A HREF="http://localhost:3000/">http://localhost:3000</A>
            </span>
            <span class="cls_006"> in your browser. Either</span>
        </div>
        <div style="position:absolute;left:108.00px;top:214.33px" class="cls_006">
            <span class="cls_006">log in as an existing user, or create a new user and a few projects. On the user profile</span>
        </div>
        <div style="position:absolute;left:108.00px;top:226.93px" class="cls_006">
            <span class="cls_006">page—</span>
            <span class="cls_007">http://localhost:3000/user</span>
            <span class="cls_006">—you should now see a list of projects as</span>
        </div>
        <div style="position:absolute;left:108.00px;top:239.53px" class="cls_006">
            <span class="cls_006">shown in the following screenshot:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:500.78px" class="cls_027">
            <span class="cls_027">findByld() - finding a single project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:523.76px" class="cls_006">
            <span class="cls_006">Something is missing so far, we don't have a page displaying the data for a single</span>
        </div>
        <div style="position:absolute;left:108.00px;top:536.36px" class="cls_006">
            <span class="cls_006">project. Let's add that and take a look at the </span>
            <span class="cls_007">model.findById</span>
            <span class="cls_006"> method as we go.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:564.46px" class="cls_013">
            <span class="cls_013">Route setup</span>
        </div>
        <div style="position:absolute;left:108.00px;top:585.44px" class="cls_006">
            <span class="cls_006">To work with a URL like the following:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:606.48px" class="cls_007">
            <span class="cls_007"> </span>
            <A HREF="http://localhost:3000/project/5182067c9756e3036c000003/">http://localhost:3000/project/5182067c9756e3036c000003</A>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 78 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:72982px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background092.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 6</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">This is the route we need to use:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">app.get('/project/:id', project.displayInfo);</span>
        </div>
        <div style="position:absolute;left:401.40px;top:135.43px" class="cls_023">
            <span class="cls_023">// Display</span>
        </div>
        <div style="position:absolute;left:379.80px;top:146.23px" class="cls_023">
            <span class="cls_023">//project info</span>
        </div>
        <div style="position:absolute;left:108.00px;top:165.97px" class="cls_006">
            <span class="cls_006">So we need to add some code to </span>
            <span class="cls_007">routes/project.js</span>
            <span class="cls_006">. We're doing a quick</span>
        </div>
        <div style="position:absolute;left:108.00px;top:178.57px" class="cls_006">
            <span class="cls_006">authentication check here, but only at a development environment level. We are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:191.17px" class="cls_006">
            <span class="cls_006">only checking to see if a user is logged in, not that they have specific permissions</span>
        </div>
        <div style="position:absolute;left:108.00px;top:203.77px" class="cls_006">
            <span class="cls_006">to access this project. After that, assuming the </span>
            <span class="cls_007">id</span>
            <span class="cls_006"> field has been passed as a URL</span>
        </div>
        <div style="position:absolute;left:108.01px;top:216.37px" class="cls_006">
            <span class="cls_006">parameter, we will use the </span>
            <span class="cls_007">Project.findById</span>
            <span class="cls_006"> method to—well—find the project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:228.97px" class="cls_006">
            <span class="cls_006">by ID!</span>
        </div>
        <div style="position:absolute;left:126.00px;top:249.91px" class="cls_023">
            <span class="cls_023">// GET project info</span>
        </div>
        <div style="position:absolute;left:126.00px;top:262.15px" class="cls_023">
            <span class="cls_023">exports.displayInfo = function(req, res) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:274.39px" class="cls_023">
            <span class="cls_023">console.log("Finding project _id: " + req.params.id);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:286.63px" class="cls_023">
            <span class="cls_023">if (req.session.loggedin !== "true"){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:298.87px" class="cls_023">
            <span class="cls_023">res.redirect('/login');</span>
        </div>
        <div style="position:absolute;left:136.80px;top:311.11px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:323.35px" class="cls_023">
            <span class="cls_023">else {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:335.59px" class="cls_023">
            <span class="cls_023">if (req.params.id) {</span>
        </div>
        <div style="position:absolute;left:158.40px;top:347.83px" class="cls_023">
            <span class="cls_023">Project.findById( req.params.id, function(err,project) {</span>
        </div>
        <div style="position:absolute;left:169.20px;top:360.07px" class="cls_023">
            <span class="cls_023">if(err){</span>
        </div>
        <div style="position:absolute;left:180.00px;top:372.31px" class="cls_023">
            <span class="cls_023">console.log(err);</span>
        </div>
        <div style="position:absolute;left:180.00px;top:384.55px" class="cls_023">
            <span class="cls_023">res.redirect('/user?404=project');</span>
        </div>
        <div style="position:absolute;left:169.20px;top:396.79px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:180.00px;top:409.03px" class="cls_023">
            <span class="cls_023">console.log(project);</span>
        </div>
        <div style="position:absolute;left:180.00px;top:421.27px" class="cls_023">
            <span class="cls_023">res.render('project-page', {</span>
        </div>
        <div style="position:absolute;left:190.80px;top:433.51px" class="cls_023">
            <span class="cls_023">title: project.projectName,</span>
        </div>
        <div style="position:absolute;left:190.80px;top:445.75px" class="cls_023">
            <span class="cls_023">projectName: project.projectName,</span>
        </div>
        <div style="position:absolute;left:190.80px;top:457.99px" class="cls_023">
            <span class="cls_023">tasks: project.tasks,</span>
        </div>
        <div style="position:absolute;left:190.80px;top:470.23px" class="cls_023">
            <span class="cls_023">createdBy: project.createdBy,</span>
        </div>
        <div style="position:absolute;left:190.80px;top:482.47px" class="cls_023">
            <span class="cls_023">projectID: req.params.id</span>
        </div>
        <div style="position:absolute;left:180.00px;top:494.71px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:169.20px;top:506.95px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:158.40px;top:519.19px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:147.60px;top:531.43px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:158.40px;top:543.67px" class="cls_023">
            <span class="cls_023">res.redirect('/user');</span>
        </div>
        <div style="position:absolute;left:147.60px;top:555.91px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:568.15px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:580.39px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:600.13px" class="cls_006">
            <span class="cls_006">As you can see, ignoring the console logs and error traps, we are sending two</span>
        </div>
        <div style="position:absolute;left:108.00px;top:612.73px" class="cls_006">
            <span class="cls_006">parameters to our new static </span>
            <span class="cls_007">Project.findById</span>
            <span class="cls_006"> method. We're passing it the </span>
            <span class="cls_007">_id</span>
        </div>
        <div style="position:absolute;left:108.00px;top:625.33px" class="cls_006">
            <span class="cls_006">of the project that we have parsed from the URL parameters, and a callback function</span>
        </div>
        <div style="position:absolute;left:108.00px;top:637.93px" class="cls_006">
            <span class="cls_006">whose main purpose is to send the project details to the view.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 79 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:73784px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background093.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Reading, Querying, and Finding</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Creating the view</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">The view itself will be quite simple for now. We just need the following content in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">the </span>
            <span class="cls_007">block content</span>
            <span class="cls_006"> section of a new view </span>
            <span class="cls_007">views/project-page.jade</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:136.80px;top:167.53px" class="cls_023">
            <span class="cls_023">h1 Mongoose Project Management</span>
        </div>
        <div style="position:absolute;left:136.80px;top:179.77px" class="cls_023">
            <span class="cls_023">h2= projectName</span>
        </div>
        <div style="position:absolute;left:136.80px;top:192.01px" class="cls_023">
            <span class="cls_023">p Created by: #{createdBy}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:204.25px" class="cls_023">
            <span class="cls_023">p Tasks: !{escape(tasks).replace(/\n/g, '&lt;br/>')}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:223.99px" class="cls_006">
            <span class="cls_006">The last line in the code is just a way of substituting line breaks in the list of tasks</span>
        </div>
        <div style="position:absolute;left:108.00px;top:236.59px" class="cls_006">
            <span class="cls_006">with </span>
            <span class="cls_007">&lt;br /></span>
            <span class="cls_006"> tags.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:269.09px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:294.07px" class="cls_006">
            <span class="cls_006">In this chapter, we have learned how to query MongoDB through Mongoose by</span>
        </div>
        <div style="position:absolute;left:108.00px;top:306.67px" class="cls_006">
            <span class="cls_006">returning single instances and arrays of instances. We have seen how to run quick</span>
        </div>
        <div style="position:absolute;left:108.00px;top:319.27px" class="cls_006">
            <span class="cls_006">single command operations and also how to build more complex queries.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:340.51px" class="cls_006">
            <span class="cls_006">We have added a number of different approaches to our MongoosePM project,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:353.11px" class="cls_006">
            <span class="cls_006">which includes returning JSON directly to an AJAX request. On top of all of this we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:365.71px" class="cls_006">
            <span class="cls_006">have used the ability of Mongoose to create custom static methods to make it easy to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:378.31px" class="cls_006">
            <span class="cls_006">get exactly what we want.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:399.55px" class="cls_006">
            <span class="cls_006">In the next chapter, we are going to take a look at updating data, so that we can</span>
        </div>
        <div style="position:absolute;left:108.00px;top:412.15px" class="cls_006">
            <span class="cls_006">allow users to change their profiles and projects.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 80 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:74586px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background094.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:302.23px;top:218.71px" class="cls_015">
            <span class="cls_015">Interacting with</span>
        </div>
        <div style="position:absolute;left:287.20px;top:254.71px" class="cls_015">
            <span class="cls_015">Data - Updating</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.41px" class="cls_006">
            <span class="cls_006">In the previous chapter, we've seen how to put data in and read it back out. It's</span>
        </div>
        <div style="position:absolute;left:108.00px;top:321.01px" class="cls_006">
            <span class="cls_006">time to see how to change the existing data. In this chapter, we will look at the three</span>
        </div>
        <div style="position:absolute;left:108.00px;top:333.61px" class="cls_006">
            <span class="cls_006">built-in static model methods that help us update in one command, and the instance</span>
        </div>
        <div style="position:absolute;left:108.00px;top:346.21px" class="cls_006">
            <span class="cls_006">method we can use to save a document following a find operation.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:367.46px" class="cls_006">
            <span class="cls_006">By the end of this chapter, you will have a good understanding of how to use the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:380.06px" class="cls_006">
            <span class="cls_006">different approaches, and which one is appropriate to different scenarios. You will</span>
        </div>
        <div style="position:absolute;left:108.00px;top:392.66px" class="cls_006">
            <span class="cls_006">also have added the ability to make edits to the logged in user, update a project's</span>
        </div>
        <div style="position:absolute;left:108.00px;top:405.26px" class="cls_006">
            <span class="cls_006">information, and log the last time a user logged in.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:437.75px" class="cls_022">
            <span class="cls_022">Model helper methods</span>
        </div>
        <div style="position:absolute;left:108.00px;top:462.73px" class="cls_006">
            <span class="cls_006">There are three static methods for updating data in a single go:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:483.97px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> update()</span>
            <span class="cls_006">: This method updates matching documents in the database</span>
        </div>
        <div style="position:absolute;left:144.00px;top:496.57px" class="cls_006">
            <span class="cls_006">without returning them</span>
        </div>
        <div style="position:absolute;left:126.00px;top:513.49px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> findOneAndUpdate()</span>
            <span class="cls_006">: This method has the same approach as </span>
            <span class="cls_007">findOne</span>
            <span class="cls_006"> that</span>
        </div>
        <div style="position:absolute;left:144.00px;top:526.09px" class="cls_006">
            <span class="cls_006">we looked at earlier, but writes the updates to the database before returning</span>
        </div>
        <div style="position:absolute;left:144.00px;top:538.69px" class="cls_006">
            <span class="cls_006">the found instance to the callback</span>
        </div>
        <div style="position:absolute;left:126.00px;top:555.61px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> findByIdAndUpdate()</span>
            <span class="cls_006">: This method is the same as </span>
            <span class="cls_007">findOneAndUpdate</span>
            <span class="cls_006">, but</span>
        </div>
        <div style="position:absolute;left:144.00px;top:568.21px" class="cls_006">
            <span class="cls_006">expects a unique ID instead of query object</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:75388px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background095.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Updating</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Building the commands</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">Each of these methods can take the following four arguments:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:156.68px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> conditions</span>
            <span class="cls_006">: These are the query conditions (or </span>
            <span class="cls_007">_id</span>
            <span class="cls_006"> for </span>
            <span class="cls_007">findByIdAndUpdate</span>
            <span class="cls_006">)</span>
        </div>
        <div style="position:absolute;left:144.00px;top:169.28px" class="cls_006">
            <span class="cls_006">used to find documents to update</span>
        </div>
        <div style="position:absolute;left:126.00px;top:186.20px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> update</span>
            <span class="cls_006">: This is an object containing the fields and values to set</span>
        </div>
        <div style="position:absolute;left:126.00px;top:203.12px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> options</span>
            <span class="cls_006">: This is an object specifying options for this operation (see more</span>
        </div>
        <div style="position:absolute;left:144.00px;top:215.72px" class="cls_006">
            <span class="cls_006">details about this in just a moment)</span>
        </div>
        <div style="position:absolute;left:126.00px;top:232.64px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> callback</span>
            <span class="cls_006">: This is the function to run after a successful operation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:253.89px" class="cls_006">
            <span class="cls_006">The options differ depending on the call made. The update() method has one set of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:266.49px" class="cls_006">
            <span class="cls_006">options you can set, and the find methods share another set of options.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:287.72px" class="cls_006">
            <span class="cls_006">The</span>
            <span class="cls_007"> update()</span>
            <span class="cls_006"> options are as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:308.96px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> safe</span>
            <span class="cls_006">: Specifies whether errors should be returned to the callbacks. Can be</span>
        </div>
        <div style="position:absolute;left:144.00px;top:321.56px" class="cls_006">
            <span class="cls_006">true or false, the default value is the value set in the schema, if this was not</span>
        </div>
        <div style="position:absolute;left:144.00px;top:334.16px" class="cls_006">
            <span class="cls_006">explicitly set in the schema it defaults to true.</span>
        </div>
        <div style="position:absolute;left:126.01px;top:351.08px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> upsert</span>
            <span class="cls_006">: Specifies whether to create the document if no matching document</span>
        </div>
        <div style="position:absolute;left:144.00px;top:363.68px" class="cls_006">
            <span class="cls_006">exists. Can be true or false, the default value is false.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:380.60px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> multi</span>
            <span class="cls_006">: Specifies whether multiple documents should be updated. Can be</span>
        </div>
        <div style="position:absolute;left:144.00px;top:393.20px" class="cls_006">
            <span class="cls_006">true or false, the default value is false.</span>
        </div>
        <div style="position:absolute;left:126.01px;top:410.12px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> strict</span>
            <span class="cls_006">: Specifies whether only data defined in the schema will be saved,</span>
        </div>
        <div style="position:absolute;left:144.00px;top:422.72px" class="cls_006">
            <span class="cls_006">regardless of whether anything additional was passed to the model</span>
        </div>
        <div style="position:absolute;left:144.00px;top:435.32px" class="cls_006">
            <span class="cls_006">constructor. Can be true or false, the default value is true.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:456.56px" class="cls_006">
            <span class="cls_006">The options for the </span>
            <span class="cls_007">findByIdAndUpdate()</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">findOneAndUpdate()</span>
            <span class="cls_006"> methods are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:469.16px" class="cls_006">
            <span class="cls_006">as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:490.40px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> new</span>
            <span class="cls_006">: Specifies whether to return the modified document rather than the</span>
        </div>
        <div style="position:absolute;left:144.00px;top:503.00px" class="cls_006">
            <span class="cls_006">original. Can be true or false, the default value is true.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:519.92px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> upsert</span>
            <span class="cls_006">: Specifies whether to create the document if it doesn't exist. Can be</span>
        </div>
        <div style="position:absolute;left:144.00px;top:532.52px" class="cls_006">
            <span class="cls_006">true or false, the default value is false.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:549.44px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> sort</span>
            <span class="cls_006">: If some documents are found, sets the sort order to choose which one</span>
        </div>
        <div style="position:absolute;left:144.00px;top:562.04px" class="cls_006">
            <span class="cls_006">to update. This should be a JavaScript object.</span>
        </div>
        <div style="position:absolute;left:126.01px;top:578.96px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> select</span>
            <span class="cls_006">: This sets the document fields to return. This is specified as a string.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 82 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:76190px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background096.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 7</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Which method to choose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">My main rule of thumb is to only use </span>
            <span class="cls_007">update()</span>
            <span class="cls_006"> when intentionally updating</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">multiple documents. Remember to set </span>
            <span class="cls_007">multi</span>
            <span class="cls_006"> to </span>
            <span class="cls_007">true</span>
            <span class="cls_006"> in the options if you want</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">to update multiple documents in one operation. Although in some cases you may</span>
        </div>
        <div style="position:absolute;left:108.00px;top:173.24px" class="cls_006">
            <span class="cls_006">decide to use it for updating a single document when you don't need to use a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:185.84px" class="cls_006">
            <span class="cls_006">return object.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:207.08px" class="cls_006">
            <span class="cls_006">If you are going to use the data after updating, I recommend using one of the </span>
            <span class="cls_007">find</span>
        </div>
        <div style="position:absolute;left:108.00px;top:219.68px" class="cls_006">
            <span class="cls_006">methods. This will ensure that what you're using in your application is exactly what</span>
        </div>
        <div style="position:absolute;left:108.00px;top:232.28px" class="cls_006">
            <span class="cls_006">is in the database, so any problems can be quickly identified.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:262.22px" class="cls_027">
            <span class="cls_027">The catch</span>
        </div>
        <div style="position:absolute;left:108.00px;top:285.20px" class="cls_006">
            <span class="cls_006">All three of these methods offer a fantastically quick way of doing things. But there</span>
        </div>
        <div style="position:absolute;left:108.00px;top:297.80px" class="cls_006">
            <span class="cls_006">is a catch. Any default values, validation, middleware, or setters applied to your</span>
        </div>
        <div style="position:absolute;left:108.00px;top:310.40px" class="cls_006">
            <span class="cls_006">schema will </span>
            <span class="cls_021">not</span>
            <span class="cls_006"> be applied.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.65px" class="cls_006">
            <span class="cls_006">So, whenever you want to use any of these things, you'll have to go back to a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.25px" class="cls_006">
            <span class="cls_006">standard practice of find document, modify the data, and then save it.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:376.74px" class="cls_022">
            <span class="cls_022">The three-step find-edit-save approach</span>
        </div>
        <div style="position:absolute;left:108.00px;top:401.72px" class="cls_006">
            <span class="cls_006">This approach requires a few more steps and a bit more code than the helper</span>
        </div>
        <div style="position:absolute;left:108.00px;top:414.32px" class="cls_006">
            <span class="cls_006">methods but is more fully featured. The </span>
            <span class="cls_007">save()</span>
            <span class="cls_006"> command accepts only one</span>
        </div>
        <div style="position:absolute;left:108.00px;top:426.92px" class="cls_006">
            <span class="cls_006">parameter, a callback function to run once the save has completed. This callback</span>
        </div>
        <div style="position:absolute;left:108.00px;top:439.52px" class="cls_006">
            <span class="cls_006">function can pass an error or return the saved object. Look at the following example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:460.46px" class="cls_023">
            <span class="cls_023">// 1: FIND the record</span>
        </div>
        <div style="position:absolute;left:126.00px;top:472.70px" class="cls_023">
            <span class="cls_023">User.findOne(</span>
        </div>
        <div style="position:absolute;left:136.80px;top:484.94px" class="cls_023">
            <span class="cls_023">{email : 'simon@theholmesoffice.com'},</span>
        </div>
        <div style="position:absolute;left:136.80px;top:497.18px" class="cls_023">
            <span class="cls_023">function(err, user) {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:509.42px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:158.40px;top:521.66px" class="cls_023">
            <span class="cls_023">// 2: EDIT the record</span>
        </div>
        <div style="position:absolute;left:158.40px;top:533.90px" class="cls_023">
            <span class="cls_023">user.name = "Simon";</span>
        </div>
        <div style="position:absolute;left:158.40px;top:546.14px" class="cls_023">
            <span class="cls_023">// 3: SAVE the record</span>
        </div>
        <div style="position:absolute;left:158.40px;top:558.38px" class="cls_023">
            <span class="cls_023">user.save(function(err,user){</span>
        </div>
        <div style="position:absolute;left:169.20px;top:570.62px" class="cls_023">
            <span class="cls_023">console.log('User saved:', user);</span>
        </div>
        <div style="position:absolute;left:158.40px;top:582.86px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:147.60px;top:595.10px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:607.34px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:126.00px;top:619.58px" class="cls_023">
            <span class="cls_023">);</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 83 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:76992px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background097.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Updating</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">As you can see there is a bit more code required, and there's also an extra callback</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">level. However, the code remains pretty simple to follow. To make it even easier, you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">can also define the callbacks as separate functions. We'll see this later.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:172.19px" class="cls_022">
            <span class="cls_022">CRUD - editing users and projects</span>
        </div>
        <div style="position:absolute;left:108.00px;top:197.17px" class="cls_006">
            <span class="cls_006">While we haven't looked at validation yet, knowing the earlier "catch" will be very</span>
        </div>
        <div style="position:absolute;left:108.00px;top:209.77px" class="cls_006">
            <span class="cls_006">helpful while handling data interactions. We should bear it in mind when building</span>
        </div>
        <div style="position:absolute;left:108.00px;top:222.37px" class="cls_006">
            <span class="cls_006">our form handling actions, and use the correct methods wherever possible so that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:234.97px" class="cls_006">
            <span class="cls_006">we don't have to rewrite them later.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:264.91px" class="cls_027">
            <span class="cls_027">Tracking user login</span>
        </div>
        <div style="position:absolute;left:108.00px;top:287.89px" class="cls_006">
            <span class="cls_006">When a user logs in, we want to update the </span>
            <span class="cls_007">lastLogin</span>
            <span class="cls_006"> date. We don't need any</span>
        </div>
        <div style="position:absolute;left:108.00px;top:300.49px" class="cls_006">
            <span class="cls_006">validation as we are setting the single field ourselves on the server, and we don't</span>
        </div>
        <div style="position:absolute;left:108.00px;top:313.09px" class="cls_006">
            <span class="cls_006">need the object returned from the database. We also know we are going to get the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:325.69px" class="cls_006">
            <span class="cls_006">correct instance as our query object will be for the unique </span>
            <span class="cls_007">_id</span>
            <span class="cls_006"> field, so we can use</span>
        </div>
        <div style="position:absolute;left:108.00px;top:338.29px" class="cls_006">
            <span class="cls_006">the </span>
            <span class="cls_007">update()</span>
            <span class="cls_006"> method.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:359.53px" class="cls_006">
            <span class="cls_006">User login is currently handled by the </span>
            <span class="cls_007">doLogin</span>
            <span class="cls_006"> function in </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">. The</span>
        </div>
        <div style="position:absolute;left:108.00px;top:372.13px" class="cls_006">
            <span class="cls_006">section of the function that handles a successful login looks like the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:393.07px" class="cls_023">
            <span class="cls_023">req.session.user = { "name" : user.name, "email": user.email,</span>
        </div>
        <div style="position:absolute;left:126.00px;top:403.87px" class="cls_023">
            <span class="cls_023">"_id": user._id };</span>
        </div>
        <div style="position:absolute;left:126.00px;top:416.11px" class="cls_023">
            <span class="cls_023">req.session.loggedIn = true;</span>
        </div>
        <div style="position:absolute;left:126.00px;top:428.35px" class="cls_023">
            <span class="cls_023">console.log('Logged in user: ' + user);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:440.59px" class="cls_023">
            <span class="cls_023">res.redirect( '/user' );</span>
        </div>
        <div style="position:absolute;left:108.00px;top:460.33px" class="cls_006">
            <span class="cls_006">So let's update that chunk of code with a new </span>
            <span class="cls_007">update()</span>
            <span class="cls_006"> function to set the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:472.93px" class="cls_007">
            <span class="cls_007">lastLogin</span>
            <span class="cls_006"> in the database:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:493.87px" class="cls_023">
            <span class="cls_023">req.session.user = { "name" : user.name, "email": user.email, "_id":</span>
        </div>
        <div style="position:absolute;left:126.00px;top:504.67px" class="cls_023">
            <span class="cls_023">user._id };</span>
        </div>
        <div style="position:absolute;left:126.00px;top:516.91px" class="cls_023">
            <span class="cls_023">req.session.loggedIn = true;</span>
        </div>
        <div style="position:absolute;left:126.00px;top:529.15px" class="cls_023">
            <span class="cls_023">console.log('Logged in user: ' + user);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:541.39px" class="cls_024">
            <span class="cls_024">User.update(</span>
        </div>
        <div style="position:absolute;left:136.80px;top:553.63px" class="cls_024">
            <span class="cls_024">{_id:user._id},</span>
        </div>
        <div style="position:absolute;left:136.80px;top:565.87px" class="cls_024">
            <span class="cls_024">{ $set: {lastLogin: Date.now()} },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:578.11px" class="cls_024">
            <span class="cls_024">function(){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:590.35px" class="cls_024">
            <span class="cls_024">res.redirect( '/user' );</span>
        </div>
        <div style="position:absolute;left:126.00px;top:602.59px" class="cls_024">
            <span class="cls_024">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:622.33px" class="cls_006">
            <span class="cls_006">Simple, hey? Now when a user logs in we set the </span>
            <span class="cls_007">lastLogin</span>
            <span class="cls_006"> date, but leave</span>
        </div>
        <div style="position:absolute;left:108.01px;top:634.93px" class="cls_006">
            <span class="cls_006">everything else unchanged.</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 84 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:77794px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background098.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 7</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Editing the current user</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">Now we're at the point where it will be useful if a user can edit their profile once</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">they have logged in. So let's set that up.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:176.14px" class="cls_013">
            <span class="cls_013">Routes in use</span>
        </div>
        <div style="position:absolute;left:108.00px;top:197.12px" class="cls_006">
            <span class="cls_006">These are the two routes we'll be using, one to display the form, and the other to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:209.72px" class="cls_006">
            <span class="cls_006">handle the submission of the form:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:230.66px" class="cls_023">
            <span class="cls_023">app.get('/user/edit', user.edit);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:230.66px" class="cls_023">
            <span class="cls_023">// Edit current user form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:242.90px" class="cls_023">
            <span class="cls_023">app.post('/user/edit', user.doEdit);</span>
        </div>
        <div style="position:absolute;left:336.60px;top:242.90px" class="cls_023">
            <span class="cls_023">// Edit current user action</span>
        </div>
        <div style="position:absolute;left:108.00px;top:269.50px" class="cls_013">
            <span class="cls_013">Setting up the form</span>
        </div>
        <div style="position:absolute;left:108.00px;top:290.48px" class="cls_006">
            <span class="cls_006">We already have a user form that is used for signing up. As we're not adding anything</span>
        </div>
        <div style="position:absolute;left:108.00px;top:303.08px" class="cls_006">
            <span class="cls_006">else to a user profile at the moment, it makes sense to re-use. The first thing to do is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:315.68px" class="cls_006">
            <span class="cls_006">modify </span>
            <span class="cls_007">views/user-form.jade</span>
            <span class="cls_006"> to display the </span>
            <span class="cls_007">name</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">email</span>
            <span class="cls_006"> values sent to it from</span>
        </div>
        <div style="position:absolute;left:108.00px;top:328.28px" class="cls_006">
            <span class="cls_006">the controllers.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:349.22px" class="cls_023">
            <span class="cls_023">h1= title</span>
        </div>
        <div style="position:absolute;left:126.00px;top:361.46px" class="cls_023">
            <span class="cls_023">label(for="FullName") Full name</span>
        </div>
        <div style="position:absolute;left:126.00px;top:373.70px" class="cls_023">
            <span class="cls_023">input(type="text", name="FullName", id="FullName"</span>
            <span class="cls_024">, value="#{name}"</span>
            <span class="cls_023">)</span>
        </div>
        <div style="position:absolute;left:126.00px;top:385.94px" class="cls_023">
            <span class="cls_023">label(for="Email") Email</span>
        </div>
        <div style="position:absolute;left:126.00px;top:398.18px" class="cls_023">
            <span class="cls_023">input(type="email", name="Email", id="Email"</span>
            <span class="cls_024">, value="#{email}"</span>
            <span class="cls_023">)</span>
        </div>
        <div style="position:absolute;left:126.00px;top:410.42px" class="cls_023">
            <span class="cls_023">input(type="submit", value="#{buttonText}")</span>
        </div>
        <div style="position:absolute;left:108.00px;top:437.02px" class="cls_013">
            <span class="cls_013">Setting up the controllers</span>
        </div>
        <div style="position:absolute;left:108.00px;top:458.00px" class="cls_006">
            <span class="cls_006">With the change to the jade template earlier, we will have stopped our user signup</span>
        </div>
        <div style="position:absolute;left:108.00px;top:470.60px" class="cls_006">
            <span class="cls_006">form from working, as it is expecting variables that we are not sending. So in the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:483.20px" class="cls_007">
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006"> file, update </span>
            <span class="cls_007">exports.create</span>
            <span class="cls_006"> to send the empty variables:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:504.14px" class="cls_023">
            <span class="cls_023">exports.create = function(req, res){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:516.38px" class="cls_023">
            <span class="cls_023">res.render('user-form', {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:528.62px" class="cls_023">
            <span class="cls_023">title: 'Create user',</span>
        </div>
        <div style="position:absolute;left:147.60px;top:540.86px" class="cls_023">
            <span class="cls_023">name: "",</span>
        </div>
        <div style="position:absolute;left:147.60px;top:553.10px" class="cls_023">
            <span class="cls_023">email: "",</span>
        </div>
        <div style="position:absolute;left:147.60px;top:565.34px" class="cls_023">
            <span class="cls_023">buttonText: "Join!"</span>
        </div>
        <div style="position:absolute;left:131.40px;top:577.58px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:589.82px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 85 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:78596px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background099.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Updating</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">We can use this function as the basis for our user edit form, by adding the following</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">controller into </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.03px" class="cls_023">
            <span class="cls_023">// GET user edit form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:160.27px" class="cls_023">
            <span class="cls_023">exports.edit = function(req, res){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:172.51px" class="cls_023">
            <span class="cls_023">if (req.session.loggedIn !== true){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:184.75px" class="cls_023">
            <span class="cls_023">res.redirect('/login');</span>
        </div>
        <div style="position:absolute;left:136.80px;top:196.99px" class="cls_023">
            <span class="cls_023">}else{</span>
        </div>
        <div style="position:absolute;left:147.60px;top:209.23px" class="cls_023">
            <span class="cls_023">res.render('user-form', {</span>
        </div>
        <div style="position:absolute;left:158.40px;top:221.47px" class="cls_023">
            <span class="cls_023">title: 'Edit profile',</span>
        </div>
        <div style="position:absolute;left:158.40px;top:233.71px" class="cls_023">
            <span class="cls_023">_id: req.session.user._id,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:245.95px" class="cls_023">
            <span class="cls_023">name: req.session.user.name,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:258.19px" class="cls_023">
            <span class="cls_023">email: req.session.user.email,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:270.43px" class="cls_023">
            <span class="cls_023">buttonText: "Save"</span>
        </div>
        <div style="position:absolute;left:147.60px;top:282.67px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:136.80px;top:294.91px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:307.15px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:326.89px" class="cls_006">
            <span class="cls_006">As you can see, here we are passing the current user's name and e-mail address</span>
        </div>
        <div style="position:absolute;left:108.00px;top:339.49px" class="cls_006">
            <span class="cls_006">from the session object to the view.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:367.59px" class="cls_013">
            <span class="cls_013">Committing the edit</span>
        </div>
        <div style="position:absolute;left:108.00px;top:388.57px" class="cls_006">
            <span class="cls_006">Further down the line we will want to add validation to this submission. So we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:401.17px" class="cls_006">
            <span class="cls_006">can't use any of the shorthand helper methods for updating. We need to use the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:413.77px" class="cls_006">
            <span class="cls_006">three-step approach:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:435.02px" class="cls_006">
            <span class="cls_006">1. Find our user by the unique ID held in the session.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:451.93px" class="cls_006">
            <span class="cls_006">2. Change the name and e-mail to the values sent in the form.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:468.85px" class="cls_006">
            <span class="cls_006">3. Save the changes.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:490.09px" class="cls_006">
            <span class="cls_006">In </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">, we need to add the following controller:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:511.03px" class="cls_023">
            <span class="cls_023">// POST user edit form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:523.27px" class="cls_023">
            <span class="cls_023">exports.doEdit = function(req, res) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:535.51px" class="cls_023">
            <span class="cls_023">if (req.session.user._id) {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:547.75px" class="cls_023">
            <span class="cls_023">User.findById( req.session.user._id,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:559.99px" class="cls_023">
            <span class="cls_023">function (err, user) {</span>
        </div>
        <div style="position:absolute;left:169.20px;top:572.23px" class="cls_023">
            <span class="cls_023">if(err){</span>
        </div>
        <div style="position:absolute;left:180.00px;top:584.47px" class="cls_023">
            <span class="cls_023">console.log(err);</span>
        </div>
        <div style="position:absolute;left:180.00px;top:596.71px" class="cls_023">
            <span class="cls_023">res.redirect( '/user?error=finding');</span>
        </div>
        <div style="position:absolute;left:169.20px;top:608.95px" class="cls_023">
            <span class="cls_023">} else {</span>
        </div>
        <div style="position:absolute;left:180.00px;top:621.19px" class="cls_023">
            <span class="cls_023">user.name = req.body.FullName;</span>
        </div>
        <div style="position:absolute;left:180.00px;top:633.43px" class="cls_023">
            <span class="cls_023">user.email = req.body.Email;</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 86 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:79398px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background100.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 7</span>
        </div>
        <div style="position:absolute;left:180.00px;top:114.01px" class="cls_023">
            <span class="cls_023">user.modifiedOn = Date.now();</span>
        </div>
        <div style="position:absolute;left:180.00px;top:126.25px" class="cls_023">
            <span class="cls_023">user.save(function (err) {</span>
        </div>
        <div style="position:absolute;left:190.80px;top:138.49px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:201.60px;top:150.73px" class="cls_023">
            <span class="cls_023">console.log('User updated: ' + req.body.FullName);</span>
        </div>
        <div style="position:absolute;left:201.60px;top:162.97px" class="cls_023">
            <span class="cls_023">req.session.user.name = req.body.FullName;</span>
        </div>
        <div style="position:absolute;left:201.60px;top:175.21px" class="cls_023">
            <span class="cls_023">req.session.user.email = req.body.Email;</span>
        </div>
        <div style="position:absolute;left:201.60px;top:187.45px" class="cls_023">
            <span class="cls_023">res.redirect( '/user' );</span>
        </div>
        <div style="position:absolute;left:190.80px;top:199.69px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:180.00px;top:211.93px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:169.20px;top:224.17px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:158.40px;top:236.41px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:147.60px;top:248.65px" class="cls_023">
            <span class="cls_023">);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:260.89px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:126.00px;top:273.13px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:292.86px" class="cls_006">
            <span class="cls_006">Note that the </span>
            <span class="cls_007">save</span>
            <span class="cls_006"> option does not return the updated document from the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:305.46px" class="cls_006">
            <span class="cls_006">database, but you could use the user variable if you needed to, as it should</span>
        </div>
        <div style="position:absolute;left:108.00px;top:318.06px" class="cls_006">
            <span class="cls_006">contain the same data.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:339.30px" class="cls_006">
            <span class="cls_006">There are a few </span>
            <span class="cls_007">if</span>
            <span class="cls_006"> conditions and callbacks in this code, but hopefully you can</span>
        </div>
        <div style="position:absolute;left:108.00px;top:351.90px" class="cls_006">
            <span class="cls_006">follow through the separate steps and see how it all ties together. Another option</span>
        </div>
        <div style="position:absolute;left:108.00px;top:364.50px" class="cls_006">
            <span class="cls_006">that you may find makes your code easier to read and follow is to make each section</span>
        </div>
        <div style="position:absolute;left:108.00px;top:377.10px" class="cls_006">
            <span class="cls_006">a separate function that is invoked from the relevant callback. For example see the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:389.70px" class="cls_006">
            <span class="cls_006">following code:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:410.64px" class="cls_023">
            <span class="cls_023">exports.doEdit = function(req, res) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:422.88px" class="cls_023">
            <span class="cls_023">if (req.session.user._id) {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:435.12px" class="cls_023">
            <span class="cls_023">User.findById( req.session.user._id,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:447.36px" class="cls_023">
            <span class="cls_023">function (err, user) {</span>
        </div>
        <div style="position:absolute;left:169.20px;top:459.60px" class="cls_023">
            <span class="cls_023">doEditSave (req, res, err, user);</span>
        </div>
        <div style="position:absolute;left:158.40px;top:471.84px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:147.60px;top:484.08px" class="cls_023">
            <span class="cls_023">);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:496.32px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:508.56px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:126.00px;top:533.04px" class="cls_023">
            <span class="cls_023">var doEditSave = function(req, res, err, user) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:545.28px" class="cls_023">
            <span class="cls_023">if(err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:557.52px" class="cls_023">
            <span class="cls_023">console.log(err);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:569.76px" class="cls_023">
            <span class="cls_023">res.redirect( '/user?error=finding');</span>
        </div>
        <div style="position:absolute;left:136.80px;top:582.00px" class="cls_023">
            <span class="cls_023">} else {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:594.24px" class="cls_023">
            <span class="cls_023">user.name = req.body.FullName;</span>
        </div>
        <div style="position:absolute;left:147.60px;top:606.48px" class="cls_023">
            <span class="cls_023">user.email = req.body.Email;</span>
        </div>
        <div style="position:absolute;left:147.60px;top:618.72px" class="cls_023">
            <span class="cls_023">user.modifiedOn = Date.now();</span>
        </div>
        <div style="position:absolute;left:147.60px;top:630.96px" class="cls_023">
            <span class="cls_023">user.save(</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 87 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:80200px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background101.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Updating</span>
        </div>
        <div style="position:absolute;left:158.40px;top:114.01px" class="cls_023">
            <span class="cls_023">function (err, user) {</span>
        </div>
        <div style="position:absolute;left:169.20px;top:126.25px" class="cls_023">
            <span class="cls_023">onEditSave (req, res, err, user);</span>
        </div>
        <div style="position:absolute;left:158.40px;top:138.49px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:147.60px;top:150.73px" class="cls_023">
            <span class="cls_023">);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:162.97px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:175.21px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:126.00px;top:199.69px" class="cls_023">
            <span class="cls_023">var onEditSave = function (req, res, err, user) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:211.93px" class="cls_023">
            <span class="cls_023">if(err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:224.17px" class="cls_023">
            <span class="cls_023">console.log(err);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:236.41px" class="cls_023">
            <span class="cls_023">res.redirect( '/user?error=saving');</span>
        </div>
        <div style="position:absolute;left:136.80px;top:248.65px" class="cls_023">
            <span class="cls_023">} else {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:260.89px" class="cls_023">
            <span class="cls_023">console.log('User updated: ' + req.body.FullName);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:273.13px" class="cls_023">
            <span class="cls_023">req.session.user.name = req.body.FullName;</span>
        </div>
        <div style="position:absolute;left:147.60px;top:285.37px" class="cls_023">
            <span class="cls_023">req.session.user.email = req.body.Email;</span>
        </div>
        <div style="position:absolute;left:147.60px;top:297.61px" class="cls_023">
            <span class="cls_023">res.redirect( '/user' );</span>
        </div>
        <div style="position:absolute;left:136.80px;top:309.85px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:322.09px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:350.52px" class="cls_027">
            <span class="cls_027">Editing projects</span>
        </div>
        <div style="position:absolute;left:108.00px;top:373.50px" class="cls_006">
            <span class="cls_006">The approach to take for editing projects is very similar to what we have done for</span>
        </div>
        <div style="position:absolute;left:108.00px;top:386.10px" class="cls_006">
            <span class="cls_006">users. We won't cover it here in detail, but you can either download the source code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:398.70px" class="cls_006">
            <span class="cls_006">available with this book, or have a go at setting it up yourself.</span>
        </div>
        <div style="position:absolute;left:177.48px;top:433.02px" class="cls_026">
            <span class="cls_026">Remember that we pass the </span>
            <span class="cls_007">_id</span>
            <span class="cls_026"> through URL parameters for</span>
        </div>
        <div style="position:absolute;left:177.48px;top:444.42px" class="cls_026">
            <span class="cls_026">projects, not in the session like we do for users.</span>
        </div>
        <div style="position:absolute;left:177.48px;top:458.70px" class="cls_026">
            <span class="cls_026">This is because we need the user information on all pages to check</span>
        </div>
        <div style="position:absolute;left:177.48px;top:470.10px" class="cls_026">
            <span class="cls_026">that they are logged in and have access to view whatever they have</span>
        </div>
        <div style="position:absolute;left:177.48px;top:481.49px" class="cls_026">
            <span class="cls_026">requested. Project specific data is only accessed on a few pages, and a</span>
        </div>
        <div style="position:absolute;left:177.48px;top:492.89px" class="cls_026">
            <span class="cls_026">user might skip from project to project, so passing the value through</span>
        </div>
        <div style="position:absolute;left:177.48px;top:504.29px" class="cls_026">
            <span class="cls_026">the URL makes most sense.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:534.30px" class="cls_006">
            <span class="cls_006">Here are the highlights of what is required in the following sections:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:562.40px" class="cls_013">
            <span class="cls_013">Routes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:583.38px" class="cls_006">
            <span class="cls_006">These are the two main routes to be added to the </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006"> file:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:604.32px" class="cls_023">
            <span class="cls_023">app.get('/project/edit/:id', project.edit);</span>
        </div>
        <div style="position:absolute;left:396.00px;top:604.32px" class="cls_023">
            <span class="cls_023">// Edit selected</span>
        </div>
        <div style="position:absolute;left:390.60px;top:615.12px" class="cls_023">
            <span class="cls_023">//project form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:627.36px" class="cls_023">
            <span class="cls_023">app.post('/project/edit/:id', project.doEdit);</span>
        </div>
        <div style="position:absolute;left:396.00px;top:627.36px" class="cls_023">
            <span class="cls_023">// Edit selected</span>
        </div>
        <div style="position:absolute;left:390.60px;top:638.16px" class="cls_023">
            <span class="cls_023">//project action</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 88 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:81002px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background102.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 7</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">New files and functions</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">You will need to create some new files and functions to build the functionality,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">and to display it in the browser. As a starting point you'll be looking at the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:159.19px" class="cls_006">
            <span class="cls_006">following files:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:180.43px" class="cls_006">
            <span class="cls_006">• Routing: Inside the controller file </span>
            <span class="cls_007">/routes/project.js</span>
            <span class="cls_006"> you will need to</span>
        </div>
        <div style="position:absolute;left:144.00px;top:193.03px" class="cls_006">
            <span class="cls_006">modify </span>
            <span class="cls_007">exports.create()</span>
            <span class="cls_006"> and create two new functions </span>
            <span class="cls_007">exports.edit()</span>
        </div>
        <div style="position:absolute;left:144.00px;top:205.63px" class="cls_006">
            <span class="cls_006">and </span>
            <span class="cls_007">exports.doEdit()</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:222.54px" class="cls_006">
            <span class="cls_006">• Display: You will need to update the template file </span>
            <span class="cls_007">views/project-form.</span>
        </div>
        <div style="position:absolute;left:144.00px;top:235.15px" class="cls_007">
            <span class="cls_007">jade</span>
            <span class="cls_006"> to accept and display values from variables.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:267.65px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:292.63px" class="cls_006">
            <span class="cls_006">In this chapter, we have learned how to modify existing data using Mongoose.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:305.23px" class="cls_006">
            <span class="cls_006">We have seen that there are some very simple methods we can use, but that this</span>
        </div>
        <div style="position:absolute;left:108.00px;top:317.83px" class="cls_006">
            <span class="cls_006">simplicity comes at a price. The price in this case is that defaults, validation, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:330.43px" class="cls_006">
            <span class="cls_006">middleware are not applied. We have also seen that we can use a more traditional</span>
        </div>
        <div style="position:absolute;left:108.00px;top:343.03px" class="cls_006">
            <span class="cls_006">three-step find-edit-save approach within Mongoose.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:364.27px" class="cls_006">
            <span class="cls_006">Following this theory we moved onto the practice and added to our MongoosePM</span>
        </div>
        <div style="position:absolute;left:108.00px;top:376.87px" class="cls_006">
            <span class="cls_006">project, making </span>
            <span class="cls_007">user</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">project</span>
            <span class="cls_006"> information updatable, and updated the login</span>
        </div>
        <div style="position:absolute;left:108.00px;top:389.47px" class="cls_006">
            <span class="cls_006">script to record a timestamp of when the user logged in.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:410.71px" class="cls_006">
            <span class="cls_006">Coming up in the next chapter we will be learning about the last of the four CRUD</span>
        </div>
        <div style="position:absolute;left:108.00px;top:423.31px" class="cls_006">
            <span class="cls_006">cornerstones, deletion.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 89 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:81804px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background103.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:82606px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background104.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:302.23px;top:218.71px" class="cls_015">
            <span class="cls_015">Interacting with</span>
        </div>
        <div style="position:absolute;left:297.22px;top:254.71px" class="cls_015">
            <span class="cls_015">Data - Deleting</span>
        </div>
        <div style="position:absolute;left:108.00px;top:308.41px" class="cls_006">
            <span class="cls_006">We have learned about Creating, Reading, and Updating data using Mongoose.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:321.01px" class="cls_006">
            <span class="cls_006">Now it is time to look at the final CRUD operation: </span>
            <span class="cls_025">deleting</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:342.26px" class="cls_006">
            <span class="cls_006">In this chapter we will:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:363.50px" class="cls_006">
            <span class="cls_006">• Learn how to delete multiple documents in one operation</span>
        </div>
        <div style="position:absolute;left:126.00px;top:380.41px" class="cls_006">
            <span class="cls_006">• Learn how to delete a single document</span>
        </div>
        <div style="position:absolute;left:126.00px;top:397.33px" class="cls_006">
            <span class="cls_006">• Put this knowledge into action by adding the functionality to delete a</span>
        </div>
        <div style="position:absolute;left:143.99px;top:409.93px" class="cls_006">
            <span class="cls_006">user account</span>
        </div>
        <div style="position:absolute;left:107.99px;top:431.17px" class="cls_006">
            <span class="cls_006">By the end of this chapter, you will be familiar with the different approaches you</span>
        </div>
        <div style="position:absolute;left:107.99px;top:443.77px" class="cls_006">
            <span class="cls_006">can take to delete data, and when it is best to use each one. You will also have</span>
        </div>
        <div style="position:absolute;left:107.99px;top:456.37px" class="cls_006">
            <span class="cls_006">added the ability to delete users and projects from your MongoosePM application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:488.87px" class="cls_022">
            <span class="cls_022">Deleting data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:513.85px" class="cls_006">
            <span class="cls_006">By now it will probably come as no surprise that there are a few different methods</span>
        </div>
        <div style="position:absolute;left:108.00px;top:526.45px" class="cls_006">
            <span class="cls_006">for deleting data. The methods are:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:547.69px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> remove()</span>
            <span class="cls_006">: This method deletes one or more documents from the collection</span>
        </div>
        <div style="position:absolute;left:126.00px;top:564.61px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> findOneAndRemove()</span>
            <span class="cls_006">: This method finds a single document based on</span>
        </div>
        <div style="position:absolute;left:144.00px;top:577.21px" class="cls_006">
            <span class="cls_006">a query object and removes it, passing it to the callback function on</span>
        </div>
        <div style="position:absolute;left:144.00px;top:589.81px" class="cls_006">
            <span class="cls_006">successful completion</span>
        </div>
        <div style="position:absolute;left:126.01px;top:606.73px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> findByIdAndRemove()</span>
            <span class="cls_006">: This method is the same as the </span>
            <span class="cls_007">findOneAndRemove</span>
        </div>
        <div style="position:absolute;left:144.00px;top:619.33px" class="cls_006">
            <span class="cls_006">method, except that it finds a document based on a provided document ID</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:83408px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background105.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Deleting</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">The </span>
            <span class="cls_007">remove()</span>
            <span class="cls_006"> method can be used in two ways: as a model method, or as an</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">instance method. When using it as a model method, you pass it a query object and it</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">will remove the matching documents. For example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:160.63px" class="cls_023">
            <span class="cls_023">User.remove({ name : /Simon/ } , function (err){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:172.87px" class="cls_023">
            <span class="cls_023">if (!err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:185.11px" class="cls_023">
            <span class="cls_023">// all users with 'Simon' in their name were deleted</span>
        </div>
        <div style="position:absolute;left:136.80px;top:197.35px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:209.59px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:229.33px" class="cls_006">
            <span class="cls_006">To use the </span>
            <span class="cls_007">remove()</span>
            <span class="cls_006"> method as an instance method you operate it after a find</span>
        </div>
        <div style="position:absolute;left:108.00px;top:241.93px" class="cls_006">
            <span class="cls_006">operation once you have results returned. For example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:262.87px" class="cls_023">
            <span class="cls_023">User.findOne({ email : 'simon@theholmesoffice.com'} ,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:275.11px" class="cls_023">
            <span class="cls_023">function (err,user){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:287.35px" class="cls_023">
            <span class="cls_023">if (!err){</span>
        </div>
        <div style="position:absolute;left:158.40px;top:299.59px" class="cls_023">
            <span class="cls_023">user.remove( function(err){</span>
        </div>
        <div style="position:absolute;left:169.20px;top:311.83px" class="cls_023">
            <span class="cls_023">// First user with matching email address was removed</span>
        </div>
        <div style="position:absolute;left:158.40px;top:324.07px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:147.60px;top:336.31px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:348.55px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:175.32px;top:378.41px" class="cls_026">
            <span class="cls_026">Be careful when using &lt;</span>
            <span class="cls_007">Model>.remove()</span>
            <span class="cls_026"> (where </span>
            <span class="cls_007">&lt;model></span>
            <span class="cls_026"> is the</span>
        </div>
        <div style="position:absolute;left:175.32px;top:389.81px" class="cls_026">
            <span class="cls_026">model name). If you specify an empty query or just a callback—like</span>
        </div>
        <div style="position:absolute;left:175.32px;top:401.21px" class="cls_026">
            <span class="cls_026">you would when using the instance method—then all the documents</span>
        </div>
        <div style="position:absolute;left:175.32px;top:412.61px" class="cls_026">
            <span class="cls_026">in the collection will be removed.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:439.65px" class="cls_006">
            <span class="cls_006">Both the </span>
            <span class="cls_007">findByIdAndRemove()</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">findOneAndRemove()</span>
            <span class="cls_006"> methods accept</span>
        </div>
        <div style="position:absolute;left:108.00px;top:452.25px" class="cls_006">
            <span class="cls_006">options and can return the deleted document to the callback. We're going to use</span>
        </div>
        <div style="position:absolute;left:108.00px;top:464.85px" class="cls_006">
            <span class="cls_006">the </span>
            <span class="cls_007">findByIdAndRemove</span>
            <span class="cls_006"> method shortly. So let's have a look at </span>
            <span class="cls_007">findOneAndRemove</span>
        </div>
        <div style="position:absolute;left:108.00px;top:477.45px" class="cls_006">
            <span class="cls_006">instead. The accepted parameters are as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:498.70px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> Query object</span>
            <span class="cls_006">: This is for a document to find and remove.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:515.61px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> Options</span>
            <span class="cls_006">: This optional parameter is an object with two possibilities:</span>
        </div>
        <div style="position:absolute;left:161.99px;top:532.53px" class="cls_029">
            <span class="cls_029">°</span>
            <span class="cls_006">°</span>
        </div>
        <div style="position:absolute;left:180.00px;top:532.53px" class="cls_007">
            <span class="cls_007">sort</span>
            <span class="cls_006">: set the sort order in case multiple docs are found</span>
        </div>
        <div style="position:absolute;left:162.00px;top:549.45px" class="cls_029">
            <span class="cls_029">°</span>
            <span class="cls_006">°</span>
        </div>
        <div style="position:absolute;left:180.00px;top:549.45px" class="cls_007">
            <span class="cls_007">select</span>
            <span class="cls_006">: set the document fields to return in the object to the callback</span>
        </div>
        <div style="position:absolute;left:126.00px;top:570.70px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> Callback</span>
            <span class="cls_006">: This optional parameter This returns either an error or the</span>
        </div>
        <div style="position:absolute;left:144.00px;top:583.30px" class="cls_006">
            <span class="cls_006">deleted document.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:604.54px" class="cls_006">
            <span class="cls_006">Here's a quick example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:625.47px" class="cls_023">
            <span class="cls_023">User.findOneAndRemove(</span>
        </div>
        <div style="position:absolute;left:136.80px;top:637.71px" class="cls_023">
            <span class="cls_023">{name : /Simon/},</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 92 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:84210px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background106.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 8</span>
        </div>
        <div style="position:absolute;left:136.80px;top:114.01px" class="cls_023">
            <span class="cls_023">{sort : 'lastLogin', select : 'name email'},</span>
        </div>
        <div style="position:absolute;left:136.80px;top:126.25px" class="cls_023">
            <span class="cls_023">function (err, user){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:138.49px" class="cls_023">
            <span class="cls_023">if (!err) {</span>
        </div>
        <div style="position:absolute;left:158.40px;top:150.73px" class="cls_023">
            <span class="cls_023">console.log(user.name + " removed");</span>
        </div>
        <div style="position:absolute;left:158.40px;top:162.97px" class="cls_023">
            <span class="cls_023">// Simon Holmes removed</span>
        </div>
        <div style="position:absolute;left:147.60px;top:175.21px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:136.80px;top:187.45px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:199.69px" class="cls_023">
            <span class="cls_023">);</span>
        </div>
        <div style="position:absolute;left:108.00px;top:219.42px" class="cls_006">
            <span class="cls_006">Here we search for users whose name contain </span>
            <span class="cls_007">Simon</span>
            <span class="cls_006">, and order them by the date</span>
        </div>
        <div style="position:absolute;left:108.00px;top:232.02px" class="cls_006">
            <span class="cls_006">they last logged in, before removing the user who hasn't logged in for the longest</span>
        </div>
        <div style="position:absolute;left:108.00px;top:244.62px" class="cls_006">
            <span class="cls_006">time. Once removed, we send their name and e-mail address to the callback to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:257.22px" class="cls_006">
            <span class="cls_006">output confirmation of the deletion.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:289.72px" class="cls_022">
            <span class="cls_022">CRUD - deleting user and projects</span>
        </div>
        <div style="position:absolute;left:108.00px;top:314.70px" class="cls_006">
            <span class="cls_006">That's the theory, so let's see it in action and let a user delete their account. To</span>
        </div>
        <div style="position:absolute;left:108.00px;top:327.30px" class="cls_006">
            <span class="cls_006">follow the approach we've been taking through this application, we'll have a page</span>
        </div>
        <div style="position:absolute;left:108.00px;top:339.90px" class="cls_006">
            <span class="cls_006">displaying a form and a form handler.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:361.14px" class="cls_006">
            <span class="cls_006">The routes in </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006"> that we'll use for this are:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:382.08px" class="cls_023">
            <span class="cls_023">app.get('/user/delete', user.confirmDelete);</span>
        </div>
        <div style="position:absolute;left:331.20px;top:392.88px" class="cls_023">
            <span class="cls_023">// delete current user form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:405.12px" class="cls_023">
            <span class="cls_023">app.post('/user/delete', user.doDelete);</span>
        </div>
        <div style="position:absolute;left:325.80px;top:415.92px" class="cls_023">
            <span class="cls_023">// Delete current user action</span>
        </div>
        <div style="position:absolute;left:108.00px;top:444.36px" class="cls_027">
            <span class="cls_027">The "Are you sure" page</span>
        </div>
        <div style="position:absolute;left:108.00px;top:467.34px" class="cls_006">
            <span class="cls_006">Before a user deletes the account we want to ask them to confirm this, in case they</span>
        </div>
        <div style="position:absolute;left:108.00px;top:479.94px" class="cls_006">
            <span class="cls_006">clicked on the link by accident. So we create a new view as </span>
            <span class="cls_007">views/user-delete-</span>
        </div>
        <div style="position:absolute;left:108.00px;top:492.54px" class="cls_007">
            <span class="cls_007">form.jade</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:513.48px" class="cls_023">
            <span class="cls_023">h1= title</span>
        </div>
        <div style="position:absolute;left:126.00px;top:525.72px" class="cls_023">
            <span class="cls_023">p #{name}, are you sure you want to permanently delete your</span>
        </div>
        <div style="position:absolute;left:126.00px;top:536.52px" class="cls_023">
            <span class="cls_023">account? The email address on this account is #{email}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:548.76px" class="cls_023">
            <span class="cls_023">form(id="formUserDelete", method="post", action="")</span>
        </div>
        <div style="position:absolute;left:136.80px;top:561.00px" class="cls_023">
            <span class="cls_023">input(type="hidden", name="_id", id="_id", value="#{_id}")</span>
        </div>
        <div style="position:absolute;left:136.80px;top:573.24px" class="cls_023">
            <span class="cls_023">input(type="submit", value="Yes, please delete it!")</span>
        </div>
        <div style="position:absolute;left:108.00px;top:592.98px" class="cls_006">
            <span class="cls_006">And create a controller to map it to the route in </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:613.92px" class="cls_023">
            <span class="cls_023">// GET user delete confirmation form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:626.16px" class="cls_023">
            <span class="cls_023">exports.confirmDelete = function(req, res){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:638.40px" class="cls_023">
            <span class="cls_023">res.render('user-delete-form', {</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 93 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:85012px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background107.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Interacting with Data - Deleting</span>
        </div>
        <div style="position:absolute;left:147.60px;top:114.01px" class="cls_023">
            <span class="cls_023">title: 'Delete account',</span>
        </div>
        <div style="position:absolute;left:147.60px;top:126.25px" class="cls_023">
            <span class="cls_023">_id: req.session.user._id,</span>
        </div>
        <div style="position:absolute;left:147.60px;top:138.49px" class="cls_023">
            <span class="cls_023">name: req.session.user.name,</span>
        </div>
        <div style="position:absolute;left:147.60px;top:150.73px" class="cls_023">
            <span class="cls_023">email: req.session.user.email</span>
        </div>
        <div style="position:absolute;left:136.80px;top:162.97px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:175.21px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:203.64px" class="cls_027">
            <span class="cls_027">Deleting the user</span>
        </div>
        <div style="position:absolute;left:108.00px;top:226.62px" class="cls_006">
            <span class="cls_006">Now we get to the business end and delete the user, using </span>
            <span class="cls_007">Model.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:239.22px" class="cls_007">
            <span class="cls_007">findByIdAndRemove()</span>
            <span class="cls_006">. In </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">, add the following </span>
            <span class="cls_007">doDelete</span>
        </div>
        <div style="position:absolute;left:108.00px;top:251.82px" class="cls_006">
            <span class="cls_006">exports function.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:272.76px" class="cls_023">
            <span class="cls_023">// POST user delete form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:285.00px" class="cls_023">
            <span class="cls_023">exports.doDelete = function(req, res) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:297.24px" class="cls_023">
            <span class="cls_023">if (req.body._id) {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:309.48px" class="cls_023">
            <span class="cls_023">User.findByIdAndRemove(</span>
        </div>
        <div style="position:absolute;left:158.40px;top:321.72px" class="cls_023">
            <span class="cls_023">req.body._id,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:333.96px" class="cls_023">
            <span class="cls_023">function (err, user) {</span>
        </div>
        <div style="position:absolute;left:169.20px;top:346.20px" class="cls_023">
            <span class="cls_023">if(err){</span>
        </div>
        <div style="position:absolute;left:180.00px;top:358.44px" class="cls_023">
            <span class="cls_023">console.log(err);</span>
        </div>
        <div style="position:absolute;left:180.00px;top:370.68px" class="cls_023">
            <span class="cls_023">return res.redirect('/user?error=deleting');</span>
        </div>
        <div style="position:absolute;left:169.20px;top:382.92px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:169.20px;top:395.16px" class="cls_023">
            <span class="cls_023">console.log("User deleted:", user);</span>
        </div>
        <div style="position:absolute;left:169.20px;top:407.40px" class="cls_023">
            <span class="cls_023">clearSession(req.session, function () {</span>
        </div>
        <div style="position:absolute;left:180.00px;top:419.64px" class="cls_023">
            <span class="cls_023">res.redirect('/');</span>
        </div>
        <div style="position:absolute;left:169.20px;top:431.88px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:158.40px;top:444.12px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:147.60px;top:456.36px" class="cls_023">
            <span class="cls_023">);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:468.60px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:480.84px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:500.58px" class="cls_006">
            <span class="cls_006">Here we are simply taking the unique ID of the user as passed through the form,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:513.18px" class="cls_006">
            <span class="cls_006">finding it in the database, and deleting the entry. Once deleted, we log the user</span>
        </div>
        <div style="position:absolute;left:108.00px;top:525.78px" class="cls_006">
            <span class="cls_006">record to the console so that we can verify it, and then we need to make sure that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:538.38px" class="cls_006">
            <span class="cls_006">the user is logged out of the system and sent to the homepage.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:559.62px" class="cls_006">
            <span class="cls_006">We need to add an extra function called </span>
            <span class="cls_007">clearSession</span>
            <span class="cls_006"> to do this, as this isn't the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:572.22px" class="cls_006">
            <span class="cls_006">only place we'll need to log out a user. Add the following to </span>
            <span class="cls_007">routes/user.js</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:593.16px" class="cls_023">
            <span class="cls_023">var clearSession = function(session, callback){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:605.40px" class="cls_023">
            <span class="cls_023">session.destroy();</span>
        </div>
        <div style="position:absolute;left:136.80px;top:617.64px" class="cls_023">
            <span class="cls_023">callback();</span>
        </div>
        <div style="position:absolute;left:126.00px;top:629.88px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 94 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:85814px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background108.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 8</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Improving on this</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">If you want to try something else, you could add to this function by deleting all</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">projects created by the deleted user.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:176.53px" class="cls_027">
            <span class="cls_027">Deleting individual projects</span>
        </div>
        <div style="position:absolute;left:108.00px;top:199.51px" class="cls_006">
            <span class="cls_006">The approach to take for deleting projects is very similar to what we have done for</span>
        </div>
        <div style="position:absolute;left:108.00px;top:212.11px" class="cls_006">
            <span class="cls_006">users. We won't cover it here in detail, but you can either download the source code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:224.71px" class="cls_006">
            <span class="cls_006">available with this book, or have a go at setting it up yourself.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:245.95px" class="cls_006">
            <span class="cls_006">Following are the highlights of what is required:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:274.05px" class="cls_013">
            <span class="cls_013">Routes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:295.03px" class="cls_006">
            <span class="cls_006">These are the two main routes, to be added to </span>
            <span class="cls_007">app.js</span>
            <span class="cls_006">:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:315.97px" class="cls_023">
            <span class="cls_023">app.get('/project/delete/:id', project.confirmDelete);</span>
        </div>
        <div style="position:absolute;left:320.40px;top:326.77px" class="cls_023">
            <span class="cls_023">//Delete selected project form</span>
        </div>
        <div style="position:absolute;left:126.00px;top:339.01px" class="cls_023">
            <span class="cls_023">app.post('/project/delete/:id', project.doDelete);</span>
        </div>
        <div style="position:absolute;left:417.60px;top:339.01px" class="cls_023">
            <span class="cls_023">// Delete</span>
        </div>
        <div style="position:absolute;left:325.80px;top:349.81px" class="cls_023">
            <span class="cls_023">//selected project action</span>
        </div>
        <div style="position:absolute;left:108.00px;top:376.41px" class="cls_013">
            <span class="cls_013">New files and functions</span>
        </div>
        <div style="position:absolute;left:108.00px;top:397.39px" class="cls_006">
            <span class="cls_006">You will need to create some new files and functions to build the functionality,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:409.99px" class="cls_006">
            <span class="cls_006">and to display it in the browser. As a starting point you'll be looking at the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:422.59px" class="cls_006">
            <span class="cls_006">following files:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:443.83px" class="cls_006">
            <span class="cls_006">• Routing: Inside the controller file </span>
            <span class="cls_007">/routes/project.js</span>
            <span class="cls_006"> you will need to</span>
        </div>
        <div style="position:absolute;left:144.00px;top:456.43px" class="cls_006">
            <span class="cls_006">create two new functions </span>
            <span class="cls_007">exports.delete()</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">exports.doDelete()</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:473.34px" class="cls_006">
            <span class="cls_006">• Display: You will need to create a new template file </span>
            <span class="cls_007">views/project-</span>
        </div>
        <div style="position:absolute;left:144.00px;top:485.95px" class="cls_007">
            <span class="cls_007">delete-form.jade</span>
            <span class="cls_006"> to ask the user for confirmation.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:518.45px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:543.43px" class="cls_006">
            <span class="cls_006">In this chapter, we have learned how to delete database records using Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:556.03px" class="cls_006">
            <span class="cls_006">methods. We then applied this knowledge to our project and added the ability for a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:568.63px" class="cls_006">
            <span class="cls_006">user to delete their profile.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:589.87px" class="cls_006">
            <span class="cls_006">This brings us to the end of the data interaction CRUD section, so you should now</span>
        </div>
        <div style="position:absolute;left:108.00px;top:602.47px" class="cls_006">
            <span class="cls_006">have a good idea of how to do most things you want to with data in your applications.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:623.71px" class="cls_006">
            <span class="cls_006">Coming up in the next chapter, we're going to look at validation and see how</span>
        </div>
        <div style="position:absolute;left:108.00px;top:636.31px" class="cls_006">
            <span class="cls_006">Mongoose can help us maintain data integrity.</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 95 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:86616px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background109.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:87418px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background110.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:302.76px;top:218.71px" class="cls_015">
            <span class="cls_015">Validating Data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:272.41px" class="cls_006">
            <span class="cls_006">An important part of any application that takes data entered by a user is data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:285.01px" class="cls_006">
            <span class="cls_006">integrity. In this chapter, we are going to look at different ways of validating data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:297.61px" class="cls_006">
            <span class="cls_006">before it is saved to the database. We will look at the built-in Mongoose validators,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:310.21px" class="cls_006">
            <span class="cls_006">and also how to add custom validation.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.46px" class="cls_006">
            <span class="cls_006">By the end of this chapter, you will understand the different approaches to data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.06px" class="cls_006">
            <span class="cls_006">validation with Mongoose, and will have added validation to create and update</span>
        </div>
        <div style="position:absolute;left:108.00px;top:356.66px" class="cls_006">
            <span class="cls_006">sections of our MongoosePM application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:389.15px" class="cls_022">
            <span class="cls_022">Mongoose validation - the basics</span>
        </div>
        <div style="position:absolute;left:108.00px;top:414.13px" class="cls_006">
            <span class="cls_006">In Mongoose, validation is set at the schema level. Remember how in our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:426.73px" class="cls_007">
            <span class="cls_007">userSchema</span>
            <span class="cls_006"> we have this for the </span>
            <span class="cls_007">email</span>
            <span class="cls_006"> field:</span>
        </div>
        <div style="position:absolute;left:136.80px;top:447.67px" class="cls_023">
            <span class="cls_023">email: { type: String, unique: true }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:467.41px" class="cls_006">
            <span class="cls_006">The </span>
            <span class="cls_007">unique: true</span>
            <span class="cls_006"> part is a type of validation that Mongoose passes directly</span>
        </div>
        <div style="position:absolute;left:108.00px;top:480.01px" class="cls_006">
            <span class="cls_006">through to MongoDB. The other types of validation we are about to look at are set</span>
        </div>
        <div style="position:absolute;left:108.00px;top:492.61px" class="cls_006">
            <span class="cls_006">in the same place, but are handled by Mongoose before it goes anywhere near the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:505.21px" class="cls_006">
            <span class="cls_006">database; unless of course, you have a type of validation where you specifically</span>
        </div>
        <div style="position:absolute;left:108.00px;top:517.81px" class="cls_006">
            <span class="cls_006">choose to check against something in the database.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:547.75px" class="cls_027">
            <span class="cls_027">Default validators</span>
        </div>
        <div style="position:absolute;left:108.00px;top:570.73px" class="cls_006">
            <span class="cls_006">Mongoose provides some common validators to get us started. We'll look at them in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:583.33px" class="cls_006">
            <span class="cls_006">this chapter. Some of these are for specific SchemaTypes, which we'll get to know in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:595.93px" class="cls_006">
            <span class="cls_006">a moment, but there is one that can be used on all SchemaTypes.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:88220px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background111.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Validating Data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">All SchemaTypes</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">There is one validator that can be used by any SchemaType, named </span>
            <span class="cls_025">required</span>
            <span class="cls_006">. This</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">will return a validation error if no data is given to a data object with this property.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:159.19px" class="cls_006">
            <span class="cls_006">It is super-easy to use. If we want to add it to </span>
            <span class="cls_007">email</span>
            <span class="cls_006"> in our </span>
            <span class="cls_007">userSchema</span>
            <span class="cls_006"> we simply</span>
        </div>
        <div style="position:absolute;left:108.00px;top:171.79px" class="cls_006">
            <span class="cls_006">need to update the line as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:192.73px" class="cls_023">
            <span class="cls_023">email: { type: String, unique: true, required: true }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:219.33px" class="cls_013">
            <span class="cls_013">Number SchemaType</span>
        </div>
        <div style="position:absolute;left:108.00px;top:240.31px" class="cls_006">
            <span class="cls_006">Number items in your schema have built-in </span>
            <span class="cls_025">min</span>
            <span class="cls_006"> and </span>
            <span class="cls_025">max</span>
            <span class="cls_006"> validators, for</span>
        </div>
        <div style="position:absolute;left:108.00px;top:252.91px" class="cls_006">
            <span class="cls_006">declaring lower and upper boundaries. They are also simple to apply. See</span>
        </div>
        <div style="position:absolute;left:108.00px;top:265.51px" class="cls_006">
            <span class="cls_006">the following for example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:286.45px" class="cls_023">
            <span class="cls_023">var teenSchema = new Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:298.69px" class="cls_023">
            <span class="cls_023">age : {type: Number, min: 13, max:19}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:310.93px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:330.67px" class="cls_006">
            <span class="cls_006">This will return a validation error if you try to save an instance of </span>
            <span class="cls_007">teenSchema</span>
        </div>
        <div style="position:absolute;left:107.99px;top:343.27px" class="cls_006">
            <span class="cls_006">with an age value of less than </span>
            <span class="cls_007">13</span>
            <span class="cls_006">, or higher than </span>
            <span class="cls_007">19</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:371.37px" class="cls_013">
            <span class="cls_013">String SchemaType</span>
        </div>
        <div style="position:absolute;left:108.00px;top:392.35px" class="cls_006">
            <span class="cls_006">String items in your schema have two other built-in validators:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:413.59px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> match</span>
            <span class="cls_006">: This validator is for matching against a regular expression</span>
        </div>
        <div style="position:absolute;left:126.00px;top:430.51px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> enum</span>
            <span class="cls_006">: This validator is for checking against a provided list of possible values</span>
        </div>
        <div style="position:absolute;left:107.99px;top:451.75px" class="cls_006">
            <span class="cls_006">Here the </span>
            <span class="cls_007">match</span>
            <span class="cls_006"> validator will check that the string matches the regular expression:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:472.69px" class="cls_023">
            <span class="cls_023">var weekdaySchema = new Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:484.93px" class="cls_023">
            <span class="cls_023">day : {type: String, match: /^(mon|tues|wednes|thurs|fri)day$/i}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:497.17px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:516.91px" class="cls_006">
            <span class="cls_006">Here the </span>
            <span class="cls_007">enum</span>
            <span class="cls_006"> validator will check that the string is one of the values in the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:529.51px" class="cls_007">
            <span class="cls_007">weekdays</span>
            <span class="cls_006"> array:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:550.45px" class="cls_023">
            <span class="cls_023">var weekdays = ['monday', 'tuesday', 'wednesday', 'thursday',</span>
        </div>
        <div style="position:absolute;left:126.00px;top:561.25px" class="cls_023">
            <span class="cls_023">'friday'];</span>
        </div>
        <div style="position:absolute;left:126.00px;top:573.49px" class="cls_023">
            <span class="cls_023">var weekdaySchema = new Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:585.73px" class="cls_023">
            <span class="cls_023">day : {type: String, enum: weekdays}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:597.97px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:295.37px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 98 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:89022px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background112.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 9</span>
        </div>
        <div style="position:absolute;left:108.00px;top:111.92px" class="cls_022">
            <span class="cls_022">Understanding validation errors</span>
        </div>
        <div style="position:absolute;left:108.00px;top:136.90px" class="cls_006">
            <span class="cls_006">When we have been creating, editing, and saving data in our project, we have been</span>
        </div>
        <div style="position:absolute;left:108.00px;top:149.50px" class="cls_006">
            <span class="cls_006">using a callback function containing two parameters: an error object and the returned</span>
        </div>
        <div style="position:absolute;left:108.00px;top:162.10px" class="cls_006">
            <span class="cls_006">data object. So far we have generally been ignoring the error object and just been</span>
        </div>
        <div style="position:absolute;left:108.00px;top:174.70px" class="cls_006">
            <span class="cls_006">saving the data, for example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:195.64px" class="cls_023">
            <span class="cls_023">user.save(function (err, user) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:207.88px" class="cls_023">
            <span class="cls_023">if(err){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:220.12px" class="cls_023">
            <span class="cls_023">console.log(err)</span>
        </div>
        <div style="position:absolute;left:136.80px;top:232.36px" class="cls_023">
            <span class="cls_023">} else { ...</span>
        </div>
        <div style="position:absolute;left:108.00px;top:252.10px" class="cls_006">
            <span class="cls_006">It is in the </span>
            <span class="cls_007">err</span>
            <span class="cls_006"> object that we receive the Mongoose validation errors. The error object</span>
        </div>
        <div style="position:absolute;left:108.00px;top:264.70px" class="cls_006">
            <span class="cls_006">will contain a top-level message and name, and a collection of specific errors. Each</span>
        </div>
        <div style="position:absolute;left:108.00px;top:277.30px" class="cls_006">
            <span class="cls_006">of these errors give an individual </span>
            <span class="cls_007">message</span>
            <span class="cls_006">, </span>
            <span class="cls_007">name</span>
            <span class="cls_006">, </span>
            <span class="cls_007">path</span>
            <span class="cls_006">, and </span>
            <span class="cls_007">type </span>
            <span class="cls_006">object. A typical</span>
        </div>
        <div style="position:absolute;left:108.00px;top:289.90px" class="cls_006">
            <span class="cls_006">validation failure looks like the following when sent to the console:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:310.84px" class="cls_023">
            <span class="cls_023">{ message: 'Validation failed',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:323.08px" class="cls_023">
            <span class="cls_023">name: 'ValidationError',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:335.32px" class="cls_023">
            <span class="cls_023">errors:</span>
        </div>
        <div style="position:absolute;left:142.20px;top:347.56px" class="cls_023">
            <span class="cls_023">{ email:</span>
        </div>
        <div style="position:absolute;left:158.40px;top:359.80px" class="cls_023">
            <span class="cls_023">{ message: 'Validator "required" failed for path email',</span>
        </div>
        <div style="position:absolute;left:169.20px;top:372.04px" class="cls_023">
            <span class="cls_023">name: 'ValidatorError',</span>
        </div>
        <div style="position:absolute;left:169.20px;top:384.28px" class="cls_023">
            <span class="cls_023">path: 'email',</span>
        </div>
        <div style="position:absolute;left:169.20px;top:396.52px" class="cls_023">
            <span class="cls_023">type: 'required' },</span>
        </div>
        <div style="position:absolute;left:153.00px;top:408.76px" class="cls_023">
            <span class="cls_023">name:</span>
        </div>
        <div style="position:absolute;left:158.40px;top:421.00px" class="cls_023">
            <span class="cls_023">{ message: 'Validator "required" failed for path name',</span>
        </div>
        <div style="position:absolute;left:169.20px;top:433.24px" class="cls_023">
            <span class="cls_023">name: 'ValidatorError',</span>
        </div>
        <div style="position:absolute;left:169.20px;top:445.48px" class="cls_023">
            <span class="cls_023">path: 'name',</span>
        </div>
        <div style="position:absolute;left:169.20px;top:457.72px" class="cls_023">
            <span class="cls_023">type: 'required' } } }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:477.46px" class="cls_006">
            <span class="cls_006">Knowing the structure of the returned error object helps us to identify the exact</span>
        </div>
        <div style="position:absolute;left:108.00px;top:490.06px" class="cls_006">
            <span class="cls_006">reason for the validation failure and send a relevant error message to the user.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:511.30px" class="cls_006">
            <span class="cls_006">To output just a summary to the console, you could loop through the error objects</span>
        </div>
        <div style="position:absolute;left:108.00px;top:523.90px" class="cls_006">
            <span class="cls_006">with the following code snippet:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:544.84px" class="cls_023">
            <span class="cls_023">if(err){</span>
        </div>
        <div style="position:absolute;left:136.80px;top:557.08px" class="cls_023">
            <span class="cls_023">Object.keys(err.errors).forEach(function(key) {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:569.32px" class="cls_023">
            <span class="cls_023">var message = err.errors[key].message;</span>
        </div>
        <div style="position:absolute;left:147.60px;top:581.56px" class="cls_023">
            <span class="cls_023">console.log('Validation error for "%s": %s', key, message);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:593.80px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:606.04px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:295.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 99 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:89824px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background113.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Validating Data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">This would result in a much more manageable output, which is as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">Validation error for "email": Validator "required" failed for path</span>
        </div>
        <div style="position:absolute;left:126.00px;top:146.23px" class="cls_023">
            <span class="cls_023">email</span>
        </div>
        <div style="position:absolute;left:126.00px;top:158.47px" class="cls_023">
            <span class="cls_023">Validation error for "name": Validator "required" failed for path</span>
        </div>
        <div style="position:absolute;left:126.00px;top:169.27px" class="cls_023">
            <span class="cls_023">name</span>
        </div>
        <div style="position:absolute;left:108.00px;top:200.27px" class="cls_022">
            <span class="cls_022">Doing it your way - create custom</span>
        </div>
        <div style="position:absolute;left:108.00px;top:224.27px" class="cls_022">
            <span class="cls_022">validation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.25px" class="cls_006">
            <span class="cls_006">Mongoose offers a number of different ways to create custom validators.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:279.19px" class="cls_027">
            <span class="cls_027">Single function - no custom error message</span>
        </div>
        <div style="position:absolute;left:108.00px;top:302.17px" class="cls_006">
            <span class="cls_006">If you only need one piece of validation for a given data item, you can simply specify</span>
        </div>
        <div style="position:absolute;left:108.00px;top:314.77px" class="cls_006">
            <span class="cls_006">a function and return </span>
            <span class="cls_007">true</span>
            <span class="cls_006"> if the validation is passed, and </span>
            <span class="cls_007">false</span>
            <span class="cls_006"> if it fails.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:336.02px" class="cls_006">
            <span class="cls_006">For example, if we want our usernames to be at least five characters long, we can</span>
        </div>
        <div style="position:absolute;left:108.00px;top:348.62px" class="cls_006">
            <span class="cls_006">create a function like the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:369.55px" class="cls_023">
            <span class="cls_023">var lengthValidator = function(val) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:381.07px" class="cls_023">
            <span class="cls_023">if (val && val.length >= 5){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:392.59px" class="cls_023">
            <span class="cls_023">return true;</span>
        </div>
        <div style="position:absolute;left:136.80px;top:404.11px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:415.63px" class="cls_023">
            <span class="cls_023">return false;</span>
        </div>
        <div style="position:absolute;left:126.00px;top:427.15px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:446.89px" class="cls_006">
            <span class="cls_006">The function is then referenced in our schema using the </span>
            <span class="cls_007">validate</span>
            <span class="cls_006"> key:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:465.67px" class="cls_023">
            <span class="cls_023">name: {type: String, required: true, validate: lengthValidator }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:485.41px" class="cls_006">
            <span class="cls_006">This is a very quick and easy way of adding custom validation. It is fine if you just</span>
        </div>
        <div style="position:absolute;left:108.00px;top:498.01px" class="cls_006">
            <span class="cls_006">want to check if its okay or not okay as it is reported as an error, but in the error</span>
        </div>
        <div style="position:absolute;left:108.00px;top:510.61px" class="cls_006">
            <span class="cls_006">collection the error </span>
            <span class="cls_007">type</span>
            <span class="cls_006"> comes through as </span>
            <span class="cls_007">undefined</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:540.55px" class="cls_027">
            <span class="cls_027">Returning a custom error message</span>
        </div>
        <div style="position:absolute;left:108.00px;top:563.53px" class="cls_006">
            <span class="cls_006">If you want a bit more feedback and granularity to your error trapping then it's useful</span>
        </div>
        <div style="position:absolute;left:108.00px;top:576.13px" class="cls_006">
            <span class="cls_006">to add a custom error message. Fortunately, Mongoose makes this pretty easy too!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:597.38px" class="cls_006">
            <span class="cls_006">Using the previous schema entry as a start point you can change the value of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:609.97px" class="cls_007">
            <span class="cls_007">validate</span>
            <span class="cls_006"> entity, setting an object instead. This object has two entries:</span>
        </div>
        <div style="position:absolute;left:125.99px;top:631.21px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> validator</span>
            <span class="cls_006">: This is your custom function</span>
        </div>
        <div style="position:absolute;left:126.00px;top:646.69px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> msg</span>
            <span class="cls_006">: This is your custom error message</span>
        </div>
        <div style="position:absolute;left:293.14px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 100 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:90626px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background114.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 9</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">For example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">validate: { validator: lengthValidator, msg: 'Too short' }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:162.03px" class="cls_013">
            <span class="cls_013">Validating a regular expression</span>
        </div>
        <div style="position:absolute;left:108.00px;top:183.01px" class="cls_006">
            <span class="cls_006">If you just want to validate against a regular expression, you don't have to create a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:195.61px" class="cls_006">
            <span class="cls_006">function to house it. Mongoose lets you put it directly into the schema.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:216.55px" class="cls_023">
            <span class="cls_023">var weekdaySchema = new Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:228.79px" class="cls_023">
            <span class="cls_023">day : {type: String, validate: {validator:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:239.59px" class="cls_023">
            <span class="cls_023">/^(mon|tues|wednes|thurs|fri)day$/i, msg: 'Not a day' }</span>
        </div>
        <div style="position:absolute;left:126.00px;top:251.83px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:278.43px" class="cls_013">
            <span class="cls_013">Taking the messages out of the schema</span>
        </div>
        <div style="position:absolute;left:108.00px;top:299.41px" class="cls_006">
            <span class="cls_006">You can take the pairing of the validation function and custom message outside of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:312.01px" class="cls_006">
            <span class="cls_006">the schema so that both are re-usable. This is done by defining an array that contains</span>
        </div>
        <div style="position:absolute;left:108.00px;top:324.61px" class="cls_006">
            <span class="cls_006">your validator and your message.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:345.55px" class="cls_023">
            <span class="cls_023">var validateLength = [lengthValidator, 'Too short' ];</span>
        </div>
        <div style="position:absolute;left:126.00px;top:357.79px" class="cls_023">
            <span class="cls_023">var validateDay = [/^(mon|tues|wednes|thurs|fri)day$/i, 'Not a</span>
        </div>
        <div style="position:absolute;left:126.00px;top:368.59px" class="cls_023">
            <span class="cls_023">day' ];</span>
        </div>
        <div style="position:absolute;left:108.00px;top:388.33px" class="cls_006">
            <span class="cls_006">You simply reference these in your schema definitions like in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:409.27px" class="cls_023">
            <span class="cls_023">name: {type: String, required: true, validate: validateLength }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:429.01px" class="cls_006">
            <span class="cls_006">Or:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:449.95px" class="cls_023">
            <span class="cls_023">day : {type: String, validate: validateDay }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:469.69px" class="cls_006">
            <span class="cls_006">An array might seem like an odd choice at the moment, but everything will become</span>
        </div>
        <div style="position:absolute;left:108.00px;top:482.29px" class="cls_006">
            <span class="cls_006">clear soon!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:512.23px" class="cls_027">
            <span class="cls_027">Using multiple re-usable validators</span>
        </div>
        <div style="position:absolute;left:108.00px;top:535.21px" class="cls_006">
            <span class="cls_006">If you aim to make your code as re-usable as possible, then you'll want to create a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:547.81px" class="cls_006">
            <span class="cls_006">few validation functions, each of which does just one thing. You can then mix and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:560.41px" class="cls_006">
            <span class="cls_006">match, sharing across schemas and even different applications when you create</span>
        </div>
        <div style="position:absolute;left:108.00px;top:573.01px" class="cls_006">
            <span class="cls_006">them. Here's where that array comes in:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:594.26px" class="cls_006">
            <span class="cls_006">The code we saw beforehand is as follows:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:615.19px" class="cls_023">
            <span class="cls_023">var validateLength = [lengthValidator, 'Too short' ];</span>
        </div>
        <div style="position:absolute;left:293.76px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 101 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:91428px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background115.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Validating Data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">This is syntactic shorthand for the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">var validateLength = [</span>
        </div>
        <div style="position:absolute;left:136.80px;top:147.67px" class="cls_023">
            <span class="cls_023">{validator: lengthValidator, msg: 'Too short'}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:159.91px" class="cls_023">
            <span class="cls_023">];</span>
        </div>
        <div style="position:absolute;left:108.00px;top:179.65px" class="cls_006">
            <span class="cls_006">Now the array starts to make a bit more sense doesn't it? We can add further</span>
        </div>
        <div style="position:absolute;left:108.00px;top:192.25px" class="cls_006">
            <span class="cls_006">validation objects to it like in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:213.19px" class="cls_023">
            <span class="cls_023">var validateUsername = [</span>
        </div>
        <div style="position:absolute;left:136.80px;top:225.43px" class="cls_023">
            <span class="cls_023">{validator: lengthValidator, msg: 'Too short'} ,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:237.67px" class="cls_023">
            <span class="cls_023">{validator: /^[a-z]+$/i, msg: 'Letters only'}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:249.91px" class="cls_023">
            <span class="cls_023">];</span>
        </div>
        <div style="position:absolute;left:174.60px;top:278.47px" class="cls_026">
            <span class="cls_026">The </span>
            <span class="cls_030">best practice</span>
            <span class="cls_026"> is to use the longer form, explicitly defining the object</span>
        </div>
        <div style="position:absolute;left:174.60px;top:289.87px" class="cls_026">
            <span class="cls_026">and not the syntactic shorthand. This makes your code easier to</span>
        </div>
        <div style="position:absolute;left:174.60px;top:301.27px" class="cls_026">
            <span class="cls_026">understand at a glance, and also easier to extend.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:327.01px" class="cls_006">
            <span class="cls_006">As you can see, it's pretty easy to build up a set of re-usable validators and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:339.61px" class="cls_006">
            <span class="cls_006">apply them to your schemas. There is one more way of doing this, by using the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:352.21px" class="cls_006">
            <span class="cls_006">SchemaType methods:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:373.15px" class="cls_023">
            <span class="cls_023">userSchema.path('name').validate(lengthValidator, 'Too short');</span>
        </div>
        <div style="position:absolute;left:126.00px;top:385.39px" class="cls_023">
            <span class="cls_023">userSchema.path('name').validate(/^[a-z]+$/i, 'Letters only');</span>
        </div>
        <div style="position:absolute;left:108.00px;top:413.83px" class="cls_027">
            <span class="cls_027">Non-blocking, asynchronous validation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:436.81px" class="cls_006">
            <span class="cls_006">So far we've been looking at validation methods that run pretty much instantly,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:449.41px" class="cls_006">
            <span class="cls_006">but what if we want to run an asynchronous operation such as checking against a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:462.01px" class="cls_006">
            <span class="cls_006">database? Mongoose provides the ability to run an asynchronous validator to do</span>
        </div>
        <div style="position:absolute;left:108.00px;top:474.61px" class="cls_006">
            <span class="cls_006">just this. To use this you specify a validator function with a second parameter—this</span>
        </div>
        <div style="position:absolute;left:108.00px;top:487.21px" class="cls_006">
            <span class="cls_006">second parameter is a callback function that expects either </span>
            <span class="cls_007">true</span>
            <span class="cls_006"> or </span>
            <span class="cls_007">false</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:508.45px" class="cls_006">
            <span class="cls_006">In the following example, we are using </span>
            <span class="cls_007">respond</span>
            <span class="cls_006"> as our callback function, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:521.05px" class="cls_006">
            <span class="cls_006">checking to see whether a user record with the supplied username already exists.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:541.99px" class="cls_023">
            <span class="cls_023">userSchema.path('username').validate(function (value, respond) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:554.23px" class="cls_023">
            <span class="cls_023">User.find({username: value}, function(err, users){</span>
        </div>
        <div style="position:absolute;left:147.60px;top:566.47px" class="cls_023">
            <span class="cls_023">if (err){</span>
        </div>
        <div style="position:absolute;left:158.40px;top:578.71px" class="cls_023">
            <span class="cls_023">console.log(err);</span>
        </div>
        <div style="position:absolute;left:158.40px;top:590.95px" class="cls_023">
            <span class="cls_023">return respond(false);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:603.19px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:147.60px;top:615.43px" class="cls_023">
            <span class="cls_023">console.log('Number found: ' + users.length);</span>
        </div>
        <div style="position:absolute;left:147.60px;top:627.67px" class="cls_023">
            <span class="cls_023">if (users.length) {</span>
        </div>
        <div style="position:absolute;left:158.40px;top:639.91px" class="cls_023">
            <span class="cls_023">respond(false); // validation failed</span>
        </div>
        <div style="position:absolute;left:293.14px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 102 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:92230px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background116.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:468.87px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 9</span>
        </div>
        <div style="position:absolute;left:147.60px;top:114.01px" class="cls_023">
            <span class="cls_023">} else {</span>
        </div>
        <div style="position:absolute;left:158.40px;top:126.25px" class="cls_023">
            <span class="cls_023">respond(true); // validation passed</span>
        </div>
        <div style="position:absolute;left:147.60px;top:138.49px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:150.73px" class="cls_023">
            <span class="cls_023">})</span>
        </div>
        <div style="position:absolute;left:126.00px;top:162.97px" class="cls_023">
            <span class="cls_023">}, 'Duplicate username');</span>
        </div>
        <div style="position:absolute;left:108.00px;top:191.40px" class="cls_027">
            <span class="cls_027">Extending Mongoose validation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:214.38px" class="cls_006">
            <span class="cls_006">While the validation functions you get with Mongoose are already pretty good,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:226.98px" class="cls_006">
            <span class="cls_006">you won't find everything there out-of-the-box. If you want validators for e-mail</span>
        </div>
        <div style="position:absolute;left:108.00px;top:239.58px" class="cls_006">
            <span class="cls_006">addresses, IP addresses, alphanumeric values, URLs—the list goes on—there are</span>
        </div>
        <div style="position:absolute;left:108.00px;top:252.18px" class="cls_006">
            <span class="cls_006">modules that can be installed and easily plugged in to your application. These all</span>
        </div>
        <div style="position:absolute;left:108.00px;top:264.78px" class="cls_006">
            <span class="cls_006">take advantage of Mongoose's plugin architecture, which we'll see in detail in </span>
            <span class="cls_021">Chapter</span>
        </div>
        <div style="position:absolute;left:108.00px;top:277.38px" class="cls_021">
            <span class="cls_021">11</span>
            <span class="cls_006">, </span>
            <span class="cls_021">Plugins - Reusing Code</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:309.88px" class="cls_022">
            <span class="cls_022">Adding validation to our project</span>
        </div>
        <div style="position:absolute;left:108.00px;top:334.86px" class="cls_006">
            <span class="cls_006">Now that we've done the theory, why not see if you can add some validation to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:347.46px" class="cls_006">
            <span class="cls_006">our MongoosePM application? We're not going to walk through this here, but do</span>
        </div>
        <div style="position:absolute;left:108.00px;top:360.06px" class="cls_006">
            <span class="cls_006">try it out yourself. If you're impatient you can of course just download the source</span>
        </div>
        <div style="position:absolute;left:108.00px;top:372.66px" class="cls_006">
            <span class="cls_006">code from Packt's website. The code contains various ways of achieving the same</span>
        </div>
        <div style="position:absolute;left:108.00px;top:385.26px" class="cls_006">
            <span class="cls_006">validation, commented out for reference.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:406.50px" class="cls_006">
            <span class="cls_006">For users, try adding the following validations:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:427.74px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> Name</span>
            <span class="cls_006">: Make this </span>
            <span class="cls_007">required</span>
            <span class="cls_006">, and with a minimum length of five characters</span>
        </div>
        <div style="position:absolute;left:126.00px;top:444.66px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> Email</span>
            <span class="cls_006">: Make this </span>
            <span class="cls_007">required</span>
            <span class="cls_006">, unique, and only allow a valid</span>
        </div>
        <div style="position:absolute;left:144.00px;top:457.26px" class="cls_006">
            <span class="cls_006">e-mail address</span>
        </div>
        <div style="position:absolute;left:253.08px;top:495.22px" class="cls_026">
            <span class="cls_026">Use a regular expression.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:528.86px" class="cls_006">
            <span class="cls_006">For projects, have a go at this:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:550.10px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_025"> projectName</span>
            <span class="cls_006">: Make this </span>
            <span class="cls_007">required</span>
            <span class="cls_006">, with a minimum length of five</span>
        </div>
        <div style="position:absolute;left:144.00px;top:562.70px" class="cls_006">
            <span class="cls_006">characters, and only accept unique values for each user</span>
        </div>
        <div style="position:absolute;left:253.08px;top:600.66px" class="cls_026">
            <span class="cls_026">Use an asynchronous validator.</span>
        </div>
        <div style="position:absolute;left:293.76px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 103 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:93032px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background117.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Validating Data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">To get the validation working for both users and projects, you will need to:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.74px" class="cls_006">
            <span class="cls_006">• Update the schemas to include validators</span>
        </div>
        <div style="position:absolute;left:126.00px;top:152.65px" class="cls_006">
            <span class="cls_006">• Update the create/edit controllers to interpret the error messages</span>
        </div>
        <div style="position:absolute;left:126.00px;top:169.57px" class="cls_006">
            <span class="cls_006">• Save the submitted data into a temporary session object</span>
        </div>
        <div style="position:absolute;left:126.00px;top:186.48px" class="cls_006">
            <span class="cls_006">• Update the form views to display the previously entered data</span>
        </div>
        <div style="position:absolute;left:107.99px;top:207.72px" class="cls_006">
            <span class="cls_006">If all else fails, download the source code for a few ideas!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:240.23px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:265.21px" class="cls_006">
            <span class="cls_006">In this chapter, we've seen how to use Mongoose to maintain the data integrity of</span>
        </div>
        <div style="position:absolute;left:108.00px;top:277.81px" class="cls_006">
            <span class="cls_006">our application. We have learned about the default validators that are available,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:290.41px" class="cls_006">
            <span class="cls_006">and also learned how to use them and how to create custom validators. Within the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:303.01px" class="cls_006">
            <span class="cls_006">custom validators, we've covered how to send custom error messages, add multiple</span>
        </div>
        <div style="position:absolute;left:108.00px;top:315.61px" class="cls_006">
            <span class="cls_006">validators, and run asynchronous validation. We also took a look at the error object</span>
        </div>
        <div style="position:absolute;left:108.00px;top:328.21px" class="cls_006">
            <span class="cls_006">returned when your validators find a problem with the data.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:349.46px" class="cls_006">
            <span class="cls_006">Coming up in the next chapter, we're going to take a look at complex schemas,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:362.06px" class="cls_006">
            <span class="cls_006">including nested documents and referencing other schemas.</span>
        </div>
        <div style="position:absolute;left:293.14px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 104 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:93834px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background118.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:252.24px;top:218.71px" class="cls_015">
            <span class="cls_015">Complex Schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:272.41px" class="cls_006">
            <span class="cls_006">In this chapter, we will explore the ways in which Mongoose can help you manage</span>
        </div>
        <div style="position:absolute;left:108.00px;top:285.01px" class="cls_006">
            <span class="cls_006">more complex data models. MongoDB is not a relational database, so there are no</span>
        </div>
        <div style="position:absolute;left:108.00px;top:297.61px" class="cls_006">
            <span class="cls_006">SQL-style </span>
            <span class="cls_007">JOIN</span>
            <span class="cls_006"> commands. Instead, we will introduce the concepts of </span>
            <span class="cls_025">population</span>
        </div>
        <div style="position:absolute;left:108.00px;top:310.21px" class="cls_006">
            <span class="cls_006">and </span>
            <span class="cls_025">subdocuments</span>
            <span class="cls_006">, exploring how they are used.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.46px" class="cls_006">
            <span class="cls_006">By the end of this chapter, you will understand the differences between the two,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.06px" class="cls_006">
            <span class="cls_006">and when each type is appropriate. We will also have added examples to our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:356.66px" class="cls_006">
            <span class="cls_006">MongoosePM application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:389.15px" class="cls_022">
            <span class="cls_022">Population - references to other</span>
        </div>
        <div style="position:absolute;left:108.00px;top:413.15px" class="cls_022">
            <span class="cls_022">collections</span>
        </div>
        <div style="position:absolute;left:108.00px;top:438.13px" class="cls_006">
            <span class="cls_006">MongoDB and Mongoose do not support </span>
            <span class="cls_007">JOIN</span>
            <span class="cls_006"> commands as MongoDB is not</span>
        </div>
        <div style="position:absolute;left:107.99px;top:450.73px" class="cls_006">
            <span class="cls_006">a relational database. Mongoose gives you an elegant way to achieve similar</span>
        </div>
        <div style="position:absolute;left:107.99px;top:463.33px" class="cls_006">
            <span class="cls_006">functionality by using population.</span>
        </div>
        <div style="position:absolute;left:173.16px;top:493.39px" class="cls_026">
            <span class="cls_026">The concept of Population was dramatically expanded upon in Version</span>
        </div>
        <div style="position:absolute;left:173.16px;top:504.79px" class="cls_026">
            <span class="cls_026">3.6 of Mongoose. Older versions won't support everything referenced</span>
        </div>
        <div style="position:absolute;left:173.16px;top:516.19px" class="cls_026">
            <span class="cls_026">in this chapter.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:541.93px" class="cls_006">
            <span class="cls_006">Population works by pulling information into the model you're currently using from</span>
        </div>
        <div style="position:absolute;left:108.00px;top:554.53px" class="cls_006">
            <span class="cls_006">a second model. Unlike </span>
            <span class="cls_007">JOIN</span>
            <span class="cls_006"> statements, these are actually separate queries. First</span>
        </div>
        <div style="position:absolute;left:108.00px;top:567.13px" class="cls_006">
            <span class="cls_006">you retrieve your primary set of data from a collection, and once that is returned,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:579.73px" class="cls_006">
            <span class="cls_006">you "populate" the required data from a secondary collection. We'll see this in some</span>
        </div>
        <div style="position:absolute;left:108.00px;top:592.33px" class="cls_006">
            <span class="cls_006">code very soon.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:94636px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background119.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Complex Schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Defining data for population</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">The first step to setting up population is in the schema. Your primary schema links</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">to the referenced model by passing an object containing the name of the model to be</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">used and the SchemaType of the linked schema object.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:181.89px" class="cls_006">
            <span class="cls_006">In our application, there are various times when it will be useful to get the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:194.49px" class="cls_006">
            <span class="cls_006">information about the person who created a specific project. Currently we store the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:207.08px" class="cls_007">
            <span class="cls_007">_id</span>
            <span class="cls_006"> of the user as a string, which we could use to manually query the users collection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:219.68px" class="cls_006">
            <span class="cls_006">once we have the data back from the projects collection. Or, we could store that </span>
            <span class="cls_007">_id</span>
        </div>
        <div style="position:absolute;left:108.00px;top:232.28px" class="cls_006">
            <span class="cls_006">as a reference and let Mongoose do the hard work for us. Sounds preferable to me!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:253.53px" class="cls_006">
            <span class="cls_006">Remember from the first paragraph of this section: Your primary schema links to the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:266.13px" class="cls_006">
            <span class="cls_006">referenced model by passing an object containing the name of the model to be used</span>
        </div>
        <div style="position:absolute;left:108.00px;top:278.73px" class="cls_006">
            <span class="cls_006">and the SchemaType of the linked schema object. So, by breaking this down, in our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:291.32px" class="cls_007">
            <span class="cls_007">projectSchema</span>
            <span class="cls_006"> we want to set the </span>
            <span class="cls_007">createdBy</span>
            <span class="cls_006"> path to be:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:312.57px" class="cls_006">
            <span class="cls_006">• An object </span>
            <span class="cls_007">{}</span>
        </div>
        <div style="position:absolute;left:126.00px;top:329.48px" class="cls_006">
            <span class="cls_006">• To contain the name of the model to be used—</span>
            <span class="cls_007">ref: 'User'</span>
        </div>
        <div style="position:absolute;left:126.00px;top:346.40px" class="cls_006">
            <span class="cls_006">• and the SchemaType of the linked schema object—</span>
            <span class="cls_007">type: mongoose.</span>
        </div>
        <div style="position:absolute;left:144.00px;top:360.00px" class="cls_007">
            <span class="cls_007">Schema.Types.ObjectId</span>
        </div>
        <div style="position:absolute;left:108.00px;top:380.24px" class="cls_006">
            <span class="cls_006">So, by putting this back together, we can change the </span>
            <span class="cls_007">createdBy</span>
            <span class="cls_006"> declaration in our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:392.84px" class="cls_007">
            <span class="cls_007">projectSchema</span>
            <span class="cls_006"> like this:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:413.78px" class="cls_023">
            <span class="cls_023">var projectSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:438.26px" class="cls_023">
            <span class="cls_023">createdBy: {type: mongoose.Schema.Types.ObjectId, ref: 'User'},</span>
        </div>
        <div style="position:absolute;left:126.00px;top:462.74px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:178.20px;top:491.30px" class="cls_007">
            <span class="cls_007">ObjectId</span>
            <span class="cls_026">, </span>
            <span class="cls_007">Number</span>
            <span class="cls_026">, </span>
            <span class="cls_007">String</span>
            <span class="cls_026">, and </span>
            <span class="cls_007">Buffer</span>
            <span class="cls_026"> are valid SchemaTypes</span>
        </div>
        <div style="position:absolute;left:178.20px;top:502.70px" class="cls_026">
            <span class="cls_026">for using as references. You only need to declare the full </span>
            <span class="cls_007">Schema.</span>
        </div>
        <div style="position:absolute;left:178.20px;top:514.10px" class="cls_007">
            <span class="cls_007">Type</span>
            <span class="cls_026"> path for </span>
            <span class="cls_007">ObjectId</span>
            <span class="cls_026">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:539.84px" class="cls_006">
            <span class="cls_006">Here we are saying that there is a one-to-one relationship between the </span>
            <span class="cls_007">User</span>
            <span class="cls_006"> model</span>
        </div>
        <div style="position:absolute;left:108.00px;top:552.44px" class="cls_006">
            <span class="cls_006">and the </span>
            <span class="cls_007">Project</span>
            <span class="cls_006"> model, but populate can also work with a one-to-many relationship</span>
        </div>
        <div style="position:absolute;left:108.00px;top:565.04px" class="cls_006">
            <span class="cls_006">by specifying an array of objects. If we want to record a number of contributors to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:577.64px" class="cls_006">
            <span class="cls_006">a project, we simply take what we have for the </span>
            <span class="cls_007">createdBy</span>
            <span class="cls_006"> definition and put it in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:590.24px" class="cls_006">
            <span class="cls_006">inside an array, like this:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:611.18px" class="cls_023">
            <span class="cls_023">var projectSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:635.66px" class="cls_023">
            <span class="cls_023">createdBy: {type: mongoose.Schema.Types.ObjectId, ref: 'User'},</span>
        </div>
        <div style="position:absolute;left:293.14px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 106 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:95438px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background120.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:464.37px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 10</span>
        </div>
        <div style="position:absolute;left:136.62px;top:114.01px" class="cls_023">
            <span class="cls_023">contributors: [ {type: mongoose.Schema.Types.ObjectId, ref: 'User'} ]</span>
        </div>
        <div style="position:absolute;left:126.00px;top:126.25px" class="cls_023">
            <span class="cls_023">,</span>
        </div>
        <div style="position:absolute;left:126.00px;top:150.73px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:170.46px" class="cls_006">
            <span class="cls_006">In MongoDB a document for this schema would look something like this:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:191.40px" class="cls_023">
            <span class="cls_023">{ "projectName" : "Population test",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:203.64px" class="cls_023">
            <span class="cls_023">"createdBy" : ObjectId("5126b7a1f8a44d1e32000001"),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:215.88px" class="cls_023">
            <span class="cls_023">"_id" : ObjectId("51ac2fc4c746ba1645000002"),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:228.12px" class="cls_023">
            <span class="cls_023">"contributors" : [</span>
        </div>
        <div style="position:absolute;left:147.60px;top:240.36px" class="cls_023">
            <span class="cls_023">ObjectId("5126b7a1f8a44d1e32000001"),</span>
        </div>
        <div style="position:absolute;left:147.60px;top:252.60px" class="cls_023">
            <span class="cls_023">ObjectId("5126b7a1f8a44d1e32000002") ] }</span>
        </div>
        <div style="position:absolute;left:178.20px;top:281.16px" class="cls_026">
            <span class="cls_026">Changing an existing schema like this can have serious impacts</span>
        </div>
        <div style="position:absolute;left:178.20px;top:292.56px" class="cls_026">
            <span class="cls_026">on the existing data and database. See the </span>
            <span class="cls_030">Data management when</span>
        </div>
        <div style="position:absolute;left:178.20px;top:303.96px" class="cls_030">
            <span class="cls_030">modifying existing schemas</span>
            <span class="cls_026"> section towards the end of this chapter.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:338.04px" class="cls_027">
            <span class="cls_027">Saving population references</span>
        </div>
        <div style="position:absolute;left:108.00px;top:361.02px" class="cls_006">
            <span class="cls_006">You don't have to do anything different to save a population reference, you just need</span>
        </div>
        <div style="position:absolute;left:108.00px;top:373.62px" class="cls_006">
            <span class="cls_006">to set the data and save a document the normal way. So we don't need to change our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:386.22px" class="cls_007">
            <span class="cls_007">Project.create</span>
            <span class="cls_006"> function at all:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:407.16px" class="cls_023">
            <span class="cls_023">Project.create({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:419.40px" class="cls_023">
            <span class="cls_023">projectName: req.body.projectName,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:431.64px" class="cls_023">
            <span class="cls_023">createdBy: req.body.userid,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:443.88px" class="cls_023">
            <span class="cls_023">createdOn : Date.now()</span>
        </div>
        <div style="position:absolute;left:126.00px;top:456.12px" class="cls_023">
            <span class="cls_023">}, function( err, project ){ …</span>
        </div>
        <div style="position:absolute;left:108.00px;top:484.56px" class="cls_027">
            <span class="cls_027">Retrieving populated data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:507.54px" class="cls_006">
            <span class="cls_006">Just like the </span>
            <span class="cls_007">JOIN</span>
            <span class="cls_006"> command you only use population when you need it. If you just</span>
        </div>
        <div style="position:absolute;left:108.00px;top:520.14px" class="cls_006">
            <span class="cls_006">want to return the project information with no mention of the creator's details then</span>
        </div>
        <div style="position:absolute;left:108.00px;top:532.74px" class="cls_006">
            <span class="cls_006">you can stick with the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:553.68px" class="cls_023">
            <span class="cls_023">Project.findById( req.params.id, function(err,project) { ...</span>
        </div>
        <div style="position:absolute;left:108.00px;top:573.42px" class="cls_006">
            <span class="cls_006">In our application, however, when we display the project information page—using</span>
        </div>
        <div style="position:absolute;left:108.00px;top:586.02px" class="cls_006">
            <span class="cls_006">the </span>
            <span class="cls_007">displayInfo</span>
            <span class="cls_006"> function in </span>
            <span class="cls_007">routes/project.js</span>
            <span class="cls_006">—we show the ID of the user who</span>
        </div>
        <div style="position:absolute;left:108.00px;top:598.62px" class="cls_006">
            <span class="cls_006">created the project. It would be much nicer if we could display the name and e-mail</span>
        </div>
        <div style="position:absolute;left:108.00px;top:611.22px" class="cls_006">
            <span class="cls_006">address instead.</span>
        </div>
        <div style="position:absolute;left:293.76px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 107 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:96240px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background121.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Complex Schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">To do this, you build a query, use the </span>
            <span class="cls_007">populate</span>
            <span class="cls_006"> command, and then </span>
            <span class="cls_007">exec()</span>
            <span class="cls_006"> when</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">ready. For example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.03px" class="cls_023">
            <span class="cls_023">Project</span>
        </div>
        <div style="position:absolute;left:126.00px;top:160.27px" class="cls_023">
            <span class="cls_023">.findById( req.params.id)</span>
        </div>
        <div style="position:absolute;left:126.00px;top:172.51px" class="cls_023">
            <span class="cls_023">.populate('createdBy')</span>
        </div>
        <div style="position:absolute;left:126.00px;top:184.75px" class="cls_023">
            <span class="cls_023">.exec(function(err,project) { ...</span>
        </div>
        <div style="position:absolute;left:108.00px;top:204.49px" class="cls_006">
            <span class="cls_006">This will populate with the entire user object, returning an object something like</span>
        </div>
        <div style="position:absolute;left:108.00px;top:217.09px" class="cls_006">
            <span class="cls_006">the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:238.03px" class="cls_023">
            <span class="cls_023">{ __v: 0,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:250.27px" class="cls_023">
            <span class="cls_023">_id: 51b495e01e686ea360000002,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:262.51px" class="cls_023">
            <span class="cls_023">createdBy:</span>
        </div>
        <div style="position:absolute;left:142.20px;top:274.75px" class="cls_023">
            <span class="cls_023">{ __v: 0,</span>
        </div>
        <div style="position:absolute;left:153.00px;top:286.99px" class="cls_023">
            <span class="cls_023">_id: 5126b7a1f8a44d1e32000001,</span>
        </div>
        <div style="position:absolute;left:153.00px;top:299.23px" class="cls_023">
            <span class="cls_023">email: 'simon@theholmesoffice.com',</span>
        </div>
        <div style="position:absolute;left:153.00px;top:311.47px" class="cls_023">
            <span class="cls_023">lastLogin: Sun Aug 04 2013 07:34:21 GMT+0100 (BST),</span>
        </div>
        <div style="position:absolute;left:153.00px;top:323.71px" class="cls_023">
            <span class="cls_023">modifiedOn: Sun Jul 28 2013 16:32:15 GMT+0100 (BST),</span>
        </div>
        <div style="position:absolute;left:153.00px;top:335.95px" class="cls_023">
            <span class="cls_023">name: 'Simon Holmes',</span>
        </div>
        <div style="position:absolute;left:153.00px;top:348.19px" class="cls_023">
            <span class="cls_023">createdOn: Fri Feb 22 2013 00:11:13 GMT+0000 (GMT) },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:360.43px" class="cls_023">
            <span class="cls_023">modifiedOn: Sun Jul 07 2013 16:21:50 GMT+0100 (BST),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:372.67px" class="cls_023">
            <span class="cls_023">projectName: 'Updated project schemas',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:384.91px" class="cls_023">
            <span class="cls_023">createdOn: Sun Jun 09 2013 15:49:04 GMT+0100 (BST) }</span>
        </div>
        <div style="position:absolute;left:108.00px;top:404.65px" class="cls_006">
            <span class="cls_006">All of this information about the user is unnecessary for us here, so we can specify</span>
        </div>
        <div style="position:absolute;left:108.00px;top:417.25px" class="cls_006">
            <span class="cls_006">the individual paths that we require. As we just want the name and e-mail of the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:429.85px" class="cls_006">
            <span class="cls_006">creator, we can specify the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:450.79px" class="cls_023">
            <span class="cls_023">.populate('createdBy', 'name email')</span>
        </div>
        <div style="position:absolute;left:108.00px;top:470.53px" class="cls_006">
            <span class="cls_006">You can also populate multiple paths in the parent schema at once. Although,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:483.13px" class="cls_006">
            <span class="cls_006">remember that each path is populated by a separate database query. If we wanted to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:495.73px" class="cls_006">
            <span class="cls_006">return an array of all contributors in a project, we could add the following path to the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:508.33px" class="cls_006">
            <span class="cls_006">populate call:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:529.27px" class="cls_023">
            <span class="cls_023">.populate('createdBy contributors')</span>
        </div>
        <div style="position:absolute;left:108.00px;top:549.01px" class="cls_006">
            <span class="cls_006">But if you want to return specific paths for each of the populated items—even if they</span>
        </div>
        <div style="position:absolute;left:108.00px;top:561.61px" class="cls_006">
            <span class="cls_006">are the same—you have to chain the populate calls as shown in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:582.55px" class="cls_023">
            <span class="cls_023">.populate('createdBy', 'name email')</span>
        </div>
        <div style="position:absolute;left:126.00px;top:594.79px" class="cls_023">
            <span class="cls_023">.populate('contributors', 'name email')</span>
        </div>
        <div style="position:absolute;left:293.14px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 108 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:97042px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background122.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:464.37px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 10</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">This will give us back more manageable data like this object:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:135.43px" class="cls_023">
            <span class="cls_023">{ __v: 0,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:147.67px" class="cls_023">
            <span class="cls_023">_id: 51b495e01e686ea360000002,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:159.91px" class="cls_023">
            <span class="cls_023">createdBy:</span>
        </div>
        <div style="position:absolute;left:142.20px;top:172.15px" class="cls_023">
            <span class="cls_023">{ _id: 5126b7a1f8a44d1e32000001,</span>
        </div>
        <div style="position:absolute;left:153.00px;top:184.39px" class="cls_023">
            <span class="cls_023">email: 'simon@theholmesoffice.com',</span>
        </div>
        <div style="position:absolute;left:153.00px;top:196.63px" class="cls_023">
            <span class="cls_023">name: 'Simon Holmes' },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:208.87px" class="cls_023">
            <span class="cls_023">modifiedOn: Sun Jul 07 2013 16:21:50 GMT+0100 (BST),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:221.11px" class="cls_023">
            <span class="cls_023">projectName: 'Updated project schemas',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:233.35px" class="cls_023">
            <span class="cls_023">createdOn: Sun Jun 09 2013 15:49:04 GMT+0100 (BST),</span>
        </div>
        <div style="position:absolute;left:136.80px;top:245.59px" class="cls_023">
            <span class="cls_023">contributors: [</span>
        </div>
        <div style="position:absolute;left:147.60px;top:257.83px" class="cls_023">
            <span class="cls_023">{ _id: 5126b7a1f8a44d1e32000001,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:270.07px" class="cls_023">
            <span class="cls_023">email: 'simon@theholmesoffice.com',</span>
        </div>
        <div style="position:absolute;left:158.40px;top:282.31px" class="cls_023">
            <span class="cls_023">name: 'Simon Holmes' },</span>
        </div>
        <div style="position:absolute;left:147.60px;top:294.55px" class="cls_023">
            <span class="cls_023">{ _id: 5126b7a1f8a44d1e32000002,</span>
        </div>
        <div style="position:absolute;left:158.40px;top:306.79px" class="cls_023">
            <span class="cls_023">email: 'someone@theholmesoffice.com',</span>
        </div>
        <div style="position:absolute;left:158.40px;top:319.03px" class="cls_023">
            <span class="cls_023">name: 'Someone Else' }</span>
        </div>
        <div style="position:absolute;left:136.80px;top:331.27px" class="cls_023">
            <span class="cls_023">]</span>
        </div>
        <div style="position:absolute;left:126.00px;top:343.51px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:370.11px" class="cls_013">
            <span class="cls_013">Querying to return a subset of results</span>
        </div>
        <div style="position:absolute;left:108.00px;top:391.09px" class="cls_006">
            <span class="cls_006">When populating data with a one-to-many relationship, you may well want to return</span>
        </div>
        <div style="position:absolute;left:108.00px;top:403.69px" class="cls_006">
            <span class="cls_006">a subset just like you might with a standard </span>
            <span class="cls_007">find</span>
            <span class="cls_006"> operation. So far we've been using</span>
        </div>
        <div style="position:absolute;left:108.00px;top:416.29px" class="cls_006">
            <span class="cls_006">syntactic shortcuts for the populate method, but Mongoose does give you the option</span>
        </div>
        <div style="position:absolute;left:108.00px;top:428.89px" class="cls_006">
            <span class="cls_006">of sending a query object for population, with the following parameters:</span>
        </div>
        <div style="position:absolute;left:125.99px;top:450.13px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> path</span>
            <span class="cls_006">: This is the path to populate and is </span>
            <span class="cls_007">required</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:465.61px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> select</span>
            <span class="cls_006">: This is a string or object specifying which paths to return.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:481.09px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> model</span>
            <span class="cls_006">: This is the name of the model you want to populate from. It defaults</span>
        </div>
        <div style="position:absolute;left:144.00px;top:493.69px" class="cls_006">
            <span class="cls_006">to the reference specified in the schema if not declared here.</span>
        </div>
        <div style="position:absolute;left:126.01px;top:509.17px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> match</span>
            <span class="cls_006">: This can specify query conditions.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:524.65px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> options</span>
            <span class="cls_006">: This can specify query options.</span>
        </div>
        <div style="position:absolute;left:107.99px;top:545.90px" class="cls_006">
            <span class="cls_006">So if we wanted to populate a maximum of five contributors who have an e-mail</span>
        </div>
        <div style="position:absolute;left:107.99px;top:558.49px" class="cls_006">
            <span class="cls_006">address at </span>
            <span class="cls_007">theholmesoffice.com</span>
            <span class="cls_006">, to sort them by name and return name and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:571.09px" class="cls_007">
            <span class="cls_007">lastLogin</span>
            <span class="cls_006"> information we could do the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:592.03px" class="cls_023">
            <span class="cls_023">.populate({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:604.27px" class="cls_023">
            <span class="cls_023">path: 'contributors',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:616.51px" class="cls_023">
            <span class="cls_023">match: { email: /@theholmesoffice\.com/i },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:628.75px" class="cls_023">
            <span class="cls_023">select: 'name lastLogin',</span>
        </div>
        <div style="position:absolute;left:293.76px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 109 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:97844px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background123.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Complex Schemas</span>
        </div>
        <div style="position:absolute;left:136.80px;top:114.01px" class="cls_023">
            <span class="cls_023">options: { limit: 5, sort: 'name' }</span>
        </div>
        <div style="position:absolute;left:126.00px;top:126.25px" class="cls_023">
            <span class="cls_023">})</span>
        </div>
        <div style="position:absolute;left:126.00px;top:138.49px" class="cls_023">
            <span class="cls_023">.exec()</span>
        </div>
        <div style="position:absolute;left:108.00px;top:158.22px" class="cls_006">
            <span class="cls_006">We don't want to do this right now, but it's nice to know that we could!</span>
        </div>
        <div style="position:absolute;left:108.00px;top:186.32px" class="cls_013">
            <span class="cls_013">Populating into multiple parent items</span>
        </div>
        <div style="position:absolute;left:108.00px;top:207.30px" class="cls_006">
            <span class="cls_006">Up to now all of our examples have been related to populating into a single-parent</span>
        </div>
        <div style="position:absolute;left:108.00px;top:219.90px" class="cls_006">
            <span class="cls_006">project. But this isn't a limitation of Mongoose. If your query on the primary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:232.50px" class="cls_006">
            <span class="cls_006">collection returns multiple documents, you can easily populate into them See</span>
        </div>
        <div style="position:absolute;left:108.00px;top:245.10px" class="cls_006">
            <span class="cls_006">the following example:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:266.04px" class="cls_023">
            <span class="cls_023">Project</span>
        </div>
        <div style="position:absolute;left:126.00px;top:278.28px" class="cls_023">
            <span class="cls_023">.find({ createdBy: userid }, 'projectName')</span>
        </div>
        <div style="position:absolute;left:126.00px;top:290.52px" class="cls_023">
            <span class="cls_023">.populate('createdBy', 'name')</span>
        </div>
        <div style="position:absolute;left:126.00px;top:302.76px" class="cls_023">
            <span class="cls_023">.exec(function(err,projects) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:315.00px" class="cls_023">
            <span class="cls_023">projects.forEach(function (project) {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:327.24px" class="cls_023">
            <span class="cls_023">console.log(project.projectName + ' created by' + project.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:338.04px" class="cls_023">
            <span class="cls_023">createdBy.name);</span>
        </div>
        <div style="position:absolute;left:136.80px;top:350.28px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:362.52px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:393.52px" class="cls_022">
            <span class="cls_022">Subdocuments</span>
        </div>
        <div style="position:absolute;left:108.00px;top:418.50px" class="cls_025">
            <span class="cls_025">Subdocuments</span>
            <span class="cls_006"> are very similar to the ordinary documents we have been using so</span>
        </div>
        <div style="position:absolute;left:108.00px;top:431.10px" class="cls_006">
            <span class="cls_006">far. They are individual documents with their own schema. The big difference is that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:443.70px" class="cls_006">
            <span class="cls_006">subdocuments are documents that are stored within a parent document, instead of a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:456.30px" class="cls_006">
            <span class="cls_006">MongoDB collection of their own.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:477.54px" class="cls_006">
            <span class="cls_006">Perhaps an example will demonstrate this best. In our MongoosePM application,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:490.14px" class="cls_006">
            <span class="cls_006">tasks are currently lacking in functionality as </span>
            <span class="cls_007">tasks</span>
            <span class="cls_006"> for a given project is just a string.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:502.74px" class="cls_006">
            <span class="cls_006">It would be better if a task had a distinct schema like the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:523.68px" class="cls_023">
            <span class="cls_023">var taskSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:535.92px" class="cls_023">
            <span class="cls_023">taskName: { type: String, required: true, validate: validateLength</span>
        </div>
        <div style="position:absolute;left:126.00px;top:546.72px" class="cls_023">
            <span class="cls_023">},</span>
        </div>
        <div style="position:absolute;left:136.80px;top:558.96px" class="cls_023">
            <span class="cls_023">taskDesc: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:571.20px" class="cls_023">
            <span class="cls_023">createdOn: { type: Date, default: Date.now },</span>
        </div>
        <div style="position:absolute;left:136.80px;top:583.44px" class="cls_023">
            <span class="cls_023">createdBy: { type: mongoose.Schema.Types.ObjectId, ref: 'User',</span>
        </div>
        <div style="position:absolute;left:126.00px;top:594.24px" class="cls_023">
            <span class="cls_023">required: true},</span>
        </div>
        <div style="position:absolute;left:136.80px;top:606.48px" class="cls_023">
            <span class="cls_023">modifiedOn: Date,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:618.72px" class="cls_023">
            <span class="cls_023">assignedTo: { type: mongoose.Schema.Types.ObjectId, ref: 'User' }</span>
        </div>
        <div style="position:absolute;left:126.00px;top:630.96px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:293.36px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 110 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:98646px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background124.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:464.37px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 10</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">This schema looks a bit more useful right? In a relational database this would be</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">a standalone table, and you would run joins between the project table, task table,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">and user table. But in a non-relational datastore, the better approach is to contain</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.29px" class="cls_006">
            <span class="cls_006">documents solely owned by a parent document, </span>
            <span class="cls_021">within</span>
            <span class="cls_006"> the parent document. To do</span>
        </div>
        <div style="position:absolute;left:108.00px;top:164.89px" class="cls_006">
            <span class="cls_006">this, we reference the new </span>
            <span class="cls_007">taskSchema</span>
            <span class="cls_006"> within the </span>
            <span class="cls_007">projectSchema</span>
            <span class="cls_006"> as an array like</span>
        </div>
        <div style="position:absolute;left:108.00px;top:177.49px" class="cls_006">
            <span class="cls_006">the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:198.43px" class="cls_023">
            <span class="cls_023">var projectSchema = new mongoose.Schema({</span>
        </div>
        <div style="position:absolute;left:136.80px;top:210.67px" class="cls_023">
            <span class="cls_023">projectName: String,</span>
        </div>
        <div style="position:absolute;left:136.80px;top:222.91px" class="cls_023">
            <span class="cls_023">…</span>
        </div>
        <div style="position:absolute;left:136.80px;top:235.15px" class="cls_023">
            <span class="cls_023">tasks: [taskSchema]</span>
        </div>
        <div style="position:absolute;left:126.00px;top:247.39px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:267.13px" class="cls_006">
            <span class="cls_006">Hey presto, a nested schema! So what does our data look like if we use this?</span>
        </div>
        <div style="position:absolute;left:108.00px;top:279.73px" class="cls_006">
            <span class="cls_006">Each task subdocument created goes into the array of </span>
            <span class="cls_007">tasks</span>
            <span class="cls_006"> as defined in the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:292.33px" class="cls_007">
            <span class="cls_007">projectSchema</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:313.27px" class="cls_023">
            <span class="cls_023">{</span>
        </div>
        <div style="position:absolute;left:136.80px;top:325.51px" class="cls_023">
            <span class="cls_023">"projectName" : "Project 2",</span>
        </div>
        <div style="position:absolute;left:136.80px;top:337.75px" class="cls_023">
            <span class="cls_023">"tasks" : [</span>
        </div>
        <div style="position:absolute;left:158.40px;top:349.99px" class="cls_023">
            <span class="cls_023">"taskName" : "A task please",</span>
        </div>
        <div style="position:absolute;left:158.40px;top:362.23px" class="cls_023">
            <span class="cls_023">"taskDesc" : "A short description of the task",</span>
        </div>
        <div style="position:absolute;left:158.40px;top:374.47px" class="cls_023">
            <span class="cls_023">"createdBy" : ObjectId("5126b7a1f8a44d1e32000001"),</span>
        </div>
        <div style="position:absolute;left:158.40px;top:386.71px" class="cls_023">
            <span class="cls_023">"_id" : ObjectId("51ad7d6cfa492a174a000005"),</span>
        </div>
        <div style="position:absolute;left:158.40px;top:398.95px" class="cls_023">
            <span class="cls_023">"createdOn" : ISODate("2013-06-04T05:38:52.847Z")</span>
        </div>
        <div style="position:absolute;left:147.60px;top:411.19px" class="cls_023">
            <span class="cls_023">},</span>
        </div>
        <div style="position:absolute;left:147.60px;top:423.43px" class="cls_023">
            <span class="cls_023">{</span>
        </div>
        <div style="position:absolute;left:158.40px;top:435.67px" class="cls_023">
            <span class="cls_023">"createdBy" : ObjectId("5126b7a1f8a44d1e32000002"),</span>
        </div>
        <div style="position:absolute;left:158.40px;top:447.91px" class="cls_023">
            <span class="cls_023">"_id" : ObjectId("51ad7d80fa492a174a000006"),</span>
        </div>
        <div style="position:absolute;left:158.40px;top:460.15px" class="cls_023">
            <span class="cls_023">"createdOn" : ISODate("2013-06-04T05:39:12.728Z"),</span>
        </div>
        <div style="position:absolute;left:158.40px;top:472.39px" class="cls_023">
            <span class="cls_023">"modifiedOn" : ISODate("2013-06-04T05:39:48.553Z"),</span>
        </div>
        <div style="position:absolute;left:158.40px;top:484.63px" class="cls_023">
            <span class="cls_023">"taskDesc" : "A quick description of this one too",</span>
        </div>
        <div style="position:absolute;left:158.40px;top:496.87px" class="cls_023">
            <span class="cls_023">"taskName" : "A secondary task"</span>
        </div>
        <div style="position:absolute;left:147.60px;top:509.11px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:136.80px;top:521.35px" class="cls_023">
            <span class="cls_023">]</span>
        </div>
        <div style="position:absolute;left:126.00px;top:533.59px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:195.48px;top:564.35px" class="cls_026">
            <span class="cls_026">Mongoose will automatically give each subdocument a</span>
        </div>
        <div style="position:absolute;left:195.48px;top:575.75px" class="cls_026">
            <span class="cls_026">unique </span>
            <span class="cls_007">_id</span>
            <span class="cls_026"> unless overridden in the schema.</span>
        </div>
        <div style="position:absolute;left:294.21px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 111 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:99448px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background125.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Complex Schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Creating subdocuments</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">Creating subdocuments is super easy. When working with subdocuments we always</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">have to go through the parent document. We also need to remember that each</span>
        </div>
        <div style="position:absolute;left:108.00px;top:160.64px" class="cls_006">
            <span class="cls_006">individual subdocument is a document in its own right, stored inside an array.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:181.89px" class="cls_006">
            <span class="cls_006">So if we want to add a new task to an existing project, we would need to:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:203.13px" class="cls_006">
            <span class="cls_006">1.</span>
        </div>
        <div style="position:absolute;left:143.99px;top:203.13px" class="cls_006">
            <span class="cls_006">Find the project in the database</span>
        </div>
        <div style="position:absolute;left:126.00px;top:220.04px" class="cls_006">
            <span class="cls_006">2.</span>
        </div>
        <div style="position:absolute;left:143.99px;top:220.04px" class="cls_006">
            <span class="cls_006">Push a task object to the tasks path</span>
        </div>
        <div style="position:absolute;left:126.00px;top:236.96px" class="cls_006">
            <span class="cls_006">3.</span>
        </div>
        <div style="position:absolute;left:143.99px;top:236.96px" class="cls_006">
            <span class="cls_006">Save the parent document.</span>
        </div>
        <div style="position:absolute;left:143.99px;top:253.87px" class="cls_006">
            <span class="cls_006">The code to do this looks like the following:</span>
        </div>
        <div style="position:absolute;left:144.00px;top:274.82px" class="cls_023">
            <span class="cls_023">Project.findById( req.body.projectID, 'tasks modifiedOn',</span>
        </div>
        <div style="position:absolute;left:154.80px;top:287.06px" class="cls_023">
            <span class="cls_023">function (err, project) {</span>
        </div>
        <div style="position:absolute;left:165.60px;top:299.30px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:176.40px;top:311.54px" class="cls_023">
            <span class="cls_023">project.tasks.push({</span>
        </div>
        <div style="position:absolute;left:187.20px;top:323.78px" class="cls_023">
            <span class="cls_023">taskName: req.body.taskName,</span>
        </div>
        <div style="position:absolute;left:187.20px;top:336.02px" class="cls_023">
            <span class="cls_023">taskDesc: req.body.taskDesc,</span>
        </div>
        <div style="position:absolute;left:187.20px;top:348.26px" class="cls_023">
            <span class="cls_023">createdBy: req.session.user._id</span>
        </div>
        <div style="position:absolute;left:176.40px;top:360.50px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:176.40px;top:372.74px" class="cls_023">
            <span class="cls_023">project.modifiedOn = Date.now();</span>
        </div>
        <div style="position:absolute;left:176.40px;top:384.98px" class="cls_023">
            <span class="cls_023">project.save(function (err, project){</span>
        </div>
        <div style="position:absolute;left:187.20px;top:397.22px" class="cls_023">
            <span class="cls_023">if(err){</span>
        </div>
        <div style="position:absolute;left:198.00px;top:409.46px" class="cls_023">
            <span class="cls_023">console.log('Oh dear', err);</span>
        </div>
        <div style="position:absolute;left:187.20px;top:421.70px" class="cls_023">
            <span class="cls_023">} else {</span>
        </div>
        <div style="position:absolute;left:198.00px;top:433.94px" class="cls_023">
            <span class="cls_023">console.log('Task saved: ' + req.body.taskName);</span>
        </div>
        <div style="position:absolute;left:198.00px;top:446.18px" class="cls_023">
            <span class="cls_023">res.redirect( '/project/' + req.body.projectID );</span>
        </div>
        <div style="position:absolute;left:187.20px;top:458.42px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:176.40px;top:470.66px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:165.60px;top:482.90px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:154.80px;top:495.14px" class="cls_023">
            <span class="cls_023">}</span>
        </div>
        <div style="position:absolute;left:144.00px;top:507.38px" class="cls_023">
            <span class="cls_023">);</span>
        </div>
        <div style="position:absolute;left:108.00px;top:533.98px" class="cls_013">
            <span class="cls_013">Saving and validation</span>
        </div>
        <div style="position:absolute;left:108.00px;top:554.96px" class="cls_006">
            <span class="cls_006">You may have noticed in the code earlier that we don't explicitly save the new</span>
        </div>
        <div style="position:absolute;left:108.00px;top:567.56px" class="cls_006">
            <span class="cls_006">subdocument. Subdocuments are saved when their parent document is saved.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:588.81px" class="cls_006">
            <span class="cls_006">Any validator errors set in the subdocument schema are bubbled back up to the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:601.40px" class="cls_006">
            <span class="cls_006">parent document, so the existing </span>
            <span class="cls_007">if(err)</span>
            <span class="cls_006"> catches in the code are all that we need.</span>
        </div>
        <div style="position:absolute;left:293.36px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 112 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:100250px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background126.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:464.37px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 10</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Retrieving subdocuments</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">As we have already learned, to get access to the subdocuments, you have to go</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">through the parent document, and that subdocuments are stored as an array.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:169.29px" class="cls_006">
            <span class="cls_006">So if we want to display a list of tasks on our project page, we don't need to change</span>
        </div>
        <div style="position:absolute;left:108.00px;top:181.88px" class="cls_006">
            <span class="cls_006">any JavaScript, as our </span>
            <span class="cls_007">displayInfo</span>
            <span class="cls_006"> function is already passing the tasks data to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:194.48px" class="cls_006">
            <span class="cls_006">the Jade template. We simply need to change how tasks are interpreted in </span>
            <span class="cls_007">views/</span>
        </div>
        <div style="position:absolute;left:108.00px;top:207.08px" class="cls_007">
            <span class="cls_007">project-page.jade</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:228.02px" class="cls_023">
            <span class="cls_023">if tasks.length > 0</span>
        </div>
        <div style="position:absolute;left:136.80px;top:240.26px" class="cls_023">
            <span class="cls_023">ul</span>
        </div>
        <div style="position:absolute;left:147.60px;top:252.50px" class="cls_023">
            <span class="cls_023">for task in tasks</span>
        </div>
        <div style="position:absolute;left:158.40px;top:264.74px" class="cls_023">
            <span class="cls_023">li</span>
        </div>
        <div style="position:absolute;left:169.20px;top:276.98px" class="cls_023">
            <span class="cls_023">a(href="/project/#{projectID}/task/edit/#{task._id}",</span>
        </div>
        <div style="position:absolute;left:126.00px;top:287.78px" class="cls_023">
            <span class="cls_023">title="#{task.taskDesc}") #{task.taskName}</span>
        </div>
        <div style="position:absolute;left:108.00px;top:314.38px" class="cls_013">
            <span class="cls_013">Accessing a specific subdocument</span>
        </div>
        <div style="position:absolute;left:108.00px;top:335.36px" class="cls_006">
            <span class="cls_006">As we saw earlier, each subdocument has a unique </span>
            <span class="cls_007">_id</span>
            <span class="cls_006"> field. When you pass</span>
        </div>
        <div style="position:absolute;left:108.00px;top:347.96px" class="cls_006">
            <span class="cls_006">this to the subdocument method </span>
            <span class="cls_007">.id()</span>
            <span class="cls_006"> that Mongoose provides, you will get the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:360.56px" class="cls_006">
            <span class="cls_006">subdocument returned to you.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:381.50px" class="cls_023">
            <span class="cls_023">Project.findById( req.body.projectID, 'tasks modifiedOn',</span>
        </div>
        <div style="position:absolute;left:136.80px;top:393.74px" class="cls_023">
            <span class="cls_023">function (err, project) {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:405.98px" class="cls_023">
            <span class="cls_023">if(!err){</span>
        </div>
        <div style="position:absolute;left:158.40px;top:418.22px" class="cls_023">
            <span class="cls_023">console.log(project.tasks); // array of tasks</span>
        </div>
        <div style="position:absolute;left:158.40px;top:430.46px" class="cls_024">
            <span class="cls_024">var thisTask = project.tasks.id(req.params.taskID);</span>
        </div>
        <div style="position:absolute;left:158.40px;top:442.70px" class="cls_023">
            <span class="cls_023">console.log(thisTask); // individual task document</span>
        </div>
        <div style="position:absolute;left:147.60px;top:454.94px" class="cls_023">
            <span class="cls_023">}});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:474.68px" class="cls_006">
            <span class="cls_006">This means that when you want to edit or delete a specific subdocument, you need to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:487.28px" class="cls_006">
            <span class="cls_006">know the </span>
            <span class="cls_007">_id</span>
            <span class="cls_006"> of the parent document </span>
            <span class="cls_021">and</span>
            <span class="cls_006"> the </span>
            <span class="cls_007">_id</span>
            <span class="cls_006"> of the subdocument. To this end,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:499.88px" class="cls_006">
            <span class="cls_006">in our project there are some new routes where we will need to pass both </span>
            <span class="cls_007">_id</span>
            <span class="cls_006"> values</span>
        </div>
        <div style="position:absolute;left:108.00px;top:512.48px" class="cls_006">
            <span class="cls_006">as URL parameters.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:533.42px" class="cls_023">
            <span class="cls_023">app.get('/project/:id/task/edit/:taskID', project.editTask);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:544.22px" class="cls_023">
            <span class="cls_023">app.post('/project/:id/task/edit/:taskID', project.doEditTask);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:555.02px" class="cls_023">
            <span class="cls_023">app.get('/project/:id/task/delete/:taskID',</span>
        </div>
        <div style="position:absolute;left:126.00px;top:565.82px" class="cls_023">
            <span class="cls_023">project.confirmDeleteTask);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:578.06px" class="cls_023">
            <span class="cls_023">app.post('/project/:id/task/delete/:taskID',</span>
        </div>
        <div style="position:absolute;left:126.00px;top:588.86px" class="cls_023">
            <span class="cls_023">project.doDeleteTask);</span>
        </div>
        <div style="position:absolute;left:293.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 113 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:101052px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background127.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Complex Schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:112.46px" class="cls_027">
            <span class="cls_027">Deleting subdocuments</span>
        </div>
        <div style="position:absolute;left:108.00px;top:135.44px" class="cls_006">
            <span class="cls_006">Mongoose couldn't make deleting subdocuments much easier for you. By chaining to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:148.04px" class="cls_006">
            <span class="cls_006">the </span>
            <span class="cls_007">.id()</span>
            <span class="cls_006"> method in the earlier code, you can add the </span>
            <span class="cls_007">.remove()</span>
            <span class="cls_006"> method.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:168.98px" class="cls_023">
            <span class="cls_023">project.tasks.id(req.body.taskID).remove();</span>
        </div>
        <div style="position:absolute;left:179.64px;top:199.74px" class="cls_026">
            <span class="cls_026">As with all changes to subdocuments, a removed subdocument</span>
        </div>
        <div style="position:absolute;left:179.64px;top:211.14px" class="cls_026">
            <span class="cls_026">won't actually be deleted until the parent document is saved.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:249.98px" class="cls_022">
            <span class="cls_022">Data management when modifying</span>
        </div>
        <div style="position:absolute;left:108.00px;top:273.98px" class="cls_022">
            <span class="cls_022">existing schemas</span>
        </div>
        <div style="position:absolute;left:108.00px;top:298.96px" class="cls_006">
            <span class="cls_006">If you have taken all of the changes outlined in this chapter and added them to your</span>
        </div>
        <div style="position:absolute;left:108.00px;top:311.56px" class="cls_006">
            <span class="cls_006">application, you'll probably notice quite early that the list of projects on the user page</span>
        </div>
        <div style="position:absolute;left:108.00px;top:324.16px" class="cls_006">
            <span class="cls_006">doesn't display. This is because we have changed the </span>
            <span class="cls_007">schemaType</span>
            <span class="cls_006"> of </span>
            <span class="cls_007">createdBy</span>
            <span class="cls_006"> in</span>
        </div>
        <div style="position:absolute;left:108.00px;top:336.76px" class="cls_007">
            <span class="cls_007">projectSchema</span>
            <span class="cls_006"> from </span>
            <span class="cls_007">String</span>
            <span class="cls_006"> to </span>
            <span class="cls_007">ObjectId</span>
            <span class="cls_006">. If you create new projects now, they will</span>
        </div>
        <div style="position:absolute;left:108.00px;top:349.36px" class="cls_006">
            <span class="cls_006">show up in the list.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:370.61px" class="cls_006">
            <span class="cls_006">In a development environment and a prototyping scenario, like we have here, this</span>
        </div>
        <div style="position:absolute;left:108.00px;top:383.21px" class="cls_006">
            <span class="cls_006">isn't a major issue as we can just add in some more temporary test data. If you're</span>
        </div>
        <div style="position:absolute;left:108.00px;top:395.81px" class="cls_006">
            <span class="cls_006">dealing with a live environment or pre-existing data that you want to use then you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:408.41px" class="cls_006">
            <span class="cls_006">have to be a bit more careful when changing a schema in this way.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:429.65px" class="cls_006">
            <span class="cls_006">There are various ways you can handle this, both on the schema side and the data</span>
        </div>
        <div style="position:absolute;left:108.00px;top:442.25px" class="cls_006">
            <span class="cls_006">management side. A possible approach is to duplicate the existing schema in its</span>
        </div>
        <div style="position:absolute;left:108.00px;top:454.85px" class="cls_006">
            <span class="cls_006">entirety and changing the SchemaTypes that you need to.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:476.09px" class="cls_006">
            <span class="cls_006">To manage the data migration you could then either create a script to update all at</span>
        </div>
        <div style="position:absolute;left:108.00px;top:488.69px" class="cls_006">
            <span class="cls_006">once, or update on an ongoing "as needed" basis. If you have a large dataset, you'll</span>
        </div>
        <div style="position:absolute;left:108.00px;top:501.29px" class="cls_006">
            <span class="cls_006">probably want to favor the latter for performance reasons. However you choose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:513.89px" class="cls_006">
            <span class="cls_006">to manage it, comes down to a judgment call each time based on latency, potential</span>
        </div>
        <div style="position:absolute;left:108.00px;top:526.49px" class="cls_006">
            <span class="cls_006">downtime, code complexity, and any other application specific consideration.</span>
        </div>
        <div style="position:absolute;left:293.36px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 114 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:101854px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background128.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:464.37px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 10</span>
        </div>
        <div style="position:absolute;left:108.00px;top:111.92px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:136.90px" class="cls_006">
            <span class="cls_006">In this chapter, we've seen how Mongoose helps us to create and use more complex</span>
        </div>
        <div style="position:absolute;left:108.00px;top:149.50px" class="cls_006">
            <span class="cls_006">database structures. We can use nested schemas and subdocuments and also pull</span>
        </div>
        <div style="position:absolute;left:108.00px;top:162.10px" class="cls_006">
            <span class="cls_006">data from other collections. Our code examples can be used as the basis for updating</span>
        </div>
        <div style="position:absolute;left:108.00px;top:174.70px" class="cls_006">
            <span class="cls_006">our MongoosePM application with better task information and returning user details</span>
        </div>
        <div style="position:absolute;left:108.00px;top:187.30px" class="cls_006">
            <span class="cls_006">with projects. Download the code for this chapter from Packt Publishing's website to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:199.90px" class="cls_006">
            <span class="cls_006">see it in greater detail.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:221.14px" class="cls_006">
            <span class="cls_006">Coming up next in the final chapter, we're going to look at how to re-use code using</span>
        </div>
        <div style="position:absolute;left:108.00px;top:233.74px" class="cls_006">
            <span class="cls_006">Mongoose plugins.</span>
        </div>
        <div style="position:absolute;left:293.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 115 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:102656px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background129.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:103458px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background130.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:172.14px;top:218.71px" class="cls_015">
            <span class="cls_015">Plugins - Re-using Code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:272.41px" class="cls_006">
            <span class="cls_006">In this chapter, we will introduce the Mongoose plugin architecture and see how we</span>
        </div>
        <div style="position:absolute;left:108.00px;top:285.01px" class="cls_006">
            <span class="cls_006">can use it to create modular re-usable code. We will look at the syntax and how to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:297.61px" class="cls_006">
            <span class="cls_006">write them and include them in our code.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:318.86px" class="cls_006">
            <span class="cls_006">By the end of this chapter, you will understand how to create and use Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.46px" class="cls_006">
            <span class="cls_006">plugins. You will also know where to go to find existing plugins that others have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:344.06px" class="cls_006">
            <span class="cls_006">written, and contribute to the community by submitting your own. You will have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:356.66px" class="cls_006">
            <span class="cls_006">created some plugins in the MongoosePM application.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:389.15px" class="cls_022">
            <span class="cls_022">Reusable schema plugins</span>
        </div>
        <div style="position:absolute;left:108.00px;top:414.13px" class="cls_006">
            <span class="cls_006">If we look at our schemas, we can see some common elements that we are repeating.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:426.73px" class="cls_006">
            <span class="cls_006">For example, each of our schemas has an identical </span>
            <span class="cls_007">modifiedOn</span>
            <span class="cls_006"> path, and our project</span>
        </div>
        <div style="position:absolute;left:108.01px;top:439.33px" class="cls_006">
            <span class="cls_006">and task schemas each have identical </span>
            <span class="cls_007">createdBy</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">createdOn</span>
            <span class="cls_006"> paths.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:460.58px" class="cls_006">
            <span class="cls_006">If you're at all familiar with the DRY (Don't Repeat Yourself) principle of coding,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:473.18px" class="cls_006">
            <span class="cls_006">you'll probably want to tidy these bits up and just declare them once. This is where</span>
        </div>
        <div style="position:absolute;left:108.00px;top:485.78px" class="cls_006">
            <span class="cls_006">the Mongoose plugin architecture comes in.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:515.71px" class="cls_027">
            <span class="cls_027">Creating a schema plugin</span>
        </div>
        <div style="position:absolute;left:108.00px;top:538.69px" class="cls_006">
            <span class="cls_006">Let's start by creating a schema extension for adding </span>
            <span class="cls_007">createdOn</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">createdBy</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:551.29px" class="cls_006">
            <span class="cls_006">Inside our </span>
            <span class="cls_007">model/db.js</span>
            <span class="cls_006"> file, we can add the following code, preferably above the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:563.89px" class="cls_006">
            <span class="cls_006">definitions for our two schemas:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:584.83px" class="cls_023">
            <span class="cls_023">var creationInfo = function creationInfo (schema, options) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:597.07px" class="cls_023">
            <span class="cls_023">schema.add({createdOn: { type: Date, default: Date.now }});</span>
        </div>
        <div style="position:absolute;left:136.80px;top:609.31px" class="cls_023">
            <span class="cls_023">schema.add({createdBy: { type: mongoose.Schema.Types.ObjectId, ref:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:620.11px" class="cls_023">
            <span class="cls_023">'User', required: true}});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:632.35px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:104260px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background131.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Plugins - Re-using Code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">This exposes a function that will allow us to plug in the paths </span>
            <span class="cls_007">createdOn</span>
            <span class="cls_006"> and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_007">
            <span class="cls_007">createdBy</span>
            <span class="cls_006">, to some of our schemas. The construct might look a little strange, but is</span>
        </div>
        <div style="position:absolute;left:108.00px;top:139.69px" class="cls_006">
            <span class="cls_006">done in this way to allow us to easily take it into a separate file as a plugin. But more</span>
        </div>
        <div style="position:absolute;left:108.00px;top:152.29px" class="cls_006">
            <span class="cls_006">on that later.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:180.39px" class="cls_013">
            <span class="cls_013">Applying the plugin to an existing schema</span>
        </div>
        <div style="position:absolute;left:108.00px;top:201.37px" class="cls_006">
            <span class="cls_006">The next step is to pull these paths into our existing schemas. We can update</span>
        </div>
        <div style="position:absolute;left:108.00px;top:213.97px" class="cls_006">
            <span class="cls_006">our </span>
            <span class="cls_007">projectSchema</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">taskSchema</span>
            <span class="cls_006"> definitions to remove the </span>
            <span class="cls_007">createdOn</span>
            <span class="cls_006"> and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:226.57px" class="cls_007">
            <span class="cls_007">createdBy</span>
            <span class="cls_006"> paths. Instead, after each of the schemas are defined, we can link the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:239.17px" class="cls_007">
            <span class="cls_007">creationInfo</span>
            <span class="cls_006"> plugin to them as shown here:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:260.11px" class="cls_023">
            <span class="cls_023">projectSchema.plugin(creationInfo);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:272.35px" class="cls_023">
            <span class="cls_023">taskSchema.plugin(creationInfo);</span>
        </div>
        <div style="position:absolute;left:108.00px;top:292.09px" class="cls_006">
            <span class="cls_006">That's all we need to do. If you run your application again, everything will still work</span>
        </div>
        <div style="position:absolute;left:108.00px;top:304.69px" class="cls_006">
            <span class="cls_006">as before, including any defaults and validators set, but your code has less repetition.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:317.29px" class="cls_006">
            <span class="cls_006">The flipside of this is that your schemas are no longer self-contained and may be</span>
        </div>
        <div style="position:absolute;left:108.00px;top:329.89px" class="cls_006">
            <span class="cls_006">harder to read.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:357.99px" class="cls_013">
            <span class="cls_013">Using an external file</span>
        </div>
        <div style="position:absolute;left:108.00px;top:378.97px" class="cls_006">
            <span class="cls_006">In order to make the code really re-usable and portable, we need to have it in an</span>
        </div>
        <div style="position:absolute;left:108.00px;top:391.57px" class="cls_006">
            <span class="cls_006">external file, not embedded in our </span>
            <span class="cls_007">db.js</span>
            <span class="cls_006"> file. If we do this we can reference it</span>
        </div>
        <div style="position:absolute;left:108.00px;top:404.17px" class="cls_006">
            <span class="cls_006">from multiple files, and easily copy it to other projects. Create a new file called</span>
        </div>
        <div style="position:absolute;left:108.00px;top:416.77px" class="cls_007">
            <span class="cls_007">creationInfo.js</span>
            <span class="cls_006"> in the model folder, with the following content:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:437.71px" class="cls_023">
            <span class="cls_023">var mongoose = require( 'mongoose' );</span>
        </div>
        <div style="position:absolute;left:126.00px;top:449.95px" class="cls_023">
            <span class="cls_023">module.exports = exports = function creationInfo (schema, options) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:462.19px" class="cls_023">
            <span class="cls_023">schema.add({createdOn: { type: Date, default: Date.now }});</span>
        </div>
        <div style="position:absolute;left:136.80px;top:474.43px" class="cls_023">
            <span class="cls_023">schema.add({createdBy: { type: mongoose.Schema.Types.ObjectId, ref:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:485.23px" class="cls_023">
            <span class="cls_023">'User', required: true}});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:497.47px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:517.21px" class="cls_006">
            <span class="cls_006">Here we have </span>
            <span class="cls_007">required</span>
            <span class="cls_006"> mongoose and just slightly modified our </span>
            <span class="cls_007">creationInfo</span>
        </div>
        <div style="position:absolute;left:108.00px;top:529.81px" class="cls_006">
            <span class="cls_006">function to become a module export function. In our </span>
            <span class="cls_007">db.js</span>
            <span class="cls_006"> file, we can remove the</span>
        </div>
        <div style="position:absolute;left:108.00px;top:542.41px" class="cls_007">
            <span class="cls_007">creationInfo</span>
            <span class="cls_006"> function and </span>
            <span class="cls_007">require</span>
            <span class="cls_006"> our new file instead.</span>
        </div>
        <div style="position:absolute;left:126.00px;top:563.35px" class="cls_023">
            <span class="cls_023">var creationInfo = require('./creationInfo');</span>
        </div>
        <div style="position:absolute;left:108.00px;top:583.09px" class="cls_006">
            <span class="cls_006">And we're good to go! We've created a re-usable schema plugin—nice and easy. You</span>
        </div>
        <div style="position:absolute;left:108.00px;top:595.69px" class="cls_006">
            <span class="cls_006">can see how by doing this you can quickly build up a re-usable library of your own</span>
        </div>
        <div style="position:absolute;left:108.00px;top:608.29px" class="cls_006">
            <span class="cls_006">schema plugins.</span>
        </div>
        <div style="position:absolute;left:293.36px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 118 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:105062px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background132.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:464.37px;top:94.56px" class="cls_019">
            <span class="cls_019">Chapter 11</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.01px" class="cls_013">
            <span class="cls_013">Using schema middleware</span>
        </div>
        <div style="position:absolute;left:108.00px;top:133.99px" class="cls_006">
            <span class="cls_006">Plugins also have access to all of the middleware available to schemas. There are two</span>
        </div>
        <div style="position:absolute;left:108.00px;top:146.59px" class="cls_006">
            <span class="cls_006">types of middleware hooks:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:167.83px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> pre</span>
            <span class="cls_006">: This middleware is for before the method has completed</span>
        </div>
        <div style="position:absolute;left:126.00px;top:184.74px" class="cls_006">
            <span class="cls_006">•</span>
            <span class="cls_007"> post</span>
            <span class="cls_006">: This is for after the method has completed</span>
        </div>
        <div style="position:absolute;left:108.00px;top:205.99px" class="cls_006">
            <span class="cls_006">You can use these to hook into the methods </span>
            <span class="cls_007">save</span>
            <span class="cls_006"> (which we'll look at in just a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:218.59px" class="cls_006">
            <span class="cls_006">moment), </span>
            <span class="cls_007">init</span>
            <span class="cls_006">, </span>
            <span class="cls_007">validate</span>
            <span class="cls_006">, and </span>
            <span class="cls_007">remove</span>
            <span class="cls_006">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:239.83px" class="cls_006">
            <span class="cls_006">Let's take a look at creating a schema plugin for the </span>
            <span class="cls_007">modifiedOn</span>
            <span class="cls_006"> path that we have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:252.43px" class="cls_006">
            <span class="cls_006">used in all of our schemas. What would be really great is if we can not only define</span>
        </div>
        <div style="position:absolute;left:108.00px;top:265.03px" class="cls_006">
            <span class="cls_006">the path in the plugin, but also set the value—this is where plugins and middleware</span>
        </div>
        <div style="position:absolute;left:108.00px;top:277.63px" class="cls_006">
            <span class="cls_006">meet perfectly.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:298.87px" class="cls_006">
            <span class="cls_006">Let's create a new file </span>
            <span class="cls_007">model/modifiedOn.js</span>
            <span class="cls_006"> and require it in </span>
            <span class="cls_007">model/db.js</span>
            <span class="cls_006">, as</span>
        </div>
        <div style="position:absolute;left:108.00px;top:311.47px" class="cls_006">
            <span class="cls_006">shown in the following:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:332.41px" class="cls_023">
            <span class="cls_023">var modifiedOn = require('./modifiedOn');</span>
        </div>
        <div style="position:absolute;left:108.00px;top:352.15px" class="cls_006">
            <span class="cls_006">In the new </span>
            <span class="cls_007">model/modifiedOn.js</span>
            <span class="cls_006"> file, add the following code:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:373.09px" class="cls_023">
            <span class="cls_023">var mongoose = require( 'mongoose' );</span>
        </div>
        <div style="position:absolute;left:126.00px;top:385.33px" class="cls_023">
            <span class="cls_023">module.exports = exports = function modifiedOn (schema, options) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:397.57px" class="cls_023">
            <span class="cls_023">schema.add({ modifiedOn: Date });</span>
        </div>
        <div style="position:absolute;left:136.80px;top:422.05px" class="cls_023">
            <span class="cls_023">schema.pre('save', function (next) {</span>
        </div>
        <div style="position:absolute;left:147.60px;top:434.29px" class="cls_023">
            <span class="cls_023">this.modifiedOn = Date.now();</span>
        </div>
        <div style="position:absolute;left:147.60px;top:446.53px" class="cls_023">
            <span class="cls_023">next();</span>
        </div>
        <div style="position:absolute;left:136.80px;top:458.77px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:126.00px;top:471.01px" class="cls_023">
            <span class="cls_023">};</span>
        </div>
        <div style="position:absolute;left:108.00px;top:490.75px" class="cls_006">
            <span class="cls_006">This will do two things, which are:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:511.99px" class="cls_006">
            <span class="cls_006">• Add the </span>
            <span class="cls_007">modifiedOn</span>
            <span class="cls_006"> path with a SchemaType of </span>
            <span class="cls_007">Date</span>
        </div>
        <div style="position:absolute;left:126.00px;top:528.91px" class="cls_006">
            <span class="cls_006">• Set the value to be the current date and time just before the document</span>
        </div>
        <div style="position:absolute;left:144.00px;top:541.51px" class="cls_006">
            <span class="cls_006">is saved</span>
        </div>
        <div style="position:absolute;left:107.99px;top:562.75px" class="cls_006">
            <span class="cls_006">This removes the need to manually set the value each time we run an update</span>
        </div>
        <div style="position:absolute;left:107.99px;top:575.35px" class="cls_006">
            <span class="cls_006">operation on any of the schemas. So we can go through our code and remove the</span>
        </div>
        <div style="position:absolute;left:107.99px;top:587.95px" class="cls_006">
            <span class="cls_006">other instances of </span>
            <span class="cls_007">user.modifiedOn = Date.now()</span>
            <span class="cls_006">, </span>
            <span class="cls_007">project.modifiedOn =</span>
        </div>
        <div style="position:absolute;left:108.00px;top:600.55px" class="cls_007">
            <span class="cls_007">Date.now()</span>
            <span class="cls_006"> and </span>
            <span class="cls_007">thisTask.modifiedOn = Date.now()</span>
            <span class="cls_006"> as they are all handled in</span>
        </div>
        <div style="position:absolute;left:108.01px;top:613.15px" class="cls_006">
            <span class="cls_006">one place, every time any document (or subdocument) is saved. How's that for not</span>
        </div>
        <div style="position:absolute;left:108.01px;top:625.75px" class="cls_006">
            <span class="cls_006">repeating yourself?</span>
        </div>
        <div style="position:absolute;left:293.99px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 119 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:105864px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background133.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:94.56px" class="cls_019">
            <span class="cls_019">Plugins - Re-using Code</span>
        </div>
        <div style="position:absolute;left:108.00px;top:114.49px" class="cls_006">
            <span class="cls_006">The final step is to remove the </span>
            <span class="cls_007">modifiedOn</span>
            <span class="cls_006"> definitions from each schema, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:127.09px" class="cls_006">
            <span class="cls_006">reference the plugin instead:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:148.03px" class="cls_023">
            <span class="cls_023">userSchema.plugin(modifiedOn);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:160.27px" class="cls_023">
            <span class="cls_023">projectSchema.plugin(modifiedOn);</span>
        </div>
        <div style="position:absolute;left:126.00px;top:172.51px" class="cls_023">
            <span class="cls_023">taskSchema.plugin(modifiedOn);</span>
        </div>
        <div style="position:absolute;left:108.00px;top:203.03px" class="cls_005">
            <span class="cls_005">Not just for plugins</span>
        </div>
        <div style="position:absolute;left:108.00px;top:222.01px" class="cls_006">
            <span class="cls_006">This </span>
            <span class="cls_007">schema.pre</span>
            <span class="cls_006"> middleware can also be used directly on the parent schema itself.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:234.61px" class="cls_006">
            <span class="cls_006">We could quite easily have had this for example on an individual schema:</span>
        </div>
        <div style="position:absolute;left:126.00px;top:255.55px" class="cls_023">
            <span class="cls_023">projectSchema.pre('save', function (next) {</span>
        </div>
        <div style="position:absolute;left:136.80px;top:267.79px" class="cls_023">
            <span class="cls_023">this.modifiedOn = Date.now();</span>
        </div>
        <div style="position:absolute;left:136.80px;top:280.03px" class="cls_023">
            <span class="cls_023">next();</span>
        </div>
        <div style="position:absolute;left:126.00px;top:292.27px" class="cls_023">
            <span class="cls_023">});</span>
        </div>
        <div style="position:absolute;left:108.00px;top:323.27px" class="cls_022">
            <span class="cls_022">Sharing with the community</span>
        </div>
        <div style="position:absolute;left:108.00px;top:348.25px" class="cls_006">
            <span class="cls_006">Mongoose plugins are not just re-usable for you, you can share them with the rest</span>
        </div>
        <div style="position:absolute;left:108.00px;top:360.85px" class="cls_006">
            <span class="cls_006">of the community. By packaging them up as npm modules, and tagging them with</span>
        </div>
        <div style="position:absolute;left:108.00px;top:373.45px" class="cls_006">
            <span class="cls_006">"mongoose", they will become available in the Mongoose plugins directory.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:394.70px" class="cls_006">
            <span class="cls_006">There are already a large number of community-submitted plugins available that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:407.30px" class="cls_006">
            <span class="cls_006">include adding support for a long number SchemaType, validation helpers, and</span>
        </div>
        <div style="position:absolute;left:108.00px;top:419.90px" class="cls_006">
            <span class="cls_006">authentication and user management plugins.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:441.14px" class="cls_006">
            <span class="cls_006">You can find the directory, and submission guidelines at the following link:</span>
        </div>
        <div style="position:absolute;left:108.00px;top:463.37px" class="cls_007">
            <span class="cls_007"> </span>
            <A HREF="http://plugins.mongoosejs.com/">http://plugins.mongoosejs.com</A>
        </div>
        <div style="position:absolute;left:108.00px;top:494.87px" class="cls_022">
            <span class="cls_022">Summary</span>
        </div>
        <div style="position:absolute;left:108.00px;top:519.85px" class="cls_006">
            <span class="cls_006">In this chapter, we've seen how we can take repeated paths from our schemas and turn</span>
        </div>
        <div style="position:absolute;left:108.00px;top:532.45px" class="cls_006">
            <span class="cls_006">them into a single Mongoose plugin. We've learned how to create them as separate</span>
        </div>
        <div style="position:absolute;left:108.00px;top:545.05px" class="cls_006">
            <span class="cls_006">files, include them in our application, and also use schema middleware to set data on a</span>
        </div>
        <div style="position:absolute;left:108.00px;top:557.65px" class="cls_006">
            <span class="cls_006">save operation. We have used all of this knowledge to create plugins and add them to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:570.25px" class="cls_006">
            <span class="cls_006">our MongoosePM application, tidying up our code and removing repetition.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:591.50px" class="cls_006">
            <span class="cls_006">This is the final chapter of </span>
            <span class="cls_021">Mongoose for Application Development</span>
            <span class="cls_006">. By now you should</span>
        </div>
        <div style="position:absolute;left:108.00px;top:604.10px" class="cls_006">
            <span class="cls_006">have the tools and understanding to enable you to build a web application based</span>
        </div>
        <div style="position:absolute;left:108.00px;top:616.70px" class="cls_006">
            <span class="cls_006">on everything Mongoose has to offer. I'm sure that by now you will agree that</span>
        </div>
        <div style="position:absolute;left:108.00px;top:629.30px" class="cls_006">
            <span class="cls_006">Mongoose is a very useful addition to the Node.js and MongoDB technology stack.</span>
        </div>
        <div style="position:absolute;left:293.14px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 120 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:106666px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background134.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:430.61px;top:185.09px" class="cls_015">
            <span class="cls_015">Index</span>
        </div>
        <div style="position:absolute;left:311.40px;top:241.53px" class="cls_028">
            <span class="cls_028">connection string</span>
        </div>
        <div style="position:absolute;left:108.00px;top:240.32px" class="cls_005">
            <span class="cls_005">Symbols</span>
        </div>
        <div style="position:absolute;left:318.41px;top:252.93px" class="cls_026">
            <span class="cls_026">about 24</span>
        </div>
        <div style="position:absolute;left:108.00px;top:263.42px" class="cls_028">
            <span class="cls_028">.save method 55</span>
        </div>
        <div style="position:absolute;left:318.41px;top:264.33px" class="cls_026">
            <span class="cls_026">database user, specifying 24</span>
        </div>
        <div style="position:absolute;left:318.41px;top:275.73px" class="cls_026">
            <span class="cls_026">port, setting 24</span>
        </div>
        <div style="position:absolute;left:108.00px;top:282.92px" class="cls_005">
            <span class="cls_005">A</span>
        </div>
        <div style="position:absolute;left:311.40px;top:287.13px" class="cls_028">
            <span class="cls_028">custom SchemaTypes 35</span>
        </div>
        <div style="position:absolute;left:311.40px;top:298.53px" class="cls_028">
            <span class="cls_028">custom validation 100</span>
        </div>
        <div style="position:absolute;left:108.00px;top:306.02px" class="cls_028">
            <span class="cls_028">Advanced Packaging Tool (APT) 15</span>
        </div>
        <div style="position:absolute;left:311.40px;top:309.93px" class="cls_028">
            <span class="cls_028">custom validators</span>
        </div>
        <div style="position:absolute;left:108.00px;top:317.42px" class="cls_028">
            <span class="cls_028">Are you sure page 93</span>
        </div>
        <div style="position:absolute;left:318.41px;top:321.33px" class="cls_026">
            <span class="cls_026">asynchronous validator 102</span>
        </div>
        <div style="position:absolute;left:108.00px;top:328.82px" class="cls_028">
            <span class="cls_028">array data type, Mongoose schema</span>
        </div>
        <div style="position:absolute;left:318.41px;top:332.73px" class="cls_026">
            <span class="cls_026">creating 100</span>
        </div>
        <div style="position:absolute;left:115.00px;top:340.22px" class="cls_026">
            <span class="cls_026">about 34</span>
        </div>
        <div style="position:absolute;left:318.41px;top:344.13px" class="cls_026">
            <span class="cls_026">creating, with custom error message 100</span>
        </div>
        <div style="position:absolute;left:115.00px;top:351.62px" class="cls_026">
            <span class="cls_026">word of caution 34</span>
        </div>
        <div style="position:absolute;left:318.41px;top:355.53px" class="cls_026">
            <span class="cls_026">creating, with single function 100</span>
        </div>
        <div style="position:absolute;left:108.00px;top:363.02px" class="cls_028">
            <span class="cls_028">asynchronous validator 102</span>
        </div>
        <div style="position:absolute;left:318.41px;top:366.93px" class="cls_026">
            <span class="cls_026">custom message, pairing out of schema 101</span>
        </div>
        <div style="position:absolute;left:318.41px;top:378.33px" class="cls_026">
            <span class="cls_026">multiple validators 101, 102</span>
        </div>
        <div style="position:absolute;left:108.00px;top:382.52px" class="cls_005">
            <span class="cls_005">B</span>
        </div>
        <div style="position:absolute;left:318.41px;top:389.73px" class="cls_026">
            <span class="cls_026">regular expression, validating 101</span>
        </div>
        <div style="position:absolute;left:108.00px;top:405.62px" class="cls_028">
            <span class="cls_028">blocking code 9</span>
        </div>
        <div style="position:absolute;left:311.40px;top:409.22px" class="cls_005">
            <span class="cls_005">D</span>
        </div>
        <div style="position:absolute;left:108.00px;top:417.02px" class="cls_028">
            <span class="cls_028">boolean datatype, Mongoose schema 33</span>
        </div>
        <div style="position:absolute;left:108.00px;top:428.42px" class="cls_028">
            <span class="cls_028">buffer datatype, Mongoose schema 33</span>
        </div>
        <div style="position:absolute;left:311.40px;top:432.32px" class="cls_028">
            <span class="cls_028">data</span>
        </div>
        <div style="position:absolute;left:318.40px;top:443.72px" class="cls_026">
            <span class="cls_026">deleting 91, 92</span>
        </div>
        <div style="position:absolute;left:108.00px;top:447.92px" class="cls_005">
            <span class="cls_005">C</span>
        </div>
        <div style="position:absolute;left:318.40px;top:455.12px" class="cls_026">
            <span class="cls_026">querying 67</span>
        </div>
        <div style="position:absolute;left:311.40px;top:466.52px" class="cls_028">
            <span class="cls_028">database connection</span>
        </div>
        <div style="position:absolute;left:108.00px;top:471.02px" class="cls_028">
            <span class="cls_028">callback() function</span>
        </div>
        <div style="position:absolute;left:318.40px;top:477.92px" class="cls_026">
            <span class="cls_026">closing 25</span>
        </div>
        <div style="position:absolute;left:115.00px;top:482.42px" class="cls_026">
            <span class="cls_026">running 10</span>
        </div>
        <div style="position:absolute;left:318.40px;top:489.32px" class="cls_026">
            <span class="cls_026">establishing 23</span>
        </div>
        <div style="position:absolute;left:108.00px;top:493.82px" class="cls_028">
            <span class="cls_028">close() method 25</span>
        </div>
        <div style="position:absolute;left:311.40px;top:500.72px" class="cls_028">
            <span class="cls_028">database connection, closing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:505.22px" class="cls_028">
            <span class="cls_028">code structure</span>
        </div>
        <div style="position:absolute;left:318.40px;top:512.12px" class="cls_026">
            <span class="cls_026">close command, calling 25</span>
        </div>
        <div style="position:absolute;left:115.00px;top:516.62px" class="cls_026">
            <span class="cls_026">about 48</span>
        </div>
        <div style="position:absolute;left:318.40px;top:523.52px" class="cls_026">
            <span class="cls_026">with Node process 26</span>
        </div>
        <div style="position:absolute;left:115.00px;top:528.02px" class="cls_026">
            <span class="cls_026">routes files, adding 49</span>
        </div>
        <div style="position:absolute;left:311.40px;top:534.92px" class="cls_028">
            <span class="cls_028">data interaction</span>
        </div>
        <div style="position:absolute;left:115.00px;top:539.42px" class="cls_026">
            <span class="cls_026">routes, tying to Mongoose models 49</span>
        </div>
        <div style="position:absolute;left:318.40px;top:546.32px" class="cls_026">
            <span class="cls_026">about 53</span>
        </div>
        <div style="position:absolute;left:108.00px;top:550.82px" class="cls_028">
            <span class="cls_028">collection 11</span>
        </div>
        <div style="position:absolute;left:318.40px;top:557.72px" class="cls_026">
            <span class="cls_026">database entry, creating 56</span>
        </div>
        <div style="position:absolute;left:108.00px;top:562.22px" class="cls_028">
            <span class="cls_028">connection events 26</span>
        </div>
        <div style="position:absolute;left:318.40px;top:569.12px" class="cls_026">
            <span class="cls_026">database entry, saving 56</span>
        </div>
        <div style="position:absolute;left:108.00px;top:573.62px" class="cls_028">
            <span class="cls_028">connection options</span>
        </div>
        <div style="position:absolute;left:318.40px;top:580.52px" class="cls_026">
            <span class="cls_026">instance, creating 53</span>
        </div>
        <div style="position:absolute;left:115.00px;top:585.02px" class="cls_026">
            <span class="cls_026">about 24</span>
        </div>
        <div style="position:absolute;left:318.40px;top:591.92px" class="cls_026">
            <span class="cls_026">instance, saving 54</span>
        </div>
        <div style="position:absolute;left:115.00px;top:596.42px" class="cls_026">
            <span class="cls_026">db 25</span>
        </div>
        <div style="position:absolute;left:318.40px;top:603.32px" class="cls_026">
            <span class="cls_026">methods, chaining 56</span>
        </div>
        <div style="position:absolute;left:115.00px;top:607.82px" class="cls_026">
            <span class="cls_026">replset 25</span>
        </div>
        <div style="position:absolute;left:318.40px;top:614.72px" class="cls_026">
            <span class="cls_026">Model.create() method 56, 57</span>
        </div>
        <div style="position:absolute;left:115.00px;top:619.22px" class="cls_026">
            <span class="cls_026">server 25</span>
        </div>
        <div style="position:absolute;left:311.40px;top:626.12px" class="cls_028">
            <span class="cls_028">data management</span>
        </div>
        <div style="position:absolute;left:115.00px;top:630.62px" class="cls_026">
            <span class="cls_026">user and pass 25</span>
        </div>
        <div style="position:absolute;left:318.40px;top:637.52px" class="cls_026">
            <span class="cls_026">existing schema, modifying 114</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:107468px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background135.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:108.00px;top:114.76px" class="cls_028">
            <span class="cls_028">datatypes, Mongoose schema</span>
        </div>
        <div style="position:absolute;left:318.41px;top:114.77px" class="cls_026">
            <span class="cls_026">saved data, using 55</span>
        </div>
        <div style="position:absolute;left:115.00px;top:126.16px" class="cls_026">
            <span class="cls_026">about 32</span>
        </div>
        <div style="position:absolute;left:318.41px;top:126.17px" class="cls_026">
            <span class="cls_026">saving 54, 55</span>
        </div>
        <div style="position:absolute;left:115.00px;top:137.56px" class="cls_026">
            <span class="cls_026">array 34</span>
        </div>
        <div style="position:absolute;left:115.00px;top:148.96px" class="cls_026">
            <span class="cls_026">boolean 33</span>
        </div>
        <div style="position:absolute;left:311.40px;top:145.67px" class="cls_005">
            <span class="cls_005">J</span>
        </div>
        <div style="position:absolute;left:115.00px;top:160.36px" class="cls_026">
            <span class="cls_026">buffer 33</span>
        </div>
        <div style="position:absolute;left:311.40px;top:168.77px" class="cls_028">
            <span class="cls_028">Jade template files</span>
        </div>
        <div style="position:absolute;left:115.00px;top:171.76px" class="cls_026">
            <span class="cls_026">custom SchemaTypes 35</span>
        </div>
        <div style="position:absolute;left:318.40px;top:180.17px" class="cls_026">
            <span class="cls_026">index.jade 58</span>
        </div>
        <div style="position:absolute;left:115.00px;top:183.16px" class="cls_026">
            <span class="cls_026">date 33</span>
        </div>
        <div style="position:absolute;left:318.40px;top:191.57px" class="cls_026">
            <span class="cls_026">layout.jade 58</span>
        </div>
        <div style="position:absolute;left:115.00px;top:194.56px" class="cls_026">
            <span class="cls_026">mixed 33</span>
        </div>
        <div style="position:absolute;left:311.40px;top:202.97px" class="cls_028">
            <span class="cls_028">JavaScript</span>
        </div>
        <div style="position:absolute;left:115.00px;top:205.96px" class="cls_026">
            <span class="cls_026">number 33</span>
        </div>
        <div style="position:absolute;left:318.40px;top:214.37px" class="cls_026">
            <span class="cls_026">about 7</span>
        </div>
        <div style="position:absolute;left:115.00px;top:217.36px" class="cls_026">
            <span class="cls_026">ObjectId 33</span>
        </div>
        <div style="position:absolute;left:318.40px;top:225.77px" class="cls_026">
            <span class="cls_026">blocking code 9</span>
        </div>
        <div style="position:absolute;left:115.00px;top:228.76px" class="cls_026">
            <span class="cls_026">string 32</span>
        </div>
        <div style="position:absolute;left:318.40px;top:237.17px" class="cls_026">
            <span class="cls_026">callback, running 10</span>
        </div>
        <div style="position:absolute;left:108.00px;top:240.16px" class="cls_028">
            <span class="cls_028">data validation</span>
        </div>
        <div style="position:absolute;left:318.40px;top:248.57px" class="cls_026">
            <span class="cls_026">callbacks 9</span>
        </div>
        <div style="position:absolute;left:115.00px;top:251.56px" class="cls_026">
            <span class="cls_026">about 97</span>
        </div>
        <div style="position:absolute;left:318.40px;top:259.97px" class="cls_026">
            <span class="cls_026">non-blocking code 9</span>
        </div>
        <div style="position:absolute;left:115.00px;top:262.96px" class="cls_026">
            <span class="cls_026">adding, to project 103</span>
        </div>
        <div style="position:absolute;left:311.40px;top:271.37px" class="cls_028">
            <span class="cls_028">jQuery document.ready method 9</span>
        </div>
        <div style="position:absolute;left:115.00px;top:274.36px" class="cls_026">
            <span class="cls_026">basics 97</span>
        </div>
        <div style="position:absolute;left:115.00px;top:285.76px" class="cls_026">
            <span class="cls_026">custom validation 100</span>
        </div>
        <div style="position:absolute;left:115.00px;top:297.16px" class="cls_026">
            <span class="cls_026">error object 99</span>
        </div>
        <div style="position:absolute;left:311.40px;top:290.87px" class="cls_005">
            <span class="cls_005">K</span>
        </div>
        <div style="position:absolute;left:115.00px;top:308.56px" class="cls_026">
            <span class="cls_026">extending 103</span>
        </div>
        <div style="position:absolute;left:311.40px;top:313.97px" class="cls_028">
            <span class="cls_028">key 11</span>
        </div>
        <div style="position:absolute;left:108.00px;top:319.96px" class="cls_028">
            <span class="cls_028">date datatype, Mongoose schema 33</span>
        </div>
        <div style="position:absolute;left:108.00px;top:331.36px" class="cls_028">
            <span class="cls_028">doLogin function 84</span>
        </div>
        <div style="position:absolute;left:311.40px;top:333.47px" class="cls_005">
            <span class="cls_005">M</span>
        </div>
        <div style="position:absolute;left:108.00px;top:350.86px" class="cls_005">
            <span class="cls_005">E</span>
        </div>
        <div style="position:absolute;left:311.40px;top:356.57px" class="cls_028">
            <span class="cls_028">match validator 98</span>
        </div>
        <div style="position:absolute;left:311.40px;top:367.97px" class="cls_028">
            <span class="cls_028">mixed data type, Mongoose schema</span>
        </div>
        <div style="position:absolute;left:108.00px;top:373.96px" class="cls_028">
            <span class="cls_028">enum validator 98</span>
        </div>
        <div style="position:absolute;left:318.40px;top:379.37px" class="cls_026">
            <span class="cls_026">about 33</span>
        </div>
        <div style="position:absolute;left:108.00px;top:385.36px" class="cls_028">
            <span class="cls_028">exports.create() function 65</span>
        </div>
        <div style="position:absolute;left:318.40px;top:390.77px" class="cls_026">
            <span class="cls_026">changes, tracking 34</span>
        </div>
        <div style="position:absolute;left:108.00px;top:396.76px" class="cls_028">
            <span class="cls_028">exports.doCreate() function 65</span>
        </div>
        <div style="position:absolute;left:311.40px;top:402.17px" class="cls_028">
            <span class="cls_028">Model.create() method</span>
        </div>
        <div style="position:absolute;left:108.00px;top:408.16px" class="cls_028">
            <span class="cls_028">Express</span>
        </div>
        <div style="position:absolute;left:318.40px;top:413.57px" class="cls_026">
            <span class="cls_026">about 56</span>
        </div>
        <div style="position:absolute;left:115.00px;top:419.56px" class="cls_026">
            <span class="cls_026">about 12</span>
        </div>
        <div style="position:absolute;left:311.40px;top:424.97px" class="cls_028">
            <span class="cls_028">model.findById method 78</span>
        </div>
        <div style="position:absolute;left:115.00px;top:430.96px" class="cls_026">
            <span class="cls_026">installing 17</span>
        </div>
        <div style="position:absolute;left:311.40px;top:436.37px" class="cls_028">
            <span class="cls_028">Model.findById(ObjectID) method 70</span>
        </div>
        <div style="position:absolute;left:311.40px;top:447.77px" class="cls_028">
            <span class="cls_028">Model.findOne() method</span>
        </div>
        <div style="position:absolute;left:108.00px;top:450.46px" class="cls_005">
            <span class="cls_005">F</span>
        </div>
        <div style="position:absolute;left:318.40px;top:459.17px" class="cls_026">
            <span class="cls_026">used, for searching single user 71</span>
        </div>
        <div style="position:absolute;left:311.40px;top:470.57px" class="cls_028">
            <span class="cls_028">Model.findOne(query) method 70</span>
        </div>
        <div style="position:absolute;left:108.00px;top:473.56px" class="cls_028">
            <span class="cls_028">findByIdAndRemove() method 92</span>
        </div>
        <div style="position:absolute;left:311.40px;top:481.97px" class="cls_028">
            <span class="cls_028">Model.find(query) method 70</span>
        </div>
        <div style="position:absolute;left:108.00px;top:484.96px" class="cls_028">
            <span class="cls_028">findByIdAndUpdate() method 81</span>
        </div>
        <div style="position:absolute;left:311.40px;top:493.37px" class="cls_028">
            <span class="cls_028">model helper methods, Mongoose</span>
        </div>
        <div style="position:absolute;left:108.00px;top:496.36px" class="cls_028">
            <span class="cls_028">find-edit-save approach 83</span>
        </div>
        <div style="position:absolute;left:318.40px;top:504.77px" class="cls_026">
            <span class="cls_026">catch 83</span>
        </div>
        <div style="position:absolute;left:108.00px;top:507.76px" class="cls_028">
            <span class="cls_028">findOneAndRemove() method 92</span>
        </div>
        <div style="position:absolute;left:318.40px;top:516.17px" class="cls_026">
            <span class="cls_026">commands, building 82</span>
        </div>
        <div style="position:absolute;left:108.00px;top:519.16px" class="cls_028">
            <span class="cls_028">findOneAndUpdate() method 81</span>
        </div>
        <div style="position:absolute;left:318.40px;top:527.57px" class="cls_026">
            <span class="cls_026">findByIdAndUpdate() 81</span>
        </div>
        <div style="position:absolute;left:318.40px;top:538.97px" class="cls_026">
            <span class="cls_026">findOneAndUpdate() 81</span>
        </div>
        <div style="position:absolute;left:108.00px;top:538.66px" class="cls_005">
            <span class="cls_005">H</span>
        </div>
        <div style="position:absolute;left:318.40px;top:550.37px" class="cls_026">
            <span class="cls_026">selecting 83</span>
        </div>
        <div style="position:absolute;left:108.00px;top:561.76px" class="cls_028">
            <span class="cls_028">http.createServer method function 11</span>
        </div>
        <div style="position:absolute;left:318.40px;top:561.77px" class="cls_026">
            <span class="cls_026">update() 81</span>
        </div>
        <div style="position:absolute;left:311.40px;top:573.17px" class="cls_028">
            <span class="cls_028">model, Mongoose 14</span>
        </div>
        <div style="position:absolute;left:108.00px;top:581.26px" class="cls_005">
            <span class="cls_005">I</span>
        </div>
        <div style="position:absolute;left:311.40px;top:584.57px" class="cls_028">
            <span class="cls_028">MongoDB</span>
        </div>
        <div style="position:absolute;left:318.40px;top:595.97px" class="cls_026">
            <span class="cls_026">about 11</span>
        </div>
        <div style="position:absolute;left:108.00px;top:604.36px" class="cls_028">
            <span class="cls_028">instance, data interaction</span>
        </div>
        <div style="position:absolute;left:318.40px;top:607.37px" class="cls_026">
            <span class="cls_026">installing 16</span>
        </div>
        <div style="position:absolute;left:115.00px;top:615.76px" class="cls_026">
            <span class="cls_026">creating 54</span>
        </div>
        <div style="position:absolute;left:311.40px;top:618.77px" class="cls_028">
            <span class="cls_028">Mongoose</span>
        </div>
        <div style="position:absolute;left:115.00px;top:627.16px" class="cls_026">
            <span class="cls_026">data, adding to 54</span>
        </div>
        <div style="position:absolute;left:318.40px;top:630.17px" class="cls_026">
            <span class="cls_026">about 12</span>
        </div>
        <div style="position:absolute;left:318.40px;top:641.57px" class="cls_026">
            <span class="cls_026">benefits 13</span>
        </div>
        <div style="position:absolute;left:293.14px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 122 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:108270px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background136.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:115.00px;top:114.77px" class="cls_026">
            <span class="cls_026">connection options 24, 25</span>
        </div>
        <div style="position:absolute;left:311.40px;top:114.76px" class="cls_028">
            <span class="cls_028">Node.js</span>
        </div>
        <div style="position:absolute;left:115.00px;top:126.17px" class="cls_026">
            <span class="cls_026">connection string 24</span>
        </div>
        <div style="position:absolute;left:318.41px;top:126.16px" class="cls_026">
            <span class="cls_026">about 8</span>
        </div>
        <div style="position:absolute;left:115.00px;top:137.57px" class="cls_026">
            <span class="cls_026">cornerstones 14</span>
        </div>
        <div style="position:absolute;left:318.41px;top:137.56px" class="cls_026">
            <span class="cls_026">installing 15</span>
        </div>
        <div style="position:absolute;left:115.00px;top:148.97px" class="cls_026">
            <span class="cls_026">database connection, establishing 23</span>
        </div>
        <div style="position:absolute;left:311.40px;top:148.96px" class="cls_028">
            <span class="cls_028">Nodemon</span>
        </div>
        <div style="position:absolute;left:115.00px;top:160.37px" class="cls_026">
            <span class="cls_026">data, deleting 91</span>
        </div>
        <div style="position:absolute;left:318.41px;top:160.36px" class="cls_026">
            <span class="cls_026">URL 60</span>
        </div>
        <div style="position:absolute;left:115.00px;top:171.77px" class="cls_026">
            <span class="cls_026">data validation 97</span>
        </div>
        <div style="position:absolute;left:311.40px;top:171.76px" class="cls_028">
            <span class="cls_028">non-blocking code 9</span>
        </div>
        <div style="position:absolute;left:115.00px;top:183.17px" class="cls_026">
            <span class="cls_026">find-edit-save approach 83</span>
        </div>
        <div style="position:absolute;left:311.40px;top:183.16px" class="cls_028">
            <span class="cls_028">npm</span>
        </div>
        <div style="position:absolute;left:115.00px;top:194.57px" class="cls_026">
            <span class="cls_026">installing 17</span>
        </div>
        <div style="position:absolute;left:318.41px;top:194.56px" class="cls_026">
            <span class="cls_026">installing 15</span>
        </div>
        <div style="position:absolute;left:115.00px;top:205.97px" class="cls_026">
            <span class="cls_026">instance methods 47</span>
        </div>
        <div style="position:absolute;left:311.40px;top:205.96px" class="cls_028">
            <span class="cls_028">number data type, Mongoose schema 33</span>
        </div>
        <div style="position:absolute;left:115.00px;top:217.37px" class="cls_026">
            <span class="cls_026">limitations 13</span>
        </div>
        <div style="position:absolute;left:115.00px;top:228.77px" class="cls_026">
            <span class="cls_026">methods, for data interaction 47</span>
        </div>
        <div style="position:absolute;left:311.40px;top:225.46px" class="cls_005">
            <span class="cls_005">O</span>
        </div>
        <div style="position:absolute;left:115.00px;top:240.17px" class="cls_026">
            <span class="cls_026">model helper methods 81</span>
        </div>
        <div style="position:absolute;left:311.40px;top:248.56px" class="cls_028">
            <span class="cls_028">ObjectId data type, Mongoose schema 33</span>
        </div>
        <div style="position:absolute;left:115.00px;top:251.57px" class="cls_026">
            <span class="cls_026">model methods 47, 48</span>
        </div>
        <div style="position:absolute;left:311.40px;top:259.96px" class="cls_028">
            <span class="cls_028">ODM (Object-Document Modeler) 7</span>
        </div>
        <div style="position:absolute;left:115.00px;top:262.97px" class="cls_026">
            <span class="cls_026">models 14</span>
        </div>
        <div style="position:absolute;left:115.00px;top:274.37px" class="cls_026">
            <span class="cls_026">population 105</span>
        </div>
        <div style="position:absolute;left:115.00px;top:285.77px" class="cls_026">
            <span class="cls_026">project, setting up 48</span>
        </div>
        <div style="position:absolute;left:311.40px;top:279.46px" class="cls_005">
            <span class="cls_005">P</span>
        </div>
        <div style="position:absolute;left:115.00px;top:297.17px" class="cls_026">
            <span class="cls_026">QueryBuilder 68</span>
        </div>
        <div style="position:absolute;left:311.40px;top:302.56px" class="cls_028">
            <span class="cls_028">package.json file 18</span>
        </div>
        <div style="position:absolute;left:115.00px;top:308.57px" class="cls_026">
            <span class="cls_026">re-usable schema plugins 117</span>
        </div>
        <div style="position:absolute;left:311.40px;top:313.96px" class="cls_028">
            <span class="cls_028">population</span>
        </div>
        <div style="position:absolute;left:115.00px;top:319.97px" class="cls_026">
            <span class="cls_026">static model methods 68</span>
        </div>
        <div style="position:absolute;left:318.40px;top:325.36px" class="cls_026">
            <span class="cls_026">about 105</span>
        </div>
        <div style="position:absolute;left:115.00px;top:331.37px" class="cls_026">
            <span class="cls_026">subdocuments 110</span>
        </div>
        <div style="position:absolute;left:318.40px;top:336.76px" class="cls_026">
            <span class="cls_026">data, defining 106</span>
        </div>
        <div style="position:absolute;left:115.00px;top:342.77px" class="cls_026">
            <span class="cls_026">validators 97</span>
        </div>
        <div style="position:absolute;left:318.40px;top:348.16px" class="cls_026">
            <span class="cls_026">data, retrieving 107, 108</span>
        </div>
        <div style="position:absolute;left:108.00px;top:354.17px" class="cls_028">
            <span class="cls_028">Mongoose database connection</span>
        </div>
        <div style="position:absolute;left:318.40px;top:359.56px" class="cls_026">
            <span class="cls_026">multiple parent items, populating 110</span>
        </div>
        <div style="position:absolute;left:115.00px;top:365.57px" class="cls_026">
            <span class="cls_026">events 26</span>
        </div>
        <div style="position:absolute;left:318.40px;top:370.96px" class="cls_026">
            <span class="cls_026">references, saving 107</span>
        </div>
        <div style="position:absolute;left:108.00px;top:376.97px" class="cls_028">
            <span class="cls_028">Mongoose default connection</span>
        </div>
        <div style="position:absolute;left:318.40px;top:382.36px" class="cls_026">
            <span class="cls_026">results subset, querying 109</span>
        </div>
        <div style="position:absolute;left:115.00px;top:388.37px" class="cls_026">
            <span class="cls_026">about 23</span>
        </div>
        <div style="position:absolute;left:311.40px;top:393.76px" class="cls_028">
            <span class="cls_028">projects</span>
        </div>
        <div style="position:absolute;left:115.00px;top:399.77px" class="cls_026">
            <span class="cls_026">multiple connections, using 24</span>
        </div>
        <div style="position:absolute;left:318.40px;top:405.16px" class="cls_026">
            <span class="cls_026">deleting 95</span>
        </div>
        <div style="position:absolute;left:108.00px;top:411.17px" class="cls_028">
            <span class="cls_028">Mongoose installation</span>
        </div>
        <div style="position:absolute;left:311.40px;top:416.56px" class="cls_028">
            <span class="cls_028">Project schema</span>
        </div>
        <div style="position:absolute;left:115.00px;top:422.57px" class="cls_026">
            <span class="cls_026">direct installation, into project 17</span>
        </div>
        <div style="position:absolute;left:318.40px;top:427.96px" class="cls_026">
            <span class="cls_026">createdBy data type 39</span>
        </div>
        <div style="position:absolute;left:115.00px;top:433.97px" class="cls_026">
            <span class="cls_026">project dependencies, using 17</span>
        </div>
        <div style="position:absolute;left:318.40px;top:439.36px" class="cls_026">
            <span class="cls_026">createdOn data type 39</span>
        </div>
        <div style="position:absolute;left:108.00px;top:445.37px" class="cls_028">
            <span class="cls_028">MongoosePM</span>
        </div>
        <div style="position:absolute;left:318.40px;top:450.76px" class="cls_026">
            <span class="cls_026">creating 39</span>
        </div>
        <div style="position:absolute;left:115.00px;top:456.77px" class="cls_026">
            <span class="cls_026">connection, creating 26, 27</span>
        </div>
        <div style="position:absolute;left:318.40px;top:462.16px" class="cls_026">
            <span class="cls_026">improving 40</span>
        </div>
        <div style="position:absolute;left:115.00px;top:468.17px" class="cls_026">
            <span class="cls_026">connection, opening at app start 28</span>
        </div>
        <div style="position:absolute;left:318.40px;top:473.56px" class="cls_026">
            <span class="cls_026">modifiedOn data type 39</span>
        </div>
        <div style="position:absolute;left:115.00px;top:479.57px" class="cls_026">
            <span class="cls_026">creating 18, 20</span>
        </div>
        <div style="position:absolute;left:318.40px;top:484.96px" class="cls_026">
            <span class="cls_026">projectName data type 39</span>
        </div>
        <div style="position:absolute;left:115.00px;top:490.97px" class="cls_026">
            <span class="cls_026">database, creating 28</span>
        </div>
        <div style="position:absolute;left:318.40px;top:496.36px" class="cls_026">
            <span class="cls_026">tasks data type 39</span>
        </div>
        <div style="position:absolute;left:115.00px;top:502.37px" class="cls_026">
            <span class="cls_026">events, catching 27</span>
        </div>
        <div style="position:absolute;left:311.40px;top:507.76px" class="cls_028">
            <span class="cls_028">projects, editing</span>
        </div>
        <div style="position:absolute;left:115.00px;top:513.77px" class="cls_026">
            <span class="cls_026">single user, finding 71</span>
        </div>
        <div style="position:absolute;left:318.40px;top:519.16px" class="cls_026">
            <span class="cls_026">performing 88</span>
        </div>
        <div style="position:absolute;left:108.00px;top:525.27px" class="cls_028">
            <span class="cls_028">Mongoose schema. </span>
            <span class="cls_031">See</span>
            <span class="cls_028"> schema, Mongoose</span>
        </div>
        <div style="position:absolute;left:318.40px;top:530.56px" class="cls_026">
            <span class="cls_026">routes 88</span>
        </div>
        <div style="position:absolute;left:108.00px;top:537.17px" class="cls_028">
            <span class="cls_028">multithreaded 8</span>
        </div>
        <div style="position:absolute;left:311.40px;top:541.96px" class="cls_028">
            <span class="cls_028">project, setting up</span>
        </div>
        <div style="position:absolute;left:318.40px;top:553.36px" class="cls_026">
            <span class="cls_026">code structure 48</span>
        </div>
        <div style="position:absolute;left:108.00px;top:556.67px" class="cls_005">
            <span class="cls_005">N</span>
        </div>
        <div style="position:absolute;left:318.40px;top:564.76px" class="cls_026">
            <span class="cls_026">routes 49</span>
        </div>
        <div style="position:absolute;left:318.40px;top:576.16px" class="cls_026">
            <span class="cls_026">URLs 49</span>
        </div>
        <div style="position:absolute;left:108.00px;top:579.77px" class="cls_028">
            <span class="cls_028">Node</span>
        </div>
        <div style="position:absolute;left:311.40px;top:587.56px" class="cls_028">
            <span class="cls_028">projects list, finding</span>
        </div>
        <div style="position:absolute;left:115.00px;top:591.17px" class="cls_026">
            <span class="cls_026">about 8</span>
        </div>
        <div style="position:absolute;left:318.40px;top:598.96px" class="cls_026">
            <span class="cls_026">AJAX call, building 77</span>
        </div>
        <div style="position:absolute;left:115.00px;top:602.57px" class="cls_026">
            <span class="cls_026">multithreaded 8</span>
        </div>
        <div style="position:absolute;left:318.40px;top:610.36px" class="cls_026">
            <span class="cls_026">res.json() method, used 74</span>
        </div>
        <div style="position:absolute;left:115.00px;top:613.97px" class="cls_026">
            <span class="cls_026">single-threaded 8</span>
        </div>
        <div style="position:absolute;left:318.40px;top:621.76px" class="cls_026">
            <span class="cls_026">route, setting up 75</span>
        </div>
        <div style="position:absolute;left:318.40px;top:633.16px" class="cls_026">
            <span class="cls_026">view, updating 76</span>
        </div>
        <div style="position:absolute;left:293.76px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 123 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:109072px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background137.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:311.40px;top:114.76px" class="cls_028">
            <span class="cls_028">single user, searching</span>
        </div>
        <div style="position:absolute;left:108.00px;top:113.55px" class="cls_005">
            <span class="cls_005">Q</span>
        </div>
        <div style="position:absolute;left:318.41px;top:126.16px" class="cls_026">
            <span class="cls_026">findOnes used 71</span>
        </div>
        <div style="position:absolute;left:108.00px;top:136.65px" class="cls_028">
            <span class="cls_028">QueryBuilder interface</span>
        </div>
        <div style="position:absolute;left:318.41px;top:137.56px" class="cls_026">
            <span class="cls_026">homepage links, adding 73</span>
        </div>
        <div style="position:absolute;left:115.00px;top:148.05px" class="cls_026">
            <span class="cls_026">about 68</span>
        </div>
        <div style="position:absolute;left:318.41px;top:148.96px" class="cls_026">
            <span class="cls_026">login action, creating 72, 73</span>
        </div>
        <div style="position:absolute;left:115.00px;top:159.45px" class="cls_026">
            <span class="cls_026">single-query operation, using 69, 70</span>
        </div>
        <div style="position:absolute;left:318.41px;top:160.36px" class="cls_026">
            <span class="cls_026">login form, creating 71</span>
        </div>
        <div style="position:absolute;left:311.40px;top:171.76px" class="cls_028">
            <span class="cls_028">static helper methods</span>
        </div>
        <div style="position:absolute;left:108.00px;top:178.95px" class="cls_005">
            <span class="cls_005">R</span>
        </div>
        <div style="position:absolute;left:318.41px;top:183.16px" class="cls_026">
            <span class="cls_026">about 70</span>
        </div>
        <div style="position:absolute;left:318.41px;top:194.56px" class="cls_026">
            <span class="cls_026">Model.findById(ObjectID) 70</span>
        </div>
        <div style="position:absolute;left:108.00px;top:202.05px" class="cls_028">
            <span class="cls_028">remove() method 92</span>
        </div>
        <div style="position:absolute;left:318.41px;top:205.96px" class="cls_026">
            <span class="cls_026">Model.findOne(query) 70</span>
        </div>
        <div style="position:absolute;left:108.00px;top:213.45px" class="cls_028">
            <span class="cls_028">res.json() method 74</span>
        </div>
        <div style="position:absolute;left:318.41px;top:217.36px" class="cls_026">
            <span class="cls_026">Model.find(query) 70</span>
        </div>
        <div style="position:absolute;left:108.00px;top:224.85px" class="cls_028">
            <span class="cls_028">re-usable schema plugins</span>
        </div>
        <div style="position:absolute;left:311.40px;top:228.76px" class="cls_028">
            <span class="cls_028">string datatype, Mongoose schema 32</span>
        </div>
        <div style="position:absolute;left:115.00px;top:236.25px" class="cls_026">
            <span class="cls_026">about 117</span>
        </div>
        <div style="position:absolute;left:311.40px;top:240.16px" class="cls_028">
            <span class="cls_028">subdocuments</span>
        </div>
        <div style="position:absolute;left:115.00px;top:247.65px" class="cls_026">
            <span class="cls_026">adding, to existing schema 118</span>
        </div>
        <div style="position:absolute;left:318.41px;top:251.56px" class="cls_026">
            <span class="cls_026">about 110, 111</span>
        </div>
        <div style="position:absolute;left:115.00px;top:259.05px" class="cls_026">
            <span class="cls_026">creating 117</span>
        </div>
        <div style="position:absolute;left:318.41px;top:262.96px" class="cls_026">
            <span class="cls_026">creating 112</span>
        </div>
        <div style="position:absolute;left:115.00px;top:270.45px" class="cls_026">
            <span class="cls_026">external file, using 118</span>
        </div>
        <div style="position:absolute;left:318.41px;top:274.36px" class="cls_026">
            <span class="cls_026">deleting 114</span>
        </div>
        <div style="position:absolute;left:115.00px;top:281.85px" class="cls_026">
            <span class="cls_026">schema middleware, using 119</span>
        </div>
        <div style="position:absolute;left:318.41px;top:285.76px" class="cls_026">
            <span class="cls_026">retrieving 113</span>
        </div>
        <div style="position:absolute;left:115.00px;top:293.25px" class="cls_026">
            <span class="cls_026">sharing, with community 120</span>
        </div>
        <div style="position:absolute;left:318.41px;top:297.16px" class="cls_026">
            <span class="cls_026">saving 112</span>
        </div>
        <div style="position:absolute;left:108.00px;top:304.65px" class="cls_028">
            <span class="cls_028">routes</span>
        </div>
        <div style="position:absolute;left:318.41px;top:308.56px" class="cls_026">
            <span class="cls_026">specific subdocument, accessing 113</span>
        </div>
        <div style="position:absolute;left:115.00px;top:316.05px" class="cls_026">
            <span class="cls_026">for project management 50</span>
        </div>
        <div style="position:absolute;left:318.41px;top:319.96px" class="cls_026">
            <span class="cls_026">validating 112</span>
        </div>
        <div style="position:absolute;left:115.00px;top:327.45px" class="cls_026">
            <span class="cls_026">for user management 50</span>
        </div>
        <div style="position:absolute;left:311.40px;top:331.36px" class="cls_028">
            <span class="cls_028">Supervisor</span>
        </div>
        <div style="position:absolute;left:318.41px;top:342.76px" class="cls_026">
            <span class="cls_026">URL 60</span>
        </div>
        <div style="position:absolute;left:108.00px;top:346.95px" class="cls_005">
            <span class="cls_005">S</span>
        </div>
        <div style="position:absolute;left:311.40px;top:362.26px" class="cls_005">
            <span class="cls_005">T</span>
        </div>
        <div style="position:absolute;left:108.00px;top:370.05px" class="cls_028">
            <span class="cls_028">schema, Mongoose</span>
        </div>
        <div style="position:absolute;left:115.00px;top:381.45px" class="cls_026">
            <span class="cls_026">__v 38</span>
        </div>
        <div style="position:absolute;left:311.40px;top:385.36px" class="cls_028">
            <span class="cls_028">technology stack</span>
        </div>
        <div style="position:absolute;left:115.00px;top:392.85px" class="cls_026">
            <span class="cls_026">about 14, 31</span>
        </div>
        <div style="position:absolute;left:318.40px;top:396.76px" class="cls_026">
            <span class="cls_026">Express 12</span>
        </div>
        <div style="position:absolute;left:115.00px;top:404.25px" class="cls_026">
            <span class="cls_026">code 44</span>
        </div>
        <div style="position:absolute;left:318.40px;top:408.16px" class="cls_026">
            <span class="cls_026">MongoDB 11</span>
        </div>
        <div style="position:absolute;left:115.00px;top:415.65px" class="cls_026">
            <span class="cls_026">collection name, setting 42</span>
        </div>
        <div style="position:absolute;left:318.40px;top:419.56px" class="cls_026">
            <span class="cls_026">Node.js 8</span>
        </div>
        <div style="position:absolute;left:115.00px;top:427.05px" class="cls_026">
            <span class="cls_026">datatypes 32</span>
        </div>
        <div style="position:absolute;left:311.40px;top:430.96px" class="cls_028">
            <span class="cls_028">technology stack, installation</span>
        </div>
        <div style="position:absolute;left:115.00px;top:438.45px" class="cls_026">
            <span class="cls_026">data, validating 37</span>
        </div>
        <div style="position:absolute;left:318.40px;top:442.36px" class="cls_026">
            <span class="cls_026">about 15</span>
        </div>
        <div style="position:absolute;left:115.00px;top:449.85px" class="cls_026">
            <span class="cls_026">default value, setting 36, 37</span>
        </div>
        <div style="position:absolute;left:318.40px;top:453.76px" class="cls_026">
            <span class="cls_026">Express.js, installing 17</span>
        </div>
        <div style="position:absolute;left:115.00px;top:461.25px" class="cls_026">
            <span class="cls_026">field sizes 32</span>
        </div>
        <div style="position:absolute;left:318.40px;top:465.16px" class="cls_026">
            <span class="cls_026">MongoDB, installing 16</span>
        </div>
        <div style="position:absolute;left:115.00px;top:472.65px" class="cls_026">
            <span class="cls_026">location, for writing 35</span>
        </div>
        <div style="position:absolute;left:318.40px;top:476.56px" class="cls_026">
            <span class="cls_026">Mongoose, installing 17</span>
        </div>
        <div style="position:absolute;left:115.00px;top:484.05px" class="cls_026">
            <span class="cls_026">models, building 40</span>
        </div>
        <div style="position:absolute;left:318.40px;top:487.96px" class="cls_026">
            <span class="cls_026">Node.js, installing 15</span>
        </div>
        <div style="position:absolute;left:115.00px;top:495.45px" class="cls_026">
            <span class="cls_026">modifying 36</span>
        </div>
        <div style="position:absolute;left:318.40px;top:499.36px" class="cls_026">
            <span class="cls_026">npm, installing 15</span>
        </div>
        <div style="position:absolute;left:115.00px;top:506.85px" class="cls_026">
            <span class="cls_026">Project schema, creating 39</span>
        </div>
        <div style="position:absolute;left:318.40px;top:510.76px" class="cls_026">
            <span class="cls_026">prerequisites 15</span>
        </div>
        <div style="position:absolute;left:115.00px;top:518.25px" class="cls_026">
            <span class="cls_026">Project schema, improving 40</span>
        </div>
        <div style="position:absolute;left:115.00px;top:529.65px" class="cls_026">
            <span class="cls_026">userSchema 38</span>
        </div>
        <div style="position:absolute;left:311.40px;top:530.26px" class="cls_005">
            <span class="cls_005">U</span>
        </div>
        <div style="position:absolute;left:115.00px;top:541.05px" class="cls_026">
            <span class="cls_026">writing 35</span>
        </div>
        <div style="position:absolute;left:108.00px;top:552.45px" class="cls_028">
            <span class="cls_028">single project, finding</span>
        </div>
        <div style="position:absolute;left:311.40px;top:553.36px" class="cls_028">
            <span class="cls_028">update() method 81, 84</span>
        </div>
        <div style="position:absolute;left:115.00px;top:563.85px" class="cls_026">
            <span class="cls_026">findById, used 78</span>
        </div>
        <div style="position:absolute;left:311.40px;top:564.76px" class="cls_028">
            <span class="cls_028">user</span>
        </div>
        <div style="position:absolute;left:115.00px;top:575.25px" class="cls_026">
            <span class="cls_026">route setup 78, 79</span>
        </div>
        <div style="position:absolute;left:318.40px;top:576.16px" class="cls_026">
            <span class="cls_026">deleting 94</span>
        </div>
        <div style="position:absolute;left:115.00px;top:586.65px" class="cls_026">
            <span class="cls_026">view, creating 80</span>
        </div>
        <div style="position:absolute;left:318.40px;top:587.56px" class="cls_026">
            <span class="cls_026">editing 85</span>
        </div>
        <div style="position:absolute;left:108.00px;top:598.05px" class="cls_028">
            <span class="cls_028">single-query operation</span>
        </div>
        <div style="position:absolute;left:311.40px;top:598.96px" class="cls_028">
            <span class="cls_028">user creating</span>
        </div>
        <div style="position:absolute;left:115.00px;top:609.45px" class="cls_026">
            <span class="cls_026">using 69</span>
        </div>
        <div style="position:absolute;left:318.40px;top:610.36px" class="cls_026">
            <span class="cls_026">confirmation page, displaying 63</span>
        </div>
        <div style="position:absolute;left:108.00px;top:620.85px" class="cls_028">
            <span class="cls_028">single-threaded 8</span>
        </div>
        <div style="position:absolute;left:318.40px;top:621.76px" class="cls_026">
            <span class="cls_026">create project functionality, adding 64</span>
        </div>
        <div style="position:absolute;left:293.14px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 124 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:109874px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background138.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:115.00px;top:114.77px" class="cls_026">
            <span class="cls_026">create user function, creating 60, 61</span>
        </div>
        <div style="position:absolute;left:318.40px;top:114.77px" class="cls_026">
            <span class="cls_026">three-step approach, using 86, 87</span>
        </div>
        <div style="position:absolute;left:115.00px;top:126.17px" class="cls_026">
            <span class="cls_026">data, creating 57</span>
        </div>
        <div style="position:absolute;left:318.40px;top:126.17px" class="cls_026">
            <span class="cls_026">user login, troubleshooting 84</span>
        </div>
        <div style="position:absolute;left:115.00px;top:137.57px" class="cls_026">
            <span class="cls_026">error trapping 62</span>
        </div>
        <div style="position:absolute;left:311.40px;top:137.57px" class="cls_028">
            <span class="cls_028">userSchema</span>
        </div>
        <div style="position:absolute;left:115.00px;top:148.97px" class="cls_026">
            <span class="cls_026">Jade template, adding 58</span>
        </div>
        <div style="position:absolute;left:318.40px;top:148.97px" class="cls_026">
            <span class="cls_026">creating 31</span>
        </div>
        <div style="position:absolute;left:115.00px;top:160.37px" class="cls_026">
            <span class="cls_026">new user form, adding 58</span>
        </div>
        <div style="position:absolute;left:115.00px;top:171.77px" class="cls_026">
            <span class="cls_026">routes 64</span>
        </div>
        <div style="position:absolute;left:311.40px;top:168.47px" class="cls_005">
            <span class="cls_005">V</span>
        </div>
        <div style="position:absolute;left:115.00px;top:183.17px" class="cls_026">
            <span class="cls_026">user session, creating 62</span>
        </div>
        <div style="position:absolute;left:311.40px;top:191.57px" class="cls_028">
            <span class="cls_028">validators, Mongoose</span>
        </div>
        <div style="position:absolute;left:115.00px;top:194.57px" class="cls_026">
            <span class="cls_026">view, linking to URL 59, 60</span>
        </div>
        <div style="position:absolute;left:318.40px;top:202.97px" class="cls_026">
            <span class="cls_026">about 97</span>
        </div>
        <div style="position:absolute;left:108.00px;top:205.97px" class="cls_028">
            <span class="cls_028">user, editing</span>
        </div>
        <div style="position:absolute;left:318.40px;top:214.37px" class="cls_026">
            <span class="cls_026">All SchemaTypes 98</span>
        </div>
        <div style="position:absolute;left:115.00px;top:217.37px" class="cls_026">
            <span class="cls_026">controllers, setting up 85, 86</span>
        </div>
        <div style="position:absolute;left:318.40px;top:225.77px" class="cls_026">
            <span class="cls_026">Number SchemaType 98</span>
        </div>
        <div style="position:absolute;left:115.00px;top:228.77px" class="cls_026">
            <span class="cls_026">form, setting up 85</span>
        </div>
        <div style="position:absolute;left:318.40px;top:237.17px" class="cls_026">
            <span class="cls_026">String SchemaType 98</span>
        </div>
        <div style="position:absolute;left:115.00px;top:240.17px" class="cls_026">
            <span class="cls_026">performing 85</span>
        </div>
        <div style="position:absolute;left:115.00px;top:251.57px" class="cls_026">
            <span class="cls_026">routes, using 85</span>
        </div>
        <div style="position:absolute;left:293.76px;top:665.55px" class="cls_008">
            <span class="cls_008">[</span>
            <span class="cls_020"> 125 </span>
            <span class="cls_008">]</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:110676px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background139.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002">w</span>
            <A HREF="http://www.it-ebooks.info/">ww.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:111478px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background140.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:234.83px;top:179.60px" class="cls_005">
            <span class="cls_005">Thank you for buying</span>
        </div>
        <div style="position:absolute;left:126.90px;top:201.40px" class="cls_032">
            <span class="cls_032">Mongoose for Application Development</span>
        </div>
        <div style="position:absolute;left:108.00px;top:248.00px" class="cls_027">
            <span class="cls_027">About Packt Publishing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:270.90px" class="cls_026">
            <span class="cls_026">Packt, pronounced 'packed', published its first book "</span>
            <span class="cls_030">Mastering phpMyAdmin for Effective</span>
        </div>
        <div style="position:absolute;left:108.00px;top:282.30px" class="cls_030">
            <span class="cls_030">MySQL Management</span>
            <span class="cls_026">" in April 2004 and subsequently continued to specialize in publishing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:293.70px" class="cls_026">
            <span class="cls_026">highly focused books on specific technologies and solutions.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:313.10px" class="cls_026">
            <span class="cls_026">Our books and publications share the experiences of your fellow IT professionals in adapting</span>
        </div>
        <div style="position:absolute;left:108.00px;top:324.50px" class="cls_026">
            <span class="cls_026">and customizing today's systems, applications, and frameworks. Our solution based books</span>
        </div>
        <div style="position:absolute;left:108.00px;top:335.90px" class="cls_026">
            <span class="cls_026">give you the knowledge and power to customize the software and technologies you're using</span>
        </div>
        <div style="position:absolute;left:108.00px;top:347.30px" class="cls_026">
            <span class="cls_026">to get the job done. Packt books are more specific and less general than the IT books you have</span>
        </div>
        <div style="position:absolute;left:108.00px;top:358.70px" class="cls_026">
            <span class="cls_026">seen in the past. Our unique business model allows us to bring you more focused information,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:370.10px" class="cls_026">
            <span class="cls_026">giving you more of what you need to know, and less of what you don't.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:389.50px" class="cls_026">
            <span class="cls_026">Packt is a modern, yet unique publishing company, which focuses on producing quality,</span>
        </div>
        <div style="position:absolute;left:108.00px;top:400.90px" class="cls_026">
            <span class="cls_026">cutting-edge books for communities of developers, administrators, and newbies alike. For</span>
        </div>
        <div style="position:absolute;left:108.00px;top:412.30px" class="cls_026">
            <span class="cls_026">more information, please visit our website: </span>
            <span class="cls_023">www.packtpub.com</span>
            <span class="cls_026">.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:441.40px" class="cls_027">
            <span class="cls_027">About Packt Open Source</span>
        </div>
        <div style="position:absolute;left:108.00px;top:464.30px" class="cls_026">
            <span class="cls_026">In 2010, Packt launched two new brands, Packt Open Source and Packt Enterprise, in order to</span>
        </div>
        <div style="position:absolute;left:108.00px;top:475.70px" class="cls_026">
            <span class="cls_026">continue its focus on specialization. This book is part of the Packt Open Source brand, home</span>
        </div>
        <div style="position:absolute;left:108.00px;top:487.10px" class="cls_026">
            <span class="cls_026">to books published on software built around Open Source licences, and offering information</span>
        </div>
        <div style="position:absolute;left:108.00px;top:498.50px" class="cls_026">
            <span class="cls_026">to anybody from advanced developers to budding web designers. The Open Source brand</span>
        </div>
        <div style="position:absolute;left:108.00px;top:509.90px" class="cls_026">
            <span class="cls_026">also runs Packt's Open Source Royalty Scheme, by which Packt gives a royalty to each Open</span>
        </div>
        <div style="position:absolute;left:108.00px;top:521.30px" class="cls_026">
            <span class="cls_026">Source project about whose software a book is sold.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:550.40px" class="cls_027">
            <span class="cls_027">Writing for Packt</span>
        </div>
        <div style="position:absolute;left:108.00px;top:573.30px" class="cls_026">
            <span class="cls_026">We welcome all inquiries from people who are interested in authoring. Book proposals</span>
        </div>
        <div style="position:absolute;left:108.00px;top:584.70px" class="cls_026">
            <span class="cls_026">should be sent to author@packtpub.com. If your book idea is still at an early stage and you</span>
        </div>
        <div style="position:absolute;left:108.00px;top:596.10px" class="cls_026">
            <span class="cls_026">would like to discuss it first before writing a formal book proposal, contact us; one of our</span>
        </div>
        <div style="position:absolute;left:108.00px;top:607.50px" class="cls_026">
            <span class="cls_026">commissioning editors will get in touch with you.</span>
        </div>
        <div style="position:absolute;left:108.00px;top:623.22px" class="cls_026">
            <span class="cls_026">We're not just looking for published authors; if you have strong technical skills but no writing</span>
        </div>
        <div style="position:absolute;left:108.00px;top:634.62px" class="cls_026">
            <span class="cls_026">experience, our experienced editors can help you develop a writing career, or simply get some</span>
        </div>
        <div style="position:absolute;left:108.00px;top:646.02px" class="cls_026">
            <span class="cls_026">additional reward for your expertise.</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:112280px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background141.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:271.55px;top:175.78px" class="cls_005">
            <span class="cls_005">Ext JS 4 Web Application</span>
        </div>
        <div style="position:absolute;left:271.55px;top:192.58px" class="cls_005">
            <span class="cls_005">Development Cookbook</span>
        </div>
        <div style="position:absolute;left:271.55px;top:211.48px" class="cls_026">
            <span class="cls_026">ISBN: 978-1-84951-686-0</span>
        </div>
        <div style="position:absolute;left:403.47px;top:211.48px" class="cls_026">
            <span class="cls_026">Paperback: 488 pages</span>
        </div>
        <div style="position:absolute;left:271.55px;top:230.88px" class="cls_026">
            <span class="cls_026">Over 110 easy-to-follow recipes backed up with</span>
        </div>
        <div style="position:absolute;left:271.55px;top:242.28px" class="cls_026">
            <span class="cls_026">real-life examples, walking you through basic Ext</span>
        </div>
        <div style="position:absolute;left:271.55px;top:253.68px" class="cls_026">
            <span class="cls_026">JS features to advanced application design using</span>
        </div>
        <div style="position:absolute;left:271.55px;top:265.08px" class="cls_026">
            <span class="cls_026">Sencha's Ext JS</span>
        </div>
        <div style="position:absolute;left:289.55px;top:284.38px" class="cls_033">
            <span class="cls_033">1.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:284.38px" class="cls_033">
            <span class="cls_033">Learn how to build Rich Internet Applications</span>
        </div>
        <div style="position:absolute;left:307.55px;top:295.18px" class="cls_033">
            <span class="cls_033">with the latest version of the Ext JS framework</span>
        </div>
        <div style="position:absolute;left:307.55px;top:305.98px" class="cls_033">
            <span class="cls_033">in a cookbook style</span>
        </div>
        <div style="position:absolute;left:289.55px;top:324.78px" class="cls_033">
            <span class="cls_033">2.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:324.78px" class="cls_033">
            <span class="cls_033">From creating forms to theming your</span>
        </div>
        <div style="position:absolute;left:307.55px;top:335.58px" class="cls_033">
            <span class="cls_033">interface, you will learn the building blocks for</span>
        </div>
        <div style="position:absolute;left:307.55px;top:346.38px" class="cls_033">
            <span class="cls_033">developing the perfect web application</span>
        </div>
        <div style="position:absolute;left:289.55px;top:365.18px" class="cls_033">
            <span class="cls_033">3.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:365.18px" class="cls_033">
            <span class="cls_033">Easy to follow recipes step through practical</span>
        </div>
        <div style="position:absolute;left:307.55px;top:375.98px" class="cls_033">
            <span class="cls_033">and detailed examples which are all fully</span>
        </div>
        <div style="position:absolute;left:307.55px;top:386.78px" class="cls_033">
            <span class="cls_033">backed up with code, illustrations, and tips</span>
        </div>
        <div style="position:absolute;left:271.55px;top:420.30px" class="cls_005">
            <span class="cls_005">OGRE 3D 1.7 Application</span>
        </div>
        <div style="position:absolute;left:271.55px;top:437.10px" class="cls_005">
            <span class="cls_005">Development Cookbook</span>
        </div>
        <div style="position:absolute;left:271.55px;top:456.00px" class="cls_026">
            <span class="cls_026">ISBN: 978-1-84951-456-9</span>
        </div>
        <div style="position:absolute;left:401.09px;top:456.00px" class="cls_026">
            <span class="cls_026">Paperback: 306 pages</span>
        </div>
        <div style="position:absolute;left:271.55px;top:475.40px" class="cls_026">
            <span class="cls_026">Over 50 recipes to provide world-class 3D</span>
        </div>
        <div style="position:absolute;left:271.55px;top:486.80px" class="cls_026">
            <span class="cls_026">graphicssolutions with OGRE 3D</span>
        </div>
        <div style="position:absolute;left:289.55px;top:506.10px" class="cls_033">
            <span class="cls_033">1.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:506.10px" class="cls_033">
            <span class="cls_033">Dive into the advanced features of OGRE 3D</span>
        </div>
        <div style="position:absolute;left:307.55px;top:516.90px" class="cls_033">
            <span class="cls_033">such as scene querying and visibility analysis</span>
        </div>
        <div style="position:absolute;left:289.55px;top:535.70px" class="cls_033">
            <span class="cls_033">2.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:535.70px" class="cls_033">
            <span class="cls_033">Give stunning effects to your application</span>
        </div>
        <div style="position:absolute;left:307.55px;top:546.50px" class="cls_033">
            <span class="cls_033">through suitable use of lights, special effects,</span>
        </div>
        <div style="position:absolute;left:307.55px;top:557.30px" class="cls_033">
            <span class="cls_033">and views</span>
        </div>
        <div style="position:absolute;left:289.55px;top:576.10px" class="cls_033">
            <span class="cls_033">3.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:576.10px" class="cls_033">
            <span class="cls_033">Surf through the full spectrum of</span>
        </div>
        <div style="position:absolute;left:307.55px;top:586.90px" class="cls_033">
            <span class="cls_033">OGRE 3D animation methods and insert</span>
        </div>
        <div style="position:absolute;left:307.55px;top:597.70px" class="cls_033">
            <span class="cls_033">flashy multimedia</span>
        </div>
        <div style="position:absolute;left:153.06px;top:644.76px" class="cls_018">
            <span class="cls_018">Please check </span>
            <A HREF="http://www.packtpub.com/">www.PacktPub.com</A>
            </span>
            <span class="cls_018"> for information on our titles</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>
    <div style="position:absolute;left:50%;margin-left:-306px;top:113082px;width:612px;height:792px;border-style:outset;overflow:hidden">
        <div style="position:absolute;left:0px;top:0px">
            <img src="d2ff0740-0c0e-11e8-b174-0cc47a792c0a_id_d2ff0740-0c0e-11e8-b174-0cc47a792c0a_files/background142.jpg" width=612
                height=792>
        </div>
        <div style="position:absolute;left:271.55px;top:175.78px" class="cls_005">
            <span class="cls_005">web2py Application Development</span>
        </div>
        <div style="position:absolute;left:271.55px;top:192.58px" class="cls_005">
            <span class="cls_005">Cookbook</span>
        </div>
        <div style="position:absolute;left:271.55px;top:211.48px" class="cls_026">
            <span class="cls_026">ISBN: 978-1-84951-546-7</span>
        </div>
        <div style="position:absolute;left:401.09px;top:211.48px" class="cls_026">
            <span class="cls_026">Paperback: 364 pages</span>
        </div>
        <div style="position:absolute;left:271.55px;top:230.88px" class="cls_026">
            <span class="cls_026">Over 110 recipes to master this full-stack Python</span>
        </div>
        <div style="position:absolute;left:271.55px;top:242.28px" class="cls_026">
            <span class="cls_026">web framework</span>
        </div>
        <div style="position:absolute;left:289.55px;top:261.58px" class="cls_033">
            <span class="cls_033">1.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:261.58px" class="cls_033">
            <span class="cls_033">Take your web2py skills to the next level</span>
        </div>
        <div style="position:absolute;left:307.55px;top:272.38px" class="cls_033">
            <span class="cls_033">by dipping into delicious, usable recipes in</span>
        </div>
        <div style="position:absolute;left:307.55px;top:283.18px" class="cls_033">
            <span class="cls_033">this cookbook</span>
        </div>
        <div style="position:absolute;left:289.55px;top:301.98px" class="cls_033">
            <span class="cls_033">2.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:301.98px" class="cls_033">
            <span class="cls_033">Learn advanced web2py usage from building</span>
        </div>
        <div style="position:absolute;left:307.55px;top:312.78px" class="cls_033">
            <span class="cls_033">advanced forms to creating PDF reports</span>
        </div>
        <div style="position:absolute;left:289.55px;top:331.58px" class="cls_033">
            <span class="cls_033">3.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:331.58px" class="cls_033">
            <span class="cls_033">Written by developers of the web2py project</span>
        </div>
        <div style="position:absolute;left:307.55px;top:342.38px" class="cls_033">
            <span class="cls_033">with plenty of code examples for interesting</span>
        </div>
        <div style="position:absolute;left:307.55px;top:353.18px" class="cls_033">
            <span class="cls_033">and comprehensive learning</span>
        </div>
        <div style="position:absolute;left:271.55px;top:420.30px" class="cls_005">
            <span class="cls_005">CouchDB and PHP Web</span>
        </div>
        <div style="position:absolute;left:271.55px;top:437.10px" class="cls_005">
            <span class="cls_005">Development Beginner's Guide</span>
        </div>
        <div style="position:absolute;left:271.55px;top:456.00px" class="cls_026">
            <span class="cls_026">ISBN: 978-1-84951-358-6</span>
        </div>
        <div style="position:absolute;left:401.09px;top:456.00px" class="cls_026">
            <span class="cls_026">Paperback: 304 pages</span>
        </div>
        <div style="position:absolute;left:271.55px;top:475.40px" class="cls_026">
            <span class="cls_026">Get your PHP application from conception to</span>
        </div>
        <div style="position:absolute;left:271.55px;top:486.80px" class="cls_026">
            <span class="cls_026">deployment by leveraging CouchDB's robust features</span>
        </div>
        <div style="position:absolute;left:289.55px;top:506.10px" class="cls_033">
            <span class="cls_033">1.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:506.10px" class="cls_033">
            <span class="cls_033">Build and deploy a flexible Social Networking</span>
        </div>
        <div style="position:absolute;left:307.55px;top:516.90px" class="cls_033">
            <span class="cls_033">application using PHP and leveraging key</span>
        </div>
        <div style="position:absolute;left:307.55px;top:527.70px" class="cls_033">
            <span class="cls_033">features of CouchDB to do the heavy lifting</span>
        </div>
        <div style="position:absolute;left:289.55px;top:546.50px" class="cls_033">
            <span class="cls_033">2.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:546.50px" class="cls_033">
            <span class="cls_033">Explore the features and functionality</span>
        </div>
        <div style="position:absolute;left:307.55px;top:557.30px" class="cls_033">
            <span class="cls_033">of CouchDB, by taking a deep look into</span>
        </div>
        <div style="position:absolute;left:307.55px;top:568.10px" class="cls_033">
            <span class="cls_033">Documents, Views, Replication, and</span>
        </div>
        <div style="position:absolute;left:307.55px;top:578.90px" class="cls_033">
            <span class="cls_033">much more.</span>
        </div>
        <div style="position:absolute;left:289.55px;top:597.70px" class="cls_033">
            <span class="cls_033">3.</span>
        </div>
        <div style="position:absolute;left:307.55px;top:597.70px" class="cls_033">
            <span class="cls_033">Conceptualize a lightweight PHP framework</span>
        </div>
        <div style="position:absolute;left:307.55px;top:608.50px" class="cls_033">
            <span class="cls_033">from scratch and write code that can easily port</span>
        </div>
        <div style="position:absolute;left:307.55px;top:619.30px" class="cls_033">
            <span class="cls_033">to other frameworks</span>
        </div>
        <div style="position:absolute;left:153.06px;top:645.00px" class="cls_018">
            <span class="cls_018">Please check </span>
            <A HREF="http://www.packtpub.com/">www.PacktPub.com</A>
            </span>
            <span class="cls_018"> for information on our titles</span>
        </div>
        <div style="position:absolute;left:264.00px;top:775.00px" class="cls_002">
            <span class="cls_002"> </span>
            <A HREF="http://www.it-ebooks.info/">www.it-ebooks.info</A>
        </div>
    </div>

</body>

</html>